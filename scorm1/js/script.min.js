var scormEnabled=true;!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(e){return!(!e||"undefined"==typeof e.length)}function t(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],c(e,this)}function r(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(r){return void f(n.promise,r)}i(n.promise,o)}else(1===e._state?i:f)(n.promise,e._value)})):e._deferreds.push(n)}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,void u(e);if("function"==typeof t)return void c(function(e,n){return function(){e.apply(n,arguments)}}(t,n),e)}e._state=1,e._value=n,u(e)}catch(r){f(e,r)}}function f(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;t>n;n++)r(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,f(n,e))})}catch(o){if(t)return;t=!0,f(n,o)}}var a=setTimeout;o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return r(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,n,o)),o},o.prototype["finally"]=e,o.all=function(e){return new o(function(t,o){function r(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var u=n.then;if("function"==typeof u)return void u.call(n,function(n){r(e,n)},o)}i[e]=n,0==--f&&t(i)}catch(c){o(c)}}if(!n(e))return o(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var f=i.length,u=0;i.length>u;u++)r(u,i[u])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(t,r){if(!n(e))return r(new TypeError("Promise.race accepts an array"));for(var i=0,f=e.length;f>i;i++)o.resolve(e[i]).then(t,r)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=e):l.Promise=o});

!function(){"use strict";function o(){var o=window,t=document;if(!("scrollBehavior"in t.documentElement.style&&!0!==o.__forceSmoothScrollPolyfill__)){var l,e=o.HTMLElement||o.Element,r=468,i={scroll:o.scroll||o.scrollTo,scrollBy:o.scrollBy,elementScroll:e.prototype.scroll||n,scrollIntoView:e.prototype.scrollIntoView},s=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now,c=(l=o.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(l)?1:0);o.scroll=o.scrollTo=function(){void 0!==arguments[0]&&(!0!==f(arguments[0])?h.call(o,t.body,void 0!==arguments[0].left?~~arguments[0].left:o.scrollX||o.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:o.scrollY||o.pageYOffset):i.scroll.call(o,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:o.scrollX||o.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:o.scrollY||o.pageYOffset))},o.scrollBy=function(){void 0!==arguments[0]&&(f(arguments[0])?i.scrollBy.call(o,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):h.call(o,t.body,~~arguments[0].left+(o.scrollX||o.pageXOffset),~~arguments[0].top+(o.scrollY||o.pageYOffset)))},e.prototype.scroll=e.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==f(arguments[0])){var o=arguments[0].left,t=arguments[0].top;h.call(this,this,void 0===o?this.scrollLeft:~~o,void 0===t?this.scrollTop:~~t)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},e.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==f(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},e.prototype.scrollIntoView=function(){if(!0!==f(arguments[0])){var l=function(o){for(;o!==t.body&&!1===(e=p(l=o,"Y")&&a(l,"Y"),r=p(l,"X")&&a(l,"X"),e||r);)o=o.parentNode||o.host;var l,e,r;return o}(this),e=l.getBoundingClientRect(),r=this.getBoundingClientRect();l!==t.body?(h.call(this,l,l.scrollLeft+r.left-e.left,l.scrollTop+r.top-e.top),"fixed"!==o.getComputedStyle(l).position&&o.scrollBy({left:e.left,top:e.top,behavior:"smooth"})):o.scrollBy({left:r.left,top:r.top,behavior:"smooth"})}else i.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function n(o,t){this.scrollLeft=o,this.scrollTop=t}function f(o){if(null===o||"object"!=typeof o||void 0===o.behavior||"auto"===o.behavior||"instant"===o.behavior)return!0;if("object"==typeof o&&"smooth"===o.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+o.behavior+" is not a valid value for enumeration ScrollBehavior.")}function p(o,t){return"Y"===t?o.clientHeight+c<o.scrollHeight:"X"===t?o.clientWidth+c<o.scrollWidth:void 0}function a(t,l){var e=o.getComputedStyle(t,null)["overflow"+l];return"auto"===e||"scroll"===e}function d(t){var l,e,i,c,n=(s()-t.startTime)/r;c=n=n>1?1:n,l=.5*(1-Math.cos(Math.PI*c)),e=t.startX+(t.x-t.startX)*l,i=t.startY+(t.y-t.startY)*l,t.method.call(t.scrollable,e,i),e===t.x&&i===t.y||o.requestAnimationFrame(d.bind(o,t))}function h(l,e,r){var c,f,p,a,h=s();l===t.body?(c=o,f=o.scrollX||o.pageXOffset,p=o.scrollY||o.pageYOffset,a=i.scroll):(c=l,f=l.scrollLeft,p=l.scrollTop,a=n),d({scrollable:c,method:a,startTime:h,startX:f,startY:p,x:e,y:r})}}"object"==typeof exports&&"undefined"!=typeof module?module.exports={polyfill:o}:o()}();
/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/intersection-observer@0.12.2/intersection-observer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(){"use strict";if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var t=function(t){for(var e=window.document,o=i(e);o;)o=i(e=o.ownerDocument);return e}(),e=[],o=null,n=null;s.prototype.THROTTLE_TIMEOUT=100,s.prototype.POLL_INTERVAL=null,s.prototype.USE_MUTATION_OBSERVER=!0,s._setupCrossOriginUpdater=function(){return o||(o=function(t,o){n=t&&o?l(t,o):{top:0,bottom:0,left:0,right:0,width:0,height:0},e.forEach((function(t){t._checkForIntersections()}))}),o},s._resetCrossOriginUpdater=function(){o=null,n=null},s.prototype.observe=function(t){if(!this._observationTargets.some((function(e){return e.element==t}))){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(t.ownerDocument),this._checkForIntersections()}},s.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter((function(e){return e.element!=t})),this._unmonitorIntersections(t.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},s.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},s.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},s.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter((function(t,e,o){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==o[e-1]}))},s.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map((function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}}));return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},s.prototype._monitorIntersections=function(e){var o=e.defaultView;if(o&&-1==this._monitoringDocuments.indexOf(e)){var n=this._checkForIntersections,r=null,s=null;this.POLL_INTERVAL?r=o.setInterval(n,this.POLL_INTERVAL):(h(o,"resize",n,!0),h(e,"scroll",n,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in o&&(s=new o.MutationObserver(n)).observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(e),this._monitoringUnsubscribes.push((function(){var t=e.defaultView;t&&(r&&t.clearInterval(r),c(t,"resize",n,!0)),c(e,"scroll",n,!0),s&&s.disconnect()}));var u=this.root&&(this.root.ownerDocument||this.root)||t;if(e!=u){var a=i(e);a&&this._monitorIntersections(a.ownerDocument)}}},s.prototype._unmonitorIntersections=function(e){var o=this._monitoringDocuments.indexOf(e);if(-1!=o){var n=this.root&&(this.root.ownerDocument||this.root)||t,r=this._observationTargets.some((function(t){var o=t.element.ownerDocument;if(o==e)return!0;for(;o&&o!=n;){var r=i(o);if((o=r&&r.ownerDocument)==e)return!0}return!1}));if(!r){var s=this._monitoringUnsubscribes[o];if(this._monitoringDocuments.splice(o,1),this._monitoringUnsubscribes.splice(o,1),s(),e!=n){var h=i(e);h&&this._unmonitorIntersections(h.ownerDocument)}}}},s.prototype._unmonitorAllIntersections=function(){var t=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var e=0;e<t.length;e++)t[e]()},s.prototype._checkForIntersections=function(){if(this.root||!o||n){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach((function(n){var i=n.element,s=u(i),h=this._rootContainsTarget(i),c=n.entry,a=t&&h&&this._computeTargetAndRootIntersection(i,s,e),l=null;this._rootContainsTarget(i)?o&&!this.root||(l=e):l={top:0,bottom:0,left:0,right:0,width:0,height:0};var f=n.entry=new r({time:window.performance&&performance.now&&performance.now(),target:i,boundingClientRect:s,rootBounds:l,intersectionRect:a});c?t&&h?this._hasCrossedThreshold(c,f)&&this._queuedEntries.push(f):c&&c.isIntersecting&&this._queuedEntries.push(f):this._queuedEntries.push(f)}),this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},s.prototype._computeTargetAndRootIntersection=function(e,i,r){if("none"!=window.getComputedStyle(e).display){for(var s,h,c,a,f,d,g,m,v=i,_=p(e),b=!1;!b&&_;){var w=null,y=1==_.nodeType?window.getComputedStyle(_):{};if("none"==y.display)return null;if(_==this.root||9==_.nodeType)if(b=!0,_==this.root||_==t)o&&!this.root?!n||0==n.width&&0==n.height?(_=null,w=null,v=null):w=n:w=r;else{var I=p(_),E=I&&u(I),T=I&&this._computeTargetAndRootIntersection(I,E,r);E&&T?(_=I,w=l(E,T)):(_=null,v=null)}else{var R=_.ownerDocument;_!=R.body&&_!=R.documentElement&&"visible"!=y.overflow&&(w=u(_))}if(w&&(s=w,h=v,c=void 0,a=void 0,f=void 0,d=void 0,g=void 0,m=void 0,c=Math.max(s.top,h.top),a=Math.min(s.bottom,h.bottom),f=Math.max(s.left,h.left),d=Math.min(s.right,h.right),m=a-c,v=(g=d-f)>=0&&m>=0&&{top:c,bottom:a,left:f,right:d,width:g,height:m}||null),!v)break;_=_&&p(_)}return v}},s.prototype._getRootRect=function(){var e;if(this.root&&!d(this.root))e=u(this.root);else{var o=d(this.root)?this.root:t,n=o.documentElement,i=o.body;e={top:0,left:0,right:n.clientWidth||i.clientWidth,width:n.clientWidth||i.clientWidth,bottom:n.clientHeight||i.clientHeight,height:n.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(e)},s.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map((function(e,o){return"px"==e.unit?e.value:e.value*(o%2?t.width:t.height)/100})),o={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return o.width=o.right-o.left,o.height=o.bottom-o.top,o},s.prototype._hasCrossedThreshold=function(t,e){var o=t&&t.isIntersecting?t.intersectionRatio||0:-1,n=e.isIntersecting?e.intersectionRatio||0:-1;if(o!==n)for(var i=0;i<this.thresholds.length;i++){var r=this.thresholds[i];if(r==o||r==n||r<o!=r<n)return!0}},s.prototype._rootIsInDom=function(){return!this.root||f(t,this.root)},s.prototype._rootContainsTarget=function(e){var o=this.root&&(this.root.ownerDocument||this.root)||t;return f(o,e)&&(!this.root||o==e.ownerDocument)},s.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this)},s.prototype._unregisterInstance=function(){var t=e.indexOf(this);-1!=t&&e.splice(t,1)},window.IntersectionObserver=s,window.IntersectionObserverEntry=r}function i(t){try{return t.defaultView&&t.defaultView.frameElement||null}catch(t){return null}}function r(t){this.time=t.time,this.target=t.target,this.rootBounds=a(t.rootBounds),this.boundingClientRect=a(t.boundingClientRect),this.intersectionRect=a(t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,o=e.width*e.height,n=this.intersectionRect,i=n.width*n.height;this.intersectionRatio=o?Number((i/o).toFixed(4)):this.isIntersecting?1:0}function s(t,e){var o,n,i,r=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(r.root&&1!=r.root.nodeType&&9!=r.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(o=this._checkForIntersections.bind(this),n=this.THROTTLE_TIMEOUT,i=null,function(){i||(i=setTimeout((function(){o(),i=null}),n))}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(r.rootMargin),this.thresholds=this._initThresholds(r.threshold),this.root=r.root||null,this.rootMargin=this._rootMarginValues.map((function(t){return t.value+t.unit})).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function h(t,e,o,n){"function"==typeof t.addEventListener?t.addEventListener(e,o,n||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,o)}function c(t,e,o,n){"function"==typeof t.removeEventListener?t.removeEventListener(e,o,n||!1):"function"==typeof t.detachEvent&&t.detachEvent("on"+e,o)}function u(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function a(t){return!t||"x"in t?t:{top:t.top,y:t.top,bottom:t.bottom,left:t.left,x:t.left,right:t.right,width:t.width,height:t.height}}function l(t,e){var o=e.top-t.top,n=e.left-t.left;return{top:o,left:n,height:e.height,width:e.width,bottom:o+e.height,right:n+e.width}}function f(t,e){for(var o=e;o;){if(o==t)return!0;o=p(o)}return!1}function p(e){var o=e.parentNode;return 9==e.nodeType&&e!=t?i(e):(o&&o.assignedSlot&&(o=o.assignedSlot.parentNode),o&&11==o.nodeType&&o.host?o.host:o)}function d(t){return t&&9===t.nodeType}}();
//# sourceMappingURL=/sm/53a8f430304314e601f512c451d4d00d99f3fa0d435de24bec9a6bfb1a7db02d.map
/*!
 * Vue.js v2.6.11
 * (c) 2014-2019 Evan You
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vue=t()}(this,function(){"use strict";var e=Object.freeze({});function t(e){return null==e}function n(e){return null!=e}function r(e){return!0===e}function i(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}function o(e){return null!==e&&"object"==typeof e}var a=Object.prototype.toString;function s(e){return"[object Object]"===a.call(e)}function c(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function u(e){return n(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function l(e){return null==e?"":Array.isArray(e)||s(e)&&e.toString===a?JSON.stringify(e,null,2):String(e)}function f(e){var t=parseFloat(e);return isNaN(t)?e:t}function p(e,t){for(var n=Object.create(null),r=e.split(","),i=0;i<r.length;i++)n[r[i]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}var d=p("slot,component",!0),v=p("key,ref,slot,slot-scope,is");function h(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}var m=Object.prototype.hasOwnProperty;function y(e,t){return m.call(e,t)}function g(e){var t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}var _=/-(\w)/g,b=g(function(e){return e.replace(_,function(e,t){return t?t.toUpperCase():""})}),$=g(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}),w=/\B([A-Z])/g,C=g(function(e){return e.replace(w,"-$1").toLowerCase()});var x=Function.prototype.bind?function(e,t){return e.bind(t)}:function(e,t){function n(n){var r=arguments.length;return r?r>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n};function k(e,t){t=t||0;for(var n=e.length-t,r=new Array(n);n--;)r[n]=e[n+t];return r}function A(e,t){for(var n in t)e[n]=t[n];return e}function O(e){for(var t={},n=0;n<e.length;n++)e[n]&&A(t,e[n]);return t}function S(e,t,n){}var T=function(e,t,n){return!1},E=function(e){return e};function N(e,t){if(e===t)return!0;var n=o(e),r=o(t);if(!n||!r)return!n&&!r&&String(e)===String(t);try{var i=Array.isArray(e),a=Array.isArray(t);if(i&&a)return e.length===t.length&&e.every(function(e,n){return N(e,t[n])});if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(i||a)return!1;var s=Object.keys(e),c=Object.keys(t);return s.length===c.length&&s.every(function(n){return N(e[n],t[n])})}catch(e){return!1}}function j(e,t){for(var n=0;n<e.length;n++)if(N(e[n],t))return n;return-1}function D(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var L="data-server-rendered",M=["component","directive","filter"],I=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],F={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:T,isReservedAttr:T,isUnknownElement:T,getTagNamespace:S,parsePlatformTagName:E,mustUseProp:T,async:!0,_lifecycleHooks:I},P=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function R(e,t,n,r){Object.defineProperty(e,t,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var H=new RegExp("[^"+P.source+".$_\\d]");var B,U="__proto__"in{},z="undefined"!=typeof window,V="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,K=V&&WXEnvironment.platform.toLowerCase(),J=z&&window.navigator.userAgent.toLowerCase(),q=J&&/msie|trident/.test(J),W=J&&J.indexOf("msie 9.0")>0,Z=J&&J.indexOf("edge/")>0,G=(J&&J.indexOf("android"),J&&/iphone|ipad|ipod|ios/.test(J)||"ios"===K),X=(J&&/chrome\/\d+/.test(J),J&&/phantomjs/.test(J),J&&J.match(/firefox\/(\d+)/)),Y={}.watch,Q=!1;if(z)try{var ee={};Object.defineProperty(ee,"passive",{get:function(){Q=!0}}),window.addEventListener("test-passive",null,ee)}catch(e){}var te=function(){return void 0===B&&(B=!z&&!V&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),B},ne=z&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function re(e){return"function"==typeof e&&/native code/.test(e.toString())}var ie,oe="undefined"!=typeof Symbol&&re(Symbol)&&"undefined"!=typeof Reflect&&re(Reflect.ownKeys);ie="undefined"!=typeof Set&&re(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var ae=S,se=0,ce=function(){this.id=se++,this.subs=[]};ce.prototype.addSub=function(e){this.subs.push(e)},ce.prototype.removeSub=function(e){h(this.subs,e)},ce.prototype.depend=function(){ce.target&&ce.target.addDep(this)},ce.prototype.notify=function(){for(var e=this.subs.slice(),t=0,n=e.length;t<n;t++)e[t].update()},ce.target=null;var ue=[];function le(e){ue.push(e),ce.target=e}function fe(){ue.pop(),ce.target=ue[ue.length-1]}var pe=function(e,t,n,r,i,o,a,s){this.tag=e,this.data=t,this.children=n,this.text=r,this.elm=i,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=a,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},de={child:{configurable:!0}};de.child.get=function(){return this.componentInstance},Object.defineProperties(pe.prototype,de);var ve=function(e){void 0===e&&(e="");var t=new pe;return t.text=e,t.isComment=!0,t};function he(e){return new pe(void 0,void 0,void 0,String(e))}function me(e){var t=new pe(e.tag,e.data,e.children&&e.children.slice(),e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.asyncMeta=e.asyncMeta,t.isCloned=!0,t}var ye=Array.prototype,ge=Object.create(ye);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(e){var t=ye[e];R(ge,e,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var i,o=t.apply(this,n),a=this.__ob__;switch(e){case"push":case"unshift":i=n;break;case"splice":i=n.slice(2)}return i&&a.observeArray(i),a.dep.notify(),o})});var _e=Object.getOwnPropertyNames(ge),be=!0;function $e(e){be=e}var we=function(e){var t;this.value=e,this.dep=new ce,this.vmCount=0,R(e,"__ob__",this),Array.isArray(e)?(U?(t=ge,e.__proto__=t):function(e,t,n){for(var r=0,i=n.length;r<i;r++){var o=n[r];R(e,o,t[o])}}(e,ge,_e),this.observeArray(e)):this.walk(e)};function Ce(e,t){var n;if(o(e)&&!(e instanceof pe))return y(e,"__ob__")&&e.__ob__ instanceof we?n=e.__ob__:be&&!te()&&(Array.isArray(e)||s(e))&&Object.isExtensible(e)&&!e._isVue&&(n=new we(e)),t&&n&&n.vmCount++,n}function xe(e,t,n,r,i){var o=new ce,a=Object.getOwnPropertyDescriptor(e,t);if(!a||!1!==a.configurable){var s=a&&a.get,c=a&&a.set;s&&!c||2!==arguments.length||(n=e[t]);var u=!i&&Ce(n);Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=s?s.call(e):n;return ce.target&&(o.depend(),u&&(u.dep.depend(),Array.isArray(t)&&function e(t){for(var n=void 0,r=0,i=t.length;r<i;r++)(n=t[r])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&e(n)}(t))),t},set:function(t){var r=s?s.call(e):n;t===r||t!=t&&r!=r||s&&!c||(c?c.call(e,t):n=t,u=!i&&Ce(t),o.notify())}})}}function ke(e,t,n){if(Array.isArray(e)&&c(t))return e.length=Math.max(e.length,t),e.splice(t,1,n),n;if(t in e&&!(t in Object.prototype))return e[t]=n,n;var r=e.__ob__;return e._isVue||r&&r.vmCount?n:r?(xe(r.value,t,n),r.dep.notify(),n):(e[t]=n,n)}function Ae(e,t){if(Array.isArray(e)&&c(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||y(e,t)&&(delete e[t],n&&n.dep.notify())}}we.prototype.walk=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)xe(e,t[n])},we.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)Ce(e[t])};var Oe=F.optionMergeStrategies;function Se(e,t){if(!t)return e;for(var n,r,i,o=oe?Reflect.ownKeys(t):Object.keys(t),a=0;a<o.length;a++)"__ob__"!==(n=o[a])&&(r=e[n],i=t[n],y(e,n)?r!==i&&s(r)&&s(i)&&Se(r,i):ke(e,n,i));return e}function Te(e,t,n){return n?function(){var r="function"==typeof t?t.call(n,n):t,i="function"==typeof e?e.call(n,n):e;return r?Se(r,i):i}:t?e?function(){return Se("function"==typeof t?t.call(this,this):t,"function"==typeof e?e.call(this,this):e)}:t:e}function Ee(e,t){var n=t?e?e.concat(t):Array.isArray(t)?t:[t]:e;return n?function(e){for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}(n):n}function Ne(e,t,n,r){var i=Object.create(e||null);return t?A(i,t):i}Oe.data=function(e,t,n){return n?Te(e,t,n):t&&"function"!=typeof t?e:Te(e,t)},I.forEach(function(e){Oe[e]=Ee}),M.forEach(function(e){Oe[e+"s"]=Ne}),Oe.watch=function(e,t,n,r){if(e===Y&&(e=void 0),t===Y&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var i={};for(var o in A(i,e),t){var a=i[o],s=t[o];a&&!Array.isArray(a)&&(a=[a]),i[o]=a?a.concat(s):Array.isArray(s)?s:[s]}return i},Oe.props=Oe.methods=Oe.inject=Oe.computed=function(e,t,n,r){if(!e)return t;var i=Object.create(null);return A(i,e),t&&A(i,t),i},Oe.provide=Te;var je=function(e,t){return void 0===t?e:t};function De(e,t,n){if("function"==typeof t&&(t=t.options),function(e,t){var n=e.props;if(n){var r,i,o={};if(Array.isArray(n))for(r=n.length;r--;)"string"==typeof(i=n[r])&&(o[b(i)]={type:null});else if(s(n))for(var a in n)i=n[a],o[b(a)]=s(i)?i:{type:i};e.props=o}}(t),function(e,t){var n=e.inject;if(n){var r=e.inject={};if(Array.isArray(n))for(var i=0;i<n.length;i++)r[n[i]]={from:n[i]};else if(s(n))for(var o in n){var a=n[o];r[o]=s(a)?A({from:o},a):{from:a}}}}(t),function(e){var t=e.directives;if(t)for(var n in t){var r=t[n];"function"==typeof r&&(t[n]={bind:r,update:r})}}(t),!t._base&&(t.extends&&(e=De(e,t.extends,n)),t.mixins))for(var r=0,i=t.mixins.length;r<i;r++)e=De(e,t.mixins[r],n);var o,a={};for(o in e)c(o);for(o in t)y(e,o)||c(o);function c(r){var i=Oe[r]||je;a[r]=i(e[r],t[r],n,r)}return a}function Le(e,t,n,r){if("string"==typeof n){var i=e[t];if(y(i,n))return i[n];var o=b(n);if(y(i,o))return i[o];var a=$(o);return y(i,a)?i[a]:i[n]||i[o]||i[a]}}function Me(e,t,n,r){var i=t[e],o=!y(n,e),a=n[e],s=Pe(Boolean,i.type);if(s>-1)if(o&&!y(i,"default"))a=!1;else if(""===a||a===C(e)){var c=Pe(String,i.type);(c<0||s<c)&&(a=!0)}if(void 0===a){a=function(e,t,n){if(!y(t,"default"))return;var r=t.default;if(e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n])return e._props[n];return"function"==typeof r&&"Function"!==Ie(t.type)?r.call(e):r}(r,i,e);var u=be;$e(!0),Ce(a),$e(u)}return a}function Ie(e){var t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function Fe(e,t){return Ie(e)===Ie(t)}function Pe(e,t){if(!Array.isArray(t))return Fe(t,e)?0:-1;for(var n=0,r=t.length;n<r;n++)if(Fe(t[n],e))return n;return-1}function Re(e,t,n){le();try{if(t)for(var r=t;r=r.$parent;){var i=r.$options.errorCaptured;if(i)for(var o=0;o<i.length;o++)try{if(!1===i[o].call(r,e,t,n))return}catch(e){Be(e,r,"errorCaptured hook")}}Be(e,t,n)}finally{fe()}}function He(e,t,n,r,i){var o;try{(o=n?e.apply(t,n):e.call(t))&&!o._isVue&&u(o)&&!o._handled&&(o.catch(function(e){return Re(e,r,i+" (Promise/async)")}),o._handled=!0)}catch(e){Re(e,r,i)}return o}function Be(e,t,n){if(F.errorHandler)try{return F.errorHandler.call(null,e,t,n)}catch(t){t!==e&&Ue(t,null,"config.errorHandler")}Ue(e,t,n)}function Ue(e,t,n){if(!z&&!V||"undefined"==typeof console)throw e;console.error(e)}var ze,Ve=!1,Ke=[],Je=!1;function qe(){Je=!1;var e=Ke.slice(0);Ke.length=0;for(var t=0;t<e.length;t++)e[t]()}if("undefined"!=typeof Promise&&re(Promise)){var We=Promise.resolve();ze=function(){We.then(qe),G&&setTimeout(S)},Ve=!0}else if(q||"undefined"==typeof MutationObserver||!re(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())ze="undefined"!=typeof setImmediate&&re(setImmediate)?function(){setImmediate(qe)}:function(){setTimeout(qe,0)};else{var Ze=1,Ge=new MutationObserver(qe),Xe=document.createTextNode(String(Ze));Ge.observe(Xe,{characterData:!0}),ze=function(){Ze=(Ze+1)%2,Xe.data=String(Ze)},Ve=!0}function Ye(e,t){var n;if(Ke.push(function(){if(e)try{e.call(t)}catch(e){Re(e,t,"nextTick")}else n&&n(t)}),Je||(Je=!0,ze()),!e&&"undefined"!=typeof Promise)return new Promise(function(e){n=e})}var Qe=new ie;function et(e){!function e(t,n){var r,i;var a=Array.isArray(t);if(!a&&!o(t)||Object.isFrozen(t)||t instanceof pe)return;if(t.__ob__){var s=t.__ob__.dep.id;if(n.has(s))return;n.add(s)}if(a)for(r=t.length;r--;)e(t[r],n);else for(i=Object.keys(t),r=i.length;r--;)e(t[i[r]],n)}(e,Qe),Qe.clear()}var tt=g(function(e){var t="&"===e.charAt(0),n="~"===(e=t?e.slice(1):e).charAt(0),r="!"===(e=n?e.slice(1):e).charAt(0);return{name:e=r?e.slice(1):e,once:n,capture:r,passive:t}});function nt(e,t){function n(){var e=arguments,r=n.fns;if(!Array.isArray(r))return He(r,null,arguments,t,"v-on handler");for(var i=r.slice(),o=0;o<i.length;o++)He(i[o],null,e,t,"v-on handler")}return n.fns=e,n}function rt(e,n,i,o,a,s){var c,u,l,f;for(c in e)u=e[c],l=n[c],f=tt(c),t(u)||(t(l)?(t(u.fns)&&(u=e[c]=nt(u,s)),r(f.once)&&(u=e[c]=a(f.name,u,f.capture)),i(f.name,u,f.capture,f.passive,f.params)):u!==l&&(l.fns=u,e[c]=l));for(c in n)t(e[c])&&o((f=tt(c)).name,n[c],f.capture)}function it(e,i,o){var a;e instanceof pe&&(e=e.data.hook||(e.data.hook={}));var s=e[i];function c(){o.apply(this,arguments),h(a.fns,c)}t(s)?a=nt([c]):n(s.fns)&&r(s.merged)?(a=s).fns.push(c):a=nt([s,c]),a.merged=!0,e[i]=a}function ot(e,t,r,i,o){if(n(t)){if(y(t,r))return e[r]=t[r],o||delete t[r],!0;if(y(t,i))return e[r]=t[i],o||delete t[i],!0}return!1}function at(e){return i(e)?[he(e)]:Array.isArray(e)?function e(o,a){var s=[];var c,u,l,f;for(c=0;c<o.length;c++)t(u=o[c])||"boolean"==typeof u||(l=s.length-1,f=s[l],Array.isArray(u)?u.length>0&&(st((u=e(u,(a||"")+"_"+c))[0])&&st(f)&&(s[l]=he(f.text+u[0].text),u.shift()),s.push.apply(s,u)):i(u)?st(f)?s[l]=he(f.text+u):""!==u&&s.push(he(u)):st(u)&&st(f)?s[l]=he(f.text+u.text):(r(o._isVList)&&n(u.tag)&&t(u.key)&&n(a)&&(u.key="__vlist"+a+"_"+c+"__"),s.push(u)));return s}(e):void 0}function st(e){return n(e)&&n(e.text)&&!1===e.isComment}function ct(e,t){if(e){for(var n=Object.create(null),r=oe?Reflect.ownKeys(e):Object.keys(e),i=0;i<r.length;i++){var o=r[i];if("__ob__"!==o){for(var a=e[o].from,s=t;s;){if(s._provided&&y(s._provided,a)){n[o]=s._provided[a];break}s=s.$parent}if(!s&&"default"in e[o]){var c=e[o].default;n[o]="function"==typeof c?c.call(t):c}}}return n}}function ut(e,t){if(!e||!e.length)return{};for(var n={},r=0,i=e.length;r<i;r++){var o=e[r],a=o.data;if(a&&a.attrs&&a.attrs.slot&&delete a.attrs.slot,o.context!==t&&o.fnContext!==t||!a||null==a.slot)(n.default||(n.default=[])).push(o);else{var s=a.slot,c=n[s]||(n[s]=[]);"template"===o.tag?c.push.apply(c,o.children||[]):c.push(o)}}for(var u in n)n[u].every(lt)&&delete n[u];return n}function lt(e){return e.isComment&&!e.asyncFactory||" "===e.text}function ft(t,n,r){var i,o=Object.keys(n).length>0,a=t?!!t.$stable:!o,s=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(a&&r&&r!==e&&s===r.$key&&!o&&!r.$hasNormal)return r;for(var c in i={},t)t[c]&&"$"!==c[0]&&(i[c]=pt(n,c,t[c]))}else i={};for(var u in n)u in i||(i[u]=dt(n,u));return t&&Object.isExtensible(t)&&(t._normalized=i),R(i,"$stable",a),R(i,"$key",s),R(i,"$hasNormal",o),i}function pt(e,t,n){var r=function(){var e=arguments.length?n.apply(null,arguments):n({});return(e=e&&"object"==typeof e&&!Array.isArray(e)?[e]:at(e))&&(0===e.length||1===e.length&&e[0].isComment)?void 0:e};return n.proxy&&Object.defineProperty(e,t,{get:r,enumerable:!0,configurable:!0}),r}function dt(e,t){return function(){return e[t]}}function vt(e,t){var r,i,a,s,c;if(Array.isArray(e)||"string"==typeof e)for(r=new Array(e.length),i=0,a=e.length;i<a;i++)r[i]=t(e[i],i);else if("number"==typeof e)for(r=new Array(e),i=0;i<e;i++)r[i]=t(i+1,i);else if(o(e))if(oe&&e[Symbol.iterator]){r=[];for(var u=e[Symbol.iterator](),l=u.next();!l.done;)r.push(t(l.value,r.length)),l=u.next()}else for(s=Object.keys(e),r=new Array(s.length),i=0,a=s.length;i<a;i++)c=s[i],r[i]=t(e[c],c,i);return n(r)||(r=[]),r._isVList=!0,r}function ht(e,t,n,r){var i,o=this.$scopedSlots[e];o?(n=n||{},r&&(n=A(A({},r),n)),i=o(n)||t):i=this.$slots[e]||t;var a=n&&n.slot;return a?this.$createElement("template",{slot:a},i):i}function mt(e){return Le(this.$options,"filters",e)||E}function yt(e,t){return Array.isArray(e)?-1===e.indexOf(t):e!==t}function gt(e,t,n,r,i){var o=F.keyCodes[t]||n;return i&&r&&!F.keyCodes[t]?yt(i,r):o?yt(o,e):r?C(r)!==t:void 0}function _t(e,t,n,r,i){if(n)if(o(n)){var a;Array.isArray(n)&&(n=O(n));var s=function(o){if("class"===o||"style"===o||v(o))a=e;else{var s=e.attrs&&e.attrs.type;a=r||F.mustUseProp(t,s,o)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}var c=b(o),u=C(o);c in a||u in a||(a[o]=n[o],i&&((e.on||(e.on={}))["update:"+o]=function(e){n[o]=e}))};for(var c in n)s(c)}else;return e}function bt(e,t){var n=this._staticTrees||(this._staticTrees=[]),r=n[e];return r&&!t?r:(wt(r=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,null,this),"__static__"+e,!1),r)}function $t(e,t,n){return wt(e,"__once__"+t+(n?"_"+n:""),!0),e}function wt(e,t,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]&&"string"!=typeof e[r]&&Ct(e[r],t+"_"+r,n);else Ct(e,t,n)}function Ct(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function xt(e,t){if(t)if(s(t)){var n=e.on=e.on?A({},e.on):{};for(var r in t){var i=n[r],o=t[r];n[r]=i?[].concat(i,o):o}}else;return e}function kt(e,t,n,r){t=t||{$stable:!n};for(var i=0;i<e.length;i++){var o=e[i];Array.isArray(o)?kt(o,t,n):o&&(o.proxy&&(o.fn.proxy=!0),t[o.key]=o.fn)}return r&&(t.$key=r),t}function At(e,t){for(var n=0;n<t.length;n+=2){var r=t[n];"string"==typeof r&&r&&(e[t[n]]=t[n+1])}return e}function Ot(e,t){return"string"==typeof e?t+e:e}function St(e){e._o=$t,e._n=f,e._s=l,e._l=vt,e._t=ht,e._q=N,e._i=j,e._m=bt,e._f=mt,e._k=gt,e._b=_t,e._v=he,e._e=ve,e._u=kt,e._g=xt,e._d=At,e._p=Ot}function Tt(t,n,i,o,a){var s,c=this,u=a.options;y(o,"_uid")?(s=Object.create(o))._original=o:(s=o,o=o._original);var l=r(u._compiled),f=!l;this.data=t,this.props=n,this.children=i,this.parent=o,this.listeners=t.on||e,this.injections=ct(u.inject,o),this.slots=function(){return c.$slots||ft(t.scopedSlots,c.$slots=ut(i,o)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ft(t.scopedSlots,this.slots())}}),l&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=ft(t.scopedSlots,this.$slots)),u._scopeId?this._c=function(e,t,n,r){var i=Pt(s,e,t,n,r,f);return i&&!Array.isArray(i)&&(i.fnScopeId=u._scopeId,i.fnContext=o),i}:this._c=function(e,t,n,r){return Pt(s,e,t,n,r,f)}}function Et(e,t,n,r,i){var o=me(e);return o.fnContext=n,o.fnOptions=r,t.slot&&((o.data||(o.data={})).slot=t.slot),o}function Nt(e,t){for(var n in t)e[b(n)]=t[n]}St(Tt.prototype);var jt={init:function(e,t){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var r=e;jt.prepatch(r,r)}else{(e.componentInstance=function(e,t){var r={_isComponent:!0,_parentVnode:e,parent:t},i=e.data.inlineTemplate;n(i)&&(r.render=i.render,r.staticRenderFns=i.staticRenderFns);return new e.componentOptions.Ctor(r)}(e,Wt)).$mount(t?e.elm:void 0,t)}},prepatch:function(t,n){var r=n.componentOptions;!function(t,n,r,i,o){var a=i.data.scopedSlots,s=t.$scopedSlots,c=!!(a&&!a.$stable||s!==e&&!s.$stable||a&&t.$scopedSlots.$key!==a.$key),u=!!(o||t.$options._renderChildren||c);t.$options._parentVnode=i,t.$vnode=i,t._vnode&&(t._vnode.parent=i);if(t.$options._renderChildren=o,t.$attrs=i.data.attrs||e,t.$listeners=r||e,n&&t.$options.props){$e(!1);for(var l=t._props,f=t.$options._propKeys||[],p=0;p<f.length;p++){var d=f[p],v=t.$options.props;l[d]=Me(d,v,n,t)}$e(!0),t.$options.propsData=n}r=r||e;var h=t.$options._parentListeners;t.$options._parentListeners=r,qt(t,r,h),u&&(t.$slots=ut(o,i.context),t.$forceUpdate())}(n.componentInstance=t.componentInstance,r.propsData,r.listeners,n,r.children)},insert:function(e){var t,n=e.context,r=e.componentInstance;r._isMounted||(r._isMounted=!0,Yt(r,"mounted")),e.data.keepAlive&&(n._isMounted?((t=r)._inactive=!1,en.push(t)):Xt(r,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?function e(t,n){if(n&&(t._directInactive=!0,Gt(t)))return;if(!t._inactive){t._inactive=!0;for(var r=0;r<t.$children.length;r++)e(t.$children[r]);Yt(t,"deactivated")}}(t,!0):t.$destroy())}},Dt=Object.keys(jt);function Lt(i,a,s,c,l){if(!t(i)){var f=s.$options._base;if(o(i)&&(i=f.extend(i)),"function"==typeof i){var p;if(t(i.cid)&&void 0===(i=function(e,i){if(r(e.error)&&n(e.errorComp))return e.errorComp;if(n(e.resolved))return e.resolved;var a=Ht;a&&n(e.owners)&&-1===e.owners.indexOf(a)&&e.owners.push(a);if(r(e.loading)&&n(e.loadingComp))return e.loadingComp;if(a&&!n(e.owners)){var s=e.owners=[a],c=!0,l=null,f=null;a.$on("hook:destroyed",function(){return h(s,a)});var p=function(e){for(var t=0,n=s.length;t<n;t++)s[t].$forceUpdate();e&&(s.length=0,null!==l&&(clearTimeout(l),l=null),null!==f&&(clearTimeout(f),f=null))},d=D(function(t){e.resolved=Bt(t,i),c?s.length=0:p(!0)}),v=D(function(t){n(e.errorComp)&&(e.error=!0,p(!0))}),m=e(d,v);return o(m)&&(u(m)?t(e.resolved)&&m.then(d,v):u(m.component)&&(m.component.then(d,v),n(m.error)&&(e.errorComp=Bt(m.error,i)),n(m.loading)&&(e.loadingComp=Bt(m.loading,i),0===m.delay?e.loading=!0:l=setTimeout(function(){l=null,t(e.resolved)&&t(e.error)&&(e.loading=!0,p(!1))},m.delay||200)),n(m.timeout)&&(f=setTimeout(function(){f=null,t(e.resolved)&&v(null)},m.timeout)))),c=!1,e.loading?e.loadingComp:e.resolved}}(p=i,f)))return function(e,t,n,r,i){var o=ve();return o.asyncFactory=e,o.asyncMeta={data:t,context:n,children:r,tag:i},o}(p,a,s,c,l);a=a||{},$n(i),n(a.model)&&function(e,t){var r=e.model&&e.model.prop||"value",i=e.model&&e.model.event||"input";(t.attrs||(t.attrs={}))[r]=t.model.value;var o=t.on||(t.on={}),a=o[i],s=t.model.callback;n(a)?(Array.isArray(a)?-1===a.indexOf(s):a!==s)&&(o[i]=[s].concat(a)):o[i]=s}(i.options,a);var d=function(e,r,i){var o=r.options.props;if(!t(o)){var a={},s=e.attrs,c=e.props;if(n(s)||n(c))for(var u in o){var l=C(u);ot(a,c,u,l,!0)||ot(a,s,u,l,!1)}return a}}(a,i);if(r(i.options.functional))return function(t,r,i,o,a){var s=t.options,c={},u=s.props;if(n(u))for(var l in u)c[l]=Me(l,u,r||e);else n(i.attrs)&&Nt(c,i.attrs),n(i.props)&&Nt(c,i.props);var f=new Tt(i,c,a,o,t),p=s.render.call(null,f._c,f);if(p instanceof pe)return Et(p,i,f.parent,s);if(Array.isArray(p)){for(var d=at(p)||[],v=new Array(d.length),h=0;h<d.length;h++)v[h]=Et(d[h],i,f.parent,s);return v}}(i,d,a,s,c);var v=a.on;if(a.on=a.nativeOn,r(i.options.abstract)){var m=a.slot;a={},m&&(a.slot=m)}!function(e){for(var t=e.hook||(e.hook={}),n=0;n<Dt.length;n++){var r=Dt[n],i=t[r],o=jt[r];i===o||i&&i._merged||(t[r]=i?Mt(o,i):o)}}(a);var y=i.options.name||l;return new pe("vue-component-"+i.cid+(y?"-"+y:""),a,void 0,void 0,void 0,s,{Ctor:i,propsData:d,listeners:v,tag:l,children:c},p)}}}function Mt(e,t){var n=function(n,r){e(n,r),t(n,r)};return n._merged=!0,n}var It=1,Ft=2;function Pt(e,a,s,c,u,l){return(Array.isArray(s)||i(s))&&(u=c,c=s,s=void 0),r(l)&&(u=Ft),function(e,i,a,s,c){if(n(a)&&n(a.__ob__))return ve();n(a)&&n(a.is)&&(i=a.is);if(!i)return ve();Array.isArray(s)&&"function"==typeof s[0]&&((a=a||{}).scopedSlots={default:s[0]},s.length=0);c===Ft?s=at(s):c===It&&(s=function(e){for(var t=0;t<e.length;t++)if(Array.isArray(e[t]))return Array.prototype.concat.apply([],e);return e}(s));var u,l;if("string"==typeof i){var f;l=e.$vnode&&e.$vnode.ns||F.getTagNamespace(i),u=F.isReservedTag(i)?new pe(F.parsePlatformTagName(i),a,s,void 0,void 0,e):a&&a.pre||!n(f=Le(e.$options,"components",i))?new pe(i,a,s,void 0,void 0,e):Lt(f,a,e,s,i)}else u=Lt(i,a,e,s);return Array.isArray(u)?u:n(u)?(n(l)&&function e(i,o,a){i.ns=o;"foreignObject"===i.tag&&(o=void 0,a=!0);if(n(i.children))for(var s=0,c=i.children.length;s<c;s++){var u=i.children[s];n(u.tag)&&(t(u.ns)||r(a)&&"svg"!==u.tag)&&e(u,o,a)}}(u,l),n(a)&&function(e){o(e.style)&&et(e.style);o(e.class)&&et(e.class)}(a),u):ve()}(e,a,s,c,u)}var Rt,Ht=null;function Bt(e,t){return(e.__esModule||oe&&"Module"===e[Symbol.toStringTag])&&(e=e.default),o(e)?t.extend(e):e}function Ut(e){return e.isComment&&e.asyncFactory}function zt(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t];if(n(r)&&(n(r.componentOptions)||Ut(r)))return r}}function Vt(e,t){Rt.$on(e,t)}function Kt(e,t){Rt.$off(e,t)}function Jt(e,t){var n=Rt;return function r(){null!==t.apply(null,arguments)&&n.$off(e,r)}}function qt(e,t,n){Rt=e,rt(t,n||{},Vt,Kt,Jt,e),Rt=void 0}var Wt=null;function Zt(e){var t=Wt;return Wt=e,function(){Wt=t}}function Gt(e){for(;e&&(e=e.$parent);)if(e._inactive)return!0;return!1}function Xt(e,t){if(t){if(e._directInactive=!1,Gt(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)Xt(e.$children[n]);Yt(e,"activated")}}function Yt(e,t){le();var n=e.$options[t],r=t+" hook";if(n)for(var i=0,o=n.length;i<o;i++)He(n[i],e,null,e,r);e._hasHookEvent&&e.$emit("hook:"+t),fe()}var Qt=[],en=[],tn={},nn=!1,rn=!1,on=0;var an=0,sn=Date.now;if(z&&!q){var cn=window.performance;cn&&"function"==typeof cn.now&&sn()>document.createEvent("Event").timeStamp&&(sn=function(){return cn.now()})}function un(){var e,t;for(an=sn(),rn=!0,Qt.sort(function(e,t){return e.id-t.id}),on=0;on<Qt.length;on++)(e=Qt[on]).before&&e.before(),t=e.id,tn[t]=null,e.run();var n=en.slice(),r=Qt.slice();on=Qt.length=en.length=0,tn={},nn=rn=!1,function(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,Xt(e[t],!0)}(n),function(e){var t=e.length;for(;t--;){var n=e[t],r=n.vm;r._watcher===n&&r._isMounted&&!r._isDestroyed&&Yt(r,"updated")}}(r),ne&&F.devtools&&ne.emit("flush")}var ln=0,fn=function(e,t,n,r,i){this.vm=e,i&&(e._watcher=this),e._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++ln,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ie,this.newDepIds=new ie,this.expression="","function"==typeof t?this.getter=t:(this.getter=function(e){if(!H.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}(t),this.getter||(this.getter=S)),this.value=this.lazy?void 0:this.get()};fn.prototype.get=function(){var e;le(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;Re(e,t,'getter for watcher "'+this.expression+'"')}finally{this.deep&&et(e),fe(),this.cleanupDeps()}return e},fn.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},fn.prototype.cleanupDeps=function(){for(var e=this.deps.length;e--;){var t=this.deps[e];this.newDepIds.has(t.id)||t.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},fn.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(e){var t=e.id;if(null==tn[t]){if(tn[t]=!0,rn){for(var n=Qt.length-1;n>on&&Qt[n].id>e.id;)n--;Qt.splice(n+1,0,e)}else Qt.push(e);nn||(nn=!0,Ye(un))}}(this)},fn.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||o(e)||this.deep){var t=this.value;if(this.value=e,this.user)try{this.cb.call(this.vm,e,t)}catch(e){Re(e,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,e,t)}}},fn.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},fn.prototype.depend=function(){for(var e=this.deps.length;e--;)this.deps[e].depend()},fn.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||h(this.vm._watchers,this);for(var e=this.deps.length;e--;)this.deps[e].removeSub(this);this.active=!1}};var pn={enumerable:!0,configurable:!0,get:S,set:S};function dn(e,t,n){pn.get=function(){return this[t][n]},pn.set=function(e){this[t][n]=e},Object.defineProperty(e,n,pn)}function vn(e){e._watchers=[];var t=e.$options;t.props&&function(e,t){var n=e.$options.propsData||{},r=e._props={},i=e.$options._propKeys=[];e.$parent&&$e(!1);var o=function(o){i.push(o);var a=Me(o,t,n,e);xe(r,o,a),o in e||dn(e,"_props",o)};for(var a in t)o(a);$e(!0)}(e,t.props),t.methods&&function(e,t){e.$options.props;for(var n in t)e[n]="function"!=typeof t[n]?S:x(t[n],e)}(e,t.methods),t.data?function(e){var t=e.$options.data;s(t=e._data="function"==typeof t?function(e,t){le();try{return e.call(t,t)}catch(e){return Re(e,t,"data()"),{}}finally{fe()}}(t,e):t||{})||(t={});var n=Object.keys(t),r=e.$options.props,i=(e.$options.methods,n.length);for(;i--;){var o=n[i];r&&y(r,o)||(a=void 0,36!==(a=(o+"").charCodeAt(0))&&95!==a&&dn(e,"_data",o))}var a;Ce(t,!0)}(e):Ce(e._data={},!0),t.computed&&function(e,t){var n=e._computedWatchers=Object.create(null),r=te();for(var i in t){var o=t[i],a="function"==typeof o?o:o.get;r||(n[i]=new fn(e,a||S,S,hn)),i in e||mn(e,i,o)}}(e,t.computed),t.watch&&t.watch!==Y&&function(e,t){for(var n in t){var r=t[n];if(Array.isArray(r))for(var i=0;i<r.length;i++)_n(e,n,r[i]);else _n(e,n,r)}}(e,t.watch)}var hn={lazy:!0};function mn(e,t,n){var r=!te();"function"==typeof n?(pn.get=r?yn(t):gn(n),pn.set=S):(pn.get=n.get?r&&!1!==n.cache?yn(t):gn(n.get):S,pn.set=n.set||S),Object.defineProperty(e,t,pn)}function yn(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),ce.target&&t.depend(),t.value}}function gn(e){return function(){return e.call(this,this)}}function _n(e,t,n,r){return s(n)&&(r=n,n=n.handler),"string"==typeof n&&(n=e[n]),e.$watch(t,n,r)}var bn=0;function $n(e){var t=e.options;if(e.super){var n=$n(e.super);if(n!==e.superOptions){e.superOptions=n;var r=function(e){var t,n=e.options,r=e.sealedOptions;for(var i in n)n[i]!==r[i]&&(t||(t={}),t[i]=n[i]);return t}(e);r&&A(e.extendOptions,r),(t=e.options=De(n,e.extendOptions)).name&&(t.components[t.name]=e)}}return t}function wn(e){this._init(e)}function Cn(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,r=n.cid,i=e._Ctor||(e._Ctor={});if(i[r])return i[r];var o=e.name||n.options.name,a=function(e){this._init(e)};return(a.prototype=Object.create(n.prototype)).constructor=a,a.cid=t++,a.options=De(n.options,e),a.super=n,a.options.props&&function(e){var t=e.options.props;for(var n in t)dn(e.prototype,"_props",n)}(a),a.options.computed&&function(e){var t=e.options.computed;for(var n in t)mn(e.prototype,n,t[n])}(a),a.extend=n.extend,a.mixin=n.mixin,a.use=n.use,M.forEach(function(e){a[e]=n[e]}),o&&(a.options.components[o]=a),a.superOptions=n.options,a.extendOptions=e,a.sealedOptions=A({},a.options),i[r]=a,a}}function xn(e){return e&&(e.Ctor.options.name||e.tag)}function kn(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"==typeof e?e.split(",").indexOf(t)>-1:(n=e,"[object RegExp]"===a.call(n)&&e.test(t));var n}function An(e,t){var n=e.cache,r=e.keys,i=e._vnode;for(var o in n){var a=n[o];if(a){var s=xn(a.componentOptions);s&&!t(s)&&On(n,o,r,i)}}}function On(e,t,n,r){var i=e[t];!i||r&&i.tag===r.tag||i.componentInstance.$destroy(),e[t]=null,h(n,t)}!function(t){t.prototype._init=function(t){var n=this;n._uid=bn++,n._isVue=!0,t&&t._isComponent?function(e,t){var n=e.$options=Object.create(e.constructor.options),r=t._parentVnode;n.parent=t.parent,n._parentVnode=r;var i=r.componentOptions;n.propsData=i.propsData,n._parentListeners=i.listeners,n._renderChildren=i.children,n._componentTag=i.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}(n,t):n.$options=De($n(n.constructor),t||{},n),n._renderProxy=n,n._self=n,function(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){for(;n.$options.abstract&&n.$parent;)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}(n),function(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&qt(e,t)}(n),function(t){t._vnode=null,t._staticTrees=null;var n=t.$options,r=t.$vnode=n._parentVnode,i=r&&r.context;t.$slots=ut(n._renderChildren,i),t.$scopedSlots=e,t._c=function(e,n,r,i){return Pt(t,e,n,r,i,!1)},t.$createElement=function(e,n,r,i){return Pt(t,e,n,r,i,!0)};var o=r&&r.data;xe(t,"$attrs",o&&o.attrs||e,null,!0),xe(t,"$listeners",n._parentListeners||e,null,!0)}(n),Yt(n,"beforeCreate"),function(e){var t=ct(e.$options.inject,e);t&&($e(!1),Object.keys(t).forEach(function(n){xe(e,n,t[n])}),$e(!0))}(n),vn(n),function(e){var t=e.$options.provide;t&&(e._provided="function"==typeof t?t.call(e):t)}(n),Yt(n,"created"),n.$options.el&&n.$mount(n.$options.el)}}(wn),function(e){var t={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",n),e.prototype.$set=ke,e.prototype.$delete=Ae,e.prototype.$watch=function(e,t,n){if(s(t))return _n(this,e,t,n);(n=n||{}).user=!0;var r=new fn(this,e,t,n);if(n.immediate)try{t.call(this,r.value)}catch(e){Re(e,this,'callback for immediate watcher "'+r.expression+'"')}return function(){r.teardown()}}}(wn),function(e){var t=/^hook:/;e.prototype.$on=function(e,n){var r=this;if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)r.$on(e[i],n);else(r._events[e]||(r._events[e]=[])).push(n),t.test(e)&&(r._hasHookEvent=!0);return r},e.prototype.$once=function(e,t){var n=this;function r(){n.$off(e,r),t.apply(n,arguments)}return r.fn=t,n.$on(e,r),n},e.prototype.$off=function(e,t){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(Array.isArray(e)){for(var r=0,i=e.length;r<i;r++)n.$off(e[r],t);return n}var o,a=n._events[e];if(!a)return n;if(!t)return n._events[e]=null,n;for(var s=a.length;s--;)if((o=a[s])===t||o.fn===t){a.splice(s,1);break}return n},e.prototype.$emit=function(e){var t=this._events[e];if(t){t=t.length>1?k(t):t;for(var n=k(arguments,1),r='event handler for "'+e+'"',i=0,o=t.length;i<o;i++)He(t[i],this,n,this,r)}return this}}(wn),function(e){e.prototype._update=function(e,t){var n=this,r=n.$el,i=n._vnode,o=Zt(n);n._vnode=e,n.$el=i?n.__patch__(i,e):n.__patch__(n.$el,e,t,!1),o(),r&&(r.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},e.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){Yt(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||h(t.$children,e),e._watcher&&e._watcher.teardown();for(var n=e._watchers.length;n--;)e._watchers[n].teardown();e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),Yt(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}(wn),function(e){St(e.prototype),e.prototype.$nextTick=function(e){return Ye(e,this)},e.prototype._render=function(){var e,t=this,n=t.$options,r=n.render,i=n._parentVnode;i&&(t.$scopedSlots=ft(i.data.scopedSlots,t.$slots,t.$scopedSlots)),t.$vnode=i;try{Ht=t,e=r.call(t._renderProxy,t.$createElement)}catch(n){Re(n,t,"render"),e=t._vnode}finally{Ht=null}return Array.isArray(e)&&1===e.length&&(e=e[0]),e instanceof pe||(e=ve()),e.parent=i,e}}(wn);var Sn=[String,RegExp,Array],Tn={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Sn,exclude:Sn,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)On(this.cache,e,this.keys)},mounted:function(){var e=this;this.$watch("include",function(t){An(e,function(e){return kn(t,e)})}),this.$watch("exclude",function(t){An(e,function(e){return!kn(t,e)})})},render:function(){var e=this.$slots.default,t=zt(e),n=t&&t.componentOptions;if(n){var r=xn(n),i=this.include,o=this.exclude;if(i&&(!r||!kn(i,r))||o&&r&&kn(o,r))return t;var a=this.cache,s=this.keys,c=null==t.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):t.key;a[c]?(t.componentInstance=a[c].componentInstance,h(s,c),s.push(c)):(a[c]=t,s.push(c),this.max&&s.length>parseInt(this.max)&&On(a,s[0],s,this._vnode)),t.data.keepAlive=!0}return t||e&&e[0]}}};!function(e){var t={get:function(){return F}};Object.defineProperty(e,"config",t),e.util={warn:ae,extend:A,mergeOptions:De,defineReactive:xe},e.set=ke,e.delete=Ae,e.nextTick=Ye,e.observable=function(e){return Ce(e),e},e.options=Object.create(null),M.forEach(function(t){e.options[t+"s"]=Object.create(null)}),e.options._base=e,A(e.options.components,Tn),function(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=k(arguments,1);return n.unshift(this),"function"==typeof e.install?e.install.apply(e,n):"function"==typeof e&&e.apply(null,n),t.push(e),this}}(e),function(e){e.mixin=function(e){return this.options=De(this.options,e),this}}(e),Cn(e),function(e){M.forEach(function(t){e[t]=function(e,n){return n?("component"===t&&s(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&"function"==typeof n&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}})}(e)}(wn),Object.defineProperty(wn.prototype,"$isServer",{get:te}),Object.defineProperty(wn.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(wn,"FunctionalRenderContext",{value:Tt}),wn.version="2.6.11";var En=p("style,class"),Nn=p("input,textarea,option,select,progress"),jn=function(e,t,n){return"value"===n&&Nn(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},Dn=p("contenteditable,draggable,spellcheck"),Ln=p("events,caret,typing,plaintext-only"),Mn=function(e,t){return Hn(t)||"false"===t?"false":"contenteditable"===e&&Ln(t)?t:"true"},In=p("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),Fn="http://www.w3.org/1999/xlink",Pn=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Rn=function(e){return Pn(e)?e.slice(6,e.length):""},Hn=function(e){return null==e||!1===e};function Bn(e){for(var t=e.data,r=e,i=e;n(i.componentInstance);)(i=i.componentInstance._vnode)&&i.data&&(t=Un(i.data,t));for(;n(r=r.parent);)r&&r.data&&(t=Un(t,r.data));return function(e,t){if(n(e)||n(t))return zn(e,Vn(t));return""}(t.staticClass,t.class)}function Un(e,t){return{staticClass:zn(e.staticClass,t.staticClass),class:n(e.class)?[e.class,t.class]:t.class}}function zn(e,t){return e?t?e+" "+t:e:t||""}function Vn(e){return Array.isArray(e)?function(e){for(var t,r="",i=0,o=e.length;i<o;i++)n(t=Vn(e[i]))&&""!==t&&(r&&(r+=" "),r+=t);return r}(e):o(e)?function(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}(e):"string"==typeof e?e:""}var Kn={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Jn=p("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),qn=p("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Wn=function(e){return Jn(e)||qn(e)};function Zn(e){return qn(e)?"svg":"math"===e?"math":void 0}var Gn=Object.create(null);var Xn=p("text,number,password,search,email,tel,url");function Yn(e){if("string"==typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}var Qn=Object.freeze({createElement:function(e,t){var n=document.createElement(e);return"select"!==e?n:(t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n)},createElementNS:function(e,t){return document.createElementNS(Kn[e],t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},setStyleScope:function(e,t){e.setAttribute(t,"")}}),er={create:function(e,t){tr(t)},update:function(e,t){e.data.ref!==t.data.ref&&(tr(e,!0),tr(t))},destroy:function(e){tr(e,!0)}};function tr(e,t){var r=e.data.ref;if(n(r)){var i=e.context,o=e.componentInstance||e.elm,a=i.$refs;t?Array.isArray(a[r])?h(a[r],o):a[r]===o&&(a[r]=void 0):e.data.refInFor?Array.isArray(a[r])?a[r].indexOf(o)<0&&a[r].push(o):a[r]=[o]:a[r]=o}}var nr=new pe("",{},[]),rr=["create","activate","update","remove","destroy"];function ir(e,i){return e.key===i.key&&(e.tag===i.tag&&e.isComment===i.isComment&&n(e.data)===n(i.data)&&function(e,t){if("input"!==e.tag)return!0;var r,i=n(r=e.data)&&n(r=r.attrs)&&r.type,o=n(r=t.data)&&n(r=r.attrs)&&r.type;return i===o||Xn(i)&&Xn(o)}(e,i)||r(e.isAsyncPlaceholder)&&e.asyncFactory===i.asyncFactory&&t(i.asyncFactory.error))}function or(e,t,r){var i,o,a={};for(i=t;i<=r;++i)n(o=e[i].key)&&(a[o]=i);return a}var ar={create:sr,update:sr,destroy:function(e){sr(e,nr)}};function sr(e,t){(e.data.directives||t.data.directives)&&function(e,t){var n,r,i,o=e===nr,a=t===nr,s=ur(e.data.directives,e.context),c=ur(t.data.directives,t.context),u=[],l=[];for(n in c)r=s[n],i=c[n],r?(i.oldValue=r.value,i.oldArg=r.arg,fr(i,"update",t,e),i.def&&i.def.componentUpdated&&l.push(i)):(fr(i,"bind",t,e),i.def&&i.def.inserted&&u.push(i));if(u.length){var f=function(){for(var n=0;n<u.length;n++)fr(u[n],"inserted",t,e)};o?it(t,"insert",f):f()}l.length&&it(t,"postpatch",function(){for(var n=0;n<l.length;n++)fr(l[n],"componentUpdated",t,e)});if(!o)for(n in s)c[n]||fr(s[n],"unbind",e,e,a)}(e,t)}var cr=Object.create(null);function ur(e,t){var n,r,i=Object.create(null);if(!e)return i;for(n=0;n<e.length;n++)(r=e[n]).modifiers||(r.modifiers=cr),i[lr(r)]=r,r.def=Le(t.$options,"directives",r.name);return i}function lr(e){return e.rawName||e.name+"."+Object.keys(e.modifiers||{}).join(".")}function fr(e,t,n,r,i){var o=e.def&&e.def[t];if(o)try{o(n.elm,e,n,r,i)}catch(r){Re(r,n.context,"directive "+e.name+" "+t+" hook")}}var pr=[er,ar];function dr(e,r){var i=r.componentOptions;if(!(n(i)&&!1===i.Ctor.options.inheritAttrs||t(e.data.attrs)&&t(r.data.attrs))){var o,a,s=r.elm,c=e.data.attrs||{},u=r.data.attrs||{};for(o in n(u.__ob__)&&(u=r.data.attrs=A({},u)),u)a=u[o],c[o]!==a&&vr(s,o,a);for(o in(q||Z)&&u.value!==c.value&&vr(s,"value",u.value),c)t(u[o])&&(Pn(o)?s.removeAttributeNS(Fn,Rn(o)):Dn(o)||s.removeAttribute(o))}}function vr(e,t,n){e.tagName.indexOf("-")>-1?hr(e,t,n):In(t)?Hn(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):Dn(t)?e.setAttribute(t,Mn(t,n)):Pn(t)?Hn(n)?e.removeAttributeNS(Fn,Rn(t)):e.setAttributeNS(Fn,t,n):hr(e,t,n)}function hr(e,t,n){if(Hn(n))e.removeAttribute(t);else{if(q&&!W&&"TEXTAREA"===e.tagName&&"placeholder"===t&&""!==n&&!e.__ieph){var r=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",r)};e.addEventListener("input",r),e.__ieph=!0}e.setAttribute(t,n)}}var mr={create:dr,update:dr};function yr(e,r){var i=r.elm,o=r.data,a=e.data;if(!(t(o.staticClass)&&t(o.class)&&(t(a)||t(a.staticClass)&&t(a.class)))){var s=Bn(r),c=i._transitionClasses;n(c)&&(s=zn(s,Vn(c))),s!==i._prevClass&&(i.setAttribute("class",s),i._prevClass=s)}}var gr,_r,br,$r,wr,Cr,xr={create:yr,update:yr},kr=/[\w).+\-_$\]]/;function Ar(e){var t,n,r,i,o,a=!1,s=!1,c=!1,u=!1,l=0,f=0,p=0,d=0;for(r=0;r<e.length;r++)if(n=t,t=e.charCodeAt(r),a)39===t&&92!==n&&(a=!1);else if(s)34===t&&92!==n&&(s=!1);else if(c)96===t&&92!==n&&(c=!1);else if(u)47===t&&92!==n&&(u=!1);else if(124!==t||124===e.charCodeAt(r+1)||124===e.charCodeAt(r-1)||l||f||p){switch(t){case 34:s=!0;break;case 39:a=!0;break;case 96:c=!0;break;case 40:p++;break;case 41:p--;break;case 91:f++;break;case 93:f--;break;case 123:l++;break;case 125:l--}if(47===t){for(var v=r-1,h=void 0;v>=0&&" "===(h=e.charAt(v));v--);h&&kr.test(h)||(u=!0)}}else void 0===i?(d=r+1,i=e.slice(0,r).trim()):m();function m(){(o||(o=[])).push(e.slice(d,r).trim()),d=r+1}if(void 0===i?i=e.slice(0,r).trim():0!==d&&m(),o)for(r=0;r<o.length;r++)i=Or(i,o[r]);return i}function Or(e,t){var n=t.indexOf("(");if(n<0)return'_f("'+t+'")('+e+")";var r=t.slice(0,n),i=t.slice(n+1);return'_f("'+r+'")('+e+(")"!==i?","+i:i)}function Sr(e,t){console.error("[Vue compiler]: "+e)}function Tr(e,t){return e?e.map(function(e){return e[t]}).filter(function(e){return e}):[]}function Er(e,t,n,r,i){(e.props||(e.props=[])).push(Rr({name:t,value:n,dynamic:i},r)),e.plain=!1}function Nr(e,t,n,r,i){(i?e.dynamicAttrs||(e.dynamicAttrs=[]):e.attrs||(e.attrs=[])).push(Rr({name:t,value:n,dynamic:i},r)),e.plain=!1}function jr(e,t,n,r){e.attrsMap[t]=n,e.attrsList.push(Rr({name:t,value:n},r))}function Dr(e,t,n,r,i,o,a,s){(e.directives||(e.directives=[])).push(Rr({name:t,rawName:n,value:r,arg:i,isDynamicArg:o,modifiers:a},s)),e.plain=!1}function Lr(e,t,n){return n?"_p("+t+',"'+e+'")':e+t}function Mr(t,n,r,i,o,a,s,c){var u;(i=i||e).right?c?n="("+n+")==='click'?'contextmenu':("+n+")":"click"===n&&(n="contextmenu",delete i.right):i.middle&&(c?n="("+n+")==='click'?'mouseup':("+n+")":"click"===n&&(n="mouseup")),i.capture&&(delete i.capture,n=Lr("!",n,c)),i.once&&(delete i.once,n=Lr("~",n,c)),i.passive&&(delete i.passive,n=Lr("&",n,c)),i.native?(delete i.native,u=t.nativeEvents||(t.nativeEvents={})):u=t.events||(t.events={});var l=Rr({value:r.trim(),dynamic:c},s);i!==e&&(l.modifiers=i);var f=u[n];Array.isArray(f)?o?f.unshift(l):f.push(l):u[n]=f?o?[l,f]:[f,l]:l,t.plain=!1}function Ir(e,t,n){var r=Fr(e,":"+t)||Fr(e,"v-bind:"+t);if(null!=r)return Ar(r);if(!1!==n){var i=Fr(e,t);if(null!=i)return JSON.stringify(i)}}function Fr(e,t,n){var r;if(null!=(r=e.attrsMap[t]))for(var i=e.attrsList,o=0,a=i.length;o<a;o++)if(i[o].name===t){i.splice(o,1);break}return n&&delete e.attrsMap[t],r}function Pr(e,t){for(var n=e.attrsList,r=0,i=n.length;r<i;r++){var o=n[r];if(t.test(o.name))return n.splice(r,1),o}}function Rr(e,t){return t&&(null!=t.start&&(e.start=t.start),null!=t.end&&(e.end=t.end)),e}function Hr(e,t,n){var r=n||{},i=r.number,o="$$v";r.trim&&(o="(typeof $$v === 'string'? $$v.trim(): $$v)"),i&&(o="_n("+o+")");var a=Br(t,o);e.model={value:"("+t+")",expression:JSON.stringify(t),callback:"function ($$v) {"+a+"}"}}function Br(e,t){var n=function(e){if(e=e.trim(),gr=e.length,e.indexOf("[")<0||e.lastIndexOf("]")<gr-1)return($r=e.lastIndexOf("."))>-1?{exp:e.slice(0,$r),key:'"'+e.slice($r+1)+'"'}:{exp:e,key:null};_r=e,$r=wr=Cr=0;for(;!zr();)Vr(br=Ur())?Jr(br):91===br&&Kr(br);return{exp:e.slice(0,wr),key:e.slice(wr+1,Cr)}}(e);return null===n.key?e+"="+t:"$set("+n.exp+", "+n.key+", "+t+")"}function Ur(){return _r.charCodeAt(++$r)}function zr(){return $r>=gr}function Vr(e){return 34===e||39===e}function Kr(e){var t=1;for(wr=$r;!zr();)if(Vr(e=Ur()))Jr(e);else if(91===e&&t++,93===e&&t--,0===t){Cr=$r;break}}function Jr(e){for(var t=e;!zr()&&(e=Ur())!==t;);}var qr,Wr="__r",Zr="__c";function Gr(e,t,n){var r=qr;return function i(){null!==t.apply(null,arguments)&&Qr(e,i,n,r)}}var Xr=Ve&&!(X&&Number(X[1])<=53);function Yr(e,t,n,r){if(Xr){var i=an,o=t;t=o._wrapper=function(e){if(e.target===e.currentTarget||e.timeStamp>=i||e.timeStamp<=0||e.target.ownerDocument!==document)return o.apply(this,arguments)}}qr.addEventListener(e,t,Q?{capture:n,passive:r}:n)}function Qr(e,t,n,r){(r||qr).removeEventListener(e,t._wrapper||t,n)}function ei(e,r){if(!t(e.data.on)||!t(r.data.on)){var i=r.data.on||{},o=e.data.on||{};qr=r.elm,function(e){if(n(e[Wr])){var t=q?"change":"input";e[t]=[].concat(e[Wr],e[t]||[]),delete e[Wr]}n(e[Zr])&&(e.change=[].concat(e[Zr],e.change||[]),delete e[Zr])}(i),rt(i,o,Yr,Qr,Gr,r.context),qr=void 0}}var ti,ni={create:ei,update:ei};function ri(e,r){if(!t(e.data.domProps)||!t(r.data.domProps)){var i,o,a=r.elm,s=e.data.domProps||{},c=r.data.domProps||{};for(i in n(c.__ob__)&&(c=r.data.domProps=A({},c)),s)i in c||(a[i]="");for(i in c){if(o=c[i],"textContent"===i||"innerHTML"===i){if(r.children&&(r.children.length=0),o===s[i])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===i&&"PROGRESS"!==a.tagName){a._value=o;var u=t(o)?"":String(o);ii(a,u)&&(a.value=u)}else if("innerHTML"===i&&qn(a.tagName)&&t(a.innerHTML)){(ti=ti||document.createElement("div")).innerHTML="<svg>"+o+"</svg>";for(var l=ti.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}else if(o!==s[i])try{a[i]=o}catch(e){}}}}function ii(e,t){return!e.composing&&("OPTION"===e.tagName||function(e,t){var n=!0;try{n=document.activeElement!==e}catch(e){}return n&&e.value!==t}(e,t)||function(e,t){var r=e.value,i=e._vModifiers;if(n(i)){if(i.number)return f(r)!==f(t);if(i.trim)return r.trim()!==t.trim()}return r!==t}(e,t))}var oi={create:ri,update:ri},ai=g(function(e){var t={},n=/:(.+)/;return e.split(/;(?![^(]*\))/g).forEach(function(e){if(e){var r=e.split(n);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t});function si(e){var t=ci(e.style);return e.staticStyle?A(e.staticStyle,t):t}function ci(e){return Array.isArray(e)?O(e):"string"==typeof e?ai(e):e}var ui,li=/^--/,fi=/\s*!important$/,pi=function(e,t,n){if(li.test(t))e.style.setProperty(t,n);else if(fi.test(n))e.style.setProperty(C(t),n.replace(fi,""),"important");else{var r=vi(t);if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++)e.style[r]=n[i];else e.style[r]=n}},di=["Webkit","Moz","ms"],vi=g(function(e){if(ui=ui||document.createElement("div").style,"filter"!==(e=b(e))&&e in ui)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<di.length;n++){var r=di[n]+t;if(r in ui)return r}});function hi(e,r){var i=r.data,o=e.data;if(!(t(i.staticStyle)&&t(i.style)&&t(o.staticStyle)&&t(o.style))){var a,s,c=r.elm,u=o.staticStyle,l=o.normalizedStyle||o.style||{},f=u||l,p=ci(r.data.style)||{};r.data.normalizedStyle=n(p.__ob__)?A({},p):p;var d=function(e,t){var n,r={};if(t)for(var i=e;i.componentInstance;)(i=i.componentInstance._vnode)&&i.data&&(n=si(i.data))&&A(r,n);(n=si(e.data))&&A(r,n);for(var o=e;o=o.parent;)o.data&&(n=si(o.data))&&A(r,n);return r}(r,!0);for(s in f)t(d[s])&&pi(c,s,"");for(s in d)(a=d[s])!==f[s]&&pi(c,s,null==a?"":a)}}var mi={create:hi,update:hi},yi=/\s+/;function gi(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(yi).forEach(function(t){return e.classList.add(t)}):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function _i(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(yi).forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{for(var n=" "+(e.getAttribute("class")||"")+" ",r=" "+t+" ";n.indexOf(r)>=0;)n=n.replace(r," ");(n=n.trim())?e.setAttribute("class",n):e.removeAttribute("class")}}function bi(e){if(e){if("object"==typeof e){var t={};return!1!==e.css&&A(t,$i(e.name||"v")),A(t,e),t}return"string"==typeof e?$i(e):void 0}}var $i=g(function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}}),wi=z&&!W,Ci="transition",xi="animation",ki="transition",Ai="transitionend",Oi="animation",Si="animationend";wi&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(ki="WebkitTransition",Ai="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Oi="WebkitAnimation",Si="webkitAnimationEnd"));var Ti=z?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function Ei(e){Ti(function(){Ti(e)})}function Ni(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),gi(e,t))}function ji(e,t){e._transitionClasses&&h(e._transitionClasses,t),_i(e,t)}function Di(e,t,n){var r=Mi(e,t),i=r.type,o=r.timeout,a=r.propCount;if(!i)return n();var s=i===Ci?Ai:Si,c=0,u=function(){e.removeEventListener(s,l),n()},l=function(t){t.target===e&&++c>=a&&u()};setTimeout(function(){c<a&&u()},o+1),e.addEventListener(s,l)}var Li=/\b(transform|all)(,|$)/;function Mi(e,t){var n,r=window.getComputedStyle(e),i=(r[ki+"Delay"]||"").split(", "),o=(r[ki+"Duration"]||"").split(", "),a=Ii(i,o),s=(r[Oi+"Delay"]||"").split(", "),c=(r[Oi+"Duration"]||"").split(", "),u=Ii(s,c),l=0,f=0;return t===Ci?a>0&&(n=Ci,l=a,f=o.length):t===xi?u>0&&(n=xi,l=u,f=c.length):f=(n=(l=Math.max(a,u))>0?a>u?Ci:xi:null)?n===Ci?o.length:c.length:0,{type:n,timeout:l,propCount:f,hasTransform:n===Ci&&Li.test(r[ki+"Property"])}}function Ii(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max.apply(null,t.map(function(t,n){return Fi(t)+Fi(e[n])}))}function Fi(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function Pi(e,r){var i=e.elm;n(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var a=bi(e.data.transition);if(!t(a)&&!n(i._enterCb)&&1===i.nodeType){for(var s=a.css,c=a.type,u=a.enterClass,l=a.enterToClass,p=a.enterActiveClass,d=a.appearClass,v=a.appearToClass,h=a.appearActiveClass,m=a.beforeEnter,y=a.enter,g=a.afterEnter,_=a.enterCancelled,b=a.beforeAppear,$=a.appear,w=a.afterAppear,C=a.appearCancelled,x=a.duration,k=Wt,A=Wt.$vnode;A&&A.parent;)k=A.context,A=A.parent;var O=!k._isMounted||!e.isRootInsert;if(!O||$||""===$){var S=O&&d?d:u,T=O&&h?h:p,E=O&&v?v:l,N=O&&b||m,j=O&&"function"==typeof $?$:y,L=O&&w||g,M=O&&C||_,I=f(o(x)?x.enter:x),F=!1!==s&&!W,P=Bi(j),R=i._enterCb=D(function(){F&&(ji(i,E),ji(i,T)),R.cancelled?(F&&ji(i,S),M&&M(i)):L&&L(i),i._enterCb=null});e.data.show||it(e,"insert",function(){var t=i.parentNode,n=t&&t._pending&&t._pending[e.key];n&&n.tag===e.tag&&n.elm._leaveCb&&n.elm._leaveCb(),j&&j(i,R)}),N&&N(i),F&&(Ni(i,S),Ni(i,T),Ei(function(){ji(i,S),R.cancelled||(Ni(i,E),P||(Hi(I)?setTimeout(R,I):Di(i,c,R)))})),e.data.show&&(r&&r(),j&&j(i,R)),F||P||R()}}}function Ri(e,r){var i=e.elm;n(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var a=bi(e.data.transition);if(t(a)||1!==i.nodeType)return r();if(!n(i._leaveCb)){var s=a.css,c=a.type,u=a.leaveClass,l=a.leaveToClass,p=a.leaveActiveClass,d=a.beforeLeave,v=a.leave,h=a.afterLeave,m=a.leaveCancelled,y=a.delayLeave,g=a.duration,_=!1!==s&&!W,b=Bi(v),$=f(o(g)?g.leave:g),w=i._leaveCb=D(function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[e.key]=null),_&&(ji(i,l),ji(i,p)),w.cancelled?(_&&ji(i,u),m&&m(i)):(r(),h&&h(i)),i._leaveCb=null});y?y(C):C()}function C(){w.cancelled||(!e.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[e.key]=e),d&&d(i),_&&(Ni(i,u),Ni(i,p),Ei(function(){ji(i,u),w.cancelled||(Ni(i,l),b||(Hi($)?setTimeout(w,$):Di(i,c,w)))})),v&&v(i,w),_||b||w())}}function Hi(e){return"number"==typeof e&&!isNaN(e)}function Bi(e){if(t(e))return!1;var r=e.fns;return n(r)?Bi(Array.isArray(r)?r[0]:r):(e._length||e.length)>1}function Ui(e,t){!0!==t.data.show&&Pi(t)}var zi=function(e){var o,a,s={},c=e.modules,u=e.nodeOps;for(o=0;o<rr.length;++o)for(s[rr[o]]=[],a=0;a<c.length;++a)n(c[a][rr[o]])&&s[rr[o]].push(c[a][rr[o]]);function l(e){var t=u.parentNode(e);n(t)&&u.removeChild(t,e)}function f(e,t,i,o,a,c,l){if(n(e.elm)&&n(c)&&(e=c[l]=me(e)),e.isRootInsert=!a,!function(e,t,i,o){var a=e.data;if(n(a)){var c=n(e.componentInstance)&&a.keepAlive;if(n(a=a.hook)&&n(a=a.init)&&a(e,!1),n(e.componentInstance))return d(e,t),v(i,e.elm,o),r(c)&&function(e,t,r,i){for(var o,a=e;a.componentInstance;)if(a=a.componentInstance._vnode,n(o=a.data)&&n(o=o.transition)){for(o=0;o<s.activate.length;++o)s.activate[o](nr,a);t.push(a);break}v(r,e.elm,i)}(e,t,i,o),!0}}(e,t,i,o)){var f=e.data,p=e.children,m=e.tag;n(m)?(e.elm=e.ns?u.createElementNS(e.ns,m):u.createElement(m,e),g(e),h(e,p,t),n(f)&&y(e,t),v(i,e.elm,o)):r(e.isComment)?(e.elm=u.createComment(e.text),v(i,e.elm,o)):(e.elm=u.createTextNode(e.text),v(i,e.elm,o))}}function d(e,t){n(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,m(e)?(y(e,t),g(e)):(tr(e),t.push(e))}function v(e,t,r){n(e)&&(n(r)?u.parentNode(r)===e&&u.insertBefore(e,t,r):u.appendChild(e,t))}function h(e,t,n){if(Array.isArray(t))for(var r=0;r<t.length;++r)f(t[r],n,e.elm,null,!0,t,r);else i(e.text)&&u.appendChild(e.elm,u.createTextNode(String(e.text)))}function m(e){for(;e.componentInstance;)e=e.componentInstance._vnode;return n(e.tag)}function y(e,t){for(var r=0;r<s.create.length;++r)s.create[r](nr,e);n(o=e.data.hook)&&(n(o.create)&&o.create(nr,e),n(o.insert)&&t.push(e))}function g(e){var t;if(n(t=e.fnScopeId))u.setStyleScope(e.elm,t);else for(var r=e;r;)n(t=r.context)&&n(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t),r=r.parent;n(t=Wt)&&t!==e.context&&t!==e.fnContext&&n(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t)}function _(e,t,n,r,i,o){for(;r<=i;++r)f(n[r],o,e,t,!1,n,r)}function b(e){var t,r,i=e.data;if(n(i))for(n(t=i.hook)&&n(t=t.destroy)&&t(e),t=0;t<s.destroy.length;++t)s.destroy[t](e);if(n(t=e.children))for(r=0;r<e.children.length;++r)b(e.children[r])}function $(e,t,r){for(;t<=r;++t){var i=e[t];n(i)&&(n(i.tag)?(w(i),b(i)):l(i.elm))}}function w(e,t){if(n(t)||n(e.data)){var r,i=s.remove.length+1;for(n(t)?t.listeners+=i:t=function(e,t){function n(){0==--n.listeners&&l(e)}return n.listeners=t,n}(e.elm,i),n(r=e.componentInstance)&&n(r=r._vnode)&&n(r.data)&&w(r,t),r=0;r<s.remove.length;++r)s.remove[r](e,t);n(r=e.data.hook)&&n(r=r.remove)?r(e,t):t()}else l(e.elm)}function C(e,t,r,i){for(var o=r;o<i;o++){var a=t[o];if(n(a)&&ir(e,a))return o}}function x(e,i,o,a,c,l){if(e!==i){n(i.elm)&&n(a)&&(i=a[c]=me(i));var p=i.elm=e.elm;if(r(e.isAsyncPlaceholder))n(i.asyncFactory.resolved)?O(e.elm,i,o):i.isAsyncPlaceholder=!0;else if(r(i.isStatic)&&r(e.isStatic)&&i.key===e.key&&(r(i.isCloned)||r(i.isOnce)))i.componentInstance=e.componentInstance;else{var d,v=i.data;n(v)&&n(d=v.hook)&&n(d=d.prepatch)&&d(e,i);var h=e.children,y=i.children;if(n(v)&&m(i)){for(d=0;d<s.update.length;++d)s.update[d](e,i);n(d=v.hook)&&n(d=d.update)&&d(e,i)}t(i.text)?n(h)&&n(y)?h!==y&&function(e,r,i,o,a){for(var s,c,l,p=0,d=0,v=r.length-1,h=r[0],m=r[v],y=i.length-1,g=i[0],b=i[y],w=!a;p<=v&&d<=y;)t(h)?h=r[++p]:t(m)?m=r[--v]:ir(h,g)?(x(h,g,o,i,d),h=r[++p],g=i[++d]):ir(m,b)?(x(m,b,o,i,y),m=r[--v],b=i[--y]):ir(h,b)?(x(h,b,o,i,y),w&&u.insertBefore(e,h.elm,u.nextSibling(m.elm)),h=r[++p],b=i[--y]):ir(m,g)?(x(m,g,o,i,d),w&&u.insertBefore(e,m.elm,h.elm),m=r[--v],g=i[++d]):(t(s)&&(s=or(r,p,v)),t(c=n(g.key)?s[g.key]:C(g,r,p,v))?f(g,o,e,h.elm,!1,i,d):ir(l=r[c],g)?(x(l,g,o,i,d),r[c]=void 0,w&&u.insertBefore(e,l.elm,h.elm)):f(g,o,e,h.elm,!1,i,d),g=i[++d]);p>v?_(e,t(i[y+1])?null:i[y+1].elm,i,d,y,o):d>y&&$(r,p,v)}(p,h,y,o,l):n(y)?(n(e.text)&&u.setTextContent(p,""),_(p,null,y,0,y.length-1,o)):n(h)?$(h,0,h.length-1):n(e.text)&&u.setTextContent(p,""):e.text!==i.text&&u.setTextContent(p,i.text),n(v)&&n(d=v.hook)&&n(d=d.postpatch)&&d(e,i)}}}function k(e,t,i){if(r(i)&&n(e.parent))e.parent.data.pendingInsert=t;else for(var o=0;o<t.length;++o)t[o].data.hook.insert(t[o])}var A=p("attrs,class,staticClass,staticStyle,key");function O(e,t,i,o){var a,s=t.tag,c=t.data,u=t.children;if(o=o||c&&c.pre,t.elm=e,r(t.isComment)&&n(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(n(c)&&(n(a=c.hook)&&n(a=a.init)&&a(t,!0),n(a=t.componentInstance)))return d(t,i),!0;if(n(s)){if(n(u))if(e.hasChildNodes())if(n(a=c)&&n(a=a.domProps)&&n(a=a.innerHTML)){if(a!==e.innerHTML)return!1}else{for(var l=!0,f=e.firstChild,p=0;p<u.length;p++){if(!f||!O(f,u[p],i,o)){l=!1;break}f=f.nextSibling}if(!l||f)return!1}else h(t,u,i);if(n(c)){var v=!1;for(var m in c)if(!A(m)){v=!0,y(t,i);break}!v&&c.class&&et(c.class)}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,i,o,a){if(!t(i)){var c,l=!1,p=[];if(t(e))l=!0,f(i,p);else{var d=n(e.nodeType);if(!d&&ir(e,i))x(e,i,p,null,null,a);else{if(d){if(1===e.nodeType&&e.hasAttribute(L)&&(e.removeAttribute(L),o=!0),r(o)&&O(e,i,p))return k(i,p,!0),e;c=e,e=new pe(u.tagName(c).toLowerCase(),{},[],void 0,c)}var v=e.elm,h=u.parentNode(v);if(f(i,p,v._leaveCb?null:h,u.nextSibling(v)),n(i.parent))for(var y=i.parent,g=m(i);y;){for(var _=0;_<s.destroy.length;++_)s.destroy[_](y);if(y.elm=i.elm,g){for(var w=0;w<s.create.length;++w)s.create[w](nr,y);var C=y.data.hook.insert;if(C.merged)for(var A=1;A<C.fns.length;A++)C.fns[A]()}else tr(y);y=y.parent}n(h)?$([e],0,0):n(e.tag)&&b(e)}}return k(i,p,l),i.elm}n(e)&&b(e)}}({nodeOps:Qn,modules:[mr,xr,ni,oi,mi,z?{create:Ui,activate:Ui,remove:function(e,t){!0!==e.data.show?Ri(e,t):t()}}:{}].concat(pr)});W&&document.addEventListener("selectionchange",function(){var e=document.activeElement;e&&e.vmodel&&Xi(e,"input")});var Vi={inserted:function(e,t,n,r){"select"===n.tag?(r.elm&&!r.elm._vOptions?it(n,"postpatch",function(){Vi.componentUpdated(e,t,n)}):Ki(e,t,n.context),e._vOptions=[].map.call(e.options,Wi)):("textarea"===n.tag||Xn(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",Zi),e.addEventListener("compositionend",Gi),e.addEventListener("change",Gi),W&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){Ki(e,t,n.context);var r=e._vOptions,i=e._vOptions=[].map.call(e.options,Wi);if(i.some(function(e,t){return!N(e,r[t])}))(e.multiple?t.value.some(function(e){return qi(e,i)}):t.value!==t.oldValue&&qi(t.value,i))&&Xi(e,"change")}}};function Ki(e,t,n){Ji(e,t,n),(q||Z)&&setTimeout(function(){Ji(e,t,n)},0)}function Ji(e,t,n){var r=t.value,i=e.multiple;if(!i||Array.isArray(r)){for(var o,a,s=0,c=e.options.length;s<c;s++)if(a=e.options[s],i)o=j(r,Wi(a))>-1,a.selected!==o&&(a.selected=o);else if(N(Wi(a),r))return void(e.selectedIndex!==s&&(e.selectedIndex=s));i||(e.selectedIndex=-1)}}function qi(e,t){return t.every(function(t){return!N(t,e)})}function Wi(e){return"_value"in e?e._value:e.value}function Zi(e){e.target.composing=!0}function Gi(e){e.target.composing&&(e.target.composing=!1,Xi(e.target,"input"))}function Xi(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function Yi(e){return!e.componentInstance||e.data&&e.data.transition?e:Yi(e.componentInstance._vnode)}var Qi={model:Vi,show:{bind:function(e,t,n){var r=t.value,i=(n=Yi(n)).data&&n.data.transition,o=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;r&&i?(n.data.show=!0,Pi(n,function(){e.style.display=o})):e.style.display=r?o:"none"},update:function(e,t,n){var r=t.value;!r!=!t.oldValue&&((n=Yi(n)).data&&n.data.transition?(n.data.show=!0,r?Pi(n,function(){e.style.display=e.__vOriginalDisplay}):Ri(n,function(){e.style.display="none"})):e.style.display=r?e.__vOriginalDisplay:"none")},unbind:function(e,t,n,r,i){i||(e.style.display=e.__vOriginalDisplay)}}},eo={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function to(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?to(zt(t.children)):e}function no(e){var t={},n=e.$options;for(var r in n.propsData)t[r]=e[r];var i=n._parentListeners;for(var o in i)t[b(o)]=i[o];return t}function ro(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}var io=function(e){return e.tag||Ut(e)},oo=function(e){return"show"===e.name},ao={name:"transition",props:eo,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(io)).length){var r=this.mode,o=n[0];if(function(e){for(;e=e.parent;)if(e.data.transition)return!0}(this.$vnode))return o;var a=to(o);if(!a)return o;if(this._leaving)return ro(e,o);var s="__transition-"+this._uid+"-";a.key=null==a.key?a.isComment?s+"comment":s+a.tag:i(a.key)?0===String(a.key).indexOf(s)?a.key:s+a.key:a.key;var c=(a.data||(a.data={})).transition=no(this),u=this._vnode,l=to(u);if(a.data.directives&&a.data.directives.some(oo)&&(a.data.show=!0),l&&l.data&&!function(e,t){return t.key===e.key&&t.tag===e.tag}(a,l)&&!Ut(l)&&(!l.componentInstance||!l.componentInstance._vnode.isComment)){var f=l.data.transition=A({},c);if("out-in"===r)return this._leaving=!0,it(f,"afterLeave",function(){t._leaving=!1,t.$forceUpdate()}),ro(e,o);if("in-out"===r){if(Ut(a))return u;var p,d=function(){p()};it(c,"afterEnter",d),it(c,"enterCancelled",d),it(f,"delayLeave",function(e){p=e})}}return o}}},so=A({tag:String,moveClass:String},eo);function co(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function uo(e){e.data.newPos=e.elm.getBoundingClientRect()}function lo(e){var t=e.data.pos,n=e.data.newPos,r=t.left-n.left,i=t.top-n.top;if(r||i){e.data.moved=!0;var o=e.elm.style;o.transform=o.WebkitTransform="translate("+r+"px,"+i+"px)",o.transitionDuration="0s"}}delete so.mode;var fo={Transition:ao,TransitionGroup:{props:so,beforeMount:function(){var e=this,t=this._update;this._update=function(n,r){var i=Zt(e);e.__patch__(e._vnode,e.kept,!1,!0),e._vnode=e.kept,i(),t.call(e,n,r)}},render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),r=this.prevChildren=this.children,i=this.$slots.default||[],o=this.children=[],a=no(this),s=0;s<i.length;s++){var c=i[s];c.tag&&null!=c.key&&0!==String(c.key).indexOf("__vlist")&&(o.push(c),n[c.key]=c,(c.data||(c.data={})).transition=a)}if(r){for(var u=[],l=[],f=0;f<r.length;f++){var p=r[f];p.data.transition=a,p.data.pos=p.elm.getBoundingClientRect(),n[p.key]?u.push(p):l.push(p)}this.kept=e(t,null,u),this.removed=l}return e(t,null,o)},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(co),e.forEach(uo),e.forEach(lo),this._reflow=document.body.offsetHeight,e.forEach(function(e){if(e.data.moved){var n=e.elm,r=n.style;Ni(n,t),r.transform=r.WebkitTransform=r.transitionDuration="",n.addEventListener(Ai,n._moveCb=function e(r){r&&r.target!==n||r&&!/transform$/.test(r.propertyName)||(n.removeEventListener(Ai,e),n._moveCb=null,ji(n,t))})}}))},methods:{hasMove:function(e,t){if(!wi)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach(function(e){_i(n,e)}),gi(n,t),n.style.display="none",this.$el.appendChild(n);var r=Mi(n);return this.$el.removeChild(n),this._hasMove=r.hasTransform}}}};wn.config.mustUseProp=jn,wn.config.isReservedTag=Wn,wn.config.isReservedAttr=En,wn.config.getTagNamespace=Zn,wn.config.isUnknownElement=function(e){if(!z)return!0;if(Wn(e))return!1;if(e=e.toLowerCase(),null!=Gn[e])return Gn[e];var t=document.createElement(e);return e.indexOf("-")>-1?Gn[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:Gn[e]=/HTMLUnknownElement/.test(t.toString())},A(wn.options.directives,Qi),A(wn.options.components,fo),wn.prototype.__patch__=z?zi:S,wn.prototype.$mount=function(e,t){return function(e,t,n){var r;return e.$el=t,e.$options.render||(e.$options.render=ve),Yt(e,"beforeMount"),r=function(){e._update(e._render(),n)},new fn(e,r,S,{before:function(){e._isMounted&&!e._isDestroyed&&Yt(e,"beforeUpdate")}},!0),n=!1,null==e.$vnode&&(e._isMounted=!0,Yt(e,"mounted")),e}(this,e=e&&z?Yn(e):void 0,t)},z&&setTimeout(function(){F.devtools&&ne&&ne.emit("init",wn)},0);var po=/\{\{((?:.|\r?\n)+?)\}\}/g,vo=/[-.*+?^${}()|[\]\/\\]/g,ho=g(function(e){var t=e[0].replace(vo,"\\$&"),n=e[1].replace(vo,"\\$&");return new RegExp(t+"((?:.|\\n)+?)"+n,"g")});var mo={staticKeys:["staticClass"],transformNode:function(e,t){t.warn;var n=Fr(e,"class");n&&(e.staticClass=JSON.stringify(n));var r=Ir(e,"class",!1);r&&(e.classBinding=r)},genData:function(e){var t="";return e.staticClass&&(t+="staticClass:"+e.staticClass+","),e.classBinding&&(t+="class:"+e.classBinding+","),t}};var yo,go={staticKeys:["staticStyle"],transformNode:function(e,t){t.warn;var n=Fr(e,"style");n&&(e.staticStyle=JSON.stringify(ai(n)));var r=Ir(e,"style",!1);r&&(e.styleBinding=r)},genData:function(e){var t="";return e.staticStyle&&(t+="staticStyle:"+e.staticStyle+","),e.styleBinding&&(t+="style:("+e.styleBinding+"),"),t}},_o=function(e){return(yo=yo||document.createElement("div")).innerHTML=e,yo.textContent},bo=p("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),$o=p("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source"),wo=p("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),Co=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,xo=/^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+\][^\s"'<>\/=]*)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,ko="[a-zA-Z_][\\-\\.0-9_a-zA-Z"+P.source+"]*",Ao="((?:"+ko+"\\:)?"+ko+")",Oo=new RegExp("^<"+Ao),So=/^\s*(\/?)>/,To=new RegExp("^<\\/"+Ao+"[^>]*>"),Eo=/^<!DOCTYPE [^>]+>/i,No=/^<!\--/,jo=/^<!\[/,Do=p("script,style,textarea",!0),Lo={},Mo={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t","&#39;":"'"},Io=/&(?:lt|gt|quot|amp|#39);/g,Fo=/&(?:lt|gt|quot|amp|#39|#10|#9);/g,Po=p("pre,textarea",!0),Ro=function(e,t){return e&&Po(e)&&"\n"===t[0]};function Ho(e,t){var n=t?Fo:Io;return e.replace(n,function(e){return Mo[e]})}var Bo,Uo,zo,Vo,Ko,Jo,qo,Wo,Zo=/^@|^v-on:/,Go=/^v-|^@|^:|^#/,Xo=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,Yo=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Qo=/^\(|\)$/g,ea=/^\[.*\]$/,ta=/:(.*)$/,na=/^:|^\.|^v-bind:/,ra=/\.[^.\]]+(?=[^\]]*$)/g,ia=/^v-slot(:|$)|^#/,oa=/[\r\n]/,aa=/\s+/g,sa=g(_o),ca="_empty_";function ua(e,t,n){return{type:1,tag:e,attrsList:t,attrsMap:ma(t),rawAttrsMap:{},parent:n,children:[]}}function la(e,t){Bo=t.warn||Sr,Jo=t.isPreTag||T,qo=t.mustUseProp||T,Wo=t.getTagNamespace||T;t.isReservedTag;zo=Tr(t.modules,"transformNode"),Vo=Tr(t.modules,"preTransformNode"),Ko=Tr(t.modules,"postTransformNode"),Uo=t.delimiters;var n,r,i=[],o=!1!==t.preserveWhitespace,a=t.whitespace,s=!1,c=!1;function u(e){if(l(e),s||e.processed||(e=fa(e,t)),i.length||e===n||n.if&&(e.elseif||e.else)&&da(n,{exp:e.elseif,block:e}),r&&!e.forbidden)if(e.elseif||e.else)a=e,(u=function(e){var t=e.length;for(;t--;){if(1===e[t].type)return e[t];e.pop()}}(r.children))&&u.if&&da(u,{exp:a.elseif,block:a});else{if(e.slotScope){var o=e.slotTarget||'"default"';(r.scopedSlots||(r.scopedSlots={}))[o]=e}r.children.push(e),e.parent=r}var a,u;e.children=e.children.filter(function(e){return!e.slotScope}),l(e),e.pre&&(s=!1),Jo(e.tag)&&(c=!1);for(var f=0;f<Ko.length;f++)Ko[f](e,t)}function l(e){if(!c)for(var t;(t=e.children[e.children.length-1])&&3===t.type&&" "===t.text;)e.children.pop()}return function(e,t){for(var n,r,i=[],o=t.expectHTML,a=t.isUnaryTag||T,s=t.canBeLeftOpenTag||T,c=0;e;){if(n=e,r&&Do(r)){var u=0,l=r.toLowerCase(),f=Lo[l]||(Lo[l]=new RegExp("([\\s\\S]*?)(</"+l+"[^>]*>)","i")),p=e.replace(f,function(e,n,r){return u=r.length,Do(l)||"noscript"===l||(n=n.replace(/<!\--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),Ro(l,n)&&(n=n.slice(1)),t.chars&&t.chars(n),""});c+=e.length-p.length,e=p,A(l,c-u,c)}else{var d=e.indexOf("<");if(0===d){if(No.test(e)){var v=e.indexOf("--\x3e");if(v>=0){t.shouldKeepComment&&t.comment(e.substring(4,v),c,c+v+3),C(v+3);continue}}if(jo.test(e)){var h=e.indexOf("]>");if(h>=0){C(h+2);continue}}var m=e.match(Eo);if(m){C(m[0].length);continue}var y=e.match(To);if(y){var g=c;C(y[0].length),A(y[1],g,c);continue}var _=x();if(_){k(_),Ro(_.tagName,e)&&C(1);continue}}var b=void 0,$=void 0,w=void 0;if(d>=0){for($=e.slice(d);!(To.test($)||Oo.test($)||No.test($)||jo.test($)||(w=$.indexOf("<",1))<0);)d+=w,$=e.slice(d);b=e.substring(0,d)}d<0&&(b=e),b&&C(b.length),t.chars&&b&&t.chars(b,c-b.length,c)}if(e===n){t.chars&&t.chars(e);break}}function C(t){c+=t,e=e.substring(t)}function x(){var t=e.match(Oo);if(t){var n,r,i={tagName:t[1],attrs:[],start:c};for(C(t[0].length);!(n=e.match(So))&&(r=e.match(xo)||e.match(Co));)r.start=c,C(r[0].length),r.end=c,i.attrs.push(r);if(n)return i.unarySlash=n[1],C(n[0].length),i.end=c,i}}function k(e){var n=e.tagName,c=e.unarySlash;o&&("p"===r&&wo(n)&&A(r),s(n)&&r===n&&A(n));for(var u=a(n)||!!c,l=e.attrs.length,f=new Array(l),p=0;p<l;p++){var d=e.attrs[p],v=d[3]||d[4]||d[5]||"",h="a"===n&&"href"===d[1]?t.shouldDecodeNewlinesForHref:t.shouldDecodeNewlines;f[p]={name:d[1],value:Ho(v,h)}}u||(i.push({tag:n,lowerCasedTag:n.toLowerCase(),attrs:f,start:e.start,end:e.end}),r=n),t.start&&t.start(n,f,u,e.start,e.end)}function A(e,n,o){var a,s;if(null==n&&(n=c),null==o&&(o=c),e)for(s=e.toLowerCase(),a=i.length-1;a>=0&&i[a].lowerCasedTag!==s;a--);else a=0;if(a>=0){for(var u=i.length-1;u>=a;u--)t.end&&t.end(i[u].tag,n,o);i.length=a,r=a&&i[a-1].tag}else"br"===s?t.start&&t.start(e,[],!0,n,o):"p"===s&&(t.start&&t.start(e,[],!1,n,o),t.end&&t.end(e,n,o))}A()}(e,{warn:Bo,expectHTML:t.expectHTML,isUnaryTag:t.isUnaryTag,canBeLeftOpenTag:t.canBeLeftOpenTag,shouldDecodeNewlines:t.shouldDecodeNewlines,shouldDecodeNewlinesForHref:t.shouldDecodeNewlinesForHref,shouldKeepComment:t.comments,outputSourceRange:t.outputSourceRange,start:function(e,o,a,l,f){var p=r&&r.ns||Wo(e);q&&"svg"===p&&(o=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];ya.test(r.name)||(r.name=r.name.replace(ga,""),t.push(r))}return t}(o));var d,v=ua(e,o,r);p&&(v.ns=p),"style"!==(d=v).tag&&("script"!==d.tag||d.attrsMap.type&&"text/javascript"!==d.attrsMap.type)||te()||(v.forbidden=!0);for(var h=0;h<Vo.length;h++)v=Vo[h](v,t)||v;s||(!function(e){null!=Fr(e,"v-pre")&&(e.pre=!0)}(v),v.pre&&(s=!0)),Jo(v.tag)&&(c=!0),s?function(e){var t=e.attrsList,n=t.length;if(n)for(var r=e.attrs=new Array(n),i=0;i<n;i++)r[i]={name:t[i].name,value:JSON.stringify(t[i].value)},null!=t[i].start&&(r[i].start=t[i].start,r[i].end=t[i].end);else e.pre||(e.plain=!0)}(v):v.processed||(pa(v),function(e){var t=Fr(e,"v-if");if(t)e.if=t,da(e,{exp:t,block:e});else{null!=Fr(e,"v-else")&&(e.else=!0);var n=Fr(e,"v-else-if");n&&(e.elseif=n)}}(v),function(e){null!=Fr(e,"v-once")&&(e.once=!0)}(v)),n||(n=v),a?u(v):(r=v,i.push(v))},end:function(e,t,n){var o=i[i.length-1];i.length-=1,r=i[i.length-1],u(o)},chars:function(e,t,n){if(r&&(!q||"textarea"!==r.tag||r.attrsMap.placeholder!==e)){var i,u,l,f=r.children;if(e=c||e.trim()?"script"===(i=r).tag||"style"===i.tag?e:sa(e):f.length?a?"condense"===a&&oa.test(e)?"":" ":o?" ":"":"")c||"condense"!==a||(e=e.replace(aa," ")),!s&&" "!==e&&(u=function(e,t){var n=t?ho(t):po;if(n.test(e)){for(var r,i,o,a=[],s=[],c=n.lastIndex=0;r=n.exec(e);){(i=r.index)>c&&(s.push(o=e.slice(c,i)),a.push(JSON.stringify(o)));var u=Ar(r[1].trim());a.push("_s("+u+")"),s.push({"@binding":u}),c=i+r[0].length}return c<e.length&&(s.push(o=e.slice(c)),a.push(JSON.stringify(o))),{expression:a.join("+"),tokens:s}}}(e,Uo))?l={type:2,expression:u.expression,tokens:u.tokens,text:e}:" "===e&&f.length&&" "===f[f.length-1].text||(l={type:3,text:e}),l&&f.push(l)}},comment:function(e,t,n){if(r){var i={type:3,text:e,isComment:!0};r.children.push(i)}}}),n}function fa(e,t){var n,r;(r=Ir(n=e,"key"))&&(n.key=r),e.plain=!e.key&&!e.scopedSlots&&!e.attrsList.length,function(e){var t=Ir(e,"ref");t&&(e.ref=t,e.refInFor=function(e){var t=e;for(;t;){if(void 0!==t.for)return!0;t=t.parent}return!1}(e))}(e),function(e){var t;"template"===e.tag?(t=Fr(e,"scope"),e.slotScope=t||Fr(e,"slot-scope")):(t=Fr(e,"slot-scope"))&&(e.slotScope=t);var n=Ir(e,"slot");n&&(e.slotTarget='""'===n?'"default"':n,e.slotTargetDynamic=!(!e.attrsMap[":slot"]&&!e.attrsMap["v-bind:slot"]),"template"===e.tag||e.slotScope||Nr(e,"slot",n,function(e,t){return e.rawAttrsMap[":"+t]||e.rawAttrsMap["v-bind:"+t]||e.rawAttrsMap[t]}(e,"slot")));if("template"===e.tag){var r=Pr(e,ia);if(r){var i=va(r),o=i.name,a=i.dynamic;e.slotTarget=o,e.slotTargetDynamic=a,e.slotScope=r.value||ca}}else{var s=Pr(e,ia);if(s){var c=e.scopedSlots||(e.scopedSlots={}),u=va(s),l=u.name,f=u.dynamic,p=c[l]=ua("template",[],e);p.slotTarget=l,p.slotTargetDynamic=f,p.children=e.children.filter(function(e){if(!e.slotScope)return e.parent=p,!0}),p.slotScope=s.value||ca,e.children=[],e.plain=!1}}}(e),function(e){"slot"===e.tag&&(e.slotName=Ir(e,"name"))}(e),function(e){var t;(t=Ir(e,"is"))&&(e.component=t);null!=Fr(e,"inline-template")&&(e.inlineTemplate=!0)}(e);for(var i=0;i<zo.length;i++)e=zo[i](e,t)||e;return function(e){var t,n,r,i,o,a,s,c,u=e.attrsList;for(t=0,n=u.length;t<n;t++)if(r=i=u[t].name,o=u[t].value,Go.test(r))if(e.hasBindings=!0,(a=ha(r.replace(Go,"")))&&(r=r.replace(ra,"")),na.test(r))r=r.replace(na,""),o=Ar(o),(c=ea.test(r))&&(r=r.slice(1,-1)),a&&(a.prop&&!c&&"innerHtml"===(r=b(r))&&(r="innerHTML"),a.camel&&!c&&(r=b(r)),a.sync&&(s=Br(o,"$event"),c?Mr(e,'"update:"+('+r+")",s,null,!1,0,u[t],!0):(Mr(e,"update:"+b(r),s,null,!1,0,u[t]),C(r)!==b(r)&&Mr(e,"update:"+C(r),s,null,!1,0,u[t])))),a&&a.prop||!e.component&&qo(e.tag,e.attrsMap.type,r)?Er(e,r,o,u[t],c):Nr(e,r,o,u[t],c);else if(Zo.test(r))r=r.replace(Zo,""),(c=ea.test(r))&&(r=r.slice(1,-1)),Mr(e,r,o,a,!1,0,u[t],c);else{var l=(r=r.replace(Go,"")).match(ta),f=l&&l[1];c=!1,f&&(r=r.slice(0,-(f.length+1)),ea.test(f)&&(f=f.slice(1,-1),c=!0)),Dr(e,r,i,o,f,c,a,u[t])}else Nr(e,r,JSON.stringify(o),u[t]),!e.component&&"muted"===r&&qo(e.tag,e.attrsMap.type,r)&&Er(e,r,"true",u[t])}(e),e}function pa(e){var t;if(t=Fr(e,"v-for")){var n=function(e){var t=e.match(Xo);if(!t)return;var n={};n.for=t[2].trim();var r=t[1].trim().replace(Qo,""),i=r.match(Yo);i?(n.alias=r.replace(Yo,"").trim(),n.iterator1=i[1].trim(),i[2]&&(n.iterator2=i[2].trim())):n.alias=r;return n}(t);n&&A(e,n)}}function da(e,t){e.ifConditions||(e.ifConditions=[]),e.ifConditions.push(t)}function va(e){var t=e.name.replace(ia,"");return t||"#"!==e.name[0]&&(t="default"),ea.test(t)?{name:t.slice(1,-1),dynamic:!0}:{name:'"'+t+'"',dynamic:!1}}function ha(e){var t=e.match(ra);if(t){var n={};return t.forEach(function(e){n[e.slice(1)]=!0}),n}}function ma(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n].name]=e[n].value;return t}var ya=/^xmlns:NS\d+/,ga=/^NS\d+:/;function _a(e){return ua(e.tag,e.attrsList.slice(),e.parent)}var ba=[mo,go,{preTransformNode:function(e,t){if("input"===e.tag){var n,r=e.attrsMap;if(!r["v-model"])return;if((r[":type"]||r["v-bind:type"])&&(n=Ir(e,"type")),r.type||n||!r["v-bind"]||(n="("+r["v-bind"]+").type"),n){var i=Fr(e,"v-if",!0),o=i?"&&("+i+")":"",a=null!=Fr(e,"v-else",!0),s=Fr(e,"v-else-if",!0),c=_a(e);pa(c),jr(c,"type","checkbox"),fa(c,t),c.processed=!0,c.if="("+n+")==='checkbox'"+o,da(c,{exp:c.if,block:c});var u=_a(e);Fr(u,"v-for",!0),jr(u,"type","radio"),fa(u,t),da(c,{exp:"("+n+")==='radio'"+o,block:u});var l=_a(e);return Fr(l,"v-for",!0),jr(l,":type",n),fa(l,t),da(c,{exp:i,block:l}),a?c.else=!0:s&&(c.elseif=s),c}}}}];var $a,wa,Ca={expectHTML:!0,modules:ba,directives:{model:function(e,t,n){var r=t.value,i=t.modifiers,o=e.tag,a=e.attrsMap.type;if(e.component)return Hr(e,r,i),!1;if("select"===o)!function(e,t,n){var r='var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;return '+(n&&n.number?"_n(val)":"val")+"});";r=r+" "+Br(t,"$event.target.multiple ? $$selectedVal : $$selectedVal[0]"),Mr(e,"change",r,null,!0)}(e,r,i);else if("input"===o&&"checkbox"===a)!function(e,t,n){var r=n&&n.number,i=Ir(e,"value")||"null",o=Ir(e,"true-value")||"true",a=Ir(e,"false-value")||"false";Er(e,"checked","Array.isArray("+t+")?_i("+t+","+i+")>-1"+("true"===o?":("+t+")":":_q("+t+","+o+")")),Mr(e,"change","var $$a="+t+",$$el=$event.target,$$c=$$el.checked?("+o+"):("+a+");if(Array.isArray($$a)){var $$v="+(r?"_n("+i+")":i)+",$$i=_i($$a,$$v);if($$el.checked){$$i<0&&("+Br(t,"$$a.concat([$$v])")+")}else{$$i>-1&&("+Br(t,"$$a.slice(0,$$i).concat($$a.slice($$i+1))")+")}}else{"+Br(t,"$$c")+"}",null,!0)}(e,r,i);else if("input"===o&&"radio"===a)!function(e,t,n){var r=n&&n.number,i=Ir(e,"value")||"null";Er(e,"checked","_q("+t+","+(i=r?"_n("+i+")":i)+")"),Mr(e,"change",Br(t,i),null,!0)}(e,r,i);else if("input"===o||"textarea"===o)!function(e,t,n){var r=e.attrsMap.type,i=n||{},o=i.lazy,a=i.number,s=i.trim,c=!o&&"range"!==r,u=o?"change":"range"===r?Wr:"input",l="$event.target.value";s&&(l="$event.target.value.trim()"),a&&(l="_n("+l+")");var f=Br(t,l);c&&(f="if($event.target.composing)return;"+f),Er(e,"value","("+t+")"),Mr(e,u,f,null,!0),(s||a)&&Mr(e,"blur","$forceUpdate()")}(e,r,i);else if(!F.isReservedTag(o))return Hr(e,r,i),!1;return!0},text:function(e,t){t.value&&Er(e,"textContent","_s("+t.value+")",t)},html:function(e,t){t.value&&Er(e,"innerHTML","_s("+t.value+")",t)}},isPreTag:function(e){return"pre"===e},isUnaryTag:bo,mustUseProp:jn,canBeLeftOpenTag:$o,isReservedTag:Wn,getTagNamespace:Zn,staticKeys:function(e){return e.reduce(function(e,t){return e.concat(t.staticKeys||[])},[]).join(",")}(ba)},xa=g(function(e){return p("type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap"+(e?","+e:""))});function ka(e,t){e&&($a=xa(t.staticKeys||""),wa=t.isReservedTag||T,function e(t){t.static=function(e){if(2===e.type)return!1;if(3===e.type)return!0;return!(!e.pre&&(e.hasBindings||e.if||e.for||d(e.tag)||!wa(e.tag)||function(e){for(;e.parent;){if("template"!==(e=e.parent).tag)return!1;if(e.for)return!0}return!1}(e)||!Object.keys(e).every($a)))}(t);if(1===t.type){if(!wa(t.tag)&&"slot"!==t.tag&&null==t.attrsMap["inline-template"])return;for(var n=0,r=t.children.length;n<r;n++){var i=t.children[n];e(i),i.static||(t.static=!1)}if(t.ifConditions)for(var o=1,a=t.ifConditions.length;o<a;o++){var s=t.ifConditions[o].block;e(s),s.static||(t.static=!1)}}}(e),function e(t,n){if(1===t.type){if((t.static||t.once)&&(t.staticInFor=n),t.static&&t.children.length&&(1!==t.children.length||3!==t.children[0].type))return void(t.staticRoot=!0);if(t.staticRoot=!1,t.children)for(var r=0,i=t.children.length;r<i;r++)e(t.children[r],n||!!t.for);if(t.ifConditions)for(var o=1,a=t.ifConditions.length;o<a;o++)e(t.ifConditions[o].block,n)}}(e,!1))}var Aa=/^([\w$_]+|\([^)]*?\))\s*=>|^function(?:\s+[\w$]+)?\s*\(/,Oa=/\([^)]*?\);*$/,Sa=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Ta={esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]},Ea={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]},Na=function(e){return"if("+e+")return null;"},ja={stop:"$event.stopPropagation();",prevent:"$event.preventDefault();",self:Na("$event.target !== $event.currentTarget"),ctrl:Na("!$event.ctrlKey"),shift:Na("!$event.shiftKey"),alt:Na("!$event.altKey"),meta:Na("!$event.metaKey"),left:Na("'button' in $event && $event.button !== 0"),middle:Na("'button' in $event && $event.button !== 1"),right:Na("'button' in $event && $event.button !== 2")};function Da(e,t){var n=t?"nativeOn:":"on:",r="",i="";for(var o in e){var a=La(e[o]);e[o]&&e[o].dynamic?i+=o+","+a+",":r+='"'+o+'":'+a+","}return r="{"+r.slice(0,-1)+"}",i?n+"_d("+r+",["+i.slice(0,-1)+"])":n+r}function La(e){if(!e)return"function(){}";if(Array.isArray(e))return"["+e.map(function(e){return La(e)}).join(",")+"]";var t=Sa.test(e.value),n=Aa.test(e.value),r=Sa.test(e.value.replace(Oa,""));if(e.modifiers){var i="",o="",a=[];for(var s in e.modifiers)if(ja[s])o+=ja[s],Ta[s]&&a.push(s);else if("exact"===s){var c=e.modifiers;o+=Na(["ctrl","shift","alt","meta"].filter(function(e){return!c[e]}).map(function(e){return"$event."+e+"Key"}).join("||"))}else a.push(s);return a.length&&(i+=function(e){return"if(!$event.type.indexOf('key')&&"+e.map(Ma).join("&&")+")return null;"}(a)),o&&(i+=o),"function($event){"+i+(t?"return "+e.value+"($event)":n?"return ("+e.value+")($event)":r?"return "+e.value:e.value)+"}"}return t||n?e.value:"function($event){"+(r?"return "+e.value:e.value)+"}"}function Ma(e){var t=parseInt(e,10);if(t)return"$event.keyCode!=="+t;var n=Ta[e],r=Ea[e];return"_k($event.keyCode,"+JSON.stringify(e)+","+JSON.stringify(n)+",$event.key,"+JSON.stringify(r)+")"}var Ia={on:function(e,t){e.wrapListeners=function(e){return"_g("+e+","+t.value+")"}},bind:function(e,t){e.wrapData=function(n){return"_b("+n+",'"+e.tag+"',"+t.value+","+(t.modifiers&&t.modifiers.prop?"true":"false")+(t.modifiers&&t.modifiers.sync?",true":"")+")"}},cloak:S},Fa=function(e){this.options=e,this.warn=e.warn||Sr,this.transforms=Tr(e.modules,"transformCode"),this.dataGenFns=Tr(e.modules,"genData"),this.directives=A(A({},Ia),e.directives);var t=e.isReservedTag||T;this.maybeComponent=function(e){return!!e.component||!t(e.tag)},this.onceId=0,this.staticRenderFns=[],this.pre=!1};function Pa(e,t){var n=new Fa(t);return{render:"with(this){return "+(e?Ra(e,n):'_c("div")')+"}",staticRenderFns:n.staticRenderFns}}function Ra(e,t){if(e.parent&&(e.pre=e.pre||e.parent.pre),e.staticRoot&&!e.staticProcessed)return Ha(e,t);if(e.once&&!e.onceProcessed)return Ba(e,t);if(e.for&&!e.forProcessed)return za(e,t);if(e.if&&!e.ifProcessed)return Ua(e,t);if("template"!==e.tag||e.slotTarget||t.pre){if("slot"===e.tag)return function(e,t){var n=e.slotName||'"default"',r=qa(e,t),i="_t("+n+(r?","+r:""),o=e.attrs||e.dynamicAttrs?Ga((e.attrs||[]).concat(e.dynamicAttrs||[]).map(function(e){return{name:b(e.name),value:e.value,dynamic:e.dynamic}})):null,a=e.attrsMap["v-bind"];!o&&!a||r||(i+=",null");o&&(i+=","+o);a&&(i+=(o?"":",null")+","+a);return i+")"}(e,t);var n;if(e.component)n=function(e,t,n){var r=t.inlineTemplate?null:qa(t,n,!0);return"_c("+e+","+Va(t,n)+(r?","+r:"")+")"}(e.component,e,t);else{var r;(!e.plain||e.pre&&t.maybeComponent(e))&&(r=Va(e,t));var i=e.inlineTemplate?null:qa(e,t,!0);n="_c('"+e.tag+"'"+(r?","+r:"")+(i?","+i:"")+")"}for(var o=0;o<t.transforms.length;o++)n=t.transforms[o](e,n);return n}return qa(e,t)||"void 0"}function Ha(e,t){e.staticProcessed=!0;var n=t.pre;return e.pre&&(t.pre=e.pre),t.staticRenderFns.push("with(this){return "+Ra(e,t)+"}"),t.pre=n,"_m("+(t.staticRenderFns.length-1)+(e.staticInFor?",true":"")+")"}function Ba(e,t){if(e.onceProcessed=!0,e.if&&!e.ifProcessed)return Ua(e,t);if(e.staticInFor){for(var n="",r=e.parent;r;){if(r.for){n=r.key;break}r=r.parent}return n?"_o("+Ra(e,t)+","+t.onceId+++","+n+")":Ra(e,t)}return Ha(e,t)}function Ua(e,t,n,r){return e.ifProcessed=!0,function e(t,n,r,i){if(!t.length)return i||"_e()";var o=t.shift();return o.exp?"("+o.exp+")?"+a(o.block)+":"+e(t,n,r,i):""+a(o.block);function a(e){return r?r(e,n):e.once?Ba(e,n):Ra(e,n)}}(e.ifConditions.slice(),t,n,r)}function za(e,t,n,r){var i=e.for,o=e.alias,a=e.iterator1?","+e.iterator1:"",s=e.iterator2?","+e.iterator2:"";return e.forProcessed=!0,(r||"_l")+"(("+i+"),function("+o+a+s+"){return "+(n||Ra)(e,t)+"})"}function Va(e,t){var n="{",r=function(e,t){var n=e.directives;if(!n)return;var r,i,o,a,s="directives:[",c=!1;for(r=0,i=n.length;r<i;r++){o=n[r],a=!0;var u=t.directives[o.name];u&&(a=!!u(e,o,t.warn)),a&&(c=!0,s+='{name:"'+o.name+'",rawName:"'+o.rawName+'"'+(o.value?",value:("+o.value+"),expression:"+JSON.stringify(o.value):"")+(o.arg?",arg:"+(o.isDynamicArg?o.arg:'"'+o.arg+'"'):"")+(o.modifiers?",modifiers:"+JSON.stringify(o.modifiers):"")+"},")}if(c)return s.slice(0,-1)+"]"}(e,t);r&&(n+=r+","),e.key&&(n+="key:"+e.key+","),e.ref&&(n+="ref:"+e.ref+","),e.refInFor&&(n+="refInFor:true,"),e.pre&&(n+="pre:true,"),e.component&&(n+='tag:"'+e.tag+'",');for(var i=0;i<t.dataGenFns.length;i++)n+=t.dataGenFns[i](e);if(e.attrs&&(n+="attrs:"+Ga(e.attrs)+","),e.props&&(n+="domProps:"+Ga(e.props)+","),e.events&&(n+=Da(e.events,!1)+","),e.nativeEvents&&(n+=Da(e.nativeEvents,!0)+","),e.slotTarget&&!e.slotScope&&(n+="slot:"+e.slotTarget+","),e.scopedSlots&&(n+=function(e,t,n){var r=e.for||Object.keys(t).some(function(e){var n=t[e];return n.slotTargetDynamic||n.if||n.for||Ka(n)}),i=!!e.if;if(!r)for(var o=e.parent;o;){if(o.slotScope&&o.slotScope!==ca||o.for){r=!0;break}o.if&&(i=!0),o=o.parent}var a=Object.keys(t).map(function(e){return Ja(t[e],n)}).join(",");return"scopedSlots:_u(["+a+"]"+(r?",null,true":"")+(!r&&i?",null,false,"+function(e){var t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(a):"")+")"}(e,e.scopedSlots,t)+","),e.model&&(n+="model:{value:"+e.model.value+",callback:"+e.model.callback+",expression:"+e.model.expression+"},"),e.inlineTemplate){var o=function(e,t){var n=e.children[0];if(n&&1===n.type){var r=Pa(n,t.options);return"inlineTemplate:{render:function(){"+r.render+"},staticRenderFns:["+r.staticRenderFns.map(function(e){return"function(){"+e+"}"}).join(",")+"]}"}}(e,t);o&&(n+=o+",")}return n=n.replace(/,$/,"")+"}",e.dynamicAttrs&&(n="_b("+n+',"'+e.tag+'",'+Ga(e.dynamicAttrs)+")"),e.wrapData&&(n=e.wrapData(n)),e.wrapListeners&&(n=e.wrapListeners(n)),n}function Ka(e){return 1===e.type&&("slot"===e.tag||e.children.some(Ka))}function Ja(e,t){var n=e.attrsMap["slot-scope"];if(e.if&&!e.ifProcessed&&!n)return Ua(e,t,Ja,"null");if(e.for&&!e.forProcessed)return za(e,t,Ja);var r=e.slotScope===ca?"":String(e.slotScope),i="function("+r+"){return "+("template"===e.tag?e.if&&n?"("+e.if+")?"+(qa(e,t)||"undefined")+":undefined":qa(e,t)||"undefined":Ra(e,t))+"}",o=r?"":",proxy:true";return"{key:"+(e.slotTarget||'"default"')+",fn:"+i+o+"}"}function qa(e,t,n,r,i){var o=e.children;if(o.length){var a=o[0];if(1===o.length&&a.for&&"template"!==a.tag&&"slot"!==a.tag){var s=n?t.maybeComponent(a)?",1":",0":"";return""+(r||Ra)(a,t)+s}var c=n?function(e,t){for(var n=0,r=0;r<e.length;r++){var i=e[r];if(1===i.type){if(Wa(i)||i.ifConditions&&i.ifConditions.some(function(e){return Wa(e.block)})){n=2;break}(t(i)||i.ifConditions&&i.ifConditions.some(function(e){return t(e.block)}))&&(n=1)}}return n}(o,t.maybeComponent):0,u=i||Za;return"["+o.map(function(e){return u(e,t)}).join(",")+"]"+(c?","+c:"")}}function Wa(e){return void 0!==e.for||"template"===e.tag||"slot"===e.tag}function Za(e,t){return 1===e.type?Ra(e,t):3===e.type&&e.isComment?(r=e,"_e("+JSON.stringify(r.text)+")"):"_v("+(2===(n=e).type?n.expression:Xa(JSON.stringify(n.text)))+")";var n,r}function Ga(e){for(var t="",n="",r=0;r<e.length;r++){var i=e[r],o=Xa(i.value);i.dynamic?n+=i.name+","+o+",":t+='"'+i.name+'":'+o+","}return t="{"+t.slice(0,-1)+"}",n?"_d("+t+",["+n.slice(0,-1)+"])":t}function Xa(e){return e.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments".split(",").join("\\b|\\b")+"\\b");function Ya(e,t){try{return new Function(e)}catch(n){return t.push({err:n,code:e}),S}}function Qa(e){var t=Object.create(null);return function(n,r,i){(r=A({},r)).warn;delete r.warn;var o=r.delimiters?String(r.delimiters)+n:n;if(t[o])return t[o];var a=e(n,r),s={},c=[];return s.render=Ya(a.render,c),s.staticRenderFns=a.staticRenderFns.map(function(e){return Ya(e,c)}),t[o]=s}}var es,ts,ns=(es=function(e,t){var n=la(e.trim(),t);!1!==t.optimize&&ka(n,t);var r=Pa(n,t);return{ast:n,render:r.render,staticRenderFns:r.staticRenderFns}},function(e){function t(t,n){var r=Object.create(e),i=[],o=[];if(n)for(var a in n.modules&&(r.modules=(e.modules||[]).concat(n.modules)),n.directives&&(r.directives=A(Object.create(e.directives||null),n.directives)),n)"modules"!==a&&"directives"!==a&&(r[a]=n[a]);r.warn=function(e,t,n){(n?o:i).push(e)};var s=es(t.trim(),r);return s.errors=i,s.tips=o,s}return{compile:t,compileToFunctions:Qa(t)}})(Ca),rs=(ns.compile,ns.compileToFunctions);function is(e){return(ts=ts||document.createElement("div")).innerHTML=e?'<a href="\n"/>':'<div a="\n"/>',ts.innerHTML.indexOf("&#10;")>0}var os=!!z&&is(!1),as=!!z&&is(!0),ss=g(function(e){var t=Yn(e);return t&&t.innerHTML}),cs=wn.prototype.$mount;return wn.prototype.$mount=function(e,t){if((e=e&&Yn(e))===document.body||e===document.documentElement)return this;var n=this.$options;if(!n.render){var r=n.template;if(r)if("string"==typeof r)"#"===r.charAt(0)&&(r=ss(r));else{if(!r.nodeType)return this;r=r.innerHTML}else e&&(r=function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}(e));if(r){var i=rs(r,{outputSourceRange:!1,shouldDecodeNewlines:os,shouldDecodeNewlinesForHref:as,delimiters:n.delimiters,comments:n.comments},this),o=i.render,a=i.staticRenderFns;n.render=o,n.staticRenderFns=a}}return cs.call(this,e,t)},wn.compile=rs,wn});
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */
var t,e;t=this,e=function(){"use strict";function t(t,e){for(var r in e)t[r]=e[r];return t}var e=/[!'()*]/g,r=function(t){return"%"+t.charCodeAt(0).toString(16)},n=/%2C/g,o=function(t){return encodeURIComponent(t).replace(e,r).replace(n,",")};function i(t){try{return decodeURIComponent(t)}catch(t){}return t}var a=function(t){return null==t||"object"==typeof t?t:String(t)};function s(t){var e={};return(t=t.trim().replace(/^(\?|#|&)/,""))?(t.split("&").forEach((function(t){var r=t.replace(/\+/g," ").split("="),n=i(r.shift()),o=r.length>0?i(r.join("=")):null;void 0===e[n]?e[n]=o:Array.isArray(e[n])?e[n].push(o):e[n]=[e[n],o]})),e):e}function u(t){var e=t?Object.keys(t).map((function(e){var r=t[e];if(void 0===r)return"";if(null===r)return o(e);if(Array.isArray(r)){var n=[];return r.forEach((function(t){void 0!==t&&(null===t?n.push(o(e)):n.push(o(e)+"="+o(t)))})),n.join("&")}return o(e)+"="+o(r)})).filter((function(t){return t.length>0})).join("&"):null;return e?"?"+e:""}var c=/\/?$/;function p(t,e,r,n){var o=n&&n.options.stringifyQuery,i=e.query||{};try{i=f(i)}catch(t){}var a={name:e.name||t&&t.name,meta:t&&t.meta||{},path:e.path||"/",hash:e.hash||"",query:i,params:e.params||{},fullPath:d(e,o),matched:t?l(t):[]};return r&&(a.redirectedFrom=d(r,o)),Object.freeze(a)}function f(t){if(Array.isArray(t))return t.map(f);if(t&&"object"==typeof t){var e={};for(var r in t)e[r]=f(t[r]);return e}return t}var h=p(null,{path:"/"});function l(t){for(var e=[];t;)e.unshift(t),t=t.parent;return e}function d(t,e){var r=t.path,n=t.query;void 0===n&&(n={});var o=t.hash;return void 0===o&&(o=""),(r||"/")+(e||u)(n)+o}function v(t,e,r){return e===h?t===e:!!e&&(t.path&&e.path?t.path.replace(c,"")===e.path.replace(c,"")&&(r||t.hash===e.hash&&y(t.query,e.query)):!(!t.name||!e.name)&&t.name===e.name&&(r||t.hash===e.hash&&y(t.query,e.query)&&y(t.params,e.params)))}function y(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||!e)return t===e;var r=Object.keys(t).sort(),n=Object.keys(e).sort();return r.length===n.length&&r.every((function(r,o){var i=t[r];if(n[o]!==r)return!1;var a=e[r];return null==i||null==a?i===a:"object"==typeof i&&"object"==typeof a?y(i,a):String(i)===String(a)}))}function m(t){for(var e=0;e<t.matched.length;e++){var r=t.matched[e];for(var n in r.instances){var o=r.instances[n],i=r.enteredCbs[n];if(o&&i){delete r.enteredCbs[n];for(var a=0;a<i.length;a++)o._isBeingDestroyed||i[a](o)}}}}var g={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(e,r){var n=r.props,o=r.children,i=r.parent,a=r.data;a.routerView=!0;for(var s=i.$createElement,u=n.name,c=i.$route,p=i._routerViewCache||(i._routerViewCache={}),f=0,h=!1;i&&i._routerRoot!==i;){var l=i.$vnode?i.$vnode.data:{};l.routerView&&f++,l.keepAlive&&i._directInactive&&i._inactive&&(h=!0),i=i.$parent}if(a.routerViewDepth=f,h){var d=p[u],v=d&&d.component;return v?(d.configProps&&w(v,a,d.route,d.configProps),s(v,a,o)):s()}var y=c.matched[f],g=y&&y.components[u];if(!y||!g)return p[u]=null,s();p[u]={component:g},a.registerRouteInstance=function(t,e){var r=y.instances[u];(e&&r!==t||!e&&r===t)&&(y.instances[u]=e)},(a.hook||(a.hook={})).prepatch=function(t,e){y.instances[u]=e.componentInstance},a.hook.init=function(t){t.data.keepAlive&&t.componentInstance&&t.componentInstance!==y.instances[u]&&(y.instances[u]=t.componentInstance),m(c)};var b=y.props&&y.props[u];return b&&(t(p[u],{route:c,configProps:b}),w(g,a,c,b)),s(g,a,o)}};function w(e,r,n,o){var i=r.props=function(t,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(t);case"boolean":return e?t.params:void 0}}(n,o);if(i){i=r.props=t({},i);var a=r.attrs=r.attrs||{};for(var s in i)e.props&&s in e.props||(a[s]=i[s],delete i[s])}}function b(t,e,r){var n=t.charAt(0);if("/"===n)return t;if("?"===n||"#"===n)return e+t;var o=e.split("/");r&&o[o.length-1]||o.pop();for(var i=t.replace(/^\//,"").split("/"),a=0;a<i.length;a++){var s=i[a];".."===s?o.pop():"."!==s&&o.push(s)}return""!==o[0]&&o.unshift(""),o.join("/")}function x(t){return t.replace(/\/+/g,"/")}var R=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},k=B,E=j,C=function(t,e){return S(j(t,e),e)},A=S,O=U,_=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function j(t,e){for(var r,n=[],o=0,i=0,a="",s=e&&e.delimiter||"/";null!=(r=_.exec(t));){var u=r[0],c=r[1],p=r.index;if(a+=t.slice(i,p),i=p+u.length,c)a+=c[1];else{var f=t[i],h=r[2],l=r[3],d=r[4],v=r[5],y=r[6],m=r[7];a&&(n.push(a),a="");var g=null!=h&&null!=f&&f!==h,w="+"===y||"*"===y,b="?"===y||"*"===y,x=r[2]||s,R=d||v;n.push({name:l||o++,prefix:h||"",delimiter:x,optional:b,repeat:w,partial:g,asterisk:!!m,pattern:R?L(R):m?".*":"[^"+P(x)+"]+?"})}}return i<t.length&&(a+=t.substr(i)),a&&n.push(a),n}function T(t){return encodeURI(t).replace(/[\/?#]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}))}function S(t,e){for(var r=new Array(t.length),n=0;n<t.length;n++)"object"==typeof t[n]&&(r[n]=new RegExp("^(?:"+t[n].pattern+")$",q(e)));return function(e,n){for(var o="",i=e||{},a=(n||{}).pretty?T:encodeURIComponent,s=0;s<t.length;s++){var u=t[s];if("string"!=typeof u){var c,p=i[u.name];if(null==p){if(u.optional){u.partial&&(o+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(R(p)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var f=0;f<p.length;f++){if(c=a(p[f]),!r[s].test(c))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(c)+"`");o+=(0===f?u.prefix:u.delimiter)+c}}else{if(c=u.asterisk?encodeURI(p).replace(/[?#]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})):a(p),!r[s].test(c))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+c+'"');o+=u.prefix+c}}else o+=u}return o}}function P(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function L(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function $(t,e){return t.keys=e,t}function q(t){return t&&t.sensitive?"":"i"}function U(t,e,r){R(e)||(r=e||r,e=[]);for(var n=(r=r||{}).strict,o=!1!==r.end,i="",a=0;a<t.length;a++){var s=t[a];if("string"==typeof s)i+=P(s);else{var u=P(s.prefix),c="(?:"+s.pattern+")";e.push(s),s.repeat&&(c+="(?:"+u+c+")*"),i+=c=s.optional?s.partial?u+"("+c+")?":"(?:"+u+"("+c+"))?":u+"("+c+")"}}var p=P(r.delimiter||"/"),f=i.slice(-p.length)===p;return n||(i=(f?i.slice(0,-p.length):i)+"(?:"+p+"(?=$))?"),i+=o?"$":n&&f?"":"(?="+p+"|$)",$(new RegExp("^"+i,q(r)),e)}function B(t,e,r){return R(e)||(r=e||r,e=[]),r=r||{},t instanceof RegExp?function(t,e){var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return $(t,e)}(t,e):R(t)?function(t,e,r){for(var n=[],o=0;o<t.length;o++)n.push(B(t[o],e,r).source);return $(new RegExp("(?:"+n.join("|")+")",q(r)),e)}(t,e,r):function(t,e,r){return U(j(t,r),e,r)}(t,e,r)}k.parse=E,k.compile=C,k.tokensToFunction=A,k.tokensToRegExp=O;var I=Object.create(null);function M(t,e,r){e=e||{};try{var n=I[t]||(I[t]=k.compile(t));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),n(e,{pretty:!0})}catch(t){return""}finally{delete e[0]}}function V(e,r,n,o){var i="string"==typeof e?{path:e}:e;if(i._normalized)return i;if(i.name){var u=(i=t({},e)).params;return u&&"object"==typeof u&&(i.params=t({},u)),i}if(!i.path&&i.params&&r){(i=t({},i))._normalized=!0;var c=t(t({},r.params),i.params);if(r.name)i.name=r.name,i.params=c;else if(r.matched.length){var p=r.matched[r.matched.length-1].path;i.path=M(p,c,r.path)}return i}var f=function(t){var e="",r="",n=t.indexOf("#");n>=0&&(e=t.slice(n),t=t.slice(0,n));var o=t.indexOf("?");return o>=0&&(r=t.slice(o+1),t=t.slice(0,o)),{path:t,query:r,hash:e}}(i.path||""),h=r&&r.path||"/",l=f.path?b(f.path,h,n||i.append):h,d=function(t,e,r){void 0===e&&(e={});var n,o=r||s;try{n=o(t||"")}catch(t){n={}}for(var i in e){var u=e[i];n[i]=Array.isArray(u)?u.map(a):a(u)}return n}(f.query,i.query,o&&o.options.parseQuery),v=i.hash||f.hash;return v&&"#"!==v.charAt(0)&&(v="#"+v),{_normalized:!0,path:l,query:d,hash:v}}var H,N=function(){},F={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(e){var r=this,n=this.$router,o=this.$route,i=n.resolve(this.to,o,this.append),a=i.location,s=i.route,u=i.href,f={},h=n.options.linkActiveClass,l=n.options.linkExactActiveClass,d=null==h?"router-link-active":h,y=null==l?"router-link-exact-active":l,m=null==this.activeClass?d:this.activeClass,g=null==this.exactActiveClass?y:this.exactActiveClass,w=s.redirectedFrom?p(null,V(s.redirectedFrom),null,n):s;f[g]=v(o,w,this.exactPath),f[m]=this.exact||this.exactPath?f[g]:function(t,e){return 0===t.path.replace(c,"/").indexOf(e.path.replace(c,"/"))&&(!e.hash||t.hash===e.hash)&&function(t,e){for(var r in e)if(!(r in t))return!1;return!0}(t.query,e.query)}(o,w);var b=f[g]?this.ariaCurrentValue:null,x=function(t){z(t)&&(r.replace?n.replace(a,N):n.push(a,N))},R={click:z};Array.isArray(this.event)?this.event.forEach((function(t){R[t]=x})):R[this.event]=x;var k={class:f},E=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:u,route:s,navigate:x,isActive:f[m],isExactActive:f[g]});if(E){if(1===E.length)return E[0];if(E.length>1||!E.length)return 0===E.length?e():e("span",{},E)}if("a"===this.tag)k.on=R,k.attrs={href:u,"aria-current":b};else{var C=function t(e){var r;if(e)for(var n=0;n<e.length;n++){if("a"===(r=e[n]).tag)return r;if(r.children&&(r=t(r.children)))return r}}(this.$slots.default);if(C){C.isStatic=!1;var A=C.data=t({},C.data);for(var O in A.on=A.on||{},A.on){var _=A.on[O];O in R&&(A.on[O]=Array.isArray(_)?_:[_])}for(var j in R)j in A.on?A.on[j].push(R[j]):A.on[j]=x;var T=C.data.attrs=t({},C.data.attrs);T.href=u,T["aria-current"]=b}else k.on=R}return e(this.tag,k,this.$slots.default)}};function z(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented||void 0!==t.button&&0!==t.button)){if(t.currentTarget&&t.currentTarget.getAttribute){var e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}var D="undefined"!=typeof window;function K(t,e,r,n,o){var i=e||[],a=r||Object.create(null),s=n||Object.create(null);t.forEach((function(t){!function t(e,r,n,o,i,a){var s=o.path,u=o.name,c=o.pathToRegexpOptions||{},p=function(t,e,r){return r||(t=t.replace(/\/$/,"")),"/"===t[0]||null==e?t:x(e.path+"/"+t)}(s,i,c.strict);"boolean"==typeof o.caseSensitive&&(c.sensitive=o.caseSensitive);var f={path:p,regex:J(p,c),components:o.components||{default:o.component},alias:o.alias?"string"==typeof o.alias?[o.alias]:o.alias:[],instances:{},enteredCbs:{},name:u,parent:i,matchAs:a,redirect:o.redirect,beforeEnter:o.beforeEnter,meta:o.meta||{},props:null==o.props?{}:o.components?o.props:{default:o.props}};if(o.children&&o.children.forEach((function(o){var i=a?x(a+"/"+o.path):void 0;t(e,r,n,o,f,i)})),r[f.path]||(e.push(f.path),r[f.path]=f),void 0!==o.alias)for(var h=Array.isArray(o.alias)?o.alias:[o.alias],l=0;l<h.length;++l){var d={path:h[l],children:o.children};t(e,r,n,d,i,f.path||"/")}u&&(n[u]||(n[u]=f))}(i,a,s,t,o)}));for(var u=0,c=i.length;u<c;u++)"*"===i[u]&&(i.push(i.splice(u,1)[0]),c--,u--);return{pathList:i,pathMap:a,nameMap:s}}function J(t,e){return k(t,[],e)}function Q(t,e){var r=K(t),n=r.pathList,o=r.pathMap,i=r.nameMap;function a(t,r,a){var s=V(t,r,!1,e),c=s.name;if(c){var p=i[c];if(!p)return u(null,s);var f=p.regex.keys.filter((function(t){return!t.optional})).map((function(t){return t.name}));if("object"!=typeof s.params&&(s.params={}),r&&"object"==typeof r.params)for(var h in r.params)!(h in s.params)&&f.indexOf(h)>-1&&(s.params[h]=r.params[h]);return s.path=M(p.path,s.params),u(p,s,a)}if(s.path){s.params={};for(var l=0;l<n.length;l++){var d=n[l],v=o[d];if(X(v.regex,s.path,s.params))return u(v,s,a)}}return u(null,s)}function s(t,r){var n=t.redirect,o="function"==typeof n?n(p(t,r,null,e)):n;if("string"==typeof o&&(o={path:o}),!o||"object"!=typeof o)return u(null,r);var s=o,c=s.name,f=s.path,h=r.query,l=r.hash,d=r.params;return h=s.hasOwnProperty("query")?s.query:h,l=s.hasOwnProperty("hash")?s.hash:l,d=s.hasOwnProperty("params")?s.params:d,c?(i[c],a({_normalized:!0,name:c,query:h,hash:l,params:d},void 0,r)):f?a({_normalized:!0,path:M(function(t,e){return b(t,e.parent?e.parent.path:"/",!0)}(f,t),d),query:h,hash:l},void 0,r):u(null,r)}function u(t,r,n){return t&&t.redirect?s(t,n||r):t&&t.matchAs?function(t,e,r){var n=a({_normalized:!0,path:M(r,e.params)});if(n){var o=n.matched,i=o[o.length-1];return e.params=n.params,u(i,e)}return u(null,e)}(0,r,t.matchAs):p(t,r,n,e)}return{match:a,addRoute:function(t,e){var r="object"!=typeof t?i[t]:void 0;K([e||t],n,o,i,r),r&&r.alias.length&&K(r.alias.map((function(t){return{path:t,children:[e]}})),n,o,i,r)},getRoutes:function(){return n.map((function(t){return o[t]}))},addRoutes:function(t){K(t,n,o,i)}}}function X(t,e,r){var n=e.match(t);if(!n)return!1;if(!r)return!0;for(var o=1,a=n.length;o<a;++o){var s=t.keys[o-1];s&&(r[s.name||"pathMatch"]="string"==typeof n[o]?i(n[o]):n[o])}return!0}var Y=D&&window.performance&&window.performance.now?window.performance:Date;function W(){return Y.now().toFixed(3)}var G=W();function Z(){return G}function tt(t){return G=t}var et=Object.create(null);function rt(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var e=window.location.protocol+"//"+window.location.host,r=window.location.href.replace(e,""),n=t({},window.history.state);return n.key=Z(),window.history.replaceState(n,"",r),window.addEventListener("popstate",it),function(){window.removeEventListener("popstate",it)}}function nt(t,e,r,n){if(t.app){var o=t.options.scrollBehavior;o&&t.app.$nextTick((function(){var i=function(){var t=Z();if(t)return et[t]}(),a=o.call(t,e,r,n?i:null);a&&("function"==typeof a.then?a.then((function(t){pt(t,i)})).catch((function(t){})):pt(a,i))}))}}function ot(){var t=Z();t&&(et[t]={x:window.pageXOffset,y:window.pageYOffset})}function it(t){ot(),t.state&&t.state.key&&tt(t.state.key)}function at(t){return ut(t.x)||ut(t.y)}function st(t){return{x:ut(t.x)?t.x:window.pageXOffset,y:ut(t.y)?t.y:window.pageYOffset}}function ut(t){return"number"==typeof t}var ct=/^#\d/;function pt(t,e){var r,n="object"==typeof t;if(n&&"string"==typeof t.selector){var o=ct.test(t.selector)?document.getElementById(t.selector.slice(1)):document.querySelector(t.selector);if(o){var i=t.offset&&"object"==typeof t.offset?t.offset:{};e=function(t,e){var r=document.documentElement.getBoundingClientRect(),n=t.getBoundingClientRect();return{x:n.left-r.left-e.x,y:n.top-r.top-e.y}}(o,i={x:ut((r=i).x)?r.x:0,y:ut(r.y)?r.y:0})}else at(t)&&(e=st(t))}else n&&at(t)&&(e=st(t));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:t.behavior}):window.scrollTo(e.x,e.y))}var ft,ht=D&&(-1===(ft=window.navigator.userAgent).indexOf("Android 2.")&&-1===ft.indexOf("Android 4.0")||-1===ft.indexOf("Mobile Safari")||-1!==ft.indexOf("Chrome")||-1!==ft.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState;function lt(e,r){ot();var n=window.history;try{if(r){var o=t({},n.state);o.key=Z(),n.replaceState(o,"",e)}else n.pushState({key:tt(W())},"",e)}catch(t){window.location[r?"replace":"assign"](e)}}function dt(t){lt(t,!0)}function vt(t,e,r){var n=function(o){o>=t.length?r():t[o]?e(t[o],(function(){n(o+1)})):n(o+1)};n(0)}var yt={redirected:2,aborted:4,cancelled:8,duplicated:16};function mt(t,e){return wt(t,e,yt.redirected,'Redirected when going from "'+t.fullPath+'" to "'+function(t){if("string"==typeof t)return t;if("path"in t)return t.path;var e={};return bt.forEach((function(r){r in t&&(e[r]=t[r])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function gt(t,e){return wt(t,e,yt.cancelled,'Navigation cancelled from "'+t.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function wt(t,e,r,n){var o=new Error(n);return o._isRouter=!0,o.from=t,o.to=e,o.type=r,o}var bt=["params","query","hash"];function xt(t){return Object.prototype.toString.call(t).indexOf("Error")>-1}function Rt(t,e){return xt(t)&&t._isRouter&&(null==e||t.type===e)}function kt(t){return function(e,r,n){var o=!1,i=0,a=null;Et(t,(function(t,e,r,s){if("function"==typeof t&&void 0===t.cid){o=!0,i++;var u,c=Ot((function(e){var o;((o=e).__esModule||At&&"Module"===o[Symbol.toStringTag])&&(e=e.default),t.resolved="function"==typeof e?e:H.extend(e),r.components[s]=e,--i<=0&&n()})),p=Ot((function(t){var e="Failed to resolve async component "+s+": "+t;a||(a=xt(t)?t:new Error(e),n(a))}));try{u=t(c,p)}catch(t){p(t)}if(u)if("function"==typeof u.then)u.then(c,p);else{var f=u.component;f&&"function"==typeof f.then&&f.then(c,p)}}})),o||n()}}function Et(t,e){return Ct(t.map((function(t){return Object.keys(t.components).map((function(r){return e(t.components[r],t.instances[r],t,r)}))})))}function Ct(t){return Array.prototype.concat.apply([],t)}var At="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Ot(t){var e=!1;return function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];if(!e)return e=!0,t.apply(this,r)}}var _t=function(t,e){this.router=t,this.base=function(t){if(!t)if(D){var e=document.querySelector("base");t=(t=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else t="/";return"/"!==t.charAt(0)&&(t="/"+t),t.replace(/\/$/,"")}(e),this.current=h,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function jt(t,e,r,n){var o=Et(t,(function(t,n,o,i){var a=function(t,e){return"function"!=typeof t&&(t=H.extend(t)),t.options[e]}(t,e);if(a)return Array.isArray(a)?a.map((function(t){return r(t,n,o,i)})):r(a,n,o,i)}));return Ct(n?o.reverse():o)}function Tt(t,e){if(e)return function(){return t.apply(e,arguments)}}_t.prototype.listen=function(t){this.cb=t},_t.prototype.onReady=function(t,e){this.ready?t():(this.readyCbs.push(t),e&&this.readyErrorCbs.push(e))},_t.prototype.onError=function(t){this.errorCbs.push(t)},_t.prototype.transitionTo=function(t,e,r){var n,o=this;try{n=this.router.match(t,this.current)}catch(t){throw this.errorCbs.forEach((function(e){e(t)})),t}var i=this.current;this.confirmTransition(n,(function(){o.updateRoute(n),e&&e(n),o.ensureURL(),o.router.afterHooks.forEach((function(t){t&&t(n,i)})),o.ready||(o.ready=!0,o.readyCbs.forEach((function(t){t(n)})))}),(function(t){r&&r(t),t&&!o.ready&&(Rt(t,yt.redirected)&&i===h||(o.ready=!0,o.readyErrorCbs.forEach((function(e){e(t)}))))}))},_t.prototype.confirmTransition=function(t,e,r){var n=this,o=this.current;this.pending=t;var i,a,s=function(t){!Rt(t)&&xt(t)&&(n.errorCbs.length?n.errorCbs.forEach((function(e){e(t)})):console.error(t)),r&&r(t)},u=t.matched.length-1,c=o.matched.length-1;if(v(t,o)&&u===c&&t.matched[u]===o.matched[c])return this.ensureURL(),t.hash&&nt(this.router,o,t,!1),s(((a=wt(i=o,t,yt.duplicated,'Avoided redundant navigation to current location: "'+i.fullPath+'".')).name="NavigationDuplicated",a));var p=function(t,e){var r,n=Math.max(t.length,e.length);for(r=0;r<n&&t[r]===e[r];r++);return{updated:e.slice(0,r),activated:e.slice(r),deactivated:t.slice(r)}}(this.current.matched,t.matched),f=p.updated,h=p.deactivated,l=p.activated,d=[].concat(function(t){return jt(t,"beforeRouteLeave",Tt,!0)}(h),this.router.beforeHooks,function(t){return jt(t,"beforeRouteUpdate",Tt)}(f),l.map((function(t){return t.beforeEnter})),kt(l)),y=function(e,r){if(n.pending!==t)return s(gt(o,t));try{e(t,o,(function(e){!1===e?(n.ensureURL(!0),s(function(t,e){return wt(t,e,yt.aborted,'Navigation aborted from "'+t.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(o,t))):xt(e)?(n.ensureURL(!0),s(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(s(mt(o,t)),"object"==typeof e&&e.replace?n.replace(e):n.push(e)):r(e)}))}catch(t){s(t)}};vt(d,y,(function(){vt(function(t){return jt(t,"beforeRouteEnter",(function(t,e,r,n){return function(t,e,r){return function(n,o,i){return t(n,o,(function(t){"function"==typeof t&&(e.enteredCbs[r]||(e.enteredCbs[r]=[]),e.enteredCbs[r].push(t)),i(t)}))}}(t,r,n)}))}(l).concat(n.router.resolveHooks),y,(function(){if(n.pending!==t)return s(gt(o,t));n.pending=null,e(t),n.router.app&&n.router.app.$nextTick((function(){m(t)}))}))}))},_t.prototype.updateRoute=function(t){this.current=t,this.cb&&this.cb(t)},_t.prototype.setupListeners=function(){},_t.prototype.teardown=function(){this.listeners.forEach((function(t){t()})),this.listeners=[],this.current=h,this.pending=null};var St=function(t){function e(e,r){t.call(this,e,r),this._startLocation=Pt(this.base)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var t=this;if(!(this.listeners.length>0)){var e=this.router,r=e.options.scrollBehavior,n=ht&&r;n&&this.listeners.push(rt());var o=function(){var r=t.current,o=Pt(t.base);t.current===h&&o===t._startLocation||t.transitionTo(o,(function(t){n&&nt(e,t,r,!0)}))};window.addEventListener("popstate",o),this.listeners.push((function(){window.removeEventListener("popstate",o)}))}},e.prototype.go=function(t){window.history.go(t)},e.prototype.push=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){lt(x(n.base+t.fullPath)),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.replace=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){dt(x(n.base+t.fullPath)),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.ensureURL=function(t){if(Pt(this.base)!==this.current.fullPath){var e=x(this.base+this.current.fullPath);t?lt(e):dt(e)}},e.prototype.getCurrentLocation=function(){return Pt(this.base)},e}(_t);function Pt(t){var e=window.location.pathname,r=e.toLowerCase(),n=t.toLowerCase();return!t||r!==n&&0!==r.indexOf(x(n+"/"))||(e=e.slice(t.length)),(e||"/")+window.location.search+window.location.hash}var Lt=function(t){function e(e,r,n){t.call(this,e,r),n&&function(t){var e=Pt(t);if(!/^\/#/.test(e))return window.location.replace(x(t+"/#"+e)),!0}(this.base)||$t()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var t=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,r=ht&&e;r&&this.listeners.push(rt());var n=function(){var e=t.current;$t()&&t.transitionTo(qt(),(function(n){r&&nt(t.router,n,e,!0),ht||It(n.fullPath)}))},o=ht?"popstate":"hashchange";window.addEventListener(o,n),this.listeners.push((function(){window.removeEventListener(o,n)}))}},e.prototype.push=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){Bt(t.fullPath),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.replace=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){It(t.fullPath),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.go=function(t){window.history.go(t)},e.prototype.ensureURL=function(t){var e=this.current.fullPath;qt()!==e&&(t?Bt(e):It(e))},e.prototype.getCurrentLocation=function(){return qt()},e}(_t);function $t(){var t=qt();return"/"===t.charAt(0)||(It("/"+t),!1)}function qt(){var t=window.location.href,e=t.indexOf("#");return e<0?"":t=t.slice(e+1)}function Ut(t){var e=window.location.href,r=e.indexOf("#");return(r>=0?e.slice(0,r):e)+"#"+t}function Bt(t){ht?lt(Ut(t)):window.location.hash=t}function It(t){ht?dt(Ut(t)):window.location.replace(Ut(t))}var Mt=function(t){function e(e,r){t.call(this,e,r),this.stack=[],this.index=-1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.push=function(t,e,r){var n=this;this.transitionTo(t,(function(t){n.stack=n.stack.slice(0,n.index+1).concat(t),n.index++,e&&e(t)}),r)},e.prototype.replace=function(t,e,r){var n=this;this.transitionTo(t,(function(t){n.stack=n.stack.slice(0,n.index).concat(t),e&&e(t)}),r)},e.prototype.go=function(t){var e=this,r=this.index+t;if(!(r<0||r>=this.stack.length)){var n=this.stack[r];this.confirmTransition(n,(function(){var t=e.current;e.index=r,e.updateRoute(n),e.router.afterHooks.forEach((function(e){e&&e(n,t)}))}),(function(t){Rt(t,yt.duplicated)&&(e.index=r)}))}},e.prototype.getCurrentLocation=function(){var t=this.stack[this.stack.length-1];return t?t.fullPath:"/"},e.prototype.ensureURL=function(){},e}(_t),Vt=function(t){void 0===t&&(t={}),this.app=null,this.apps=[],this.options=t,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Q(t.routes||[],this);var e=t.mode||"hash";switch(this.fallback="history"===e&&!ht&&!1!==t.fallback,this.fallback&&(e="hash"),D||(e="abstract"),this.mode=e,e){case"history":this.history=new St(this,t.base);break;case"hash":this.history=new Lt(this,t.base,this.fallback);break;case"abstract":this.history=new Mt(this,t.base)}},Ht={currentRoute:{configurable:!0}};function Nt(t,e){return t.push(e),function(){var r=t.indexOf(e);r>-1&&t.splice(r,1)}}return Vt.prototype.match=function(t,e,r){return this.matcher.match(t,e,r)},Ht.currentRoute.get=function(){return this.history&&this.history.current},Vt.prototype.init=function(t){var e=this;if(this.apps.push(t),t.$once("hook:destroyed",(function(){var r=e.apps.indexOf(t);r>-1&&e.apps.splice(r,1),e.app===t&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=t;var r=this.history;if(r instanceof St||r instanceof Lt){var n=function(t){r.setupListeners(),function(t){var n=r.current,o=e.options.scrollBehavior;ht&&o&&"fullPath"in t&&nt(e,t,n,!1)}(t)};r.transitionTo(r.getCurrentLocation(),n,n)}r.listen((function(t){e.apps.forEach((function(e){e._route=t}))}))}},Vt.prototype.beforeEach=function(t){return Nt(this.beforeHooks,t)},Vt.prototype.beforeResolve=function(t){return Nt(this.resolveHooks,t)},Vt.prototype.afterEach=function(t){return Nt(this.afterHooks,t)},Vt.prototype.onReady=function(t,e){this.history.onReady(t,e)},Vt.prototype.onError=function(t){this.history.onError(t)},Vt.prototype.push=function(t,e,r){var n=this;if(!e&&!r&&"undefined"!=typeof Promise)return new Promise((function(e,r){n.history.push(t,e,r)}));this.history.push(t,e,r)},Vt.prototype.replace=function(t,e,r){var n=this;if(!e&&!r&&"undefined"!=typeof Promise)return new Promise((function(e,r){n.history.replace(t,e,r)}));this.history.replace(t,e,r)},Vt.prototype.go=function(t){this.history.go(t)},Vt.prototype.back=function(){this.go(-1)},Vt.prototype.forward=function(){this.go(1)},Vt.prototype.getMatchedComponents=function(t){var e=t?t.matched?t:this.resolve(t).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(t){return Object.keys(t.components).map((function(e){return t.components[e]}))}))):[]},Vt.prototype.resolve=function(t,e,r){var n=V(t,e=e||this.history.current,r,this),o=this.match(n,e),i=o.redirectedFrom||o.fullPath;return{location:n,route:o,href:function(t,e,r){var n="hash"===r?"#"+e:e;return t?x(t+"/"+n):n}(this.history.base,i,this.mode),normalizedTo:n,resolved:o}},Vt.prototype.getRoutes=function(){return this.matcher.getRoutes()},Vt.prototype.addRoute=function(t,e){this.matcher.addRoute(t,e),this.history.current!==h&&this.history.transitionTo(this.history.getCurrentLocation())},Vt.prototype.addRoutes=function(t){this.matcher.addRoutes(t),this.history.current!==h&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Vt.prototype,Ht),Vt.install=function t(e){if(!t.installed||H!==e){t.installed=!0,H=e;var r=function(t){return void 0!==t},n=function(t,e){var n=t.$options._parentVnode;r(n)&&r(n=n.data)&&r(n=n.registerRouteInstance)&&n(t,e)};e.mixin({beforeCreate:function(){r(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,n(this,this)},destroyed:function(){n(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",g),e.component("RouterLink",F);var o=e.config.optionMergeStrategies;o.beforeRouteEnter=o.beforeRouteLeave=o.beforeRouteUpdate=o.created}},Vt.version="3.5.3",Vt.isNavigationFailure=Rt,Vt.NavigationFailureType=yt,Vt.START_LOCATION=h,D&&window.Vue&&window.Vue.use(Vt),Vt},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueRouter=e();
/*!
 * Vue Scroller 
 * version: 2.2.4 
 * repo: https://github.com/wangdahoo/vue-scroller 
 * build: 2017-09-21 16:25:35
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("VueScroller",[],e):"object"==typeof exports?exports.VueScroller=e():t.VueScroller=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e){t.exports=function(t,e,n,o){var i,r=t=t||{},a=typeof t.default;"object"!==a&&"function"!==a||(i=t,r=t.default);var l="function"==typeof r?r.options:r;if(e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns),n&&(l._scopeId=n),o){var s=Object.create(l.computed||null);Object.keys(o).forEach(function(t){var e=o[t];s[t]=function(){return e}}),l.computed=s}return{esModule:i,exports:r,options:l}}},function(t,e,n){n(14);var o=n(0)(n(3),n(13),"data-v-ecaca2b0",null);t.exports=o.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{fillColor:{type:String,default:"#AAA"}}}},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),r=o(i),a=n(6),l=o(a),s=n(10),c=o(s),_=n(9),u=o(_),f=/^[\d]+(\%)?$/,p=function(t){return"%"!=t[t.length-1]?t+"px":t},h=function(t){return f.test(t)};e.default={components:{Spinner:c.default,Arrow:u.default},props:{onRefresh:Function,onInfinite:Function,refreshText:{type:String,default:""},noDataText:{type:String,default:""},width:{type:String,default:"100%",validator:h},height:{type:String,default:"100%",validator:h},snapping:{type:Boolean,default:!1},snapWidth:{type:Number,default:100},snapHeight:{type:Number,default:100},animating:{type:Boolean,default:!0},animationDuration:{type:Number,default:250},bouncing:{type:Boolean,default:!0},refreshLayerColor:{type:String,default:"#AAA"},loadingLayerColor:{type:String,default:"#AAA"},cssClass:String,minContentHeight:{type:Number,default:0}},computed:{w:function(){return p(this.width)},h:function(){return p(this.height)},showInfiniteLayer:function(){var t=0;return this.content&&(t=this.content.offsetHeight),!!this.onInfinite&&t>this.minContentHeight}},data:function(){return{containerId:"outer-"+Math.random().toString(36).substring(3,8),contentId:"inner-"+Math.random().toString(36).substring(3,8),state:0,loadingState:0,showLoading:!1,container:void 0,content:void 0,scroller:void 0,pullToRefreshLayer:void 0,mousedown:!1,infiniteTimer:void 0,resizeTimer:void 0}},mounted:function(){var t=this;this.container=document.getElementById(this.containerId),this.container.style.width=this.w,this.container.style.height=this.h,this.content=document.getElementById(this.contentId),this.cssClass&&this.content.classList.add(this.cssClass),this.pullToRefreshLayer=this.content.getElementsByTagName("div")[0];var e=(0,l.default)(this.content);this.scroller=new r.default(e,{scrollingX:!1,snapping:this.snapping,animating:this.animating,animationDuration:this.animationDuration,bouncing:this.bouncing}),this.onRefresh&&this.scroller.activatePullToRefresh(60,function(){t.state=1},function(){t.state=0},function(){t.state=2,t.$on("$finishPullToRefresh",function(){setTimeout(function(){t.state=0,t.finishPullToRefresh()})}),t.onRefresh(t.finishPullToRefresh)}),this.onInfinite&&(this.infiniteTimer=setInterval(function(){var e=t.scroller.getValues(),n=(e.left,e.top);e.zoom;if(t.content.offsetHeight>0&&n+60>t.content.offsetHeight-t.container.clientHeight){if(t.loadingState)return;t.loadingState=1,t.showLoading=!0,t.onInfinite(t.finishInfinite)}},10));var n=this.container.getBoundingClientRect();this.scroller.setPosition(n.left+this.container.clientLeft,n.top+this.container.clientTop),this.snapping&&this.scroller.setSnapSize(this.snapWidth,this.snapHeight);var o=function(){return{width:t.content.offsetWidth,height:t.content.offsetHeight}},i=o(),a=i.content_width,s=i.content_height;this.resizeTimer=setInterval(function(){var e=o(),n=e.width,i=e.height;n===a&&i===s||(a=n,s=i,t.resize())},10)},destroyed:function(){clearInterval(this.resizeTimer),this.infiniteTimer&&clearInterval(this.infiniteTimer)},methods:{resize:function(){var t=this.container,e=this.content;this.scroller.setDimensions(t.clientWidth,t.clientHeight,e.offsetWidth,e.offsetHeight)},finishPullToRefresh:function(){this.scroller.finishPullToRefresh()},finishInfinite:function(t){this.loadingState=t?2:0,this.showLoading=!1,2==this.loadingState&&this.resetLoadingState()},triggerPullToRefresh:function(){this.scroller.triggerPullToRefresh()},scrollTo:function(t,e,n){this.scroller.scrollTo(t,e,n)},scrollBy:function(t,e,n){this.scroller.scrollBy(t,e,n)},touchStart:function(t){t.target.tagName.match(/input|textarea|select/i)||this.scroller.doTouchStart(t.touches,t.timeStamp)},touchMove:function(t){this.scroller.doTouchMove(t.touches,t.timeStamp)},touchEnd:function(t){this.scroller.doTouchEnd(t.timeStamp)},mouseDown:function(t){t.target.tagName.match(/input|textarea|select/i)||(this.scroller.doTouchStart([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),this.mousedown=!0)},mouseMove:function(t){this.mousedown&&(this.scroller.doTouchMove([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),this.mousedown=!0)},mouseUp:function(t){this.mousedown&&(this.scroller.doTouchEnd(t.timeStamp),this.mousedown=!1)},getPosition:function(){var t=this.scroller.getValues();return{left:parseInt(t.left),top:parseInt(t.top)}},resetLoadingState:function(){var t=this,e=this.scroller.getValues(),n=(e.left,e.top);e.zoom,this.container,this.content;n+60>this.content.offsetHeight-this.container.clientHeight?setTimeout(function(){t.resetLoadingState()},1e3):this.loadingState=0}}}},function(t,e,n){"use strict";function o(t){o.installed||(o.installed=!0,t.component("scroller",a.default))}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(1),a=function(t){return t&&t.__esModule?t:{default:t}}(r),l={install:o,Scroller:a.default};void 0!==("undefined"==typeof window?"undefined":i(window))&&window.Vue&&window.Vue.use(l),e.default=l},function(t,e,n){"use strict";var o;!function(i){var r=function(){},a=function(t){var e=Date.now||function(){return+new Date},n={},o=1,i={effect:{}};return i.effect.Animate={requestAnimationFrame:function(){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame,n=!!e;if(e&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(e.toString())&&(n=!1),n)return function(t,n){e(t,n)};var o={},i=0,r=1,a=null,l=+new Date;return function(t,e){var n=r++;return o[n]=t,i++,null===a&&(a=setInterval(function(){var t=+new Date,e=o;o={},i=0;for(var n in e)e.hasOwnProperty(n)&&(e[n](t),l=t);t-l>2500&&(clearInterval(a),a=null)},1e3/60)),n}}(),stop:function(t){var e=null!=n[t];return e&&(n[t]=null),e},isRunning:function(t){return null!=n[t]},start:function(t,r,a,l,s,c){var _=e(),u=_,f=0,p=0,h=o++;if(c||(c=document.body),h%20==0){var d={};for(var m in n)d[m]=!0;n=d}var g=function o(d){var m=!0!==d,g=e();if(!n[h]||r&&!r(h))return n[h]=null,void(a&&a(60-p/((g-_)/1e3),h,!1));if(m)for(var v=Math.round((g-u)/(1e3/60))-1,y=0;y<Math.min(v,4);y++)o(!0),p++;l&&(f=(g-_)/l)>1&&(f=1);var T=s?s(f):f;!1!==t(T,g,m)&&1!==f||!m?m&&(u=g,i.effect.Animate.requestAnimationFrame(o,c)):(n[h]=null,a&&a(60-p/((g-_)/1e3),h,1===f||null==l))};return n[h]=!0,i.effect.Animate.requestAnimationFrame(g,c),h}},i}(i),l=function(t,e){this.__callback=t,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:r,penetrationDeceleration:.03,penetrationAcceleration:.08};for(var n in e)this.options[n]=e[n]},s=function(t){return Math.pow(t-1,3)+1},c=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},_={__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(t,e,n,o){var i=this;t===+t&&(i.__clientWidth=t),e===+e&&(i.__clientHeight=e),n===+n&&(i.__contentWidth=n),o===+o&&(i.__contentHeight=o),i.__computeScrollMax(),i.scrollTo(i.__scrollLeft,i.__scrollTop,!0)},setPosition:function(t,e){var n=this;n.__clientLeft=t||0,n.__clientTop=e||0},setSnapSize:function(t,e){var n=this;n.__snapWidth=t,n.__snapHeight=e},activatePullToRefresh:function(t,e,n,o){var i=this;i.__refreshHeight=t,i.__refreshActivate=e,i.__refreshDeactivate=n,i.__refreshStart=o},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var t=this;t.__refreshActive=!1,t.__refreshDeactivate&&t.__refreshDeactivate(),t.scrollTo(t.__scrollLeft,t.__scrollTop,!0)},getValues:function(){var t=this;return{left:t.__scrollLeft,top:t.__scrollTop,zoom:t.__zoomLevel}},getScrollMax:function(){var t=this;return{left:t.__maxScrollLeft,top:t.__maxScrollTop}},zoomTo:function(t,e,n,o,i){var r=this;if(!r.options.zooming)throw new Error("Zooming is not enabled!");i&&(r.__zoomComplete=i),r.__isDecelerating&&(a.effect.Animate.stop(r.__isDecelerating),r.__isDecelerating=!1);var l=r.__zoomLevel;null==n&&(n=r.__clientWidth/2),null==o&&(o=r.__clientHeight/2),t=Math.max(Math.min(t,r.options.maxZoom),r.options.minZoom),r.__computeScrollMax(t);var s=(n+r.__scrollLeft)*t/l-n,c=(o+r.__scrollTop)*t/l-o;s>r.__maxScrollLeft?s=r.__maxScrollLeft:s<0&&(s=0),c>r.__maxScrollTop?c=r.__maxScrollTop:c<0&&(c=0),r.__publish(s,c,t,e)},zoomBy:function(t,e,n,o,i){var r=this;r.zoomTo(r.__zoomLevel*t,e,n,o,i)},scrollTo:function(t,e,n,o){var i=this;if(i.__isDecelerating&&(a.effect.Animate.stop(i.__isDecelerating),i.__isDecelerating=!1),null!=o&&o!==i.__zoomLevel){if(!i.options.zooming)throw new Error("Zooming is not enabled!");t*=o,e*=o,i.__computeScrollMax(o)}else o=i.__zoomLevel;i.options.scrollingX?i.options.paging?t=Math.round(t/i.__clientWidth)*i.__clientWidth:i.options.snapping&&(t=Math.round(t/i.__snapWidth)*i.__snapWidth):t=i.__scrollLeft,i.options.scrollingY?i.options.paging?e=Math.round(e/i.__clientHeight)*i.__clientHeight:i.options.snapping&&(e=Math.round(e/i.__snapHeight)*i.__snapHeight):e=i.__scrollTop,t=Math.max(Math.min(i.__maxScrollLeft,t),0),e=Math.max(Math.min(i.__maxScrollTop,e),0),t===i.__scrollLeft&&e===i.__scrollTop&&(n=!1),i.__isTracking||i.__publish(t,e,o,n)},scrollBy:function(t,e,n){var o=this,i=o.__isAnimating?o.__scheduledLeft:o.__scrollLeft,r=o.__isAnimating?o.__scheduledTop:o.__scrollTop;o.scrollTo(i+(t||0),r+(e||0),n)},doMouseZoom:function(t,e,n,o){var i=this,r=t>0?.97:1.03;return i.zoomTo(i.__zoomLevel*r,!1,n-i.__clientLeft,o-i.__clientTop)},doTouchStart:function(t,e){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var n=this;n.__interruptedAnimation=!0,n.__isDecelerating&&(a.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1,n.__interruptedAnimation=!0),n.__isAnimating&&(a.effect.Animate.stop(n.__isAnimating),n.__isAnimating=!1,n.__interruptedAnimation=!0);var o,i,r=1===t.length;r?(o=t[0].pageX,i=t[0].pageY):(o=Math.abs(t[0].pageX+t[1].pageX)/2,i=Math.abs(t[0].pageY+t[1].pageY)/2),n.__initialTouchLeft=o,n.__initialTouchTop=i,n.__zoomLevelStart=n.__zoomLevel,n.__lastTouchLeft=o,n.__lastTouchTop=i,n.__lastTouchMove=e,n.__lastScale=1,n.__enableScrollX=!r&&n.options.scrollingX,n.__enableScrollY=!r&&n.options.scrollingY,n.__isTracking=!0,n.__didDecelerationComplete=!1,n.__isDragging=!r,n.__isSingleTouch=r,n.__positions=[]},doTouchMove:function(t,e,n){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var o=this;if(o.__isTracking){var i,r;2===t.length?(i=Math.abs(t[0].pageX+t[1].pageX)/2,r=Math.abs(t[0].pageY+t[1].pageY)/2):(i=t[0].pageX,r=t[0].pageY);var a=o.__positions;if(o.__isDragging){var l=i-o.__lastTouchLeft,s=r-o.__lastTouchTop,c=o.__scrollLeft,_=o.__scrollTop,u=o.__zoomLevel;if(null!=n&&o.options.zooming){var f=u;if(u=u/o.__lastScale*n,u=Math.max(Math.min(u,o.options.maxZoom),o.options.minZoom),f!==u){var p=i-o.__clientLeft,h=r-o.__clientTop;c=(p+c)*u/f-p,_=(h+_)*u/f-h,o.__computeScrollMax(u)}}if(o.__enableScrollX){c-=l*this.options.speedMultiplier;var d=o.__maxScrollLeft;(c>d||c<0)&&(o.options.bouncing?c+=l/2*this.options.speedMultiplier:c=c>d?d:0)}if(o.__enableScrollY){_-=s*this.options.speedMultiplier;var m=o.__maxScrollTop;(_>m||_<0)&&(o.options.bouncing?(_+=s/2*this.options.speedMultiplier,o.__enableScrollX||null==o.__refreshHeight||(!o.__refreshActive&&_<=-o.__refreshHeight?(o.__refreshActive=!0,o.__refreshActivate&&o.__refreshActivate()):o.__refreshActive&&_>-o.__refreshHeight&&(o.__refreshActive=!1,o.__refreshDeactivate&&o.__refreshDeactivate()))):_=_>m?m:0)}a.length>60&&a.splice(0,30),a.push(c,_,e),o.__publish(c,_,u)}else{var g=o.options.locking?3:0,v=Math.abs(i-o.__initialTouchLeft),y=Math.abs(r-o.__initialTouchTop);o.__enableScrollX=o.options.scrollingX&&v>=g,o.__enableScrollY=o.options.scrollingY&&y>=g,a.push(o.__scrollLeft,o.__scrollTop,e),o.__isDragging=(o.__enableScrollX||o.__enableScrollY)&&(v>=5||y>=5),o.__isDragging&&(o.__interruptedAnimation=!1)}o.__lastTouchLeft=i,o.__lastTouchTop=r,o.__lastTouchMove=e,o.__lastScale=n}},doTouchEnd:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var e=this;if(e.__isTracking){if(e.__isTracking=!1,e.__isDragging)if(e.__isDragging=!1,e.__isSingleTouch&&e.options.animating&&t-e.__lastTouchMove<=100){for(var n=e.__positions,o=n.length-1,i=o,r=o;r>0&&n[r]>e.__lastTouchMove-100;r-=3)i=r;if(i!==o){var a=n[o]-n[i],l=e.__scrollLeft-n[i-2],s=e.__scrollTop-n[i-1];e.__decelerationVelocityX=l/a*(1e3/60),e.__decelerationVelocityY=s/a*(1e3/60);var c=e.options.paging||e.options.snapping?4:1;Math.abs(e.__decelerationVelocityX)>c||Math.abs(e.__decelerationVelocityY)>c?e.__refreshActive||e.__startDeceleration(t):e.options.scrollingComplete()}else e.options.scrollingComplete()}else t-e.__lastTouchMove>100&&e.options.scrollingComplete();e.__isDecelerating||(e.__refreshActive&&e.__refreshStart?(e.__publish(e.__scrollLeft,-e.__refreshHeight,e.__zoomLevel,!0),e.__refreshStart&&e.__refreshStart()):((e.__interruptedAnimation||e.__isDragging)&&e.options.scrollingComplete(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0,e.__zoomLevel),e.__refreshActive&&(e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate()))),e.__positions.length=0}},__publish:function(t,e,n,o){var i=this,r=i.__isAnimating;if(r&&(a.effect.Animate.stop(r),i.__isAnimating=!1),o&&i.options.animating){i.__scheduledLeft=t,i.__scheduledTop=e,i.__scheduledZoom=n;var l=i.__scrollLeft,_=i.__scrollTop,u=i.__zoomLevel,f=t-l,p=e-_,h=n-u,d=function(t,e,n){n&&(i.__scrollLeft=l+f*t,i.__scrollTop=_+p*t,i.__zoomLevel=u+h*t,i.__callback&&i.__callback(i.__scrollLeft,i.__scrollTop,i.__zoomLevel))},m=function(t){return i.__isAnimating===t},g=function(t,e,n){e===i.__isAnimating&&(i.__isAnimating=!1),(i.__didDecelerationComplete||n)&&i.options.scrollingComplete(),i.options.zooming&&(i.__computeScrollMax(),i.__zoomComplete&&(i.__zoomComplete(),i.__zoomComplete=null))};i.__isAnimating=a.effect.Animate.start(d,m,g,i.options.animationDuration,r?s:c)}else i.__scheduledLeft=i.__scrollLeft=t,i.__scheduledTop=i.__scrollTop=e,i.__scheduledZoom=i.__zoomLevel=n,i.__callback&&i.__callback(t,e,n),i.options.zooming&&(i.__computeScrollMax(),i.__zoomComplete&&(i.__zoomComplete(),i.__zoomComplete=null))},__computeScrollMax:function(t){var e=this;null==t&&(t=e.__zoomLevel),e.__maxScrollLeft=Math.max(e.__contentWidth*t-e.__clientWidth,0),e.__maxScrollTop=Math.max(e.__contentHeight*t-e.__clientHeight,0)},__startDeceleration:function(t){var e=this;if(e.options.paging){var n=Math.max(Math.min(e.__scrollLeft,e.__maxScrollLeft),0),o=Math.max(Math.min(e.__scrollTop,e.__maxScrollTop),0),i=e.__clientWidth,r=e.__clientHeight;e.__minDecelerationScrollLeft=Math.floor(n/i)*i,e.__minDecelerationScrollTop=Math.floor(o/r)*r,e.__maxDecelerationScrollLeft=Math.ceil(n/i)*i,e.__maxDecelerationScrollTop=Math.ceil(o/r)*r}else e.__minDecelerationScrollLeft=0,e.__minDecelerationScrollTop=0,e.__maxDecelerationScrollLeft=e.__maxScrollLeft,e.__maxDecelerationScrollTop=e.__maxScrollTop;var l=function(t,n,o){e.__stepThroughDeceleration(o)},s=e.options.snapping?4:.001,c=function(){var t=Math.abs(e.__decelerationVelocityX)>=s||Math.abs(e.__decelerationVelocityY)>=s;return t||(e.__didDecelerationComplete=!0),t},_=function(t,n,o){e.__isDecelerating=!1,e.__didDecelerationComplete&&e.options.scrollingComplete(),e.scrollTo(e.__scrollLeft,e.__scrollTop,e.options.snapping)};e.__isDecelerating=a.effect.Animate.start(l,c,_)},__stepThroughDeceleration:function(t){var e=this,n=e.__scrollLeft+e.__decelerationVelocityX,o=e.__scrollTop+e.__decelerationVelocityY;if(!e.options.bouncing){var i=Math.max(Math.min(e.__maxDecelerationScrollLeft,n),e.__minDecelerationScrollLeft);i!==n&&(n=i,e.__decelerationVelocityX=0);var r=Math.max(Math.min(e.__maxDecelerationScrollTop,o),e.__minDecelerationScrollTop);r!==o&&(o=r,e.__decelerationVelocityY=0)}if(t?e.__publish(n,o,e.__zoomLevel):(e.__scrollLeft=n,e.__scrollTop=o),!e.options.paging){e.__decelerationVelocityX*=.95,e.__decelerationVelocityY*=.95}if(e.options.bouncing){var a=0,l=0,s=e.options.penetrationDeceleration,c=e.options.penetrationAcceleration;n<e.__minDecelerationScrollLeft?a=e.__minDecelerationScrollLeft-n:n>e.__maxDecelerationScrollLeft&&(a=e.__maxDecelerationScrollLeft-n),o<e.__minDecelerationScrollTop?l=e.__minDecelerationScrollTop-o:o>e.__maxDecelerationScrollTop&&(l=e.__maxDecelerationScrollTop-o),0!==a&&(a*e.__decelerationVelocityX<=0?e.__decelerationVelocityX+=a*s:e.__decelerationVelocityX=a*c),0!==l&&(l*e.__decelerationVelocityY<=0?e.__decelerationVelocityY+=l*s:e.__decelerationVelocityY=l*c)}}};for(var u in _)l.prototype[u]=_[u];void 0!==t&&t.exports?t.exports=l:void 0!==(o=function(){return l}.call(e,n,e,t))&&(t.exports=o)}(window)},function(t,e,n){"use strict";function o(t){var e,n=window,o=document.documentElement.style;n.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?e="presto":"MozAppearance"in o?e="gecko":"WebkitAppearance"in o?e="webkit":"string"==typeof navigator.cpuClass&&(e="trident");var i={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[e],r=document.createElement("div"),a=i+"Perspective",l=i+"Transform";return void 0!==r.style[a]?function(e,n,o){t.style[l]="translate3d("+-e+"px,"+-n+"px,0) scale("+o+")"}:void 0!==r.style[l]?function(e,n,o){t.style[l]="translate("+-e+"px,"+-n+"px) scale("+o+")"}:function(e,n,o){t.style.marginLeft=e?-e/o+"px":"",t.style.marginTop=n?-n/o+"px":"",t.style.zoom=o||""}}t.exports=o},function(t,e,n){e=t.exports=n(8)(),e.push([t.i,"._v-container[data-v-ecaca2b0]{-webkit-tap-highlight-color:rgba(0,0,0,0);width:100%;height:100%;position:absolute;top:0;left:0;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}._v-container>._v-content[data-v-ecaca2b0]{width:100%;-webkit-transform-origin:left top;-webkit-transform:translateZ(0);-moz-transform-origin:left top;-moz-transform:translateZ(0);-ms-transform-origin:left top;-ms-transform:translateZ(0);-o-transform-origin:left top;-o-transform:translateZ(0);transform-origin:left top;transform:translateZ(0)}._v-container>._v-content>.pull-to-refresh-layer[data-v-ecaca2b0]{width:100%;height:60px;margin-top:-60px;text-align:center;font-size:16px;color:#aaa}._v-container>._v-content>.loading-layer[data-v-ecaca2b0]{width:100%;height:60px;text-align:center;font-size:16px;line-height:60px;color:#aaa;position:relative}._v-container>._v-content>.loading-layer>.no-data-text[data-v-ecaca2b0]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:1}._v-container>._v-content>.loading-layer>.no-data-text[data-v-ecaca2b0],._v-container>._v-content>.loading-layer>.spinner-holder[data-v-ecaca2b0]{opacity:0;transition:opacity .15s linear;-webkit-transition:opacity .15s linear}._v-container>._v-content>.loading-layer>.no-data-text.active[data-v-ecaca2b0],._v-container>._v-content>.loading-layer>.spinner-holder.active[data-v-ecaca2b0]{opacity:1}._v-container>._v-content>.loading-layer .spinner-holder[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder[data-v-ecaca2b0]{text-align:center;-webkit-font-smoothing:antialiased}._v-container>._v-content>.loading-layer .spinner-holder .arrow[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .arrow[data-v-ecaca2b0]{width:20px;height:20px;margin:8px auto 0;-webkit-transform:translateZ(0) rotate(0deg);transform:translateZ(0) rotate(0deg);transition:transform .2s linear}._v-container>._v-content>.loading-layer .spinner-holder .text[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .text[data-v-ecaca2b0]{display:block;margin:0 auto;font-size:14px;line-height:20px;color:#aaa}._v-container>._v-content>.loading-layer .spinner-holder .spinner[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .spinner[data-v-ecaca2b0]{margin-top:14px;width:32px;height:32px;fill:#444;stroke:#69717d}._v-container>._v-content>.pull-to-refresh-layer.active .spinner-holder .arrow[data-v-ecaca2b0]{-webkit-transform:translateZ(0) rotate(180deg);transform:translateZ(0) rotate(180deg)}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},i=0;i<this.length;i++){var r=this[i][0];"number"==typeof r&&(o[r]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&o[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(t,e,n){var o=n(0)(n(2),n(11),null,null);t.exports=o.exports},function(t,e,n){var o=n(0)(null,n(12),null,null);t.exports=o.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{staticStyle:{"enable-background":"new 0 0 63.657 63.657"},attrs:{viewBox:"0 0 63.657 63.657","xml:space":"preserve",width:"512px",height:"512px"}},[n("g",[n("g",[n("g",[n("g",[n("polygon",{attrs:{points:"31.891,63.657 0.012,35.835 2.642,32.821 31.886,58.343 61.009,32.824 63.645,35.832",fill:t.fillColor}})])]),t._v(" "),n("g",[n("g",[n("rect",{attrs:{x:"29.827",width:"4",height:"60",fill:t.fillColor}})])])]),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g")]),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g")])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{staticClass:"spinner",attrs:{viewBox:"0 0 64 64"}},[n("g",{attrs:{"stroke-width":"4","stroke-linecap":"round"}},[n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(180)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:"1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0;1",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(210)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:"0;1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(240)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".1;0;1;.85;.7;.65;.55;.45;.35;.25;.15;.1",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(270)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".15;.1;0;1;.85;.7;.65;.55;.45;.35;.25;.15",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(300)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".25;.15;.1;0;1;.85;.7;.65;.55;.45;.35;.25",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(330)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".35;.25;.15;.1;0;1;.85;.7;.65;.55;.45;.35",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(0)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".45;.35;.25;.15;.1;0;1;.85;.7;.65;.55;.45",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(30)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".55;.45;.35;.25;.15;.1;0;1;.85;.7;.65;.55",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(60)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".65;.55;.45;.35;.25;.15;.1;0;1;.85;.7;.65",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(90)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".7;.65;.55;.45;.35;.25;.15;.1;0;1;.85;.7",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(120)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".85;.7;.65;.55;.45;.35;.25;.15;.1;0;1;.85",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(150)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:"1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0;1",repeatCount:"indefinite"}})])])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"_v-container",attrs:{id:t.containerId},on:{touchstart:function(e){t.touchStart(e)},touchmove:function(e){t.touchMove(e)},touchend:function(e){t.touchEnd(e)},mousedown:function(e){t.mouseDown(e)},mousemove:function(e){t.mouseMove(e)},mouseup:function(e){t.mouseUp(e)}}},[n("div",{staticClass:"_v-content",attrs:{id:t.contentId}},[t.onRefresh?n("div",{staticClass:"pull-to-refresh-layer",class:{active:1==t.state,"active refreshing":2==t.state}},[n("span",{staticClass:"spinner-holder"},[2!=t.state?n("arrow",{staticClass:"arrow",attrs:{fillColor:t.refreshLayerColor}}):t._e(),t._v(" "),2!=t.state?n("span",{staticClass:"text",style:{color:t.refreshLayerColor},domProps:{textContent:t._s(t.refreshText)}}):t._e(),t._v(" "),2==t.state?n("span",[t._t("refresh-spinner",[n("spinner",{style:{fill:t.refreshLayerColor,stroke:t.refreshLayerColor}})])],2):t._e()],1)]):t._e(),t._v(" "),t._t("default"),t._v(" "),t.showInfiniteLayer?n("div",{staticClass:"loading-layer"},[n("span",{staticClass:"spinner-holder",class:{active:t.showLoading}},[t._t("infinite-spinner",[n("spinner",{style:{fill:t.loadingLayerColor,stroke:t.loadingLayerColor}})])],2),t._v(" "),n("div",{staticClass:"no-data-text",class:{active:!t.showLoading&&2==t.loadingState},style:{color:t.loadingLayerColor},domProps:{textContent:t._s(t.noDataText)}})]):t._e()],2)])},staticRenderFns:[]}},function(t,e,n){var o=n(7);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(15)("1ca3e1c8",o,!0)},function(t,e,n){function o(t){for(var e=0;e<t.length;e++){var n=t[e],o=_[n.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](n.parts[i]);for(;i<n.parts.length;i++)o.parts.push(r(n.parts[i]));o.parts.length>n.parts.length&&(o.parts.length=n.parts.length)}else{for(var a=[],i=0;i<n.parts.length;i++)a.push(r(n.parts[i]));_[n.id]={id:n.id,refs:1,parts:a}}}}function i(){var t=document.createElement("style");return t.type="text/css",u.appendChild(t),t}function r(t){var e,n,o=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(o){if(h)return d;o.parentNode.removeChild(o)}if(m){var r=p++;o=f||(f=i()),e=a.bind(null,o,r,!1),n=a.bind(null,o,r,!0)}else o=i(),e=l.bind(null,o),n=function(){o.parentNode.removeChild(o)};return e(t),function(o){if(o){if(o.css===t.css&&o.media===t.media&&o.sourceMap===t.sourceMap)return;e(t=o)}else n()}}function a(t,e,n,o){var i=n?"":o.css;if(t.styleSheet)t.styleSheet.cssText=g(e,i);else{var r=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function l(t,e){var n=e.css,o=e.media,i=e.sourceMap;if(o&&t.setAttribute("media",o),i&&(n+="\n/*# sourceURL="+i.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var s="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!s)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var c=n(16),_={},u=s&&(document.head||document.getElementsByTagName("head")[0]),f=null,p=0,h=!1,d=function(){},m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n){h=n;var i=c(t,e);return o(i),function(e){for(var n=[],r=0;r<i.length;r++){var a=i[r],l=_[a.id];l.refs--,n.push(l)}e?(i=c(t,e),o(i)):i=[];for(var r=0;r<n.length;r++){var l=n[r];if(0===l.refs){for(var s=0;s<l.parts.length;s++)l.parts[s]();delete _[l.id]}}}};var g=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var n=[],o={},i=0;i<e.length;i++){var r=e[i],a=r[0],l=r[1],s=r[2],c=r[3],_={id:t+":"+i,css:l,media:s,sourceMap:c};o[a]?o[a].parts.push(_):n.push(o[a]={id:a,parts:[_]})}return n}}])});
//# sourceMappingURL=vue-scroller.min.js.map
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).transform={})}(this,(function(e){"use strict";const t=["scale","scale3d","scaleX","scaleY","scaleZ"];e.parse=e=>{const t=e.trim().split(/\) |\)/);if(1===t.length)return{[t[0]]:!0};return t.reduce((e,t)=>{if(!t)return e;const[r,n]=t.split("("),s=n.split(",").map(e=>(e=>e.endsWith("px")?parseFloat(e):Number.isNaN(Number(e))?e:Number(e))(e.endsWith(")")?e.replace(")",""):e.trim())),i=1===s.length?s[0]:s;return Object.assign(e,{[r]:i})},{})},e.stringify=e=>{const r=(e,r)=>"number"!=typeof r||t.includes(e)?r.toString():r+"px";return Object.keys(e).reduce((t,n)=>{const s=e[n];return!0===s?n:!1===s?t:Array.isArray(s)?`${t} ${n}(${s.map(e=>r(n,e)).join(", ")})`:`${t} ${n}(${r(n,s)})`},"").trim()},Object.defineProperty(e,"__esModule",{value:!0})}));
!function(e){"use strict";if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return new Blob}catch(e){}var a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){function s(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]}function t(){this.data=[]}function c(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n}function l(e){this.code=this[this.name=e]}var n=t.prototype,o=c.prototype,d=e.FileReaderSync,i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),r=i.length,a=e.URL||e.webkitURL||e,u=a.createObjectURL,p=a.revokeObjectURL,h=a,g=e.btoa,f=e.atob,m=e.ArrayBuffer,v=e.Uint8Array,b=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(c.fake=o.fake=!0;r--;)l.prototype[i[r]]=r+1;return a.createObjectURL||(h=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(b),n.origin=t&&t[1])),n}),h.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof c?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):g?t+";base64,"+g(e.data):t+","+encodeURIComponent(e.data)):u?u.call(a,e):void 0},h.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&p&&p.call(a,e)},n.append=function(e){var t=this.data;if(v&&(e instanceof m||e instanceof v)){for(var n="",o=new v(e),i=0,r=o.length;i<r;i++)n+=String.fromCharCode(o[i]);t.push(n)}else if("Blob"===s(e)||"File"===s(e)){if(!d)throw new l("NOT_READABLE_ERR");var a=new d;t.push(a.readAsBinaryString(e))}else e instanceof c?"base64"===e.encoding&&f?t.push(f(e.data)):"URI"===e.encoding?t.push(decodeURIComponent(e.data)):"raw"===e.encoding&&t.push(e.data):("string"!=typeof e&&(e+=""),t.push(unescape(encodeURIComponent(e))))},n.getBlob=function(e){return arguments.length||(e=null),new c(this.data.join(""),e,"raw")},n.toString=function(){return"[object BlobBuilder]"},o.slice=function(e,t,n){var o=arguments.length;return o<3&&(n=null),new c(this.data.slice(e,1<o?t:this.data.length),n,this.encoding)},o.toString=function(){return"[object Blob]"},o.close=function(){this.size=0,delete this.data},t}(e);e.Blob=function(e,t){var n=t&&t.type||"",o=new a;if(e)for(var i=0,r=e.length;i<r;i++)o.append(e[i]);return o.getBlob(n)}}(void 0!==self&&self||"undefined"!=typeof window&&window||this.content||this);var CryptoJS=CryptoJS||function(s){function n(){}var e={},t=e.lib={},o=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||r).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var i=0;i<e;i++)t[o+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(o+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[o+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=s.ceil(t/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*s.random()|0);return new c.init(t,e)}}),i=e.enc={},r=i.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},a=i.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++)n.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},l=i.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},d=t.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,o=t.sigBytes,i=this.blockSize,r=o/(4*i);if(e=(r=e?s.ceil(r):s.max((0|r)-this._minBufferSize,0))*i,o=s.min(4*e,o),e){for(var a=0;a<e;a+=i)this._doProcessBlock(n,a);a=n.splice(0,e),t.sigBytes-=o}return new c.init(a,o)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});t.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new u.HMAC.init(n,t).finalize(e)}}});var u=e.algo={};return e}(Math);function UAParser(){this.ua="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"",this.UNKNOWN="?",this.OBJ_TYPE="object",this.STR_TYPE="string",this.NAME="name",this.VERSION="version",this.BLACKBERRY="BlackBerry",this.BROWSER="Browser",this.CHROME="Chrome",this.FIREFOX="Firefox",this.OPERA="Opera",this.oldSafariMap={"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},this.windowsVersionMap={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},this.regexes={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[this.NAME,this.VERSION],[/opios[\/ ]+([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Mini"]],[/\bopr\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[this.NAME,this.VERSION],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[this.VERSION,[this.NAME,"UC"+this.BROWSER]],[/\bqbcore\/([\w\.]+)/i],[this.VERSION,[this.NAME,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[this.VERSION,[this.NAME,"WeChat"]],[/konqueror\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[this.VERSION,[this.NAME,"IE"]],[/yabrowser\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[this.NAME,/(.+)/,"$1 Secure "+this.BROWSER],this.VERSION],[/\bfocus\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX+" Focus"]],[/\bopt\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Dolphin"]],[/coast\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[this.VERSION,[this.NAME,"MIUI "+this.BROWSER]],[/fxios\/([-\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX]],[/\bqihu|(qi?ho?o?|360)browser/i],[[this.NAME,"360 "+this.BROWSER]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[this.NAME,/(.+)/,"$1 "+this.BROWSER],this.VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[this.NAME,/_/g," "],this.VERSION],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[this.NAME,this.VERSION],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[this.NAME],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[this.NAME,"Facebook"],this.VERSION],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[this.NAME,this.VERSION],[/\bgsa\/([\w\.]+) .*safari\//i],[this.VERSION,[this.NAME,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[this.VERSION,[this.NAME,this.CHROME+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[this.NAME,this.CHROME+" WebView"],this.VERSION],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[this.VERSION,[this.NAME,"Android "+this.BROWSER]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[this.NAME,this.VERSION],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[this.VERSION,[this.NAME,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[this.VERSION,this.NAME],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[this.NAME,[this.VERSION,this.strMapper,this.oldSafariMap]],[/(webkit|khtml)\/([\w\.]+)/i],[this.NAME,this.VERSION],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[this.NAME,"Netscape"],this.VERSION],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[this.VERSION,[this.NAME,this.FIREFOX+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[this.NAME,this.VERSION]],os:[[/microsoft (windows) (vista|xp)/i],[this.NAME,this.VERSION],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[this.NAME,[this.VERSION,this.strMapper,this.windowsVersionMap]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[this.NAME,"Windows"],[this.VERSION,this.strMapper,this.windowsVersionMap]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[this.VERSION,/_/g,"."],[this.NAME,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[this.NAME,"Mac OS"],[this.VERSION,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[this.VERSION,this.NAME],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[this.NAME,this.VERSION],[/\(bb(10);/i],[this.VERSION,[this.NAME,this.BLACKBERRY]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[this.VERSION,[this.NAME,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[this.VERSION,[this.NAME,"webOS"]],[/crkey\/([\d\.]+)/i],[this.VERSION,[this.NAME,this.CHROME+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[this.NAME,"Chromium OS"],this.VERSION],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[this.NAME,this.VERSION],[/(sunos) ?([\w\.\d]*)/i],[[this.NAME,"Solaris"],this.VERSION],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[this.NAME,this.VERSION]]},this.has=function(e,t){return typeof e===this.STR_TYPE&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},this.strMapper=function(e,t){for(var n in t)if(typeof t[n]===this.OBJ_TYPE&&0<t[n].length){for(var o=0;o<t[n].length;o++)if(this.has(t[n][o],e))return n===this.UNKNOWN?void 0:n}else if(this.has(t[n],e))return n===this.UNKNOWN?void 0:n;return e},this.rgxMapper=function(e,t,n){for(var o,i,r,a,s,c=0;c<n.length&&!a;){for(var l=n[c],d=n[c+1],u=o=0;u<l.length&&!a;)if(a=l[u++].exec(t))for(i=0;i<d.length;i++)s=a[++o],typeof(r=d[i])===this.OBJ_TYPE&&0<r.length?2==r.length?"function"==typeof r[1]?e[r[0]]=r[1].call(e,s):e[r[0]]=r[1]:3==r.length?"function"!=typeof r[1]||r[1].exec&&r[1].test?e[r[0]]=s?s.replace(r[1],r[2]):void 0:e[r[0]]=s?r[1].call(e,s,r[2]):void 0:4==r.length&&(e[r[0]]=s?r[3].call(e,s.replace(r[1],r[2])):void 0):e[r]=s||void 0;c+=2}},this.getBrowserDetails=function(){var e={name:void 0,version:void 0};return this.rgxMapper(e,this.ua,this.regexes.browser),e},this.getOSDetails=function(){var e={name:void 0,version:void 0};return this.rgxMapper(e,this.ua,this.regexes.os),e}}!function(){var c=CryptoJS.lib.WordArray;CryptoJS.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var r=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<n;a++)e.push(o.charAt(r>>>6*(3-a)&63));if(t=o.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;!(r=n.charAt(64))||-1!=(r=e.indexOf(r))&&(t=r);for(var o,i,r=[],a=0,s=0;s<t;s++){s%4&&(o=n.indexOf(e.charAt(s-1))<<s%4*2,i=n.indexOf(e.charAt(s))>>>6-s%4*2,r[a>>>2]|=(o|i)<<24-a%4*8,a++)}return c.create(r,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(r){function x(e,t,n,o,i,r,a){return((e=e+(t&n|~t&o)+i+a)<<r|e>>>32-r)+t}function I(e,t,n,o,i,r,a){return((e=e+(t&o|n&~o)+i+a)<<r|e>>>32-r)+t}function E(e,t,n,o,i,r,a){return((e=e+(t^n^o)+i+a)<<r|e>>>32-r)+t}function S(e,t,n,o,i,r,a){return((e=e+(n^(t|~o))+i+a)<<r|e>>>32-r)+t}for(var e=CryptoJS,t=(o=e.lib).WordArray,n=o.Hasher,o=e.algo,T=[],i=0;i<64;i++)T[i]=4294967296*r.abs(r.sin(i+1))|0;o=o.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=e[i=t+n];e[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var n=this._hash.words,i=e[t+0],o=e[t+1],r=e[t+2],a=e[t+3],s=e[t+4],c=e[t+5],l=e[t+6],d=e[t+7],u=e[t+8],p=e[t+9],h=e[t+10],g=e[t+11],f=e[t+12],m=e[t+13],v=e[t+14],b=e[t+15],k=x(k=n[0],C=n[1],w=n[2],y=n[3],i,7,T[0]),y=x(y,k,C,w,o,12,T[1]),w=x(w,y,k,C,r,17,T[2]),C=x(C,w,y,k,a,22,T[3]),k=x(k,C,w,y,s,7,T[4]),y=x(y,k,C,w,c,12,T[5]),w=x(w,y,k,C,l,17,T[6]),C=x(C,w,y,k,d,22,T[7]),k=x(k,C,w,y,u,7,T[8]),y=x(y,k,C,w,p,12,T[9]),w=x(w,y,k,C,h,17,T[10]),C=x(C,w,y,k,g,22,T[11]),k=x(k,C,w,y,f,7,T[12]),y=x(y,k,C,w,m,12,T[13]),w=x(w,y,k,C,v,17,T[14]),k=I(k,C=x(C,w,y,k,b,22,T[15]),w,y,o,5,T[16]),y=I(y,k,C,w,l,9,T[17]),w=I(w,y,k,C,g,14,T[18]),C=I(C,w,y,k,i,20,T[19]),k=I(k,C,w,y,c,5,T[20]),y=I(y,k,C,w,h,9,T[21]),w=I(w,y,k,C,b,14,T[22]),C=I(C,w,y,k,s,20,T[23]),k=I(k,C,w,y,p,5,T[24]),y=I(y,k,C,w,v,9,T[25]),w=I(w,y,k,C,a,14,T[26]),C=I(C,w,y,k,u,20,T[27]),k=I(k,C,w,y,m,5,T[28]),y=I(y,k,C,w,r,9,T[29]),w=I(w,y,k,C,d,14,T[30]),k=E(k,C=I(C,w,y,k,f,20,T[31]),w,y,c,4,T[32]),y=E(y,k,C,w,u,11,T[33]),w=E(w,y,k,C,g,16,T[34]),C=E(C,w,y,k,v,23,T[35]),k=E(k,C,w,y,o,4,T[36]),y=E(y,k,C,w,s,11,T[37]),w=E(w,y,k,C,d,16,T[38]),C=E(C,w,y,k,h,23,T[39]),k=E(k,C,w,y,m,4,T[40]),y=E(y,k,C,w,i,11,T[41]),w=E(w,y,k,C,a,16,T[42]),C=E(C,w,y,k,l,23,T[43]),k=E(k,C,w,y,p,4,T[44]),y=E(y,k,C,w,f,11,T[45]),w=E(w,y,k,C,b,16,T[46]),k=S(k,C=E(C,w,y,k,r,23,T[47]),w,y,i,6,T[48]),y=S(y,k,C,w,d,10,T[49]),w=S(w,y,k,C,v,15,T[50]),C=S(C,w,y,k,c,21,T[51]),k=S(k,C,w,y,f,6,T[52]),y=S(y,k,C,w,a,10,T[53]),w=S(w,y,k,C,h,15,T[54]),C=S(C,w,y,k,o,21,T[55]),k=S(k,C,w,y,u,6,T[56]),y=S(y,k,C,w,b,10,T[57]),w=S(w,y,k,C,l,15,T[58]),C=S(C,w,y,k,m,21,T[59]),k=S(k,C,w,y,s,6,T[60]),y=S(y,k,C,w,g,10,T[61]),w=S(w,y,k,C,r,15,T[62]),C=S(C,w,y,k,p,21,T[63]);n[0]=n[0]+k|0,n[1]=n[1]+C|0,n[2]=n[2]+w|0,n[3]=n[3]+y|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32;var i=r.floor(n/4294967296);for(t[15+(64+o>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t[14+(64+o>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;n<4;n++)o=t[n],t[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=n._createHelper(o),e.HmacMD5=n._createHmacHelper(o)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,l=t.WordArray,o=(t=e.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(a=this.cfg).hasher.create(),o=l.create(),i=o.words,r=a.keySize,a=a.iterations;i.length<r;){s&&n.update(s);var s=n.update(e).finalize(t);n.reset();for(var c=1;c<a;c++)s=n.finalize(s),n.reset();o.concat(s)}return o.sigBytes=4*r,o}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(){var e=(p=CryptoJS).lib,t=e.Base,a=e.WordArray,n=e.BufferedBlockAlgorithm,o=p.enc.Base64,i=p.algo.EvpKDF,r=e.Cipher=n.extend({cfg:t.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){n.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(o){return{encrypt:function(e,t,n){return("string"==typeof t?h:u).encrypt(o,e,t,n)},decrypt:function(e,t,n){return("string"==typeof t?h:u).decrypt(o,e,t,n)}}}});e.StreamCipher=r.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});function s(e,t,n){var o=this._iv;o?this._iv=void 0:o=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=o[i]}var c=p.mode={},l=(e.BlockCipherMode=t.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize;s.call(this,e,t,o),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+o)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=e.slice(t,t+o);n.decryptBlock(e,t),s.call(this,e,t,o),this._prevBlock=i}}),c=c.CBC=l,l=(p.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,o=(n=n-e.sigBytes%n)<<24|n<<16|n<<8|n,i=[],r=0;r<n;r+=4)i.push(o);n=a.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},e.BlockCipher=r.extend({cfg:r.cfg.extend({mode:c,padding:l}),reset:function(){r.reset.call(this);var e,t=(n=this.cfg).iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode=e.call(n,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var d=e.CipherParams=t.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?a.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t,n=(e=o.parse(e)).words;return 1398893684==n[0]&&1701076831==n[1]&&(t=a.create(n.slice(2,4)),n.splice(0,4),e.sigBytes-=16),d.create({ciphertext:e,salt:t})}},u=e.SerializableCipher=t.extend({cfg:t.extend({format:c}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var i=e.createEncryptor(n,o);return t=i.finalize(t),i=i.cfg,d.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,o){return o=o||a.random(8),e=i.create({keySize:t+n}).compute(e,o),n=a.create(e.words.slice(t),4*n),e.sigBytes=4*t,d.create({key:e,iv:n,salt:o})}},h=e.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:p}),encrypt:function(e,t,n,o){return n=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize),o.iv=n.iv,(e=u.encrypt.call(this,e,t,n.key,o)).mixIn(n),e},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),n=o.kdf.execute(n,e.keySize,e.ivSize,t.salt),o.iv=n.iv,u.decrypt.call(this,e,t,n.key,o)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,a=[],o=[],i=[],r=[],s=[],c=[],l=[],d=[],u=[],p=[],h=[],g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(var f=0,m=0,g=0;g<256;g++){var v=(v=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&v^99;a[f]=v;var b=h[o[v]=f],k=h[b],y=h[k],w=257*h[v]^16843008*v;i[f]=w<<24|w>>>8,r[f]=w<<16|w>>>16,s[f]=w<<8|w>>>24,c[f]=w,w=16843009*y^65537*k^257*b^16843008*f,l[v]=w<<24|w>>>8,d[v]=w<<16|w>>>16,u[v]=w<<8|w>>>24,p[v]=w,f?(f=b^h[h[h[y^b]]],m^=h[h[m]]):f=m=1}var C=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e,t=(o=this._key).words,n=o.sigBytes/4,o=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],r=0;r<o;r++){r<n?i[r]=t[r]:(e=i[r-1],r%n?6<n&&4==r%n&&(e=a[e>>>24]<<24|a[e>>>16&255]<<16|a[e>>>8&255]<<8|a[255&e]):(e=a[(e=e<<8|e>>>24)>>>24]<<24|a[e>>>16&255]<<16|a[e>>>8&255]<<8|a[255&e],e^=C[r/n|0]<<24),i[r]=i[r-n]^e)}for(t=this._invKeySchedule=[],n=0;n<o;n++)r=o-n,e=n%4?i[r]:i[r-4],t[n]=n<4||r<=4?e:l[a[e>>>24]]^d[a[e>>>16&255]]^u[a[e>>>8&255]]^p[a[255&e]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,r,s,c,a)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,u,p,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,i,r,a,s){for(var c=this._nRounds,l=e[t]^n[0],d=e[t+1]^n[1],u=e[t+2]^n[2],p=e[t+3]^n[3],h=4,g=1;g<c;g++)var f=o[l>>>24]^i[d>>>16&255]^r[u>>>8&255]^a[255&p]^n[h++],m=o[d>>>24]^i[u>>>16&255]^r[p>>>8&255]^a[255&l]^n[h++],v=o[u>>>24]^i[p>>>16&255]^r[l>>>8&255]^a[255&d]^n[h++],p=o[p>>>24]^i[l>>>16&255]^r[d>>>8&255]^a[255&u]^n[h++],l=f,d=m,u=v;f=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[u>>>8&255]<<8|s[255&p])^n[h++],m=(s[d>>>24]<<24|s[u>>>16&255]<<16|s[p>>>8&255]<<8|s[255&l])^n[h++],v=(s[u>>>24]<<24|s[p>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^n[h++],p=(s[p>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&u])^n[h++],e[t]=f,e[t+1]=m,e[t+2]=v,e[t+3]=p},keySize:8});e.AES=t._createHelper(n)}(),function(e,t){"object"==typeof exports?module.exports=exports=t(require("./core")):"function"==typeof define&&define.amd?define(["./core"],t):t(e.CryptoJS)}(this,function(c){return function(i){var e=c,t=e.lib,n=t.WordArray,o=t.Hasher,r=e.algo,a=[],k=[];!function(){function e(e){return 0|4294967296*(e-(0|e))}for(var t=2,n=0;n<64;)!function(e){for(var t=i.sqrt(e),n=2;n<=t;n++)if(!(e%n))return;return 1}(t)||(n<8&&(a[n]=e(i.pow(t,.5))),k[n]=e(i.pow(t,1/3)),n++),t++}();var y=[],s=r.SHA256=o.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n,o,i,r,a=this._hash.words,s=a[0],c=a[1],l=a[2],d=a[3],u=a[4],p=a[5],h=a[6],g=a[7],f=0;f<64;f++){f<16?y[f]=0|e[t+f]:(o=((n=y[f-15])<<25|n>>>7)^(n<<14|n>>>18)^n>>>3,r=((i=y[f-2])<<15|i>>>17)^(i<<13|i>>>19)^i>>>10,y[f]=o+y[f-7]+r+y[f-16]);var m=s&c^s&l^c&l,v=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),b=g+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&p^~u&h)+k[f]+y[f],g=h,h=p,p=u,u=0|d+b,d=l,l=c,c=s,s=0|b+(v+m)}a[0]=0|a[0]+s,a[1]=0|a[1]+c,a[2]=0|a[2]+l,a[3]=0|a[3]+d,a[4]=0|a[4]+u,a[5]=0|a[5]+p,a[6]=0|a[6]+h,a[7]=0|a[7]+g},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(64+o>>>9<<4)]=i.floor(n/4294967296),t[15+(64+o>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=o._createHelper(s),e.HmacSHA256=o._createHmacHelper(s)}(Math),c.SHA256}),function(e,t){"use strict";"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Fingerprint2=t()}(this,function(){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError("'this' is null or undefined");var o=Object(this),i=o.length>>>0;if(0==i)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),i<=r)return-1;for(n=Math.max(0<=r?r:i-Math.abs(r),0);n<i;){if(n in o&&o[n]===e)return n;n++}return-1});function e(e){this.options=this.extend(e,{swfContainerId:"fingerprintjs2",swfPath:"flash/compiled/FontList.swf",detectScreenOrientation:!0,sortPluginsFor:[/palemoon/i]}),this.nativeForEach=Array.prototype.forEach,this.nativeMap=Array.prototype.map}return e.prototype={extend:function(e,t){if(null==e)return t;for(var n in e)null!=e[n]&&t[n]!==e[n]&&(t[n]=e[n]);return t},log:function(e){window.console},get:function(o){var e=[],e=this.userAgentKey(e);e=this.languageKey(e),e=this.colorDepthKey(e),e=this.screenResolutionKey(e),e=this.availableScreenResolutionKey(e),e=this.timezoneOffsetKey(e),e=this.sessionStorageKey(e),e=this.localStorageKey(e),e=this.indexedDbKey(e),e=this.addBehaviorKey(e),e=this.openDatabaseKey(e),e=this.cpuClassKey(e),e=this.platformKey(e),e=this.doNotTrackKey(e),e=this.pluginsKey(e),e=this.canvasKey(e),e=this.webglKey(e),e=this.adBlockKey(e),e=this.hasLiedLanguagesKey(e),e=this.hasLiedResolutionKey(e),e=this.hasLiedOsKey(e),e=this.hasLiedBrowserKey(e),e=this.touchSupportKey(e);var i=this;this.fontsKey(e,function(e){var n=[];i.each(e,function(e){var t=e.value;e.value&&(void 0!==e.value.join&&(t=e.value.join(";")),n.push(t))});var t=i.x64hash128(n.join("~~~"),31);return o(t,e)})},userAgentKey:function(e){return this.options.excludeUserAgent||e.push({key:"user_agent",value:this.getUserAgent()}),e},getUserAgent:function(){return navigator.userAgent},languageKey:function(e){return this.options.excludeLanguage||e.push({key:"language",value:navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage}),e},colorDepthKey:function(e){return this.options.excludeColorDepth||e.push({key:"color_depth",value:screen.colorDepth}),e},screenResolutionKey:function(e){return this.options.excludeScreenResolution?e:this.getScreenResolution(e)},getScreenResolution:function(e){var t=this.options.detectScreenOrientation&&screen.height>screen.width?[screen.height,screen.width]:[screen.width,screen.height];return void 0!==t&&e.push({key:"resolution",value:t}),e},availableScreenResolutionKey:function(e){return this.options.excludeAvailableScreenResolution?e:this.getAvailableScreenResolution(e)},getAvailableScreenResolution:function(e){var t;return screen.availWidth&&screen.availHeight&&(t=!this.options.detectScreenOrientation||screen.availHeight>screen.availWidth?[screen.availHeight,screen.availWidth]:[screen.availWidth,screen.availHeight]),void 0!==t&&e.push({key:"available_resolution",value:t}),e},timezoneOffsetKey:function(e){return this.options.excludeTimezoneOffset||e.push({key:"timezone_offset",value:(new Date).getTimezoneOffset()}),e},sessionStorageKey:function(e){return!this.options.excludeSessionStorage&&this.hasSessionStorage()&&e.push({key:"session_storage",value:1}),e},localStorageKey:function(e){return!this.options.excludeSessionStorage&&this.hasLocalStorage()&&e.push({key:"local_storage",value:1}),e},indexedDbKey:function(e){return!this.options.excludeIndexedDB&&this.hasIndexedDB()&&e.push({key:"indexed_db",value:1}),e},addBehaviorKey:function(e){return document.body&&!this.options.excludeAddBehavior&&document.body.addBehavior&&e.push({key:"add_behavior",value:1}),e},openDatabaseKey:function(e){return!this.options.excludeOpenDatabase&&window.openDatabase&&e.push({key:"open_database",value:1}),e},cpuClassKey:function(e){return this.options.excludeCpuClass||e.push({key:"cpu_class",value:this.getNavigatorCpuClass()}),e},platformKey:function(e){return this.options.excludePlatform||e.push({key:"navigator_platform",value:this.getNavigatorPlatform()}),e},doNotTrackKey:function(e){return this.options.excludeDoNotTrack||e.push({key:"do_not_track",value:this.getDoNotTrack()}),e},canvasKey:function(e){return!this.options.excludeCanvas&&this.isCanvasSupported()&&e.push({key:"canvas",value:this.getCanvasFp()}),e},webglKey:function(e){return this.options.excludeWebGL?"undefined"==typeof NODEBUG&&this.log("Skipping WebGL fingerprinting per excludeWebGL configuration option"):this.isWebGlSupported()?e.push({key:"webgl",value:this.getWebglFp()}):"undefined"==typeof NODEBUG&&this.log("Skipping WebGL fingerprinting because it is not supported in this browser"),e},adBlockKey:function(e){return this.options.excludeAdBlock||e.push({key:"adblock",value:this.getAdBlock()}),e},hasLiedLanguagesKey:function(e){return this.options.excludeHasLiedLanguages||e.push({key:"has_lied_languages",value:this.getHasLiedLanguages()}),e},hasLiedResolutionKey:function(e){return this.options.excludeHasLiedResolution||e.push({key:"has_lied_resolution",value:this.getHasLiedResolution()}),e},hasLiedOsKey:function(e){return this.options.excludeHasLiedOs||e.push({key:"has_lied_os",value:this.getHasLiedOs()}),e},hasLiedBrowserKey:function(e){return this.options.excludeHasLiedBrowser||e.push({key:"has_lied_browser",value:this.getHasLiedBrowser()}),e},fontsKey:function(e,t){return this.options.excludeJsFonts?this.flashFontsKey(e,t):this.jsFontsKey(e,t)},flashFontsKey:function(t,n){return this.options.excludeFlashFonts?("undefined"==typeof NODEBUG&&this.log("Skipping flash fonts detection per excludeFlashFonts configuration option"),n(t)):this.hasSwfObjectLoaded()?this.hasMinFlashInstalled()?void 0===this.options.swfPath?("undefined"==typeof NODEBUG&&this.log("To use Flash fonts detection, you must pass a valid swfPath option, skipping Flash fonts enumeration"),n(t)):void this.loadSwfAndDetectFonts(function(e){t.push({key:"swf_fonts",value:e.join(";")}),n(t)}):("undefined"==typeof NODEBUG&&this.log("Flash is not installed, skipping Flash fonts enumeration"),n(t)):("undefined"==typeof NODEBUG&&this.log("Swfobject is not detected, Flash fonts enumeration is skipped"),n(t))},jsFontsKey:function(u,p){var h=this;return setTimeout(function(){var r=["monospace","sans-serif","serif"],a=document.getElementsByTagName("body")[0],s=document.createElement("span");s.style.fontSize="72px",s.innerHTML="mmmmmmmmmmlli";for(var c={},l={},e=0,t=r.length;e<t;e++)s.style.fontFamily=r[e],a.appendChild(s),c[r[e]]=s.offsetWidth,l[r[e]]=s.offsetHeight,a.removeChild(s);var n=["Andale Mono","Arial","Arial Black","Arial Hebrew","Arial MT","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Bitstream Vera Sans Mono","Book Antiqua","Bookman Old Style","Calibri","Cambria","Cambria Math","Century","Century Gothic","Century Schoolbook","Comic Sans","Comic Sans MS","Consolas","Courier","Courier New","Garamond","Geneva","Georgia","Helvetica","Helvetica Neue","Impact","Lucida Bright","Lucida Calligraphy","Lucida Console","Lucida Fax","LUCIDA GRANDE","Lucida Handwriting","Lucida Sans","Lucida Sans Typewriter","Lucida Sans Unicode","Microsoft Sans Serif","Monaco","Monotype Corsiva","MS Gothic","MS Outlook","MS PGothic","MS Reference Sans Serif","MS Sans Serif","MS Serif","MYRIAD","MYRIAD PRO","Palatino","Palatino Linotype","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Tahoma","Times","Times New Roman","Times New Roman PS","Trebuchet MS","Verdana","Wingdings","Wingdings 2","Wingdings 3"];h.options.extendedJsFonts&&(n=n.concat(["Abadi MT Condensed Light","Academy Engraved LET","ADOBE CASLON PRO","Adobe Garamond","ADOBE GARAMOND PRO","Agency FB","Aharoni","Albertus Extra Bold","Albertus Medium","Algerian","Amazone BT","American Typewriter","American Typewriter Condensed","AmerType Md BT","Andalus","Angsana New","AngsanaUPC","Antique Olive","Aparajita","Apple Chancery","Apple Color Emoji","Apple SD Gothic Neo","Arabic Typesetting","ARCHER","ARNO PRO","Arrus BT","Aurora Cn BT","AvantGarde Bk BT","AvantGarde Md BT","AVENIR","Ayuthaya","Bandy","Bangla Sangam MN","Bank Gothic","BankGothic Md BT","Baskerville","Baskerville Old Face","Batang","BatangChe","Bauer Bodoni","Bauhaus 93","Bazooka","Bell MT","Bembo","Benguiat Bk BT","Berlin Sans FB","Berlin Sans FB Demi","Bernard MT Condensed","BernhardFashion BT","BernhardMod BT","Big Caslon","BinnerD","Blackadder ITC","BlairMdITC TT","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bodoni MT","Bodoni MT Black","Bodoni MT Condensed","Bodoni MT Poster Compressed","Bookshelf Symbol 7","Boulder","Bradley Hand","Bradley Hand ITC","Bremen Bd BT","Britannic Bold","Broadway","Browallia New","BrowalliaUPC","Brush Script MT","Californian FB","Calisto MT","Calligrapher","Candara","CaslonOpnface BT","Castellar","Centaur","Cezanne","CG Omega","CG Times","Chalkboard","Chalkboard SE","Chalkduster","Charlesworth","Charter Bd BT","Charter BT","Chaucer","ChelthmITC Bk BT","Chiller","Clarendon","Clarendon Condensed","CloisterBlack BT","Cochin","Colonna MT","Constantia","Cooper Black","Copperplate","Copperplate Gothic","Copperplate Gothic Bold","Copperplate Gothic Light","CopperplGoth Bd BT","Corbel","Cordia New","CordiaUPC","Cornerstone","Coronet","Cuckoo","Curlz MT","DaunPenh","Dauphin","David","DB LCD Temp","DELICIOUS","Denmark","DFKai-SB","Didot","DilleniaUPC","DIN","DokChampa","Dotum","DotumChe","Ebrima","Edwardian Script ITC","Elephant","English 111 Vivace BT","Engravers MT","EngraversGothic BT","Eras Bold ITC","Eras Demi ITC","Eras Light ITC","Eras Medium ITC","EucrosiaUPC","Euphemia","Euphemia UCAS","EUROSTILE","Exotc350 Bd BT","FangSong","Felix Titling","Fixedsys","FONTIN","Footlight MT Light","Forte","FrankRuehl","Fransiscan","Freefrm721 Blk BT","FreesiaUPC","Freestyle Script","French Script MT","FrnkGothITC Bk BT","Fruitger","FRUTIGER","Futura","Futura Bk BT","Futura Lt BT","Futura Md BT","Futura ZBlk BT","FuturaBlack BT","Gabriola","Galliard BT","Gautami","Geeza Pro","Geometr231 BT","Geometr231 Hv BT","Geometr231 Lt BT","GeoSlab 703 Lt BT","GeoSlab 703 XBd BT","Gigi","Gill Sans","Gill Sans MT","Gill Sans MT Condensed","Gill Sans MT Ext Condensed Bold","Gill Sans Ultra Bold","Gill Sans Ultra Bold Condensed","Gisha","Gloucester MT Extra Condensed","GOTHAM","GOTHAM BOLD","Goudy Old Style","Goudy Stout","GoudyHandtooled BT","GoudyOLSt BT","Gujarati Sangam MN","Gulim","GulimChe","Gungsuh","GungsuhChe","Gurmukhi MN","Haettenschweiler","Harlow Solid Italic","Harrington","Heather","Heiti SC","Heiti TC","HELV","Herald","High Tower Text","Hiragino Kaku Gothic ProN","Hiragino Mincho ProN","Hoefler Text","Humanst 521 Cn BT","Humanst521 BT","Humanst521 Lt BT","Imprint MT Shadow","Incised901 Bd BT","Incised901 BT","Incised901 Lt BT","INCONSOLATA","Informal Roman","Informal011 BT","INTERSTATE","IrisUPC","Iskoola Pota","JasmineUPC","Jazz LET","Jenson","Jester","Jokerman","Juice ITC","Kabel Bk BT","Kabel Ult BT","Kailasa","KaiTi","Kalinga","Kannada Sangam MN","Kartika","Kaufmann Bd BT","Kaufmann BT","Khmer UI","KodchiangUPC","Kokila","Korinna BT","Kristen ITC","Krungthep","Kunstler Script","Lao UI","Latha","Leelawadee","Letter Gothic","Levenim MT","LilyUPC","Lithograph","Lithograph Light","Long Island","Lydian BT","Magneto","Maiandra GD","Malayalam Sangam MN","Malgun Gothic","Mangal","Marigold","Marion","Marker Felt","Market","Marlett","Matisse ITC","Matura MT Script Capitals","Meiryo","Meiryo UI","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","MingLiU-ExtB","Minion","Minion Pro","Miriam","Miriam Fixed","Mistral","Modern","Modern No. 20","Mona Lisa Solid ITC TT","Mongolian Baiti","MONO","MoolBoran","Mrs Eaves","MS LineDraw","MS Mincho","MS PMincho","MS Reference Specialty","MS UI Gothic","MT Extra","MUSEO","MV Boli","Nadeem","Narkisim","NEVIS","News Gothic","News GothicMT","NewsGoth BT","Niagara Engraved","Niagara Solid","Noteworthy","NSimSun","Nyala","OCR A Extended","Old Century","Old English Text MT","Onyx","Onyx BT","OPTIMA","Oriya Sangam MN","OSAKA","OzHandicraft BT","Palace Script MT","Papyrus","Parchment","Party LET","Pegasus","Perpetua","Perpetua Titling MT","PetitaBold","Pickwick","Plantagenet Cherokee","Playbill","PMingLiU","PMingLiU-ExtB","Poor Richard","Poster","PosterBodoni BT","PRINCETOWN LET","Pristina","PTBarnum BT","Pythagoras","Raavi","Rage Italic","Ravie","Ribbon131 Bd BT","Rockwell","Rockwell Condensed","Rockwell Extra Bold","Rod","Roman","Sakkal Majalla","Santa Fe LET","Savoye LET","Sceptre","Script","Script MT Bold","SCRIPTINA","Serifa","Serifa BT","Serifa Th BT","ShelleyVolante BT","Sherwood","Shonar Bangla","Showcard Gothic","Shruti","Signboard","SILKSCREEN","SimHei","Simplified Arabic","Simplified Arabic Fixed","SimSun","SimSun-ExtB","Sinhala Sangam MN","Sketch Rockwell","Skia","Small Fonts","Snap ITC","Snell Roundhand","Socket","Souvenir Lt BT","Staccato222 BT","Steamer","Stencil","Storybook","Styllo","Subway","Swis721 BlkEx BT","Swiss911 XCm BT","Sylfaen","Synchro LET","System","Tamil Sangam MN","Technical","Teletype","Telugu Sangam MN","Tempus Sans ITC","Terminal","Thonburi","Traditional Arabic","Trajan","TRAJAN PRO","Tristan","Tubular","Tunga","Tw Cen MT","Tw Cen MT Condensed","Tw Cen MT Condensed Extra Bold","TypoUpright BT","Unicorn","Univers","Univers CE 55 Medium","Univers Condensed","Utsaah","Vagabond","Vani","Vijaya","Viner Hand ITC","VisualUI","Vivaldi","Vladimir Script","Vrinda","Westminster","WHITNEY","Wide Latin","ZapfEllipt BT","ZapfHumnst BT","ZapfHumnst Dm BT","Zapfino","Zurich BlkEx BT","Zurich Ex BT","ZWAdobeF"]));for(var o=[],i=0,d=n.length;i<d;i++)!function(e){for(var t=!1,n=0,o=r.length;n<o;n++){s.style.fontFamily=e+","+r[n],a.appendChild(s);var i=s.offsetWidth!==c[r[n]]||s.offsetHeight!==l[r[n]];a.removeChild(s),t=t||i}return t}(n[i])||o.push(n[i]);u.push({key:"js_fonts",value:o}),p(u)},1)},pluginsKey:function(e){return this.options.excludePlugins||(this.isIE()?e.push({key:"ie_plugins",value:this.getIEPlugins()}):e.push({key:"regular_plugins",value:this.getRegularPlugins()})),e},getRegularPlugins:function(){for(var e=[],t=0,n=navigator.plugins.length;t<n;t++)e.push(navigator.plugins[t]);return this.pluginsShouldBeSorted()&&(e=e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),this.map(e,function(e){var t=this.map(e,function(e){return[e.type,e.suffixes].join("~")}).join(",");return[e.name,e.description,t].join("::")},this)},getIEPlugins:function(){var e=[];return(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window)&&(e=this.map(["AcroPDF.PDF","Adodb.Stream","AgControl.AgControl","DevalVRXCtrl.DevalVRXCtrl.1","MacromediaFlashPaper.MacromediaFlashPaper","Msxml2.DOMDocument","Msxml2.XMLHTTP","PDF.PdfCtrl","QuickTime.QuickTime","QuickTimeCheckObject.QuickTimeCheck.1","RealPlayer","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","Scripting.Dictionary","SWCtl.SWCtl","Shell.UIHelper","ShockwaveFlash.ShockwaveFlash","Skype.Detection","TDCCtl.TDCCtl","WMPlayer.OCX","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1"],function(e){try{return new ActiveXObject(e),e}catch(e){return null}})),navigator.plugins&&(e=e.concat(this.getRegularPlugins())),e},pluginsShouldBeSorted:function(){for(var e=!1,t=0,n=this.options.sortPluginsFor.length;t<n;t++){var o=this.options.sortPluginsFor[t];if(navigator.userAgent.match(o)){e=!0;break}}return e},touchSupportKey:function(e){return this.options.excludeTouchSupport||e.push({key:"touch_support",value:this.getTouchSupport()}),e},hasSessionStorage:function(){try{return!!window.sessionStorage}catch(e){return!0}},hasLocalStorage:function(){try{return!!window.localStorage}catch(e){return!0}},hasIndexedDB:function(){return!!window.indexedDB},getNavigatorCpuClass:function(){return navigator.cpuClass?navigator.cpuClass:"unknown"},getNavigatorPlatform:function(){return navigator.platform?navigator.platform:"unknown"},getDoNotTrack:function(){return navigator.doNotTrack?navigator.doNotTrack:"unknown"},getTouchSupport:function(){var e=0,t=!1;void 0!==navigator.maxTouchPoints?e=navigator.maxTouchPoints:void 0!==navigator.msMaxTouchPoints&&(e=navigator.msMaxTouchPoints);try{document.createEvent("TouchEvent"),t=!0}catch(e){}return[e,t,"ontouchstart"in window]},getCanvasFp:function(){var e=[],t=document.createElement("canvas");t.width=2e3,t.height=200,t.style.display="inline";var n=t.getContext("2d");return n.rect(0,0,10,10),n.rect(2,2,6,6),e.push("canvas winding:"+(!1===n.isPointInPath(5,5,"evenodd")?"yes":"no")),n.textBaseline="alphabetic",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",this.options.dontUseFakeFontInCanvas?n.font="11pt Arial":n.font="11pt no-real-font-123",n.fillText("Cwm fjordbank glyphs vext quiz, ",2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.font="18pt Arial",n.fillText("Cwm fjordbank glyphs vext quiz, ",4,45),n.globalCompositeOperation="multiply",n.fillStyle="rgb(255,0,255)",n.beginPath(),n.arc(50,50,50,0,2*Math.PI,!0),n.closePath(),n.fill(),n.fillStyle="rgb(0,255,255)",n.beginPath(),n.arc(100,50,50,0,2*Math.PI,!0),n.closePath(),n.fill(),n.fillStyle="rgb(255,255,0)",n.beginPath(),n.arc(75,100,50,0,2*Math.PI,!0),n.closePath(),n.fill(),n.fillStyle="rgb(255,0,255)",n.arc(75,75,75,0,2*Math.PI,!0),n.arc(75,75,25,0,2*Math.PI,!0),n.fill("evenodd"),e.push("canvas fp:"+t.toDataURL()),e.join("~")},getWebglFp:function(){function e(e){return t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),"["+e[0]+", "+e[1]+"]"}var t=this.getWebglCanvas();if(!t)return null;var n=[],o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o);var i=new Float32Array([-.2,-.9,0,.4,-.26,0,0,.732134444,0]);t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),o.itemSize=3,o.numItems=3;var r=t.createProgram(),a=t.createShader(t.VERTEX_SHADER);t.shaderSource(a,"attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}"),t.compileShader(a);var s,c,l,d=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(d,"precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}"),t.compileShader(d),t.attachShader(r,a),t.attachShader(r,d),t.linkProgram(r),t.useProgram(r),r.vertexPosAttrib=t.getAttribLocation(r,"attrVertex"),r.offsetUniform=t.getUniformLocation(r,"uniformOffset"),t.enableVertexAttribArray(r.vertexPosArray),t.vertexAttribPointer(r.vertexPosAttrib,o.itemSize,t.FLOAT,!1,0,0),t.uniform2f(r.offsetUniform,1,1),t.drawArrays(t.TRIANGLE_STRIP,0,o.numItems),null!=t.canvas&&n.push(t.canvas.toDataURL()),n.push("extensions:"+t.getSupportedExtensions().join(";")),n.push("webgl aliased line width range:"+e(t.getParameter(t.ALIASED_LINE_WIDTH_RANGE))),n.push("webgl aliased point size range:"+e(t.getParameter(t.ALIASED_POINT_SIZE_RANGE))),n.push("webgl alpha bits:"+t.getParameter(t.ALPHA_BITS)),n.push("webgl antialiasing:"+(t.getContextAttributes().antialias?"yes":"no")),n.push("webgl blue bits:"+t.getParameter(t.BLUE_BITS)),n.push("webgl depth bits:"+t.getParameter(t.DEPTH_BITS)),n.push("webgl green bits:"+t.getParameter(t.GREEN_BITS)),n.push("webgl max anisotropy:"+((l=(s=t).getExtension("EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic"))?(0===(c=s.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT))&&(c=2),c):null)),n.push("webgl max combined texture image units:"+t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),n.push("webgl max cube map texture size:"+t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE)),n.push("webgl max fragment uniform vectors:"+t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS)),n.push("webgl max render buffer size:"+t.getParameter(t.MAX_RENDERBUFFER_SIZE)),n.push("webgl max texture image units:"+t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)),n.push("webgl max texture size:"+t.getParameter(t.MAX_TEXTURE_SIZE)),n.push("webgl max varying vectors:"+t.getParameter(t.MAX_VARYING_VECTORS)),n.push("webgl max vertex attribs:"+t.getParameter(t.MAX_VERTEX_ATTRIBS)),n.push("webgl max vertex texture image units:"+t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)),n.push("webgl max vertex uniform vectors:"+t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)),n.push("webgl max viewport dims:"+e(t.getParameter(t.MAX_VIEWPORT_DIMS))),n.push("webgl red bits:"+t.getParameter(t.RED_BITS)),n.push("webgl renderer:"+t.getParameter(t.RENDERER)),n.push("webgl shading language version:"+t.getParameter(t.SHADING_LANGUAGE_VERSION)),n.push("webgl stencil bits:"+t.getParameter(t.STENCIL_BITS)),n.push("webgl vendor:"+t.getParameter(t.VENDOR)),n.push("webgl version:"+t.getParameter(t.VERSION)),t.getShaderPrecisionFormat?(n.push("webgl vertex shader high float precision:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision),n.push("webgl vertex shader high float precision rangeMin:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).rangeMin),n.push("webgl vertex shader high float precision rangeMax:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).rangeMax),n.push("webgl vertex shader medium float precision:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision),n.push("webgl vertex shader medium float precision rangeMin:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).rangeMin),n.push("webgl vertex shader medium float precision rangeMax:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).rangeMax),n.push("webgl vertex shader low float precision:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT).precision),n.push("webgl vertex shader low float precision rangeMin:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT).rangeMin),n.push("webgl vertex shader low float precision rangeMax:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT).rangeMax),n.push("webgl fragment shader high float precision:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision),n.push("webgl fragment shader high float precision rangeMin:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).rangeMin),n.push("webgl fragment shader high float precision rangeMax:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).rangeMax),n.push("webgl fragment shader medium float precision:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision),n.push("webgl fragment shader medium float precision rangeMin:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).rangeMin),n.push("webgl fragment shader medium float precision rangeMax:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).rangeMax),n.push("webgl fragment shader low float precision:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT).precision),n.push("webgl fragment shader low float precision rangeMin:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT).rangeMin),n.push("webgl fragment shader low float precision rangeMax:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT).rangeMax),n.push("webgl vertex shader high int precision:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT).precision),n.push("webgl vertex shader high int precision rangeMin:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT).rangeMin),n.push("webgl vertex shader high int precision rangeMax:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT).rangeMax),n.push("webgl vertex shader medium int precision:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT).precision),n.push("webgl vertex shader medium int precision rangeMin:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT).rangeMin),n.push("webgl vertex shader medium int precision rangeMax:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT).rangeMax),n.push("webgl vertex shader low int precision:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT).precision),n.push("webgl vertex shader low int precision rangeMin:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT).rangeMin),n.push("webgl vertex shader low int precision rangeMax:"+t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT).rangeMax),n.push("webgl fragment shader high int precision:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT).precision),n.push("webgl fragment shader high int precision rangeMin:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT).rangeMin),n.push("webgl fragment shader high int precision rangeMax:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT).rangeMax),n.push("webgl fragment shader medium int precision:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT).precision),n.push("webgl fragment shader medium int precision rangeMin:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT).rangeMin),n.push("webgl fragment shader medium int precision rangeMax:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT).rangeMax),n.push("webgl fragment shader low int precision:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT).precision),n.push("webgl fragment shader low int precision rangeMin:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT).rangeMin),n.push("webgl fragment shader low int precision rangeMax:"+t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT).rangeMax)):"undefined"==typeof NODEBUG&&this.log("WebGL fingerprinting is incomplete, because your browser does not support getShaderPrecisionFormat"),n.join("~")},getAdBlock:function(){var e=document.createElement("div");e.setAttribute("id","ads");try{return document.body.appendChild(e),!document.getElementById("ads")}catch(e){return!1}},getHasLiedLanguages:function(){if(void 0!==navigator.languages)try{if(navigator.languages[0].substr(0,2)!==navigator.language.substr(0,2))return!0}catch(e){return!0}return!1},getHasLiedResolution:function(){return screen.width<screen.availWidth||screen.height<screen.availHeight},getHasLiedOs:function(){var e=navigator.userAgent.toLowerCase(),t=navigator.oscpu,n=navigator.platform.toLowerCase(),o=0<=e.indexOf("windows phone")?"Windows Phone":0<=e.indexOf("win")?"Windows":0<=e.indexOf("android")?"Android":0<=e.indexOf("linux")?"Linux":0<=e.indexOf("iphone")||0<=e.indexOf("ipad")?"iOS":0<=e.indexOf("mac")?"Mac":"Other",i="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;if(i&&"Windows Phone"!==o&&"Android"!==o&&"iOS"!==o&&"Other"!==o)return!0;if(void 0!==t){if(0<=(t=t.toLowerCase()).indexOf("win")&&"Windows"!==o&&"Windows Phone"!==o)return!0;if(0<=t.indexOf("linux")&&"Linux"!==o&&"Android"!==o)return!0;if(0<=t.indexOf("mac")&&"Mac"!==o&&"iOS"!==o)return!0;if(0===t.indexOf("win")&&0===t.indexOf("linux")&&0<=t.indexOf("mac")&&"other"!==o)return!0}return 0<=n.indexOf("win")&&"Windows"!==o&&"Windows Phone"!==o||((0<=n.indexOf("linux")||0<=n.indexOf("android")||0<=n.indexOf("pike"))&&"Linux"!==o&&"Android"!==o||((0<=n.indexOf("mac")||0<=n.indexOf("ipad")||0<=n.indexOf("ipod")||0<=n.indexOf("iphone"))&&"Mac"!==o&&"iOS"!==o||(0===n.indexOf("win")&&0===n.indexOf("linux")&&0<=n.indexOf("mac")&&"other"!==o||void 0===navigator.plugins&&"Windows"!==o&&"Windows Phone"!==o)))},getHasLiedBrowser:function(){var e=navigator.userAgent.toLowerCase(),t=navigator.productSub,n=0<=e.indexOf("firefox")?"Firefox":0<=e.indexOf("opera")||0<=e.indexOf("opr")?"Opera":0<=e.indexOf("chrome")?"Chrome":0<=e.indexOf("safari")?"Safari":0<=e.indexOf("trident")?"Internet Explorer":"Other";if(("Chrome"===n||"Safari"===n||"Opera"===n)&&"20030107"!==t)return!0;var o,i=eval.toString().length;if(37===i&&"Safari"!==n&&"Firefox"!==n&&"Other"!==n)return!0;if(39===i&&"Internet Explorer"!==n&&"Other"!==n)return!0;if(33===i&&"Chrome"!==n&&"Opera"!==n&&"Other"!==n)return!0;try{throw"a"}catch(e){try{e.toSource(),o=!0}catch(e){o=!1}}return!(!o||"Firefox"===n||"Other"===n)},isCanvasSupported:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},isWebGlSupported:function(){if(!this.isCanvasSupported())return!1;var t,e=document.createElement("canvas");try{t=e.getContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){t=!1}return!!window.WebGLRenderingContext&&!!t},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName||!("Netscape"!==navigator.appName||!/Trident/.test(navigator.userAgent))},hasSwfObjectLoaded:function(){return void 0!==window.swfobject},hasMinFlashInstalled:function(){return swfobject.hasFlashPlayerVersion("9.0.0")},addFlashDivNode:function(){var e=document.createElement("div");e.setAttribute("id",this.options.swfContainerId),document.body.appendChild(e)},loadSwfAndDetectFonts:function(t){var e="___fp_swf_loaded";window[e]=function(e){t(e)};var n=this.options.swfContainerId;this.addFlashDivNode();var o={onReady:e};swfobject.embedSWF(this.options.swfPath,n,"1","1","9.0.0",!1,o,{allowScriptAccess:"always",menu:"false"},{})},getWebglCanvas:function(){var e=document.createElement("canvas"),t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){}return t=t||null},each:function(e,t,n){if(null!==e)if(this.nativeForEach&&e.forEach===this.nativeForEach)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,i=e.length;o<i;o++)if(t.call(n,e[o],o,e)==={})return}else for(var r in e)if(e.hasOwnProperty(r)&&t.call(n,e[r],r,e)==={})return},map:function(e,o,i){var r=[];return null==e?r:this.nativeMap&&e.map===this.nativeMap?e.map(o,i):(this.each(e,function(e,t,n){r[r.length]=o.call(i,e,t,n)}),r)},x64Add:function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},x64Multiply:function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},x64Rotl:function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},x64LeftShift:function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},x64Xor:function(e,t){return[e[0]^t[0],e[1]^t[1]]},x64Fmix:function(e){return e=this.x64Xor(e,[0,e[0]>>>1]),e=this.x64Multiply(e,[4283543511,3981806797]),e=this.x64Xor(e,[0,e[0]>>>1]),e=this.x64Multiply(e,[3301882366,444984403]),e=this.x64Xor(e,[0,e[0]>>>1])},x64hash128:function(e,t){t=t||0;for(var n=(e=e||"").length%16,o=e.length-n,i=[0,t],r=[0,t],a=[0,0],s=[0,0],c=[2277735313,289559509],l=[1291169091,658871167],d=0;d<o;d+=16)a=[255&e.charCodeAt(d+4)|(255&e.charCodeAt(d+5))<<8|(255&e.charCodeAt(d+6))<<16|(255&e.charCodeAt(d+7))<<24,255&e.charCodeAt(d)|(255&e.charCodeAt(d+1))<<8|(255&e.charCodeAt(d+2))<<16|(255&e.charCodeAt(d+3))<<24],s=[255&e.charCodeAt(d+12)|(255&e.charCodeAt(d+13))<<8|(255&e.charCodeAt(d+14))<<16|(255&e.charCodeAt(d+15))<<24,255&e.charCodeAt(d+8)|(255&e.charCodeAt(d+9))<<8|(255&e.charCodeAt(d+10))<<16|(255&e.charCodeAt(d+11))<<24],a=this.x64Multiply(a,c),a=this.x64Rotl(a,31),a=this.x64Multiply(a,l),i=this.x64Xor(i,a),i=this.x64Rotl(i,27),i=this.x64Add(i,r),i=this.x64Add(this.x64Multiply(i,[0,5]),[0,1390208809]),s=this.x64Multiply(s,l),s=this.x64Rotl(s,33),s=this.x64Multiply(s,c),r=this.x64Xor(r,s),r=this.x64Rotl(r,31),r=this.x64Add(r,i),r=this.x64Add(this.x64Multiply(r,[0,5]),[0,944331445]);switch(a=[0,0],s=[0,0],n){case 15:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+14)],48));case 14:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+13)],40));case 13:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+12)],32));case 12:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+11)],24));case 11:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+10)],16));case 10:s=this.x64Xor(s,this.x64LeftShift([0,e.charCodeAt(d+9)],8));case 9:s=this.x64Xor(s,[0,e.charCodeAt(d+8)]),s=this.x64Multiply(s,l),s=this.x64Rotl(s,33),s=this.x64Multiply(s,c),r=this.x64Xor(r,s);case 8:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+7)],56));case 7:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+6)],48));case 6:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+5)],40));case 5:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+4)],32));case 4:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+3)],24));case 3:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+2)],16));case 2:a=this.x64Xor(a,this.x64LeftShift([0,e.charCodeAt(d+1)],8));case 1:a=this.x64Xor(a,[0,e.charCodeAt(d)]),a=this.x64Multiply(a,c),a=this.x64Rotl(a,31),a=this.x64Multiply(a,l),i=this.x64Xor(i,a)}return i=this.x64Xor(i,[0,e.length]),r=this.x64Xor(r,[0,e.length]),i=this.x64Add(i,r),r=this.x64Add(r,i),i=this.x64Fmix(i),r=this.x64Fmix(r),i=this.x64Add(i,r),r=this.x64Add(r,i),("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)+("00000000"+(r[0]>>>0).toString(16)).slice(-8)+("00000000"+(r[1]>>>0).toString(16)).slice(-8)}},e.VERSION="1.1.1",e}),window.Modernizr=function(n,r){function e(e){p.cssText=e}function a(e,t){return typeof e===t}function i(e,t){return!!~(""+e).indexOf(t)}function s(e,t){for(var n in e){var o=e[n];if(!i(o,"-")&&p[o]!==r)return"pfx"!=t||o}return!1}function t(e,t,n){var o=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+f.join(o+" ")+o).split(" ");return a(t,"string")||void 0===t?s(i,t):function(e,t,n){for(var o in e){var i=t[e[o]];if(i!==r)return!1===n?e[o]:a(i,"function")?i.bind(n||t):i}return!1}(i=(e+" "+m.join(o+" ")+o).split(" "),t,n)}var o,c={},l=n.documentElement,d="modernizr",u=n.createElement(d),p=u.style,h=" -webkit- -moz- -o- -ms- ".split(" "),g="Webkit Moz O ms",f=g.split(" "),m=g.toLowerCase().split(" "),v={},b=[],k=b.slice,y={}.hasOwnProperty,w=void 0!==y&&void 0!==y.call?function(e,t){return y.call(e,t)}:function(e,t){return t in e&&void 0===e.constructor.prototype[t]};for(var C in Function.prototype.bind||(Function.prototype.bind=function(o){var i=this;if("function"!=typeof i)throw new TypeError;var r=k.call(arguments,1),a=function(){if(this instanceof a){function e(){}e.prototype=i.prototype;var t=new e,n=i.apply(t,r.concat(k.call(arguments)));return Object(n)===n?n:t}return i.apply(o,r.concat(k.call(arguments)))};return a}),v.canvas=function(){var e=n.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},v.rgba=function(){return e("background-color:rgba(150,255,150,.5)"),i(p.backgroundColor,"rgba")},v.backgroundsize=function(){return t("backgroundSize")},v.borderradius=function(){return t("borderRadius")},v.opacity=function(){return e(h.join("opacity:.55;")+""),/^0.55$/.test(p.opacity)},v.video=function(){var e=n.createElement("video"),t=!1;try{(t=!!e.canPlayType)&&((t=new Boolean(t)).ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),t.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),t.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(e){}return t},v.audio=function(){var e=n.createElement("audio"),t=!1;try{(t=!!e.canPlayType)&&((t=new Boolean(t)).ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),t.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),t.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(e){}return t},v.localstorage=function(){try{return localStorage.setItem(d,d),localStorage.removeItem(d),!0}catch(e){return!1}},v)w(v,C)&&(o=C.toLowerCase(),c[o]=v[C](),b.push((c[o]?"":"no-")+o));return c.addTest=function(e,t){if("object"==typeof e)for(var n in e)w(e,n)&&c.addTest(n,e[n]);else{if(e=e.toLowerCase(),c[e]!==r)return c;t="function"==typeof t?t():t,l.className+=" "+(t?"":"no-")+e,c[e]=t}return c},e(""),function(e,c){function l(){var e=g.elements;return"string"==typeof e?e.split(" "):e}function d(e){var t=s[e[o]];return t||(t={},a++,e[o]=a,s[a]=t),t}function u(e,t,n){return t=t||c,h?t.createElement(e):!(o=(n=n||d(t)).cache[e]?n.cache[e].cloneNode():r.test(e)?(n.cache[e]=n.createElem(e)).cloneNode():n.createElem(e)).canHaveChildren||i.test(e)||o.tagUrn?o:n.frag.appendChild(o);var o}function t(e){var t,n,o,i,r,a,s=d(e=e||c);return!g.shivCSS||p||s.hasCSS||(s.hasCSS=(i="article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}",r=(o=e).createElement("p"),a=o.getElementsByTagName("head")[0]||o.documentElement,r.innerHTML="x<style>"+i+"</style>",!!a.insertBefore(r.lastChild,a.firstChild))),h||(t=e,(n=s).cache||(n.cache={},n.createElem=t.createElement,n.createFrag=t.createDocumentFragment,n.frag=n.createFrag()),t.createElement=function(e){return g.shivMethods?u(e,t,n):n.createElem(e)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/[\w\-]+/g,function(e){return n.createElem(e),n.frag.createElement(e),'c("'+e+'")'})+");return n}")(g,n.frag)),e}var p,h,n=e.html5||{},i=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,r=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,o="_html5shiv",a=0,s={};!function(){try{var e=c.createElement("a");e.innerHTML="<xyz></xyz>",p="hidden"in e,h=1==e.childNodes.length||function(){c.createElement("a");var e=c.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(e){h=p=!0}}();var g={elements:n.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:!1!==n.shivCSS,supportsUnknownElements:h,shivMethods:!1!==n.shivMethods,type:"default",shivDocument:t,createElement:u,createDocumentFragment:function(e,t){if(e=e||c,h)return e.createDocumentFragment();for(var n=(t=t||d(e)).frag.cloneNode(),o=0,i=l(),r=i.length;o<r;o++)n.createElement(i[o]);return n}};e.html5=g,t(c)}(this,n),c._version="2.8.3",c._prefixes=h,c._domPrefixes=m,c._cssomPrefixes=f,c.testProp=function(e){return s([e])},c.testAllProps=t,l.className=l.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(" js "+b.join(" ")),c}(this.document),function(e,v){function u(e){return"[object Function]"==i.call(e)}function b(e){return"string"==typeof e}function p(){}function k(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function y(){var e=x.shift();I=1,e?e.t?w(function(){("c"==e.t?N.injectCss:N.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),y()):I=0}function t(e,t,n,o,i){return I=0,t=t||"j",b(e)?(a="c"==t?O:T,s=e,c=t,l=this.i++,d=n,u=o,p=(p=i)||N.errorTimeout,h=v.createElement(a),f=g=0,m={t:c,s:s,e:d,a:u,x:p},1===A[s]&&(f=1,A[s]=[]),"object"==a?h.data=s:(h.src=s,h.type=a),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){r.call(this,f)},x.splice(l,0,m),"img"!=a&&(f||2===A[s]?(S.insertBefore(h,E?null:C),w(r,p)):A[s].push(h))):(x.splice(this.i++,0,e),1==x.length&&y()),this;function r(e){if(!g&&k(h.readyState)&&(m.r=g=1,I||y(),h.onload=h.onreadystatechange=null,e))for(var t in"img"!=a&&w(function(){S.removeChild(h)},50),A[s])A[s].hasOwnProperty(t)&&A[s][t].onload()}var a,s,c,l,d,u,p,h,g,f,m}function s(){var e=N;return e.loader={load:t,i:0},e}var n,o=v.documentElement,w=e.setTimeout,C=v.getElementsByTagName("script")[0],i={}.toString,x=[],I=0,r="MozAppearance"in o.style,E=r&&!!v.createRange().compareNode,S=E?o:C.parentNode,o=e.opera&&"[object Opera]"==i.call(e.opera),o=!!v.attachEvent&&!o,T=r?"object":o?"script":"img",O=o?"script":T,a=Array.isArray||function(e){return"[object Array]"==i.call(e)},c=[],A={},l={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}},N=function(e){function d(e,t,n,o,i){var r=function(e){for(var t,n,e=e.split("!"),o=c.length,i=e.pop(),r=e.length,i={url:i,origUrl:i,prefixes:e},a=0;a<r;a++)n=e[a].split("="),(t=l[n.shift()])&&(i=t(i,n));for(a=0;a<o;a++)i=c[a](i);return i}(e),a=r.autoCallback;r.url.split(".").pop().split("?").shift(),r.bypass||(t=t&&(u(t)?t:t[e]||t[o]||t[e.split("/").pop().split("?")[0]]),r.instead?r.instead(e,t,n,o,i):(A[r.url]?r.noexec=!0:A[r.url]=1,n.load(r.url,r.forceCSS||!r.forceJS&&"css"==r.url.split(".").pop().split("?").shift()?"c":void 0,r.noexec,r.attrs,r.timeout),(u(t)||u(a))&&n.load(function(){s(),t&&t(r.origUrl,i,o),a&&a(r.origUrl,i,o),A[r.url]=2})))}function t(e,t){function n(n,e){if(n){if(b(n))e||(s=function(){var e=[].slice.call(arguments);c.apply(this,e),l()}),d(n,s,t,0,r);else if(Object(n)===n)for(i in o=function(){var e,t=0;for(e in n)n.hasOwnProperty(e)&&t++;return t}(),n)n.hasOwnProperty(i)&&(e||--o||(u(s)?s=function(){var e=[].slice.call(arguments);c.apply(this,e),l()}:s[i]=function(t){return function(){var e=[].slice.call(arguments);t&&t.apply(this,e),l()}}(c[i])),d(n[i],s,t,i,r))}else e||l()}var o,i,r=!!e.test,a=e.load||e.both,s=e.callback||p,c=s,l=e.complete||p;n(r?e.yep:e.nope,!!a),a&&n(a)}var n,o,i=this.yepnope.loader;if(b(e))d(e,0,i,0);else if(a(e))for(n=0;n<e.length;n++)b(o=e[n])?d(o,0,i,0):a(o)?N(o):Object(o)===o&&t(o,i);else Object(e)===e&&t(e,i)};N.addPrefix=function(e,t){l[e]=t},N.addFilter=function(e){c.push(e)},N.errorTimeout=1e4,null==v.readyState&&v.addEventListener&&(v.readyState="loading",v.addEventListener("DOMContentLoaded",n=function(){v.removeEventListener("DOMContentLoaded",n,0),v.readyState="complete"},0)),e.yepnope=s(),e.yepnope.executeStack=y,e.yepnope.injectJs=function(e,t,n,o,i,r){var a,s,c=v.createElement("script"),o=o||N.errorTimeout;for(s in c.src=e,n)c.setAttribute(s,n[s]);t=r?y:t||p,c.onreadystatechange=c.onload=function(){!a&&k(c.readyState)&&(a=1,t(),c.onload=c.onreadystatechange=null)},w(function(){a||t(a=1)},o),i?c.onload():C.parentNode.insertBefore(c,C)},e.yepnope.injectCss=function(e,t,n,o,i,r){var a,o=v.createElement("link"),t=r?y:t||p;for(a in o.href=e,o.rel="stylesheet",o.type="text/css",n)o.setAttribute(a,n[a]);i||(C.parentNode.insertBefore(o,C),w(t,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};var self=this||{};try{!function(e){if("+"!==new e("q=%2B").get("q")||"+"!==new e({q:"+"}).get("q")||"+"!==new e([["q","+"]]).get("q")||"q=%0A"!==new e("q=\n").toString()||"q=+%26"!==new e({q:" &"}).toString()||"q=%25zx"!==new e({q:"%zx"}).toString())throw e;self.URLSearchParams=e}(URLSearchParams)}catch(e){!function(e,r,c){"use strict";var l=e.create,d=e.defineProperty,t=/[!'\(\)~]|%20|%00/g,n=/%(?![0-9a-fA-F]{2})/g,o=/\+/g,i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},a={append:function(e,t){h(this._ungap,e,t)},delete:function(e){delete this._ungap[e]},get:function(e){return this.has(e)?this._ungap[e][0]:null},getAll:function(e){return this.has(e)?this._ungap[e].slice(0):[]},has:function(e){return e in this._ungap},set:function(e,t){this._ungap[e]=[r(t)]},forEach:function(t,n){var o=this;for(var i in o._ungap)o._ungap[i].forEach(e,i);function e(e){t.call(n,e,r(i),o)}},toJSON:function(){return{}},toString:function(){var e=[];for(var t in this._ungap)for(var n=f(t),o=0,i=this._ungap[t];o<i.length;o++)e.push(n+"="+f(i[o]));return e.join("&")}};for(var s in a)d(u.prototype,s,{configurable:!0,writable:!0,value:a[s]});function u(e){var t,n=l(null);switch(d(this,"_ungap",{value:n}),!0){case!e:break;case"string"==typeof e:"?"===e.charAt(0)&&(e=e.slice(1));for(var o=e.split("&"),i=0,r=o.length;i<r;i++){var a=(t=o[i]).indexOf("=");-1<a?h(n,g(t.slice(0,a)),g(t.slice(a+1))):t.length&&h(n,g(t),"")}break;case c(e):for(i=0,r=e.length;i<r;i++){h(n,(t=e[i])[0],t[1])}break;case"forEach"in e:e.forEach(p,n);break;default:for(var s in e)h(n,s,e[s])}}function p(e,t){h(this,t,e)}function h(e,t,n){var o=c(n)?n.join(","):n;t in e?e[t].push(o):e[t]=[o]}function g(e){return decodeURIComponent(e.replace(n,"%25").replace(o," "))}function f(e){return encodeURIComponent(e).replace(t,m)}function m(e){return i[e]}self.URLSearchParams=u}(Object,String,Array.isArray)}function getElementsByAttribute(e,t,n,o){for(var i,r,a="*"==t&&e.all?e.all:e.getElementsByTagName(t),s=new Array,c=void 0!==o?new RegExp("(^|\\s)"+o+"(\\s|$)","i"):null,l=0;l<a.length;l++)"string"==typeof(r=(i=a[l]).getAttribute&&i.getAttribute(n))&&0<r.length&&(void 0===o||c&&c.test(r))&&s.push(i);return s}function toggleClass(e,t){(strHasClass(e.className,t)?removeClass:addClass)(e,t)}function addRemoveClass(e,t,n){var o=e.className,i=!0;if(t)for(var r=0;r<t.length;r++)strHasClass(o,t[r])||(i=!1,o+=(""==o?"":" ")+t[r]);if(n)for(r=0;r<n.length;r++)strHasClass(o,n[r])&&(i=!1,o=strRemoveClass(o,n[r]));i||(e.className=o.trim())}function addClass(e,t){var n=e.className.trim();if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)strHasClass(n,t[i])||(o=!1,n+=(""==n?"":" ")+t[i]);if(o)return}else{if(strHasClass(n,t))return;n+=(""==n?"":" ")+t}e.className=n}function removeClass(e,t){var n=e.className;if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)strHasClass(n,t[i])&&(o=!1,n=strRemoveClass(n,t[i]));if(o)return}else{if(!strHasClass(n,t))return;n=strRemoveClass(n,t)}""==(n=n.trim())?e.removeAttribute("class"):e.className=n}function getClassThatStartsWith(e,t){for(var n=e.className.trim().split(" "),o=0;o<n.length;o++)if(-1<n[o].indexOf(t))return n[o]}function hasClass(e,t){var n=e.className;return e instanceof SVGElement&&(n=n.baseVal),strHasClass(n,t)}function strHasClass(e,t){for(var n=(e=e||"").trim().split(" "),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1}function strRemoveClass(e,t){for(var n=(e=e||"").trim().split(" "),o=0;o<n.length;o++)n[o]==t&&(n[o]=null);return n.join(" ")}function shouldParse(e){if(!isAbsoluteURLPath(e)&&0!=e.indexOf("/")&&0!=e.indexOf("#dontparse"))return!0}function removeElement(e){e&&e.parentNode&&e.parentNode.removeChild(e)}!function(m){var o=!1;try{o=!!Symbol.iterator}catch(e){}function e(e,t){var n=[];return e.forEach(t,n),o?n[Symbol.iterator]():{next:function(){var e=n.shift();return{done:void 0===e,value:e}}}}"forEach"in m||(m.forEach=function(n,o){var i=this,e=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(t){!t.length||t in e||(e[t]=i.getAll(t)).forEach(function(e){n.call(o,e,t,i)})})}),"keys"in m||(m.keys=function(){return e(this,function(e,t){this.push(t)})}),"values"in m||(m.values=function(){return e(this,function(e,t){this.push(e)})}),"entries"in m||(m.entries=function(){return e(this,function(e,t){this.push([t,e])})}),!o||Symbol.iterator in m||(m[Symbol.iterator]=m.entries),"sort"in m||(m.sort=function(){for(var e,t,n,o=this.entries(),i=o.next(),r=i.done,a=[],s=Object.create(null);!r;)t=(n=i.value)[0],a.push(t),t in s||(s[t]=[]),s[t].push(n[1]),r=(i=o.next()).done;for(a.sort(),e=0;e<a.length;e++)this.delete(a[e]);for(e=0;e<a.length;e++)t=a[e],this.append(t,s[t].shift())}),function(u){function p(e){var t=e.append;e.append=m.append,URLSearchParams.call(e,e._usp.search.slice(1)),e.append=t}function h(e,t){if(!(e instanceof t))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+t.name)}function e(t){var n,o,i,e=t.prototype,r=f(e,"searchParams"),a=f(e,"href"),s=f(e,"search");function c(e,t){m.append.call(this,e,t),e=this.toString(),i.set.call(this._usp,e?"?"+e:"")}function l(e){m.delete.call(this,e),e=this.toString(),i.set.call(this._usp,e?"?"+e:"")}function d(e,t){m.set.call(this,e,t),e=this.toString(),i.set.call(this._usp,e?"?"+e:"")}!r&&s&&s.set&&(i=s,o=function(e,t){return e.append=c,e.delete=l,e.set=d,g(e,"_usp",{configurable:!0,writable:!0,value:t})},n=function(e,t){return g(e,"_searchParams",{configurable:!0,writable:!0,value:o(t,e)}),t},u.defineProperties(e,{href:{get:function(){return a.get.call(this)},set:function(e){var t=this._searchParams;a.set.call(this,e),t&&p(t)}},search:{get:function(){return s.get.call(this)},set:function(e){var t=this._searchParams;s.set.call(this,e),t&&p(t)}},searchParams:{get:function(){return h(this,t),this._searchParams||n(this,new URLSearchParams(this.search.slice(1)))},set:function(e){h(this,t),n(this,e)}}}))}var g=u.defineProperty,f=u.getOwnPropertyDescriptor;try{e(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&e(URL)}catch(e){}}(Object)}(self.URLSearchParams.prototype,Object),function(e){"use strict";var t=e.prototype,r=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var n,o=document.implementation.createHTMLDocument(""),i=o.documentElement;return i.innerHTML=e,n=i.firstElementChild,1===i.childElementCount&&"html"===n.localName.toLowerCase()&&o.replaceChild(n,i),o}return r.apply(this,arguments)}}(DOMParser),ph={removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},getHash:function(e){if(0<=e.indexOf("#"))return e.substr(e.lastIndexOf("#")+1)},normalize:function(e){var t=ph.normalizedArray(e).join("/");return arguments.length&&"/"==e.substr(0,1)&&(t="file:///"+t),t},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&0<n&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/kotobee:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"chrome-extension:"==t[0]&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t},basename:function(e){if(-1==e.indexOf("/"))return e;var t=ph.normalizedArray(e);return t[t.length-1]},removeBase:function(e){var t=ph.normalizedArray(e);t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==e.substr(0,1)&&(n="/"+n),n},removeFilename:function(e){var t=ph.normalizedArray(e);if(-1==t[t.length-1].indexOf("."))return e;t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==e.substr(0,1)&&(n="/"+n),n},removeExtension:function(e){if(-1==e.indexOf("."))return e;var t=e.split(".");return t.splice(t.length-1,1),t.join(".")},getExtension:function(e){if(-1==e.indexOf("."))return"";var t=e.split(".");return t[t.length-1]},dirname:function(e){if(-1==e.indexOf("/"))return e;var t=ph.normalizedArray(e);return 0<=t[t.length-1].indexOf(".")&&t.splice(t.length-1,1),1==t.length?t[0]:t[t.length-1]},relative:function(e,t){var n,o,i=ph.normalizedArray(e),r=ph.normalizedArray(t),a=new Array;for(0<=i[i.length-1].indexOf(".")&&i.splice(i.length-1,1),n=0;n<i.length&&i[n]==r[n];n++);for(o=n;o<i.length;o++)a.push("..");for(o=n;o<r.length;o++)a.push(r[o]);return a.join("/")},join:function(){for(var e=new Array,t=0;t<arguments.length;t++){var n=ph.normalizedArray(arguments[t]);t<arguments.length-1&&!isAbsoluteURLPath(n[n.length-1])&&0<=n[n.length-1].indexOf(".")&&n.splice(n.length-1,1),e=e.concat(n)}var o=ph.normalize(e.join("/"));return"/"==arguments[0].substr(0,1)&&(o=desktop?"file:////"+o:"/"+o),o},parent:function(e){e=ph.removeFilename(e);var t=ph.normalizedArray(e);t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(n="/"+n),n}};var startDate=Date.now(),LoggerWorker,loggerWorker,kLog=function(e){if(debug){null==e&&(e="null"),debugDuration&&(e=Date.now()-startDate+" "+String(e));try{if(loggerWorker)return void loggerWorker.postMessage({func:"log",params:arguments})}catch(e){}try{console.log.apply(this,arguments)}catch(e){}}},log=kLog;function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function randStr(e,t){return null==t&&(t="s"),t+Math.random().toString(36).substring(5).substr(0,e)}function getDateTime(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),i=e.getHours(),r=e.getMinutes(),a=e.getSeconds();return 1==n.toString().length&&(n="0"+n),1==o.toString().length&&(o="0"+o),1==i.toString().length&&(i="0"+i),1==r.toString().length&&(r="0"+r),1==a.toString().length&&(a="0"+a),t+"/"+n+"/"+o+" "+i+":"+r+":"+a}function getFormData(e){e=e||{};var t=new FormData;for(var n in e)e[n]&&t.append(n,e[n]);return t}function newBlob(t,n){try{return new Blob([t],{type:n})}catch(e){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==e.name&&window.BlobBuilder){var o=new BlobBuilder;return o.append(t.buffer),o.getBlob(n)}if("InvalidStateError"==e.name)return new Blob([t.buffer],{type:n})}}var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n,o,i,r,a,s,c=this._keyStr.indexOf(e.charAt(e.length-1)),l=this._keyStr.indexOf(e.charAt(e.length-2)),d=e.length/4*3;64==c&&d--,64==l&&d--;var u=0,p=0,h=t?new Uint8Array(t):new Uint8Array(d);for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),u=0;u<d;u+=3)n=this._keyStr.indexOf(e.charAt(p++))<<2|(r=this._keyStr.indexOf(e.charAt(p++)))>>4,o=(15&r)<<4|(a=this._keyStr.indexOf(e.charAt(p++)))>>2,i=(3&a)<<6|(s=this._keyStr.indexOf(e.charAt(p++))),h[u]=n,64!=a&&(h[u+1]=o),64!=s&&(h[u+2]=i);return h}},currentIndex,currentVIndex;function arrayBufferToBuffer(e){for(var t=new Buffer(e.byteLength),n=new Uint8Array(e),o=0;o<t.length;++o)t[o]=n[o];return t}function clone(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=clone(e[n]));return t}function rgb2hex(e){if(/^#[0-9A-F]{6}$/i.test(e))return e;function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+t(e[1])+t(e[2])+t(e[3]):void 0}function timeOut(e,t){var n=setInterval(function(){clearInterval(n),e()},t);return n}function wrapNode(e,t){var n=document.createRange();n.selectNode(e),n.surroundContents(document.createElement(t))}function wrapNodeFromTo(e,t,n,o){var i=document.createRange();i.setStart(e,n),i.setEnd(e,o),i.surroundContents(document.createElement(t))}function XMLEscape(e,t){for(var n="",o=0;o<e.length;o++){var i=e.charAt(o);n+="&"==i?"&amp;":"'"==i?t?"&apos;":"&#39;":i}return n}function replaceHTML(e,t){var n="string"==typeof e?document.getElementById(e):e,o=n.cloneNode(!1);return o.innerHTML=t,n.parentNode.replaceChild(o,n),o}function kTemplate(e,t){return"web"!=t&&(mobile||"mobile"==t)?"templates/"+e.replace(".html",".mobile.html"):"templates/"+e}function arrayContainsProperty(e,t,n){for(var o=0;o<e.length;o++)if(e[o][t]==n)return!0;return!1}function cacheBust(e){if(desktop&&(0==e.indexOf("/")||0==e.indexOf("file://")||0==e.indexOf("chrome-extension://")))return e;var t="?";return 0<=e.indexOf("?")&&(t="&"),e+t+Math.floor(9999*Math.random())}function addPrefixedEvent(e,t,n){for(var o=["webkit","moz","MS","o",""],i=0;i<o.length;i++)o[i]||(t=t.toLowerCase()),e.addEventListener(o[i]+t,n,!1)}function removePrefixedEvent(e,t,n){for(var o=["webkit","moz","MS","o",""],i=0;i<o.length;i++)o[i]||(t=t.toLowerCase()),e.removeEventListener(o[i]+t,n,!1)}function redrawForChrome(e){e=e||document.body,-1!=navigator.userAgent.toLowerCase().indexOf("chrome")&&(e.style.display="inline-block",e.offsetHeight,e.style.display="")}function pauseVideoAndAudio(e){for(var t=(e=e||document).getElementsByTagName("audio"),n=t.length;n--;)try{t[n].pause()}catch(e){}for(var o=e.getElementsByTagName("video"),n=o.length;n--;)try{o[n].pause()}catch(e){}}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}function asyncCheck(e,t,n,o){return e?o():(n.push(o),t.apply(this,n))}function autoprefixTransform(e,t){t=t||"",e.style.transform=e.style.msTransform=e.style.webkitTransform=e.style.mozTransform=t}function deleteTransform(e){e&&(e.style.transform=e.style.msTransform=e.style.webkitTransform=e.style.mozTransform=null)}function deleteTransformOrigin(e){e&&(e.style.transformOrigin=e.style.msTransformOrigin=e.style.webkitTransformOrigin=e.style.mozTransformOrigin=null)}function getChildIndex(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t}function getFilteredChildIndex(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}function autoprefixTransformOrigin(e,t){t=t||"",e.style.transformOrigin=e.style.msTransformOrigin=e.style.webkitTransformOrigin=e.style.mozTransformOrigin=t}function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(0<t)return!0;if(0<e.indexOf("Trident/"))return!0;var n=e.indexOf("Edge/");return!1}function getImgDataSrc(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){var e=new FileReader;e.onloadend=function(){t&&t(e.result)},e.readAsDataURL(n.response)},n.send()}function isAbsoluteURLPath(e){return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||(0==e.trim().indexOf("file://")||(0==e.trim().indexOf("kotobee://")||(0==e.trim().indexOf("chrome-extension://")||(!!e.trim().match(/^[A-Z]:\//g)||void 0)))))))}function isAbsoluteURLAndNotDataPath(e){return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("file://")||(0==e.trim().indexOf("kotobee://")||(0==e.trim().indexOf("chrome-extension://")||void 0)))))}function isKotobeeBooks(e){var t=(e=e||window.location.href).split("://");if(!(t.length<=1)){var n=t[1];return 0==n.indexOf("dev.books.kotobee.com")||(0==n.indexOf("books.kotobee.com")||(0==n.indexOf("books-test.kotobee.com")||void 0))}}function isKotobeeHosted(e){var t=(e=e||window.location.href).split("://");if(!(t.length<=1)){var n=t[1];if(0==n.indexOf("dev.books.kotobee.com"))return!0;if(0==n.indexOf("books.kotobee.com"))return!0;if(0==n.indexOf("books-test.kotobee.com"))return!0;for(var o=["kotobee.com"],i=0;i<o.length;i++){if(0<=n.indexOf(o[i]+"/ebook"))return!0;if(0<=n.indexOf(o[i]+"/library"))return!0;if(0<=n.indexOf(o[i]+"/lti"))return!0}var r="kotobee.com";"undefined"!=typeof hostingDomain&&hostingDomain&&0==(r=hostingDomain.replace(/https?:\/\//g,"")).indexOf("www.")&&(r=r.substr(4)),"undefined"==typeof hostUrlMode&&(hostUrlMode="subdomain");var a="folder"==hostUrlMode?"":".";if(0<=e.indexOf(a+r)){if("folder"==hostUrlMode)return!0;var s=r.replace(".","\\."),c=new RegExp("https?:\\/\\/(.*?\\.)"+s+".*","g"),l=e.replace(c,"$1");if(l){var d=l.replace(/(.*?)\./g,"$1");if(0<=r.indexOf("kotobee.com")){if("www"==d)return!1;if("dev"==d)return!1;if("test"==d)return!1;if("qa"==d)return!1;if("books-test"==d)return!1;if("moodle-test"==d)return!1}else if("www"==d)return!1;return!0}}}}function decodeHTMLEntities(e){for(var t=[["amp","&"],["apos","'"],["#x27","'"],["#x2F","/"],["#39","'"],["#47","/"],["lt","<"],["gt",">"],["nbsp"," "],["quot",'"']],n=0,o=t.length;n<o;++n)e=e.replace(new RegExp("&"+t[n][0]+";","g"),t[n][1]);return e}function addFormHiddenInput(e,t,n){var o=document.createElement("input");o.setAttribute("name",e),o.setAttribute("type","hidden"),o.setAttribute("value",t),n.appendChild(o)}function getElemMargin(e,t){return getElemDim(e,"margin",t)}function getElemPadding(e,t){return getElemDim(e,"padding",t)}function getElemDim(e,t,n){var o={},i=(n=n||{}).computed?getComputedStyle(e):e.style;return o.left=i[t+"Left"].split("px")[0],o.right=i[t+"Right"].split("px")[0],"auto"==o.left||"auto"==o.left?o.x="auto":o.x=Math.round(o.left)+Math.round(o.right),o.top=i[t+"Top"].split("px")[0],o.bottom=i[t+"Bottom"].split("px")[0],"auto"==o.top||"auto"==o.bottom?o.y="auto":o.y=Math.round(o.top)+Math.round(o.bottom),o}function makeArrayUnique(e){for(var t=0;t<e.length;t++)for(var n=e[t],o=e.length;o--;)t!=o&&e[o].length+"  "+n.length&&e[o]==n&&e.splice(o,1);return e}function makeObjectArrayUnique(e){for(var t=0;t<e.length;t++)for(var n=e[t],o=e.length;o--;)t!=o&&e[o]&&n&&JSON.stringify(e[o])==JSON.stringify(n)&&e.splice(o,1);return e}function cloneNodeAttributes(e){var t=document.createElement(e.nodeName);return copyAttributes(e,t),t}function copyAttributes(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value)}function getBoundingBox(e){if(3!=e.nodeType)return e.getBoundingClientRect();var t=document.createRange();t.selectNode(e);var n=t.getBoundingClientRect();return t.detach(),n}function parents(e,t){t=t||{};for(var n=[];e&&e&&(!t.stopAtId||e.id!=t.stopAtId);e=e.parentNode){if(t.stopAtIds){for(var o,i=0;i<t.stopAtIds.length;i++)if(e.id==t.stopAtIds[i]){o=!0;break}if(o)break}t.filterByClass&&!e.classList.contains(t.filterByClass)||n.unshift(e)}return n}function getCurrentTime(){return Math.floor(Date.now()/1e3)}function getQueryStringValue(e){var t=window.location.href.split("?");if(!(t.length<=1))for(var n=t[1].split("&"),o=0;o<n.length;o++){var i=n[o].split("=");if(i[0]==e)return i[1]}}function copyObjToObj(e,t,n){for(var o in n=n||{},e)n.onlyIfNotExists&&null!=t[o]||(t[o]=e[o])}function traverseToBottom(e,t){for(;e&&e.children.length;){if(t&&e.id==t)return e;e=e.children[0]}return e}function traverseToTop(e,t){for(;e&&e.parentNode;){if(t&&e.id==t)return e;e=e.parentNode}return!e||e.parentNode||e.id!=t?null:e}function traverseToTopWithClass(e,t){for(;e&&e.parentNode;){if(t&&e.classList.contains(t))return e;e=e.parentNode}return e&&!e.parentNode&&e.classList.contains(t)?e:null}function getDomainFromURL(e){var t=new URL(e);return t.protocol+"//"+t.hostname}function hasParent(e,t,n,o){n=n||3;for(var i=0;i<n;i++){if(!(e=e.parentNode))return;if("body"==e.nodeName.toLowerCase())return;if(hasClass(e,t))return!0}}function hasParentWithId(e,t,n,o){n=n||3;for(var i=0;i<n;i++){if(!(e=e.parentNode))return;if("body"==e.nodeName.toLowerCase())return;if(e.id==t)return!0}}function hasParentNode(e,t,n){n=n||3;for(var o=0;o<n;o++){if(!(e=e.parentNode))return;var i=e.nodeName.toLowerCase();if("body"==i)return;if(i==t)return!0}}function XORCipher(){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e,t){var n;return n=e,function(e){var t,n,o,i,r,a,s,c,l=0,d="";if(!e)return e;for(;t=e[l++],n=e[l++],o=e[l++],i=(s=t<<16|n<<8|o)>>12&63,r=s>>6&63,a=63&s,d+=u.charAt(s>>18&63)+u.charAt(i)+u.charAt(r)+u.charAt(a),l<e.length;);return((c=e.length%3)?d.slice(0,c-3):d)+"===".slice(c||3)}(t=i(t,function(e,t){return e.charCodeAt(0)^o(n,t)}))},decode:function(e,t){return t=function(e){var t,n,o,i,r,a,s,c,l=0,d=[];if(!e)return e;e+="";for(;i=u.indexOf(e.charAt(l++)),r=u.indexOf(e.charAt(l++)),a=u.indexOf(e.charAt(l++)),s=u.indexOf(e.charAt(l++)),t=(c=i<<18|r<<12|a<<6|s)>>16&255,n=c>>8&255,o=255&c,d.push(t),64!==a&&(d.push(n),64!==s&&d.push(o)),l<e.length;);return d}(t),n=e,i(t,function(e,t){return String.fromCharCode(e^o(n,t))}).join("");var n}};function o(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){for(var n=[],o=0;o<e.length;o++)n[o]=t(e[o],o);return n}}function isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}function digits(e,t){return 1!=t&&e<Math.pow(10,t-1)?"0"+digits(e,t-1):e}function cleanURL(e){try{native&&mobile&&(e=(e=window.Ionic.WebView.convertFileSrc(e)).replace(/([^:])\/\//g,"$1/"))}catch(e){}return e}function parseHtml(e){var t=parser.parseFromString(e,"text/html");return t&&t.documentElement||(t=parser.parseFromString(e,"text/xml")),t}function parseXml(e){var t=parser.parseFromString(e,"text/xml");return t&&t.documentElement||(t=parser.parseFromString(e,"text/html")),t}function getTopOffsetRelativeTo(e,t){for(var n=0;e&&e!=t;)n+=e.offsetTop,e=e.offsetParent;return n}function existsInArray(e,t,n){n=n||{};for(var o=t.length;o--;)if(t[o]==e)return!n.index||o}function removeFromArray(e,t){for(var n=t.length;n--;)t.splice(n,1)}function serializeObject(e,t,n){var o=Object.prototype.toString.call(e);if(void 0===n)if("[object Object]"===o)n={};else{if("[object Array]"!==o)return;n=[]}for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=e[i];if(null!=r)switch(Object.prototype.toString.call(r)){case"[object Array]":case"[object Object]":serializeObject(r,a(t,i),n);break;default:n[a(t,i)]=("boolean"==typeof r?Number:encodeURIComponent)(r)}}function a(e,t){return null!=e?e+"["+t+"]":t}return n}function getBaseSuffix(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function waitFor(e,t,n){n=n||0,"string"==typeof e&&window[e]||Array.isArray(e)&&e.length||/#|\./.test(e)&&document.querySelector(e)?t():n<3e3&&setTimeout(function(){waitFor(e,t,n+100)},100)}function base64URL(e){return e.toString(CryptoJS.enc.Base64).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function getClosest(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}function removePx(e){if(e){var t=e.split("px");return t.length?Number(t[0]):void 0}}function addDigitsToArray(e,t){if(!e)return e;for(var n=0;n<e.length;n++)e[n]=digits(e[n],t);return e}function UAParser(){this.ua="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"",this.UNKNOWN="?",this.OBJ_TYPE="object",this.STR_TYPE="string",this.NAME="name",this.VERSION="version",this.BLACKBERRY="BlackBerry",this.BROWSER="Browser",this.CHROME="Chrome",this.FIREFOX="Firefox",this.OPERA="Opera",this.oldSafariMap={"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},this.windowsVersionMap={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},this.regexes={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[this.NAME,this.VERSION],[/opios[\/ ]+([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Mini"]],[/\bopr\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[this.NAME,this.VERSION],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[this.VERSION,[this.NAME,"UC"+this.BROWSER]],[/\bqbcore\/([\w\.]+)/i],[this.VERSION,[this.NAME,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[this.VERSION,[this.NAME,"WeChat"]],[/konqueror\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[this.VERSION,[this.NAME,"IE"]],[/yabrowser\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[this.NAME,/(.+)/,"$1 Secure "+this.BROWSER],this.VERSION],[/\bfocus\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX+" Focus"]],[/\bopt\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Dolphin"]],[/coast\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[this.VERSION,[this.NAME,"MIUI "+this.BROWSER]],[/fxios\/([-\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX]],[/\bqihu|(qi?ho?o?|360)browser/i],[[this.NAME,"360 "+this.BROWSER]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[this.NAME,/(.+)/,"$1 "+this.BROWSER],this.VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[this.NAME,/_/g," "],this.VERSION],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[this.NAME,this.VERSION],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[this.NAME],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[this.NAME,"Facebook"],this.VERSION],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[this.NAME,this.VERSION],[/\bgsa\/([\w\.]+) .*safari\//i],[this.VERSION,[this.NAME,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[this.VERSION,[this.NAME,this.CHROME+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[this.NAME,this.CHROME+" WebView"],this.VERSION],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[this.VERSION,[this.NAME,"Android "+this.BROWSER]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[this.NAME,this.VERSION],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[this.VERSION,[this.NAME,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[this.VERSION,this.NAME],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[this.NAME,[this.VERSION,this.strMapper,this.oldSafariMap]],[/(webkit|khtml)\/([\w\.]+)/i],[this.NAME,this.VERSION],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[this.NAME,"Netscape"],this.VERSION],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[this.VERSION,[this.NAME,this.FIREFOX+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[this.NAME,this.VERSION]],os:[[/microsoft (windows) (vista|xp)/i],[this.NAME,this.VERSION],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[this.NAME,[this.VERSION,this.strMapper,this.windowsVersionMap]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[this.NAME,"Windows"],[this.VERSION,this.strMapper,this.windowsVersionMap]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[this.VERSION,/_/g,"."],[this.NAME,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[this.NAME,"Mac OS"],[this.VERSION,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[this.VERSION,this.NAME],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[this.NAME,this.VERSION],[/\(bb(10);/i],[this.VERSION,[this.NAME,this.BLACKBERRY]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[this.VERSION,[this.NAME,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[this.VERSION,[this.NAME,"webOS"]],[/crkey\/([\d\.]+)/i],[this.VERSION,[this.NAME,this.CHROME+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[this.NAME,"Chromium OS"],this.VERSION],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[this.NAME,this.VERSION],[/(sunos) ?([\w\.\d]*)/i],[[this.NAME,"Solaris"],this.VERSION],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[this.NAME,this.VERSION]]},this.has=function(e,t){return typeof e===this.STR_TYPE&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},this.strMapper=function(e,t){for(var n in t)if(typeof t[n]===this.OBJ_TYPE&&0<t[n].length){for(var o=0;o<t[n].length;o++)if(this.has(t[n][o],e))return n===this.UNKNOWN?void 0:n}else if(this.has(t[n],e))return n===this.UNKNOWN?void 0:n;return e},this.rgxMapper=function(e,t,n){for(var o,i,r,a,s,c=0;c<n.length&&!a;){for(var l=n[c],d=n[c+1],u=o=0;u<l.length&&!a;)if(a=l[u++].exec(t))for(i=0;i<d.length;i++)s=a[++o],typeof(r=d[i])===this.OBJ_TYPE&&0<r.length?2==r.length?"function"==typeof r[1]?e[r[0]]=r[1].call(e,s):e[r[0]]=r[1]:3==r.length?"function"!=typeof r[1]||r[1].exec&&r[1].test?e[r[0]]=s?s.replace(r[1],r[2]):void 0:e[r[0]]=s?r[1].call(e,s,r[2]):void 0:4==r.length&&(e[r[0]]=s?r[3].call(e,s.replace(r[1],r[2])):void 0):e[r]=s||void 0;c+=2}},this.getBrowserDetails=function(){var e={name:void 0,version:void 0};return this.rgxMapper(e,this.ua,this.regexes.browser),e},this.getOSDetails=function(){var e={name:void 0,version:void 0};return this.rgxMapper(e,this.ua,this.regexes.os),e}}function phpDateToJS(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])}function createService(e,t){window[e]=t()}function getUrlExt(e){var t=ph.getExtension(e);return t=(t=t.split("?")[0]).split("#")[0]}function getTemplate(e){var t=kTemplate(e);return templatesRepo[t]||(t=kTemplate(e,"web")),templatesRepo[t]}function isIpad(){var t=0==window.location.search.indexOf("?ipadtest"),e=window.navigator.userAgent;if(t&&window.alert("ua: "+e),-1<e.indexOf("iPad"))return!0;if(t&&window.alert("window.navigator.platform: "+window.navigator.platform),"iPad"==window.navigator.platform)return!0;if(t&&window.alert("Check 1"),-1<e.indexOf("Mac")||-1<e.indexOf("CriOS")){t&&window.alert("Check 2");try{return document.createEvent("TouchEvent"),t&&window.alert("return true"),!0}catch(e){t&&window.alert("caught")}}return!1}function removeSplashScreen(){document.getElementById("splash").innerHTML=""}function stringSimilarity(e,t){var n=e,o=t;e.length<t.length&&(n=t,o=e);var i=n.length;return 0==i?1:(i-function(e,t){e=e.toLowerCase(),t=t.toLowerCase();for(var n=new Array,o=0;o<=e.length;o++){for(var i,r=o,a=0;a<=t.length;a++){0==o?n[a]=a:0<a&&(i=n[a-1],e.charAt(o-1)!=t.charAt(a-1)&&(i=Math.min(Math.min(i,r),n[a])+1),n[a-1]=r,r=i)}0<o&&(n[t.length]=r)}return n[t.length]}(n,o))/parseFloat(i)}function getPathForCordova(e){return native&&e.startsWith("file:///")?e.replace("file:///","kotobee://localhost/_app_file_/"):e}String.prototype.includes=function(e){return-1!==this.indexOf(e)},String.prototype.toCamelCase=function(){return this.toLowerCase().replace(/(?:(^.)|(\s+.))/g,function(e){return e.charAt(e.length-1).toUpperCase()})};var parser=new DOMParser,preview,previewParams,app,mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),mobileDebug=!1,ios=/iPhone|iPad|iPod/i.test(navigator.userAgent);isIpad()&&(mobile=1,ios=!0);var readerV=1.7,debug=!1,native,bookPath,noFlash,isReaderApp,isRelease=!0,desktop,chromeApp,os,miniapps={},uuid,kotobee={},loggerWorker,partitionEnabled="Android"==mobile&&config.kotobee.segregate,isKotobee=!0,debugDuration=!1,overflowScroll=!mobile|config.overflowScroll,vueExclude=!1,firstRouteShown;if(0<window.location.href.indexOf("?preview")){preview=!0,mobileDebug=!0;for(var arr=window.location.href.split("?"),arr=arr[1].split("&"),previewParams={},i=0;i<arr.length;i++){var arr2=arr[i].split("=");previewParams[arr2[0]]=arr2[1]}mobile=!!previewParams.mobile}$rootScope={$$phase:!1,$apply:function(){},$on:function(){},$broadcast:function(){}},$location={path:function(e){if(e)return window.location.href="#"+e;var t=window.location.hash;return t?t.split("#")[1]:void 0},search:function(e){var t,n;if("object"==typeof e)for(var o in e)n=e[t=o];else t=e;var i=(i=window.location.hash).split("?")[0];window.location.hash=i+"?"+t+(n?"="+n:"")}},$ionicPlatform={ready:function(e){e()},registerBackButtonAction:function(){}},$injector={get:function(e){return window[e]}},$window={open:function(e){window.open(e)}},$sce={trustAsResourceUrl:function(e){return e},trustAsHtml:function(e){return e}},$timeout=setTimeout,$interpolate=function(o){return function(e){for(var t in e){var n=new RegExp("{{"+t+"}}","g");o=o.replace(n,e[t])}return o}},$document=[document],$ionicGesture={on:function(){}},$ionicHistory={clearHistory:function(){},clearCache:function(){},forwardView:function(){return{}},backView:function(){return{}},goBack:function(){return{}},nextViewOptions:function(){return{}}},$http={get:function(){return khttp.get.apply(null,arguments)},post:function(){return khttp.post.apply(null,arguments)}},$ionicLoading={show:function(){},hide:function(){}},$compile=function(n){return function(e){var t=document.createElement("div");return t.innerHTML=n,t.children}},$q={defer:function(){var t,n,o,i,r,a,s,c={},e={resolve:function(e){t=!0,n=e,s&&(c.success?c.success():c.then&&c.then())},reject:function(e){o=!0,i=e,s&&(c.error?c.error():c.catch&&c.catch())}};return c.then=c.success=function(e){return s=!0,t?(e=e||r)&&e(n):r=e,c},c.error=c.catch=function(e){return s=!0,o?(e=e||a)&&e(i):a=e,c},e.promise=c,e}},$filter=function(e){return function(){return vueApp.$options.filters[e].apply(null,arguments)}},angular={element:function(o){return o==document.body&&(o=document.getElementById("kotobeeVue")),{scope:function(){return new Proxy({},{get:function(e,t){for(var n=o.__vue__;n&&!n[t];)n=n.$parent;if(n)return n[t]}})},injector:function(){return{get:function(e){return window[e]}}}}}},inherited=function(e,t,n){for(var o=e;o&&!o[t];)o=o.$parent;if(o)return isFunction(o[t])?o[t].apply(null,n||[]):o[t]};var log=kLog;vueExclude&&(app.directive("iframeOnload",[function(){return{scope:!1,link:function(e,t,n){t.on("load",function(){return e.modal.siteOptions.loaded()})}}}]),app.directive("containerScroll",function(r){return{scope:!1,link:function(e,t,n){var o=Math.round(99999*Math.random());addClass(t[0],"containerMobileScroll containerScroll"+o),function n(){r(function(){var t=document.getElementsByClassName("containerScroll"+o);function e(e){t[0].getElementsByClassName("kbContent");e.touches&&1<e.touches.length||e.stopPropagation()}t.length?t[0].addEventListener("touchstart",e):++i<50&&n()},40)}();var i=0}}}),app.directive("enterWithoutShift",function(){return function(t,e,n){e.bind("keydown keypress",function(e){e.shiftKey||13===e.which&&(t.$apply(function(){t.$eval(n.enterWithoutShift)}),e.preventDefault())})}}),app.directive("enterWithCtrl",function(){return function(t,e,n){e.bind("keydown keypress",function(e){e.ctrlKey&&13===e.which&&(t.$apply(function(){t.$eval(n.enterWithCtrl)}),e.preventDefault())})}}),app.directive("searchheader",function(r,a){return{restrict:"E",replace:!1,scope:{obj:"=obj",prop:"=prop",kotobeeGradient:"=kotobeeGradient",onValue:"=onValue",offValue:"=offValue",noCancel:"=noCancel",searchKeyOb:"=searchKeyOb",onsearch:"&"},templateUrl:kTemplate("headers/headerSearch.html"),link:function(n,o,i){n.$watch("obj[prop]",function(e,t){e===a(i.onValue)(n)&&r(function(){o[0].getElementsByTagName("input")[0].focus()})}),n.hide=function(){n.obj[n.prop]=n.offValue}}}}),app.directive("ngEnter",function(){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ngEnter)}),e.preventDefault())})}}),app.directive("nextchapterscroll",function(){return{restrict:"E",templateUrl:kTemplate("components/nextChapterScroll.html")}}),app.directive("autofocusme",function(o){return{link:function(e,t,n){o(function(){t[0].focus()},350)}}}),app.directive("readerheader",function(){return{restrict:"E",templateUrl:kTemplate("headers/readerHeader.html"),scope:!1}}),app.directive("headerdefault",function(){return{restrict:"E",templateUrl:kTemplate("headers/headerDefault.html"),scope:!1}}),app.directive("headerselection",function(){return{restrict:"E",templateUrl:kTemplate("headers/headerSelection.html"),scope:!1}}),app.directive("headersearchitems",function(){return{restrict:"E",templateUrl:kTemplate("headers/headerSearchItems.html"),scope:!1}}),app.directive("headertextsize",function(){return{restrict:"E",templateUrl:kTemplate("headers/headerTextSize.html"),scope:!1}}),app.directive("headerfreehand",function(){return{restrict:"E",templateUrl:kTemplate("headers/headerFreehand.html"),scope:!1}}),app.directive("headerlibrary",function(){return{restrict:"E",templateUrl:kTemplate("headers/headerLibrary.html"),scope:!1}}),app.directive("mouseEvents",function(e,t,o,n,i){return{restrict:"A",link:function(e,t,n){o.init(t)}}}),app.directive("vanillaScroll",function(){return{restrict:"A",link:function(e,t,n){t[0].addEventListener("scroll",function(){e.scroll(this)})}}}),app.directive("selectOptions",function(){return{restrict:"E",templateUrl:kTemplate("headers/selectOptions.html")}}),app.directive("selectionOptions",function(){return{restrict:"E",templateUrl:kTemplate("components/selectionOptions.html")}}),app.directive("tabMenu",function(){return{restrict:"E",replace:!0,templateUrl:kTemplate("panels/tabMenu.html")}}),app.directive("media",function(){return{restrict:"E",replace:!0,templateUrl:kTemplate("panels/media.html"),scope:!1}}),app.directive("noteitem",function(){return{restrict:"E",templateUrl:kTemplate("components/noteItem.html")}}),app.directive("bookmarkitem",function(){return{restrict:"E",templateUrl:kTemplate("components/bookmarkItem.html")}}),app.directive("hlightitem",function(){return{restrict:"E",templateUrl:kTemplate("components/hlightItem.html")}}),app.directive("bookThumb",function(){return{restrict:"E",replace:!0,templateUrl:kTemplate("panels/bookThumb.html")}}),app.directive("thumbnail",function(){return{restrict:"A",link:function(e,t,n){t.attr("style","background-size:cover,width:50px,height:50px")}}}),app.directive("onimgload",function(){return{restrict:"A",link:function(t,n,o){n.bind("load",function(e){t[o.onimgload](n),t.$apply()})}}}),app.directive("showafterimageload",function(){return{restrict:"A",link:function(e,t,n){t.bind("load",function(e){e.currentTarget.style.opacity=1,autoprefixTransform(e.currentTarget,"translate(-50%, -100%) scale(1)")})}}}),app.directive("headerShrink",function(o){return{restrict:"A",link:function(e,t,n){o.setup(e,t,n)}}}),app.directive("categoryList",function(e){return{restrict:"E",templateUrl:kTemplate("components/categoryList.html"),scope:{rtl:"=rtl",list:"=list",parent:"=parent",backlist:"=backlist",odd:"=odd",level:"=level",categoryClicked:"=clicked",categoryBackClicked:"=backClicked"}}}),app.directive("sdk",function(){return{restrict:"E",templateUrl:mobile?"":"templates/panels/sdk.html"}}),app.directive("sdkProfileForm",function(){return{restrict:"E",templateUrl:kTemplate("panels/sdkProfileForm.html"),scope:{profile:"=profile",save:"=save",cancel:"=cancel"}}}),app.directive("bookInfo",function(){return{restrict:"E",templateUrl:kTemplate("panels/bookInfo.html"),scope:{pageview:"=pageview",book:"=book"}}}),app.directive("stars",function(){return{restrict:"E",templateUrl:kTemplate("components/stars.html"),scope:{rating:"=rating",type:"=type",onselect:"=onselect"},link:function(t,e,n){t.rating||(t.rating=0),"input"==t.type&&(t.rating=t.selectedRating=0),t.over=function(e){"input"==t.type&&(t.rating=e)},t.select=function(e){"input"==t.type&&(t.rating=t.selectedRating=e,t.onselect&&t.onselect(e))},t.leave=function(){"input"==t.type&&null!=t.selectedRating&&(t.rating=t.selectedRating)}}}})),Vue.directive("showafterimageload",{bind:function(e,t){e.addEventListener("load",function(e){e.currentTarget.style.opacity=1,autoprefixTransform(e.currentTarget,"translate(-50%, -100%) scale(1)")})}}),Vue.directive("autofocus",{bind:function(e,t){Vue.nextTick(function(){e&&e.focus&&e.focus()})}}),Vue.directive("headershrink",{inserted:function(e,t){}}),Vue.directive("longpress",{bind:function(e,t,n){t.value;var o=null;function i(e){"click"===e.type&&0!==e.button||null===o&&(o=setTimeout(function(){t.value(void 0)},1e3))}function r(e){null!==o&&(clearTimeout(o),o=null)}e.addEventListener("mousedown",i),e.addEventListener("touchstart",i),e.addEventListener("click",r),e.addEventListener("mouseout",r),e.addEventListener("touchend",r),e.addEventListener("touchcancel",r)}}),Vue.directive("imgfallback",{bind:function(e,t){e.addEventListener("error",function(e){e.target.src=t.value})}}),Vue.directive("tooltip",{bind:function(e,t){mobile||(e.removeAttribute("title"),e.addEventListener("mouseover",function(){tooltip.show(e,t.value)}),e.addEventListener("mouseout",function(){tooltip.hide()}))}}),Vue.filter("bookSetup",function(){var e=document.getElementById("chaptersContent"),c=document.getElementById("epubContainer");function t(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}cache.setOb("epubContainer",c),cache.setOb("chaptersContent",e),e.addEventListener("contextmenu",function(e){t(e)}),e.addEventListener("mousedown",function(e){if(2===e.which)return t(e),!1}),e.addEventListener("click",function(e){if(2===e.which)return t(e),!1}),document.getElementById("chapters").addEventListener("click",function(e){var t=e.target;if("span"==t.nodeName.toLowerCase()&&"a"==t.parentNode.nodeName.toLowerCase()&&(t=t.parentNode),"a"==t.nodeName.toLowerCase()){if(!o(t))return;var n=t.getAttribute("href");if(n){if(n.match(/http[s]?:/g))return;if(0==n.indexOf("/"))return;if(0==n.indexOf("#"))return void $ionicSideMenuDelegate.close();e.preventDefault(),$rootScope.renderScope.chapterLink(t)}else e.preventDefault(),$rootScope.renderScope.chapterLink(t)}else if("i"==t.nodeName.toLowerCase()){if(!o(t))return;0<t.parentElement.getElementsByTagName("ol").length&&(t.offsetHeight,t.parentElement.classList.toggle("expanded"))}function o(e){for(var t=e.parentNode;t&&t!=document.body;){if(hasClass(t,"menu")&&(hasClass(t,"menu-left")||hasClass(t,"menu-right")))return 1;t=t.parentNode}}});var n=document.getElementById("chapters");function o(e){if(hasParentWithId(e.target,"epubContainer",99)){selection.active()&&selection.reset();var t=e.target;if("sections"!=t.nodeName.toLowerCase()&&!hasClass(t,"k-section")&&"video"!=t.nodeName.toLowerCase()&&"audio"!=t.nodeName.toLowerCase()){if(t.hasAttribute("contenteditable"))return e.stopPropagation(),void t.focus();for(var n=t.childNodes.length;n--;)if("#text"==t.childNodes[n].nodeName&&""!=t.childNodes[n].nodeValue.replace(/\s+/g," ").trim())return void selection.elementDown(t,e)}}}n.addEventListener("touchstart",o),n.addEventListener("mousedown",o),n.addEventListener("keyup",function(e){var t;!hasParentWithId(e.target,"epubContainer",99)||(t=e.target)&&hasClass(t,"ki-textfield")&&(kInteractive.events.add({action:"answerClicked",disableRemote:!0,param:null,elem:t}),kInteractive.action(t,e),e.stopPropagation())}),n.addEventListener("change",function(e){var t;!hasParentWithId(e.target,"epubContainer",99)||(t=e.target)&&hasClass(t,"ki-textfield")&&(kInteractive.action(t,e),e.stopPropagation())}),n.addEventListener("dragend",function(e){var t;!hasParentWithId(e.target,"epubContainer",99)||(t=e.target)&&hasClass(t,"ki-draggable")&&(kInteractive.events.add({action:"answerClicked",disableRemote:!0,param:null,elem:t}),kInteractive.action(t,e),e.stopPropagation())}),n.addEventListener("click",function(e){if(hasParentWithId(e.target,"epubContainer",99)){var t=e.target;if(t){for(var n=t;n&&n!=c;){if("a"==n.nodeName.toLowerCase()){if(hasClass(n,"ki-btn"))kInteractive.action(n,e);else{var o=n.getAttribute("href");if(!o)return kInteractive.action(n,e),void e.stopPropagation();o.match(/http[s]?:/g)?$rootScope.renderScope.externalLink(n):0==o.indexOf("/")?window.open(o):0==o.indexOf("mailto:")?window.location.href=o:(0!=o.indexOf("#")&&(o=ph.join(stg.data.book.chapter.url,o)),chapters.applyChapterStateFromURL(o))}return void e.stopPropagation()}if("input"==n.nodeName.toLowerCase()&&"submit"!=n.type)return hasClass(n,"ki-inputbox")&&(kInteractive.events.add({action:"answerClicked",disableRemote:!0,param:null,elem:t}),kInteractive.action(t,n)),void e.stopPropagation();n=n.parentNode}if("video"!=t.nodeName.toLowerCase()&&"audio"!=t.nodeName.toLowerCase()){if("img"==t.nodeName.toLowerCase()){if(hasClass(t,"kInteractive")&&"none"!=kInteractive.readData(t).behavior)return kInteractive.action(t,e),void e.stopPropagation();var i=t.parentNode;if(hasClass(i,"kInteractive")){if(hasClass(i,"widget"))return kInteractive.action(t,e),void e.stopPropagation();if(hasClass(i,"questions"))return kInteractive.action(t,e),void e.stopPropagation()}var r=!0,a=kInteractive.readData(t);if(a&&a.popup||(r=!1),t.hasAttribute("static")&&(r=!1),t.hasAttribute("data-static")&&(r=!1),r){var s={};return s.thumbnail=s.src=cleanURL(a.path?ph.join(stg.data.book.chapter.absoluteURL,a.path):t.getAttribute("src")),s.large="large"==a.popupSize,s.title=t.getAttribute("title")?t.getAttribute("title"):ph.basename(s.thumbnail),s.ext=ph.getExtension(s.thumbnail),s.type="image",media.show(s),void e.stopPropagation()}}return hasClass(t,"ki-btn")||hasClass(t,"kInteractive")?(kInteractive.action(t,e),void e.stopPropagation()):"true"==t.getAttribute("contenteditable")?(t.focus(),void e.stopPropagation()):void("input"!=t.nodeName.toLowerCase()||e.stopPropagation())}}}})}),Vue.filter("chapterHtml",function(e){if(e){for(var t=e.getElementsByTagName("li"),n=t.length;n--;){addClass(t[n],"item"),t[n].getElementsByTagName("ol").length&&addClass(t[n],"parent");var o=t[n].getElementsByTagName("ol").length?" parent":"";t[n].innerHTML='<i class="icon'+o+'"> </i> '+t[n].innerHTML}for(var i=e.getElementsByTagName("a"),n=i.length;n--;)"true"==i[n].getAttribute("data-expand")&&addClass(i[n].parentNode,"expanded");for(var r,a,s,c,l,n=0;n<i.length;n++){i[n].href&&(r=i[n].getAttribute("href"),a="",book.currentBook&&(a="/book/"+book.currentBook.id),null!=(s=chapters.indexFromUrl(i[n].getAttribute("href")))&&(c=r.split("html#"),l=Array.isArray(c)&&c.length&&2<=c.length?"/"+c[1]:"",i[n].setAttribute("data-url",i[n].getAttribute("href")),i[n].setAttribute("href","#"+a+"/reader/chapter/"+s+l)))}}}),Vue.filter("contentHtml",function(e,t){var n=document.createElement("div");n.setAttribute("id","epubContent"),t=t||stg.data.book.chapter.absoluteURL,htmlParser.wrapOrphans(e),kInteractive&&kInteractive.preRender(e,{chapterUrl:t}),$filter("contentSrc")(e,t);var o=document.createElement("sections"),i=e.getElementsByTagName("body")[0];if(partitionEnabled){for(var r=new Array,a=0;;){var s=!0,c=!1,l=0;r[a]=document.createElement("section"),r[a].setAttribute("sec",a),addClass(r[a],"k-section");for(var d=i.childNodes.length;d--;)if(!i.childNodes[d].style||"absolute"!=i.childNodes[d].style.position){if(!((l+=(null!=i.childNodes[d].textContent?i.childNodes[d].textContent:i.childNodes[d].data).length)<4e3||s)){c=!0;break}s=!1,r[a].insertBefore(i.childNodes[d],r[a].firstChild)}if(!c)break;a++}for(d=0;d<r.length;d++)o.insertBefore(r[d],o.firstChild)}else{var u=document.createElement("section");u.setAttribute("sec","0"),addClass(u,"k-section");for(d=i.childNodes.length;d--;)u.insertBefore(i.childNodes[d],u.firstChild);o.appendChild(u)}i.appendChild(o);for(var p,h=e.getElementsByTagName("body")[0].innerHTML,g=e.getElementsByTagName("meta"),d=0;d<g.length;d++){var f=g[d].getAttribute("name");if(f&&"viewport"==f.toLowerCase()){p=!0;break}}p&&chapters.mightCrashOnIos(h)&&(h=(h=h.replace(/<span[^>]*?><\/span>/g,"")).replace(/data-[^ ]*?=".*?"/g,"")),n.innerHTML=h;for(var m=n.getElementsByTagName("script");m.length;)m[0].parentNode.removeChild(m[0]);return pauseVideoAndAudio(n),n}),Vue.filter("contentJs",function(e){var i,r=$q.defer(),t=cache.getOb("epubContent");return document.getElementById("epubMeta")?(document.getElementById("epubMeta").innerHTML="",i=document.getElementById("epubMeta")):((i=document.createElement("div")).setAttribute("id","epubMeta"),i.className="hide",t.parentNode.insertBefore(i,t.nextSibling)),cache.setOb("epubMeta",i),selection.newChapter(),function(){function e(){if(n++,0,"#e7e3d9"==rgb2hex(window.getComputedStyle(cache.getOb("epubContent")).getPropertyValue("background-color"))){clearInterval(o),removeClass(i,"hide");for(var e,t=document.getElementsByTagName("style"),n=0;n<t.length;n++){t[n].hasAttribute("kotobee")&&(e=(e=t[n].innerHTML).replace(/[^}]*?{[^}]*?background-color:#e7e3d9 !important;.*?}/g,""),t[n].innerHTML=e)}settings.initialize(),r.resolve({})}}removeClass(cache.getOb("epubContent"),"bgInherit");var o=setInterval(e,30);e()}(),r.promise}),Vue.filter("contentSrc",function(e,t){for(var n,o,i,r=getElementsByAttribute(e,"*","src"),a=0;a<r.length;a++){shouldParse(c=r[a].getAttribute("src"))&&r[a].setAttribute("src",ph.join(ph.removeHash(t),c)),"img"==r[a].nodeName.toLowerCase()&&(hasClass(r[a],"kInteractive")||hasClass(r[a].parentNode,"kInteractive")||r[a].style.height||r[a].getAttribute("height")||(r[a].style.maxWidth="100%"),chromeApp&&(!r[a].getAttribute("src")||isAbsoluteURLAndNotDataPath(o=(n=r[a]).getAttribute("src"))&&(i=n.getAttribute("chrome"),stg.data.chromeAssets[o]?n.setAttribute("src",stg.data.chromeAssets[o]):i&&stg.data.chromeAssets[i]?n.setAttribute("src",stg.data.chromeAssets[i]):(i=Math.round(1e5*Math.random()),n.setAttribute("src",""),n.setAttribute("chrome",i),getImgDataSrc(o,function(t){setTimeout(function(){stg.data.chromeAssets[i]=t;var e=getElementsByAttribute(document,"img","chrome",i);e.length&&e[0].setAttribute("src",t)},300)})))))}for(var s=getElementsByAttribute(e,"*","poster"),a=0;a<s.length;a++){shouldParse(c=s[a].getAttribute("poster"))&&s[a].setAttribute("poster",ph.join(ph.removeHash(t),c))}for(var c,l=getElementsByAttribute(e,"image","xlink:href"),a=0;a<l.length;a++){shouldParse(c=l[a].getAttribute("xlink:href"))&&l[a].setAttribute("xlink:href",ph.join(ph.removeHash(t),c))}for(var d=getElementsByAttribute(e,"*","style"),a=0;a<d.length;a++){var u=d[a].getAttribute("style");-1!=u.toLowerCase().indexOf("url(")&&(hasParent(d[a],"kInteractive",5)||d[a].setAttribute("style",u.replace(/(.*?url\()(.+?)(\).*?)/g,p)))}function p(){var e=arguments[2];return 0==e.indexOf('"')&&(e=e.split('"')[1]),0==e.indexOf("'")&&(e=e.split("'")[1]),0==e.indexOf("&quot;")&&(e=e.split("&quot;")[1]),-1!=e.indexOf("http://")||-1!=e.indexOf("https://")||0==e.indexOf("data:")?arguments[0]:(e=ph.join(ph.removeHash(t),e),arguments[1]+e+arguments[3])}}),function(){var x,I,E,S,T=[];Vue.filter("contentVirt",function(e,t,l){if(kLog("contentVirt"),kLog(e,t,l),config.parseCachingVer)l&&l();else try{function n(e){if(e){for(var t=T.length;t--;)if(T[t]==e)return;var n=cache.getOb("epubContent").className;addClass(cache.getOb("epubContent"),"reveal");var o=e.offsetTop-cache.getOb("epubContent").offsetTop;0!=o&&(e.style.marginTop=o+"px",T.push(e),cache.getOb("epubContent").className=n)}}var d=[];function o(e,t){(t=t||{}).id=Math.round(9999*Math.random());t.cb;if(null==t.includeAnnotations&&(t.includeAnnotations=!0),hasClass(e,"parsed"))return t.cb&&t.cb(e),e;addClass(e,"parsed");var n={};if("fxl"==stg.data.book.chapter.layout&&chapters.mightCrashOnIos(e.textContent)){if(native&&mobile){for(var o=e.getElementsByTagName("img"),i=0;i<o.length;i++){var r=o[i].getAttribute("src");r&&o[i].setAttribute("src",cleanURL(r))}o=null}for(var a=e.getElementsByTagName("a"),i=0;i<a.length;i++)a[i].setAttribute("onclick","return false;");return a=null,addClass(document.body,"ios15DisabledAnnotation"),void(l&&l(e))}removeClass(document.body,"ios15DisabledAnnotation");var s=e.innerHTML;if(workers.supported()&&t.allowWorkers){return d.push({html:s,el:e,options:t}),1==d.length&&function o(){n.html=d[0].html;n.WEBVIEW_SERVER_URL=window.WEBVIEW_SERVER_URL;n.native=window.native;n.mobile=window.mobile;workers.call("htmlParser","parse",[n],function(e){var t=replaceHTML(d[0].el,e),n=d[0].options;n.includeAnnotations&&u(),d.shift(),n.cb&&n.cb(t),d.length&&o()})}(),!0}var c=replaceHTML(e,s=htmlParser.parse(s));return t.includeAnnotations&&u(),l&&l(c),c}function u(){}if("reset"==e)return x=I=null,E=!0,void(T=[]);var i=cache.getOb("epubContent");if("reveal"==e)return void addClass(i,"reveal");if("undoReveal"==e)return void removeClass(i,"reveal");if("parse"==e)return void o(t,{includeAnnotations:!1,allowWorkers:!0,source:"parse mode",cb:l});if("parseAndAnnotations"==e)return void o(t,{allowWorkers:!0,source:"parseAndAnnotations mode"});var r,a,s=i.parentNode.parentNode,c=s.style.webkitTransform||s.style.mozTransform||s.style.transform,p=null==e&&null!=t?t:!overflowScroll||!config.overflowScroll&&preview&&mobile?-Number(c.split(",")[1].slice(0,-2)):cache.getOb("epubContainer").scrollTop,h=p<S?"up":"down",g=(S=p)+s.parentNode.offsetHeight,f=i.children;if(E){for(var m=[],v=0,b=0;b<f.length;b++){for(var k=[],y=f[b],w=0;w<y.childNodes.length;w++)k[w]={},y.childNodes[w].offsetTop+y.childNodes[w].offsetHeight<p-200||y.childNodes[w].offsetTop>g+200?k[w].add=["cNone","noMargin"]:(0==v&&(k[w].setMargin=!0,v=1,r=w),k[w].remove=["cNone","noMargin"],k[w].setParse=!0,a=w);for(w=0;w<k.length;w++)k[w].setMargin&&n(y.childNodes[w]),k[w].setParse&&m.push([y.childNodes[w],{source:"from clean",allowWorkers:!0}]),addRemoveClass(y.childNodes[w],k[w].add,k[w].remove);for(w=0;w<k.length;w++);null!=r&&(x=y.childNodes[r]),null!=a&&(I=y.childNodes[a])}if(E=!1,m.length)for(w=0;w<m.length;w++){var C=m[w];w==m.length-1&&(C[1].cb=l),o(C[0],C[1])}else l&&l();return}if("fxl"==stg.data.book.chapter.layout)return;if(1<f.length)return;if(1==f[0].childNodes.length)return;y=f[0];if("up"==h){if(!(x.offsetTop+x.offsetHeight)<+p&&!(x.offsetTop>p-200))return;if(I==y.childNodes[0])return}else if("down"==h){if(!(I.offsetTop>g+0||I.offsetTop+I.offsetHeight<g+200))return;if(x==y.childNodes[y.childNodes.length-1])return}x&&(x.offsetTop+x.offsetHeight<+p?(addClass(x,"cNone"),addClass(x,"noMargin"),x.nextSibling&&(removeClass(x=x.nextSibling,"noMargin"),n(x),x=o(x,{source:"topElem1"}))):x.offsetTop>p-200&&x.previousSibling&&(addClass(x,"noMargin"),removeClass(x=x.previousSibling,"cNone"),removeClass(x,"noMargin"),n(x),x=o(x,{source:"topElem2"}))),I&&(I.offsetTop>g+0?(addClass(I,"cNone"),I.previousSibling&&(removeClass(I=I.previousSibling,"cNone"),I=o(I,{source:"bottomElem1"}))):I.offsetTop+I.offsetHeight<g+200&&I.nextSibling&&(removeClass(I=I.nextSibling,"cNone"),I=o(I,{source:"bottomElem2"})))}catch(e){}})}(),Vue.filter("js",function(e,t){var n=$q.defer();t=t||{};if(chapters.disableJsLoading)return n.resolve({}),n.promise;for(var o=[],i=e.getElementsByTagName("script"),r=0;r<i.length;r++)if(i[r].getAttribute("src")){var a=i[r].getAttribute("src");if(i[r].parentNode.removeChild(i[r]),r--,0<=a.indexOf("/kotobeeInteractive.js"))continue;a.indexOf(":/"),o.push({mode:"url",val:a})}else o.push({mode:"code",val:i[r].innerHTML});var s=e.getElementsByTagName("body")[0];return s.getAttribute("onload")&&o.push({mode:"code",val:s.getAttribute("onload")}),t.noJsParse?n.resolve():jsParser.inject(o,function(e){n.resolve(e)}),n.promise}),Vue.filter("coverPath",function(e,t){var n=(config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png";return e?isAbsoluteURLPath(e)?e:e=cleanURL(e=t?(config.kotobee.liburl?config.kotobee.liburl:"../../")+"books/"+t+"/EPUB/"+e:ph.join(bookPath,stg.data.packageURL,e)):n}),Vue.filter("categoryStyle",function(e){var t="";isKotobeeHosted()&&(t=publicRoot);var n="";return"image"!=e.display&&"imagetext"!=e.display||e.img&&(n+="background-image:url("+(t+"imgUser/"+e.img)+");"),"image"==e.display&&(n+="color:transparent;"),e.css&&(n+=e.css),n}),Vue.filter("catImgPath",function(e){var t=(config.kotobee.liburl?config.kotobee.liburl:"")+"imgUser/"+e;return config.kotobee.liburl+"/"+ph.join(bookPath,t)}),Vue.filter("decodeHtmlEntities",function(e){return decodeHTMLEntities(e)}),Vue.filter("nativeLinks",function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.getElementsByTagName("a"),o=0;o<n.length;o++){var i=n[o].getAttribute("href");n[o].setAttribute("onclick","window.open('"+i+"', '_system');"),n[o].setAttribute("href","#")}return t.innerHTML}),Vue.filter("moreDataExists",function(e,t){try{if(!stg.currentLibrary)return!1;if("categories"==t)return!1;if("downloaded"==t)return!1;var n;if("favorites"==t&&(n=stg.favorites),"all"==t&&(n=stg.currentLibrary.books),0==n.length)return!1}catch(e){return!1}return e}),Vue.filter("round",function(e){return Math.round(e)}),Vue.filter("arrayEmpty",function(e){if(!e)return!0;for(var t=0;t<e.length;t++)if(Array.isArray(e[t])){if(!$filter("arrayEmpty")(e[t]))return!1}else if(e[t])return!1;return!0}),Vue.filter("langFromId",function(e){for(var t=0;t<stg.data.languages.length;t++)if(stg.data.languages[t].val==e)return stg.data.languages[t].label;return e}),Vue.filter("cleanurl",function(){return cleanURL}),Vue.filter("unsafe",function(e){return e}),Vue.filter("unsafeResource",function(e){return e}),Vue.filter("nl2br",function(e){return e?0<=e.indexOf("</")?e:e.replace(/\n/g,"<br>"):""}),Vue.filter("releasePlatform",function(e){switch(e){case"win32":return"Windows 32-bit";case"win64":return"Windows 64-bit";case"win":return"Windows";case"mac":return"Macintosh"}}),Vue.filter("filesizeLabel",function(e){return e?1e6<e?Math.round(10*e/1e6)/10+" GB":1e3<e?Math.round(10*e/1e3)/10+" MB":Math.round(10*e)/10+" KB":""}),Vue.filter("miniappIconPath",function(e){var t=kMiniapps.getRoot(),n="icon.png";if(e.dataJson._listingIcon){if(isAbsoluteURLPath(n=e.dataJson._listingIcon))return getPathForCordova(n);n="userdata/"+n}return getPathForCordova(t)+"miniapps/"+e.folder+"/"+n}),Vue.filter("metaExists",function(e){if(e&&"N/A"!=e&&"No rights specified"!=e)return e}),Vue.filter("noteEntryStyle",function(e,t){var n=[];return t==e&&n.push("editing"),e.public?(n.push("public"),((e.uid=stg.data.user.id)||stg.data.user.perms&&stg.data.user.perms.globaldata)&&n.push("mine"),n.push("hasAvatar")):n.push("mine"),n.join(" ")}),Vue.filter("noteUsernameChar",function(e){return e?e.name?e.name.substr(0,1):e.uid==stg.data.user.id?"ME":e.email?e.email.substr(0,1):"N/A":"N/A"}),Vue.filter("noteUsername",function(e){return e.name?e.name:e.uid==stg.data.user.id?translit.get("me"):e.email?e.email.substr(0,1)+"***@***.***":translit.get("anonymous")}),Vue.filter("dateTimeFromServer",function(e){return e?phpDateToJS(e).toUTCString():""}),Vue.filter("styles",function(e,t){var n=$q.defer();if(chapters.disableCssLoading)return n.resolve({}),n.promise;t=t||{};for(var o,i=[],r=e.getElementsByTagName("link"),a=0;a<r.length;a++)if("text/css"==r[a].getAttribute("type")&&r[a].getAttribute("href").length){var s=ph.join(t.path,r[a].getAttribute("href")),c=!1;if(isAbsoluteURLPath(r[a].getAttribute("href"))&&(s=r[a].getAttribute("href"),c=!0),function(e){if(0<=e.indexOf("/css/kotobeeInteractive.css"))return!0}(s))continue;s==bookPath+"EPUB/css/base.css"&&(o=!0),i.push({type:"path",val:s,dontCache:c})}o||config.dontForceBaseCss||i.unshift({type:"path",val:bookPath+"EPUB/css/base.css",dontCache:!1});for(var l=e.getElementsByTagName("style"),a=0;a<l.length;a++)i.push({type:"local",val:l[a].innerHTML,root:t.path});return t.noCssParse?n.resolve():cssParser.inject(i,t,function(e){n.resolve(e)}),n.promise}),Vue.filter("t",function(e,t){return translit.get(e,Array.prototype.slice.call(arguments,2))}),createService("annotations",function(){var n,u,p,o={};function k(e){return e.children.length?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}function y(e){for(var t="",n=0;n<e.length;n++)t+=e[n].textContent;return t}return o.initialize=function(e){chapters.addListener(function(e,t){if("renderedChapter"==e){if(n&&n.index==currentIndex)return o.show();n={index:currentIndex,vIndex:currentVIndex},!backend.cloudParam("sync")||config.kotobee.public||p?o.show():o.sync()}})},o.reset=function(){u=p=n=null},o.sync=function(r,a){var e;backend.cloudParam("sync")&&(e={},(r=r||{}).all||(e.chapter=currentIndex,e.chaptername=stg.data.currentPageOb.title,e.file=stg.getChapterFilename()),function(e,t){var n={};n.ver=readerV,null!=e.chapter&&(n.chapter=e.chapter);null!=e.chaptername&&(n.chaptername=e.chaptername);null!=e.file&&(n.file=e.file);backend.getNotebook(n,function(e){t(u=e)})}(e,function(e){var t,n,o,i;e&&!e.error?(t=e.notes&&e.notes.items?e.notes.items:e.notes,n=e.bookmarks&&e.bookmarks.items?e.bookmarks.items:e.bookmarks,o=e.hlights&&e.hlights.items?e.hlights.items:e.hlights,i=e.sketches&&e.sketches.items?e.sketches.items:e.sketches,freehand.addSketchesFromSync(i||{},function(){notes.addNotesFromSync(t||{},function(){bookmarks.addBookmarksFromSync(n||{},function(){hlights.addHlightsFromSync(o||{},function(){r.all&&(p=!0),a&&a()})})})})):a&&a()}))},o.show=function(e,i){for(var t=e=e||cache.getOb("epubContent");null!=(t=t.previousSibling);)0;var n=[];n.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&n.push(stg.data.currentRPageOb.index),$timeout(function(){stg.getBookmarks(function(o){stg.getNotes(function(n){stg.getHlights(function(t){stg.getSketches(function(e){bookmarks.addBookmarksFromOffline(o),notes.addNotesFromOffline(n),hlights.addHlightsFromOffline(t),freehand.addSketchesFromOffline(e),i&&i()})})})})},1e3)},o.updateNotebookArray=function(c,l){c=c||{};var d=new Array;stg.getBookmarks(function(s){for(var e=0;e<s.length;e++){var t=s[e];t.chapter=chapters.getUnanchoredIndex(t.chapter),null!=t.chapter?(d[t.chapter]||(d[t.chapter]=new Array),d[t.chapter].push(t)):s.splice(e--,1)}stg.getNotes(function(a){for(var e=0;e<a.length;e++){var t=a[e];t.chapter=chapters.getUnanchoredIndex(t.chapter),null!=t.chapter?(d[t.chapter]||(d[t.chapter]=new Array),t.noteTrusted="",t.note&&(t.noteTrusted=$sce.trustAsHtml(t.note.replace(new RegExp("\r?\n","g"),"<br />"))),d[t.chapter].push(t)):a.splice(e--,1)}stg.getHlights(function(e){for(var t=0;t<e.length;t++){(n=e[t]).chapter=chapters.getUnanchoredIndex(n.chapter),null!=n.chapter?(d[n.chapter]||(d[n.chapter]=new Array),d[n.chapter].push(n)):e.splice(t--,1)}for(var n in d)d[n].title=book.getTitleByIndex(n);for(var o,t=0;t<d.length;t++)if(d[t])for(var i=0;i<d[t].length;i++){d[t][i].location&&(o=String(d[t][i].location).split(","),o=String(o[0]).split("-"),d[t][i].locationDec=Number("0."+addDigitsToArray(o[0].split("."),3).join("")))}for(t=0;t<d.length;t++)d[t]&&(d[t]=d[t].sort(function(e,t){return e.locationDec>t.locationDec?1:-1}));var r={};backend.cloudParam("sync")&&u&&(s.length<u.bookmarks.total&&(r.moreExist=!0),a.length<u.notes.total&&(r.moreExist=!0),e.length<u.hlights.total&&(r.moreExist=!0),p=!r.moreExist),r.results=d,r.showDelete=c.showDelete,Vue.set(stg.data,"notebookContent",r),l&&l()})})})},o.getMatchingElements=function(o,e){var t=traverser.getElemsByLocation(o.location,e),n=y(t);if(t&&1==t.length){var i=t[0].type;if("textarea"==i||"text"==i||"radio"==i||"checkbox"==i)return t}if(.88<=stringSimilarity(r(n),r(o.src)))return t;function r(e){return e?e.toLowerCase().trim().replace(/\s+?/g,""):e}if(o.locations&&o.locations.length)for(var a=0;a<o.locations.length;a++)if(stg.data.book.version==o.locations[a].version&&o.location!=o.locations[a].location){var s=traverser.getElemsByLocation(o.locations[a].location,e);if(.88<=stringSimilarity(r(n=y(s)),r(o.src)))return b(s,o.locations[a].version)}var c=cache.getOb("epubContent"),c=cache.getOb("epubContent"),l=cache.getOb("epubContent");for(t.length&&(l=t[0].parentNode);l&&l!=c&&!(0<=r(l.textContent).indexOf(r(o.src)));)l=l.parentNode;for(var d=o.src.split(" "),a=d.length;a--;)r(d[a])||d.splice(a,1);for(var u=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,k,!1);g=u.nextNode();)if(u.currentNode=g,-1!=r(u.currentNode.textContent).indexOf(r(d[0]))){for(var p=1,h=[u.currentNode];m=u.nextNode();){if(v=r(m.textContent)){if(-1==v.indexOf(r(d[p])))break;if(h.push(m),++p>=d.length)break}}if(p>=d.length)return b(h,null)}for(var g,u=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,k,!1);g=u.nextNode();){var f=r(o.src);if(u.currentNode=g,-1!=f.indexOf(r(u.currentNode.textContent))){f=f.replace(r(u.currentNode.textContent),"");for(var m,v,h=[u.currentNode];m=u.nextNode();){if(v=r(m.textContent)){if(-1==f.indexOf(v))break;if(f=f.replace(v,""),h.push(m),f.length<=0)break}}if(f.length<=0)return b(h,null)}}function b(e,t){if(!config.kotobee.sync)return e;var n={};return n.bid=stg.data.book.id,n.cloudid=config.kotobee.cloudid,n.nid=o.nid,n.hid=o.hid,n.location=t,n.location||(n.location=traverser.convertElemsToLocation(e).leftRange),backend.updateAnnotation(n),e}return[]},o}),createService("auth",function(){var i={};function o(){config.kotobee.rememberme&&(stg.data.user.rememberMe=!0);var n,e=getQueryStringValue("code");if((e&&(stg.data.user.code=e.replace(/[#\/]/g,"")),config.kotobee.registrationsettings||(config.kotobee.registrationsettings={}),config.src="library"==config.kotobee.mode?"library":"book",config.kotobee&&(config.kotobee.js||config.kotobee.css))&&!document.getElementsByClassName("kotobeeInjectedScript").length){document.getElementsByTagName("head");if(config.kotobee.js)for(var t=0;t<config.kotobee.js.length;t++){var o=document.createElement("script");o.src=cacheBust(config.kotobee.js[t]),o.className="kotobeeInjectedScript",document.body.appendChild(o)}if(config.kotobee.css)for(t=0;t<config.kotobee.css.length;t++){var i=document.createElement("link");i.rel="stylesheet",i.href=cacheBust(config.kotobee.css[t]),i.className="kotobeeInjectedScript",document.body.appendChild(i)}}config.kotobee&&config.kotobee.sso&&(config.kotobee.sso.length?Array.isArray(config.kotobee.sso)&&(n={},config.kotobee.sso.forEach(function(e){var t;e.enabled&&(delete(t=Object.assign({},e)).provider,t.params.clientsecret&&delete t.params.clientsecret,t.params.pkce&&delete t.params.pkce,t.params.version&&delete t.params.version,n[e.provider]=t)}),Object.keys(n).length?config.kotobee.sso=n:delete config.kotobee.sso):delete config.kotobee.sso),(desktop||native)&&config&&config.kotobee&&config.kotobee.payment&&delete config.kotobee.payment,config.kotobee&&config.kotobee.payment&&"book"==config.kotobee.mode&&config.kotobee.pricing&&config.kotobee.pricing.purchasable&&(config.kotobee.landing=!0)}return i.authenticate=function(){var e=$q.defer();return putTest("inside"),i.getPermissions(function(e){view.generate();try{if("book"==config.kotobee.mode&&isKotobeeHosted()&&(bookPath=config.kotobee.public?publicRoot+"epub/":"/books/"+publicRoot.split("/books/")[1].split("/")[0]+"/EPUB/epub/"),"kotobee"==config.kotobee.hostType&&(bookPath=config.kotobee.public?stg.data.paths.private+"books/"+config.kotobee.hostPath+"/EPUB/epub/":config.kotobee.liburl+"books/"+config.kotobee.hostPath+"/EPUB/epub/"),(native||desktop)&&e&&backend.cloudParam("offline")&&"offline"==e.error)return void i.startup({tab:"downloads"})}catch(e){}login.start()}),e.promise},i.getPermissions=function(n){"library"==config.kotobee.mode?backend.getUnauthLibrary(function(e){if("offline"!=(e=e||{}).error){if(e.cloud)for(var t in e.cloud)config.kotobee[t]=config.kotobee[t]&&Array.isArray(config.kotobee[t])?config.kotobee[t].concat(e.cloud[t]):e.cloud[t];config.kotobee.permsLoaded=!0,config.kotobee.offline=e.offline,config.kotobee.offlinedelete=e.offlinedelete,config.kotobee.js=e.js,config.kotobee.css=e.css,stg.data.currentLibrary.iskotobee&&(config.kotobee.entry=!0,config.kotobee.allowlogin=!0),o(),n()}else n(e)}):"book"==config.kotobee.mode?config.kotobee.cloudid?backend.getPermissions(function(e){for(var t in e)"sso"==t&&config.testSSO&&config.kotobee.sso&&config.kotobee.sso.length||(config.kotobee[t]=e[t]);config.kotobee.permsLoaded=!0,o(),n()}):(config.kotobee.public=!0,o(),n()):$injector.get("app").getPermissions(n)},i.startup=function(e){var t,n;if(e=e||{},!native||{}.watermarkPlaceholder&&(t='<div id="watermark"><span>'+translit.get("createdUsing")+'</span><a href="#" class="inlineBlock" style="vertical-align: sub" onclick="nav.openInBrowser(\'https://www.kotobee.com\');return false;"><img width="163" src="'+rootDir+'img/ui/authorLogo.png"></a></div>',(n=document.createElement("div")).innerHTML=t,document.body.insertBefore(n,document.getElementById("html5Fallback")),setTimeout(function(){addClass(document.getElementById("watermark"),"show")},4e3)),0,"library"==config.kotobee.mode){i.authenticated=!0;var o="";e.tab&&(o="/tab/"+e.tab);try{$location.path("/library"+o)}catch(e){}kMiniapps.initialize({mode:"library"}),design.applyRichTextLibrary(),$ionicHistory.clearHistory()}else"book"==config.kotobee.mode?book.loadBook().then(function(){design.applyRichTextLibrary(),i.authenticated=!0,$location.path("/reader"),$ionicHistory.clearHistory(),kMiniapps.initialize(),sync.initialize(),setTimeout(function(){chapters.initialize(),kotobee.dispatchEvent("bookOpened",stg.data.book)},1e3)}):"app"==config.kotobee.mode&&(i.authenticated=!0,setTimeout(function(){$location.path("/app")},0),$ionicHistory.clearHistory());kotobee&&kotobee.dispatchEvent("ready")},i.redeemCode=function(e,t){var n=clone(e),o={model:{},submit:function(){modals.hide(),n.code=o.model.code,n.code&&(kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),backend.redeemCode(n,function(e){e&&!e.error?(kStatus.update(),t()):kStatus.showAndHide(translit.get(e?e.error:"unexpectedError"),3e3)}))}};modals.show({mode:"redeemCodePanel",redeemCodeInfo:o})},i}),createService("autohide",function(){var r,a,i,s,o,c,l,d,e={};function u(){var e,t,n,o={};return document.getElementById("libraryThumbs")&&0<=window.location.href.indexOf("#/library")?(o.mode="library",o.header=document.getElementById("libraryHeader"),o.scope=document.getElementById("library").__vue__,o.libTabs=document.getElementById("libraryTabs"),o.libTabs&&(o.libTabHeight=o.libTabs.offsetHeight)):(o.mode="reader",o.header=document.getElementById("readerHeader"),o.header&&(o.scope=document.getElementById("chapters").__vue__),o.tabMenu=document.getElementById("tabMenu"),o.tabMenu&&(o.tabMenuHeight=o.tabMenu.offsetHeight),(e=document.body.getElementsByClassName("navControls")).length&&((t=(e=e[e.length-1]).getElementsByClassName("next")).length&&(o.navNext=t[0]),(n=e.getElementsByClassName("prev")).length&&(o.navPrev=n[0]),o.navWidth=o.navNext.offsetWidth)),o.headerHeight=o.header?o.header.offsetHeight:0,o}function t(o){c=null;o.target.parentNode.nodeName.toLowerCase();var e=u();if("reader"==e.mode)"neverShow"==config.autohideReaderMode&&l&&(new Date).getTime()-d<800&&Math.abs(h(o).x-l.x)<50&&function(e,t){var n=h(o).y;if(Math.abs(n-l.y)<15)return;n<l.y?l.y>.85*document.body.clientHeight&&m(e):n>.85*document.body.clientHeight&&m(t);n>l.y?l.y<.15*document.body.clientHeight&&m(e):n<.15*document.body.clientHeight&&m(t)}("tab","hidden");else if("library"==e.mode)if("showOnScroll"==config.autohideLibMode){var t=document.getElementsByClassName("bookThumbsContainer")[0],n=document.getElementById("libraryThumbs"),i=(i=Number(getElemPadding(n).top))||0;t.offsetHeight<n.offsetHeight-i&&m("buttons")}else if("showOnTap"!=config.autohideLibMode&&"hideOnTap"!=config.autohideLibMode&&"neverShow"==config.autohideLibMode&&l){if((new Date).getTime()-d<800&&Math.abs(h(o).x-l.x)<50&&l.y<100&&h(o).y>l.y)return m("header");m("hidden")}l=null}function n(e){if(e.target){if(function(e){var t=e.nodeName.toLowerCase();if("a"==t)return!0;if("video"==t)return!0;if("audio"==t)return!0;if(hasClass(e,"kInteractive"))return!0;if(hasParent(e,"kInteractive"))return!0}(e.target))return;var t=e.target.nodeName.toLowerCase();if("span"==t)return;if("button"==t)return;if("a"==t)return;if("input"==t)return;if("textarea"==t)return;if("label"==t)return;if(hasParentNode(e.target,"button"))return;if(hasParentNode(e.target,"a"))return;if(hasParentNode(e.target,"input"))return}var n=u();if("reader"==n.mode){if(!hasParentWithId(e.target,"epubContainer",99))return;if("alwaysShow"==config.autohideReaderMode)return;if("neverShow"==config.autohideReaderMode)return}if("library"==n.mode){if(!hasParentWithId(e.target,"libraryThumbs",99))return;if("alwaysShow"==config.autohideLibMode)return;if("neverShow"==config.autohideLibMode)return;if("showOnTap"==config.autohideLibMode||"hideOnTap"==config.autohideLibMode){var o=e.target,i=o.parentNode.nodeName.toLowerCase();if("a"==i||"button"==i)return;if(o.classList.contains("thumbImg"))return}}a=!0,selection.active()?selection.reset():"hidden"==r?m("buttons"):"buttons"==r?m("hidden"):"midway"==r&&m("buttons")}function p(e){l=h(e),d=(new Date).getTime()}function h(e){return e.changedTouches&&e.changedTouches.length?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:e.touches&&e.touches.length?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}}function g(e){var t=(e=e||{}).dims;if(f((t=t||u()).header,i,t.headerHeight,"up",!!ios),"reader"==t.mode){if(e.headerOnly)return;if(e.tabOnly)return void n();f(t.navNext,i*t.navWidth/t.headerHeight,t.navWidth,book.isRtl()?"left":"right"),f(t.navPrev,i*t.navWidth/t.headerHeight,t.navWidth,book.isRtl()?"right":"left"),n()}else if("library"==t.mode){if(!t.libTabs)return void(e.dims=u());if(f(t.libTabs,i,t.libTabHeight,"up"),e.headerOnly)return}function n(){f(t.tabMenu,i*t.tabMenuHeight/t.headerHeight,t.tabMenuHeight,"down",!!ios)}}function f(o,i,e,r,a){var s=1-(i=Math.min(e,i))/44;window.requestAnimationFrame(function(){var e;if(o&&("up"==r?e="translate3d(0, -"+i+"px, 0)":"down"==r?e="translate3d(0, "+i+"px, 0)":"right"==r?e="translate3d("+i+"px, 0, 0)":"left"==r&&(e="translate3d(-"+i+"px, 0, 0)"),autoprefixTransform(o,e),a))for(var t=0,n=o.children.length;t<n;t++)o.children[t].style.opacity=s})}function m(e){if(r!=e){var t=u();if("buttons"==e)s=i=0,g();else if("header"==e)g({headerOnly:!(s=i=0)});else if("tab"==e)g({tabOnly:!(s=i=0)});else if("hidden"==e){s=i=t.headerHeight;var n="translate3d(100%, 0, 0)",o="translate3d(-100%, 0, 0)";if(t.tabMenu&&autoprefixTransform(t.tabMenu,"translate3d(0, 100%, 0)"),t.header&&autoprefixTransform(t.header,"translate3d(0, -100%, 0)"),t.libTabs&&autoprefixTransform(t.libTabs,"translate3d(0, -44px, 0)"),t.navPrev&&autoprefixTransform(t.navPrev,book.isRtl()?n:o),t.navNext&&autoprefixTransform(t.navNext,book.isRtl()?o:n),"reader"==t.mode&&!(t.header&&t.tabMenu&&t.navPrev&&t.navNext))return;if("library"==t.mode&&!t.libTabs)return}r=e}}return e.initialize=function(){mobile&&(document.body.addEventListener(mobile&&!mobileDebug?"touchend":"mouseup",t),document.body.addEventListener(mobile&&!mobileDebug?"touchstart":"mousedown",p),document.body.addEventListener("click",n),config.autohideHeader&&!config.autohideReaderMode&&(config.autohideReaderMode="showOnScroll"),config.autohideHeader||(config.autohideReaderMode="alwaysShow"),config.autohideLibHeader&&!config.autohideLibMode&&(config.autohideLibMode="showOnScroll"),config.autohideLibHeader||(config.autohideLibMode="alwaysShow"))},e.setup=function(e,t){if(r="buttons","reader"==t){if("alwaysShow"==config.autohideReaderMode)return;if("neverShow"==config.autohideReaderMode)return m("hidden"),e.$watch("header.mode",function(e,t){e!=t&&m("selection"==e||"searchItems"==e||"textSize"==e?"header":"hidden")}),void(e.autohideEase=!0);var n,o;vueApp.$watch("data.settings.textSize",function(e,t){if(!n){if(n=!0,"showOnTap"==config.autohideReaderMode)return;if("hideOnTap"==config.autohideReaderMode)return}m("buttons")}),e.$watch("header.mode",function(e,t){!o&&(o=!0,"showOnTap"==config.autohideReaderMode)||m("buttons")}),"showOnTap"==config.autohideReaderMode&&m("hidden")}if("library"==t){if("alwaysShow"==config.autohideLibMode)return;if("neverShow"==config.autohideLibMode)return void m("hidden");"showOnTap"==config.autohideLibMode&&m("hidden"),e.$watch("subMode",function(e,t){m("buttons")}),e.$watch("searchOb.enabled",function(e,t){m("buttons")})}e.autohideEase=!0},e.hideBtns=function(){m("hidden")},e.showBtns=function(){m("buttons")},e.scrolled=function(e){var t=40;if(l){var n=c=c||u();if("reader"==n.mode){if("alwaysShow"==config.autohideReaderMode)return;if("showOnTap"==config.autohideReaderMode)return;if("hideOnTap"==config.autohideReaderMode)return;if("neverShow"==config.autohideReaderMode)return}if("library"==n.mode){if("alwaysShow"==config.autohideLibMode)return;if("showOnTap"==config.autohideLibMode)return;if("hideOnTap"==config.autohideLibMode)return;if("neverShow"==config.autohideLibMode)return;t=5}if(o=o||Math.max(t,e.target.scrollTop),a)return a=!1,o=Math.max(t,e.target.scrollTop),void("hidden"==r&&(o-=n.headerHeight,s=n.headerHeight));if("reader"==n.mode){if(!n.scope.header)return;if("default"!=n.scope.header.mode)return;if($injector.get("nav").transforming)return}else if("library"==n.mode){if(n.scope.subMode)return;if(n.scope.searchOb.enabled)return}if(i=n.headerHeight-(n.headerHeight-(e.target.scrollTop-o)),r=i>=n.headerHeight?(o=e.target.scrollTop-n.headerHeight,i=n.headerHeight,"hidden"):i<0?(o=Math.max(t,e.target.scrollTop),i=0,"buttons"):"midway",null==s&&(s=0),s==n.headerHeight){if(i==n.headerHeight)return;if(14<i)return;o=Math.max(t,e.target.scrollTop),i=0}i+s!=0&&(s=i,g({dims:n}))}},e}),createService("backend",function(){var l,d,p={},n=[],u={headers:{"Content-Type":void 0}};function h(){try{if("undefined"!=typeof lti&&lti&&email&&hash){stg.data.user.email=email,stg.data.user.pwd=hash,stg.data.user.rememberMe=!0;var e=document.getElementsByTagName("head")[0];if(e.length){e[0];for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)if(t[n].hasAttribute("lti")){t[n].parentNode.removeChild(t[n]);break}}}}catch(e){}}p.getAuthVarsOld=function(){return{libid:config.kotobee.libid,email:stg.data.user.email,pwd:stg.data.user.pwd}},p.getAuthVars=function(){var e={env:config.kotobee.mode};return stg.data.user&&(stg.data.user.email&&stg.data.user.pwd?Object.assign(e,{email:stg.data.user.email,pwd:stg.data.user.pwd,env:config.kotobee.mode}):stg.data.user.code&&Object.assign(e,{code:stg.data.user.code,env:config.kotobee.mode})),h(),e.cloudid=config.kotobee.cloudid,"library"==e.env&&stg.data.book&&(e.bid=stg.data.book.id),uuid&&(e.fingerprint=uuid),e},p.addListener=function(e,t){n.push({event:e,func:t})},p.initialize=function(){putTest("X");var t=$q.defer();return putTest("Y"),putTest("Z"),putTest("J"),kError.detect("s_authError",p.loginErrorDetection),putTest("K"),stg.readSlot("user"+config.kotobee.cloudid,function(e){config.kotobee.cloudid&&e&&Vue.set(stg.data,"user",e),stg.data.user||Vue.set(stg.data,"user",{}),0==stg.data.user.length&&Vue.set(stg.data,"user",{}),Vue.set(stg.data.user,"loggedIn",!1),putTest("L"),preview?t.resolve():p.getFingerprint(function(e){uuid=e,t.resolve()})}),t.promise},p.getFingerprint=function(r){function a(){var e={excludeUserAgent:!0,excludeScreenResolution:!0,excludeDoNotTrack:!0,excludeAvailableScreenResolution:!0,excludeOpenDatabase:!0,excludePlugins:!0,excludeCanvas:!0,excludeWebGL:!0,excludeJsFonts:!0,excludeCanvas:!1,excludeWebGL:!1};new Fingerprint2(e).get(function(e,t){try{e=e||process.env.USERNAME,stg.writeSlot("fingerprint",e,function(){r(e)})}catch(e){}})}native&&window.plugins&&window.plugins.uniqueDeviceID?window.plugins.uniqueDeviceID.get(function(e){e&&e.length?r(e):a()},a):!desktop||"mac"==os?a():require("child_process").exec("wmic CPU get ProcessorId",{cwd:"."},function(e,t,n){var o,i;t&&(o=t.toUpperCase().split("PROCESSORID")).length&&(i=o[1].trim()).length?r(i):a()})};var g=null,t=null;p.setLibraryLoginCallback=function(e){g=e},p.setLibraryLogoutCallback=function(e){t=e},p.loginErrorDetection=function(t){stg.data.user.loggedIn=!1,t&&("email"==config.kotobee.loginmode||config.kotobee.promocodesdisabled?t.loginOptions.canLoginByEmail=!0:"code"==config.kotobee.loginmode?t.loginOptions.canLoginByCode=!0:t.loginOptions.canLoginByEmail=t.loginOptions.canLoginByCode=!0,t.loginOptions.mode=t.loginOptions.canLoginByEmail?"email":"code",t.model||(t.model={}),t.loginOptions.signIn=function(){modals.hide(),setTimeout(function(){if("code"==t.loginOptions.mode){if(!t.model||!t.model.code)return void kError.update({error:"enterYourCode"});stg.data.user.code=t.model.code,stg.data.user.email=stg.data.user.pwd=null}else{if(!stg.data.user.email)return void kError.update({error:"enterYourEmail"});if(!t.model||!t.model.pwd)return void kError.update({error:"enterYourPwd"});stg.data.user.pwd=t.model.pwd,stg.data.user.code=null}function e(){p.login({userInput:!0}).then(function(e){e.error||t.model&&(t.model.pwd=t.model.code=null)})}config.kotobee.permsLoaded?e():$injector.get("auth").getPermissions(e)},800)},t.loginOptions.register=function(){modals.hide(),$location.path("/register")},t.loginOptions.forgotPassword=function(){modals.hide(),$location.path("/forgotpwd")},t.loginOptions.redeemCode=function(){t.loginOptions.mode="code",Vue.nextTick(function(){try{document.getElementsByClassName("codeInputTxt")[0].focus()}catch(e){}})},t.loginOptions.signInByEmail=function(){t.loginOptions.mode="email",Vue.nextTick(function(){try{document.getElementsByClassName("emailInputTxt")[0].focus()}catch(e){}})})};var f=null;p.refreshSignatures=function(t){var e=config.kotobee.liburl+"user/signatures";$http.post(e,getFormData(p.getAuthVars()),u).success(function(e){e.error||(stg.data.user.signatures=e.signatures,t&&t())})};var m={ping:!0};function v(e){if((stg.data.currentLibrary=e)&&e.categories){for(var t=[],n=0;n<e.categories.length;n++)t.push(e.categories[n]);for(n=0;n<e.categories.length;n++)for(var o=e.categories[n],i=0;i<t.length;i++)t[i].parent&&t[i].parent.id==o.id&&(o.children||(o.children=[]),o.children.push(t[i]),t[i].nested=!0);for(n=0;n<e.categories.length;n++)e.categories[n].nested&&(e.categories.splice(n,1),n--);Vue.set(stg.data.currentLibrary,"sectionsMode",null);for(n=0;n<e.categories.length;n++)if(e.categories[n].section){Vue.set(stg.data.currentLibrary,"sectionsMode",!0);break}}}function o(){kotobee.popup(translit.get("unexpectedError"),{okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})}function i(e){var t=getFormData(p.getAuthVars());t.append("software",isReaderApp?"readerapp":"reader"),t.append("platform",navigator.userAgent),t.append("assetType",config.kotobee.mode);try{t.append("assetName","book"==config.kotobee.mode?stg.data.book.meta.dc.title:stg.data.currentLibrary.name)}catch(e){}var n=window.location.href;return t.append("assetPath",n.split("#")[0]),config.kotobee.cloudid&&t.append("assetId",config.kotobee.cloudid),"library"==config.kotobee.mode&&(stg.data.book&&null!=stg.data.book.id?t.append("bid",stg.data.book.id):e.bid&&t.append("bid",e.bid)),stg.data.user.email&&t.append("email",stg.data.user.email),stg.data.user.code&&t.append("code",stg.data.user.code),e.action&&t.append("action",e.action),e.param&&t.append("param",e.param),stg.data.book&&stg.data.book.chapter&&stg.data.book.chapter.title&&t.append("chapter",stg.data.book.chapter.title),t}return p.login=function(o,t){o=o||{};var i={func:arguments.callee,args:arguments};document.body.focus=null;var r,e,a=$q.defer();o.ping||(r=modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),timeLimit:1e4}),Vue.set(stg.data.user,"loggedIn",!1)),t&&(f=t),"book"==config.kotobee.mode&&(e=config.kotobee.liburl+"library/auth"),"library"==config.kotobee.mode&&(e=config.kotobee.liburl+"library/get"),h(),preview||(p.fingerprint=uuid);var n=p.getAuthVars(),s={},c=Boolean(o.accessToken||o.idToken);return stg.data.sso&&stg.data.sso.oauth?(s.ssoprovider=stg.data.sso.oauth.provider,s.ssoaccesstoken=stg.data.sso.oauth.accessToken,s.ssoidtoken=stg.data.sso.oauth.idToken,c=Boolean(s.ssoaccesstoken||s.ssoidtoken)):o.ssoProvider&&c&&(s.ssoprovider=o.ssoProvider,s.ssoaccesstoken=o.accessToken,s.ssoidtoken=o.idToken),Object.keys(s).length&&(n=Object.assign(n,s)),o.userInput&&(n.input=!0),n.platformdesc=navigator.userAgent,native?(n.platform="mobile",device&&(n.platformdesc=device.platform+" "+device.model+" "+device.version+" "+(device.manufacturer?device.manufacturer:""))):n.platform=desktop?"desktop":"web",n.v=readerV,o.ping&&(n.ping=!0,n.pwd=o.pwd),n.v=config.v,n.lang=stg.data.settings.language,c&&Vue.set(stg.data.user,"rememberMe",!0),$http.post(e,getFormData(n),u).success(function(n){if(clearTimeout(void 0),r&&modals.hide(r),n.error)return n.cloud&&n.cloud.public&&(d=!0),o.dontShowErrorDialog||kError.update({error:n.error,ref:i}),Vue.set(stg.data.user,"pwd",null),Vue.set(stg.data.user,"code",null),stg.writeSlot("user"+config.kotobee.cloudid,{}),o.ping&&p.logout({dontSignoutSSO:!0}),void a.resolve(n);if(n.cloud&&n.cloud.public&&!n.email)return p.logout(),a.resolve(),t?t():null;var e=3e5;void 0===e&&(e=3e5),l&&clearTimeout(l),l=setTimeout(function(){n.pwd&&(m.pwd=n.pwd),p.login(m)},e),o.ping||(c&&n.email&&Vue.set(stg.data.user,"email",n.email),Vue.set(stg.data.user,"pwd",n.pwd),Vue.set(stg.data.user,"id",n.userid),Vue.set(stg.data.user,"name",n.username),Vue.set(stg.data.user,"lastchap",n.lastchap),Vue.set(stg.data.user,"perms",n.perms),Vue.set(stg.data.user,"signatures",n.signatures),Vue.set(stg.data.user,"role",n.role),p.getS3PathsIf(!stg.data.paths,function(){var e;function t(){if(!n.cloudid&&!n.success)return o.dontShowErrorDialog||kError.update({error:"s_authError"}),void a.resolve({error:"s_authError"});Vue.set(stg.data.user,"loggedIn",!0),"library"==config.kotobee.mode&&(v(n),function(e){if(!e)return;if(!stg.data.user)return;if(!config.kotobee.offline)return;if(!config.kotobee.offlinedelete)return;if(!stg.data.downloaded.length)return;for(var t="",n=0;n<stg.data.downloaded.length;n++)t+=(t?",":"")+stg.data.downloaded[n].id;p.hasAccessTo({testagainst:t},function(e){if(Array.isArray(e)||(e=[e]),e.length!=stg.data.downloaded.length){for(var t=[],n=0;n<stg.data.downloaded.length;n++){for(var o=stg.data.downloaded[n],i=!1,r=0;r<e.length;r++)if(o.id==e[r].bid){i=!0;break}i||t.push(o)}var a=-1;!function e(){if(++a>=t.length)return;native?crdv.deleteEbook(t[a],e):desktop&&$injector.get("np").deleteEbook(t[a],e)}()}})}(n),g&&g()),a.resolve(n),f&&(f(n),f=null)}"book"==config.kotobee.mode&&n.chapters&&$injector.get("book").setAllowedChapters(n.chapters),stg.data.user.rememberMe?(e={rememberMe:!0},stg.data.user.email&&stg.data.user.pwd?(e.email=stg.data.user.email,e.pwd=stg.data.user.pwd):stg.data.user.code&&(e.code=stg.data.user.code),stg.writeSlot("user"+config.kotobee.cloudid,e,t)):stg.clearSlot("user"+config.kotobee.cloudid,t)}))}).error(function(e){clearTimeout(void 0),modals.hide(),kError.update({error:e||"networkError",ref:i})}),a.promise},p.libraryHasPublicBooks=function(){return d},p.logout=function(e){(e=e||{}).dontSignoutSSO||$injector.get("login").logout(),Vue.set(stg.data.user,"pwd",null),Vue.set(stg.data.user,"loggedIn",!1),Vue.set(stg.data.user,"email",null),Vue.set(stg.data.user,"code",null),stg.data.sso&&stg.data.sso.oauth&&delete stg.data.sso.oauth,kInteractive.questions.f.clearSavedAnswers(),stg.writeSlot("user"+config.kotobee.cloudid,stg.data.user,function(){"library"==config.kotobee.mode?$timeout(function(){if(kError.update({error:"s_authError"}),p.cloudParam("entry")){stg.data.currentLibrary.books||(stg.data.currentLibrary.books=[]);for(var e=0;e<stg.data.currentLibrary.books.length;e++)stg.data.currentLibrary.books[e].favorite=!1;$injector.get("library").applyExistingBooks()}else stg.data.currentLibrary={};t&&t()},200):$injector.get("login").toLoginScreen()})},p.getPermissions=function(n){var t={func:arguments.callee,args:arguments},e={};return e.env=config.kotobee.mode,e.cloudid=config.kotobee.cloudid,$http.post(config.kotobee.liburl+"library/permissions",getFormData(e),u).success(function(e){var t;e.error?(kError.update({error:"errorAndCallback",msg:e.error,cb:crdv.exit}),(t=document.getElementsByClassName("loaded")).length&&t[0].parentNode.removeChild(t[0])):n&&n(e)}).error(function(e){(native||desktop)&&p.cloudParam("offline")?n&&n({error:"offline"}):kError.update({error:e||"networkError",ref:t})})},p.register=function(e,t){var n,o={func:arguments.callee,args:arguments},i=modals.show({mode:"loading",loadingMsg:translit.get("registeringAccount")}),r=p.getAuthVars();r.email=e.email1,r.promocode=e.promocode,r.name=e.name,e.dob&&(n=new Date(e.dob),r.dob=n.getDate()+"-"+n.getMonth()+"-"+n.getFullYear()),r.organization=e.organization,r.dept=e.dept,r.univ=e.univ,r.faculty=e.faculty,r.class=e.class,r.division=e.division,r.customid=e.customid,r.gender=e.gender,r.country=e.country,r.city=e.city,r.phone=e.phone,r.info=e.info,r.root=config.kotobee.liburl,r.lang=stg.data.settings.language;var a=getFormData(r);return a.append("platform",navigator.userAgent),$http.post(config.kotobee.liburl+"user/register",a,u).success(function(e){return modals.hide(i),e.error?(kError.update(e),t?t():null):void(t&&t(e))}).error(function(e){kError.update({error:e||"networkError",ref:o})})},p.forgotPwd=function(e,t){var n={func:arguments.callee,args:arguments},o=modals.show({mode:"loading",loadingMsg:translit.get("retrieving")}),i=p.getAuthVars();i.email=e.email,i.root=config.kotobee.liburl;var r=getFormData(i);return $http.post(config.kotobee.liburl+"user/forgotpwd",r,u).success(function(e){modals.hide(o),e.error?kError.update(e):t&&t(e)}).error(function(e){kError.update({error:e||"networkError",ref:n})})},p.redeemCode=function(e,t){var n={func:arguments.callee,args:arguments},o=getFormData(p.getAuthVars());o.append("redeemcode",e.code),o.append("platform",navigator.userAgent),$http.post(config.kotobee.liburl+"user/redeemcode",o,u).success(function(e){t(e)}).error(function(e){kError.update({error:e||"networkError",ref:n})})},p.getNotebook=function(e,t){var n=getFormData(p.getAuthVars());null!=e.chapter&&n.append("chapter",e.chapter),null!=e.chaptername&&n.append("chaptername",e.chaptername),null!=e.file&&n.append("file",e.file),n.append("ver",e.ver),$http.post(config.kotobee.liburl+"library/notebook/all",n,u).success(function(e){e.error&&kError.update(e),t&&t(e)}).error(function(e){Vue.set(stg.data,"syncing",!1),t&&t()})},p.downloadBinaryFile=function(e,t,n,o){n=n||{};var i={responseType:"arraybuffer",method:"GET",showProgress:!1};return i.onProgress=n.onProgress,p.sendRawPost(e,{serial:"."},i,function(n){desktop?np.writeArrayBuffer(n,t,{},function(){o&&o(!0)}):native&&crdv.resolvePath(ph.removeFilename(t),ph.basename(t),function(e,t){crdv.writeFile(n,t,{parentDir:e},function(){o&&o(!0)})})})},p.userLoggedIn=function(){if(stg.data.user.loggedIn)return!0;try{if("library"==config.kotobee.mode&&stg.data.book&&("public"==stg.data.book.accessmode||"all"==stg.data.book.accessmode))return!0}catch(e){}},p.downloadEbookTest=function(e,t){var n={id:e.id,mode:e.binary};return p.sendRawPost("http://192.168.1.5/files/test.zip",n,{responseType:"blob",onProgress:function(e){}},function(e){return e.error?(kError.update(e),void t()):void t(e)})},p.downloadEbook=function(e,t,n){try{var o={func:arguments.callee,args:arguments},i={responseType:"blob",onProgress:t};mobile&&native&&(i.responseType="arraybuffer");var r={id:e.id,mode:"binary",requester:"reader"};return p.sendRawPost(config.kotobee.liburl+"library/ebook/download",r,i,function(e){return e.error?(kError.update({error:e.error?e.error:"networkError",ref:o}),void n()):void n(e)})}catch(e){}},p.tincan=function(e,t){var n=getFormData(p.getAuthVars());for(var o in e)n.append(o,e[o]);$http.post(config.kotobee.liburl+"tincan",n,u).success(function(e){t&&t()}).error(function(e,t){})},p.getUnauthLibrary=function(t){var n,e;"library"==config.kotobee.mode&&(n={func:arguments.callee,args:arguments},e=getFormData(p.getAuthVars()),$http.post(config.kotobee.liburl+"library/getbasic",e,u).success(function(e){e.error&&(native||desktop)&&p.cloudParam("offline")?t&&t({error:"offline"}):(v(e),t&&t(e))}).error(function(e){(native||desktop)&&p.cloudParam("offline")?t&&t({error:"offline"}):kError.update({error:e||"networkError",ref:n})}))},p.addtoFav=function(e,t){var n={func:arguments.callee,args:arguments},o=getFormData(p.getAuthVars());o.append("bid",e.id),o.append("cloudid",p.cloudParam("cloudid")),o.append("type","book"),$http.post(config.kotobee.liburl+"library/favorite/add",o,u).success(function(e){return e.error?(kError.update(e),void t()):void t(e)}).error(function(e){kError.update({error:e||"networkError",ref:n})})},p.removeFav=function(e,t){var n={func:arguments.callee,args:arguments},o=getFormData(p.getAuthVars());o.append("bid",e.id),o.append("cloudid",p.cloudParam("cloudid")),o.append("type","book"),$http.post(config.kotobee.liburl+"library/favorite/remove",o,u).success(function(e){return e.error?(kError.update(e),void t()):void t(e)}).error(function(e){kError.update({error:e||"networkError",ref:n})})},p.updateAnnotation=function(e,t){var n=getFormData(p.getAuthVars());n.append("cloudid",e.cloudid),n.append("location",e.location),e.bid&&n.append("bid",e.bid),e.nid&&n.append("nid",e.nid),e.hid&&n.append("hid",e.hid),$http.post(config.kotobee.liburl+"library/notebook/update",n,u).success(function(e){t&&t(e)}).error(function(e){})},p.createOrder=function(e,t){var n=getFormData(p.getAuthVars());e.bid&&n.append("bid",e.bid),e.platform&&n.append("platform",e.platform),e.accountemail&&n.append("accountemail",e.accountemail),e.items&&n.append("items",e.items),$http.post(config.kotobee.liburl+"library/order/add",n,u).success(function(e){t&&(e.order&&e.order.id||o(),t(e))}).error(function(e){o()})},p.getOrder=function(e,t){var n=getFormData();n.append("orderid",e.orderid),n.append("uid",e.uid),n.append("valid",e.valid),$http.post(config.kotobee.liburl+"library/order/get",n,u).success(function(e){t&&t(e)}).error(function(e){})},p.checkBookUpdates=function(e,t){var n=getFormData(p.getAuthVars());n.append("bid",e.bid),null!=e.checksum&&n.append("checksum",e.checksum),null!=e.ver&&n.append("ver",e.ver),$http.post(config.kotobee.liburl+"library/ebook/checkupdates",n,u).success(function(e){e.error?t():t(e)}).error(function(e){})},p.getServerLang=function(e){if(!isKotobeeHosted()||config.loadLangsLocally)return khttp.get(cacheBust(rootDir+"locales/"+e.lang+".js"));var t=getFormData();return t.append("lang",e.lang),t.append("root",rootDir),t.append("v",readerV),t.append("base",publicRoot),khttp.post(config.kotobee.liburl+"library/getlang",t,u)},p.setLang=function(e,t){var n;preview||config.kotobee.cloudid&&((n=getFormData(p.getAuthVars())).append("lang",e.lang),$http.post(config.kotobee.liburl+"user/setlang",n,u).success(function(e){t&&t(e)}).error(function(e){t&&t({error:!0})}))},p.getS3PathsIf=function(e,t){if(e)return p.getS3Paths(t);t({})},p.getS3Paths=function(t){var e=getFormData();$http.post(config.kotobee.liburl+"library/s3paths",e,u).success(function(e){return e.error?kError.update(e):(stg.data.paths=e,function(e){for(var t=0;t<n.length;t++)n[t].event==e&&n[t].func()}("pathsChanged"),void(t&&t(e)))}).error(function(e){t&&t({error:!0})})},p.verifyCloudEmail=function(e,t){var n=getFormData(p.getAuthVars());n.append("cloudemail",e.cloudemail),e.pwd&&n.append("pwd",e.pwd),$http.post(config.kotobee.liburl+"user/verify",n,u).success(function(e){t&&t(e)}).error(function(){})},p.addBookStat=function(e,t){var n;e=e||{},preview||config.kotobee.cloudid&&(window.location.href,(n=getFormData(p.getAuthVars())).append("type",e.type),$http.post(config.kotobee.liburl+"library/ebook/stat",n,u).success(function(e){}).error(function(){}))},p.addEvent=function(e,t){var n,o;e=e||{},preview||config.disableEventTracking||(n=window.location.href,!debug&&(0<=n.indexOf("localhost/")||0<=n.indexOf("localhost:"))||(o=i(e),$http.post(config.kotobee.liburl+"event/add",o,u).success(function(e){t&&t(e)}).error(function(){})))},p.addStat=function(e,t){var n,o;e=e||{},preview||(0<=(n=window.location.href).indexOf("localhost/")||0<=n.indexOf("localhost:")||(o=i(e),$http.post(config.kotobee.liburl+"stat/add",o,u).success(function(e){t&&t(e)}).error(function(){})))},p.getUserProfile=function(e,t){var n={func:arguments.callee,args:arguments},o=getFormData(p.getAuthVars());$http.post(config.kotobee.liburl+"user/profile",o,u).success(function(e){return e.error?(kError.update(e),void t()):void t(e)}).error(function(e){kError.update({error:e||"networkError",ref:n})})},p.updateProfile=function(e,t){var n,o={func:arguments.callee,args:arguments},i=getFormData(p.getAuthVars());for(var r in delete e.cloudid,e.dob&&(n=new Date(e.dob),e.dob=n.getDate()+"-"+n.getMonth()+"-"+n.getFullYear()),e)i.append(r,e[r]);$http.post(config.kotobee.liburl+"user/update",i,u).success(function(e){return e.error?(kError.update(e),void t()):void t(e)}).error(function(e){kError.update({error:e||"networkError",ref:o})})},p.setUserData=function(e,t){var n=getFormData(p.getAuthVars());n.append("label",e.label),n.append("data",e.data),e.overwrite&&n.append("overwrite",e.overwrite),e.category&&n.append("category",e.category),e.subcategory&&n.append("subcategory",e.subcategory),e.options&&n.append("options",e.options),$http.post(config.kotobee.liburl+"cloud/set",n,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.getUserData=function(e,t){var n=getFormData(p.getAuthVars());e.label&&n.append("label",e.label),e.category&&n.append("category",e.category),e.subcategory&&n.append("subcategory",e.subcategory),e.allUsers&&n.append("allUsers",!0),e.options&&n.append("options",e.options),$http.post(config.kotobee.liburl+"cloud/get",n,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.getDataPerms=function(t){var e=getFormData(p.getAuthVars());$http.post(config.kotobee.liburl+"cloud/perms",e,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.getUserList=function(e,t){var n=getFormData(p.getAuthVars());e.role&&n.append("role",e.role),$http.post(config.kotobee.liburl+"cloud/users",n,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.getUserDataArray=function(e,t){var n=getFormData(p.getAuthVars());e.array&&n.append("array",e.array),$http.post(config.kotobee.liburl+"cloud/getarray",n,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.setUserDataArray=function(e,t){var n=getFormData(p.getAuthVars());e.array&&n.append("array",e.array),$http.post(config.kotobee.liburl+"cloud/setarray",n,u).success(function(e){t(e)}).error(function(){throw"Network Error. Please try again"})},p.deleteUserData=function(e,t){var n=getFormData(p.getAuthVars());n.append("label",e.label),n.append("data",e.data),e.all&&n.append("all",e.all),e.category&&n.append("category",e.category),e.subcategory&&n.append("subcategory",e.subcategory),e.options&&n.append("options",e.options),$http.post(config.kotobee.liburl+"cloud/delete",n,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.sendEmail=function(e,t){var n=getFormData(p.getAuthVars());n.append("to",e.to),n.append("message",e.message),n.append("subject",e.subject),e.cc&&n.append("cc",e.cc),e.html&&n.append("html",e.html),e.fromEmail&&n.append("fromEmail",e.fromEmail),e.fromName&&n.append("fromName",e.fromName),$http.post(config.kotobee.liburl+"cloud/send",n,u).success(function(e){if(e.error)throw e;t(e)}).error(function(){throw"Network Error. Please try again"})},p.getReviews=function(e,t){var n=getFormData(p.getAuthVars());e.uid&&n.append("uid",e.uid),e.bid&&n.append("bid",e.bid),e.max&&n.append("max",e.max),$http.post(config.kotobee.liburl+"library/review/all",n,u).success(function(e){t(e)}).error(function(){t()})},p.sendDeletionRequest=function(t){var e=getFormData(p.getAuthVars());$http.post(config.kotobee.liburl+"user/requestdelete",e,u).success(function(e){t(e)}).error(function(){t()})},p.addReview=function(e,t){var n=getFormData(p.getAuthVars());n.append("content",e.content),e.bid&&n.append("bid",e.bid),null!=e.rating&&n.append("rating",e.rating),e.name&&n.append("name",e.name),$http.post(config.kotobee.liburl+"library/review/add",n,u).success(function(e){t(e)}).error(function(){})},p.externalLink=function(n,e){try{if((e=e||{}).secure&&!native&&!desktop&&!preview)return void $window.open(n);function o(e,t){native?crdv.openInNativeBrowser(e,t):desktop?require("nw.gui").Shell.openExternal(e):window.open(e,"_blank")}if(e.target&&"_blank"==e.target.toLowerCase())return void o(n,!0);if(native)return void o(n);var i={title:translit.get("externalLink"),src:$sce.trustAsResourceUrl(n),openInNativeBrowser:o,status:"loading"},r=setTimeout(function(){i.status="",i.error=translit.get("errorLoadingPage"),$rootScope.$$phase||$rootScope.$apply()},1e4);i.loaded=function(e,t,n){i.status="loaded",clearTimeout(r),$rootScope.$$phase||$rootScope.$apply()};var a=modals.show({mode:"externalSite",animation:"slide-in-up",dynamic:!0,backdropClickToClose:!1,siteOptions:i});desktop||preview||p.getXframeOptions({url:n},function(e){var t;i.status="loaded",$rootScope.$$phase||$rootScope.$apply(),e&&e.success&&("sameorigin"!=(t=e.success.toLowerCase())&&"deny"!=t||(modals.hide(a),setTimeout(function(){modals.show({mode:"xFrameError",errorOptions:{url:n,openInNativeBrowser:o}})},500)))})}catch(e){}},p.createRequest=function(e,t,n){t=t||{};var o=getFormData(p.getAuthVars());for(var i in t)o.append(i,t[i]);$http.post(e,o,u).success(function(e){n(e)}).error(function(){n(!1)})},p.convertPDF=function(e,t){var n;e=e||{},preview||((n=getFormData(p.getAuthVars())).append("url",e.url),$http.post(config.kotobee.liburl+"library/pdf",n,u).success(function(e){t(e)}).error(function(){}))},p.validatePdfConversion=function(e,t){var n=getFormData(p.getAuthVars());for(var o in e)n.append(o,e[o]);$http.post(config.kotobee.liburl+"library/pdf/validate",n,u).success(function(e){t(e)}).error(function(e){})},p.getXframeOptions=function(e,t){var n=getFormData(p.getAuthVars());n.append("url",e.url),$http.post(config.kotobee.liburl+"getxframe",n,u).success(function(e){e.error?t():t(e)}).error(function(e){})},p.hasAccessTo=function(e,n){var t=getFormData(p.getAuthVars());for(var o in e=e||{})t.append(o,e[o]);t.append("v",readerV),$http.post(config.kotobee.liburl+"user/access",t,u).success(function(e){config.kotobee.payment,n&&n(e)}).error(function(e,t){n&&n({error:""})})},p.setLastChapter=function(n){var e=getFormData(p.getAuthVars());e.append("chapter",currentIndex),$http.post(config.kotobee.liburl+"user/lastchap",e,u).success(function(e){n&&n(e)}).error(function(e,t){n&&n({error:""})})},p.cloudParam=function(e){return config.kotobee[e]},p.getEbook=function(e,t){var n={func:arguments.callee,args:arguments},o=getFormData(p.getAuthVars());for(var i in e)o.append(i,e[i]);$http.post(config.kotobee.liburl+"library/ebook/get",o,u).success(function(e){e.error&&kError.update(e),e.pricing||(e.pricing=[]),config.kotobee.payment,t&&t(e)}).error(function(e){kError.update({error:e||"networkError",ref:n}),t&&t({error:e||"networkError"})})},p.getEbooks=function(e,t,n){var o={func:arguments.callee,args:arguments},i=(p.getAuthVars(),getFormData(p.getAuthVars()));for(var r in e)i.append(r,e[r]);i.append("v",readerV),i.append("includeauthor",1),i.append("includecategory",1),$http.post(config.kotobee.liburl+"library/ebook/all",i,u).success(function(e){e.error&&kError.update(e),config.kotobee.payment,n&&n(e,t)}).error(function(e){kError.update({error:e||"networkError",ref:o}),n&&n({error:e||"networkError"},t)})},p.sendRawPost=function(i,t,n,r,o){var a={func:arguments.callee,args:arguments};o=o||0;var e,s="",c={};if((t=t||{})&&t.forEach?t.forEach(function(e,t){c[t]=e}):Object.assign(c,t),n.ignoreCredentials||(e=p.getAuthVars(),c=Object.assign(e,c)),n.queryString)s=Object.entries(c).map(function(e){var t=e[1];return Array.isArray(t)?(t=serializeObject(t,e[0]),Object.entries(t).map(function(e){return e[0]+"="+encodeURIComponent(e[1])}).join("&")):e[0]+"="+encodeURIComponent(t)}).join("&"),i+=s?"?"+s:"";else if(n.requestType&&"json"==n.requestType.toLowerCase())s=JSON.stringify(c);else for(var l in c){var d=c[l];null!=d&&"object"!=typeof d&&("string"==typeof d&&(d=encodeURIComponent(d=("."+d).substr(1))),"boolean"==typeof d&&(d=d?1:0),s+="&"+l+"="+d)}var u=new XMLHttpRequest;return u.id=999*Math.random(),u.open(n.method?n.method:"POST",i,!0),"GET"!=n.method&&u.setRequestHeader("Content-type",n.requestType&&"json"==n.requestType.toLowerCase()?"application/json;charset=UTF-8":"application/x-www-form-urlencoded"),n.onProgress&&(u.onprogress=function(e){var t;if(e.lengthComputable)t=e.loaded/e.total;else{if(!e.target.getResponseHeader("x-decompressed-content-length"))return;t=e.loaded/Number(e.target.getResponseHeader("x-decompressed-content-length"))}n.onProgress(t)}),n.responseType&&(u.responseType=n.responseType),u.onreadystatechange=function(e){if(!u.aborted){var t=u.status;if(0==t&&("file:"==window.location.protocol&&(t=200),"chrome-extension:"==window.location.protocol&&(t=200),"kotobee:"==window.location.protocol&&(t=200)),4==u.readyState)if(200==t){var n=u.response,o=getUrlExt(i);if(!u.responseType||"json"==u.responseType||"js"==o||"json"==o)try{n=JSON.parse(n)}catch(e){}r&&(r(n),p.abort(u))}else u.onerror()}},u.addEventListener("error",function(e){u.aborted||(p.abort(u),r&&(a.args[4]=null,r({error:"networkError",ref:a})))},!1),u.onerror=function(e){return u.aborted?u:3<=o?(p.abort(u),void(r&&(a.args[4]=null,r({error:"networkError",ref:a})))):(p.abort(u),p.sendRawPost(i,t,n,r,++o))},n.queryString||"GET"==n.method?u.send():u.send(s),u},p.abort=function(e){e&&(e.aborted=!0,4!=e.readyState&&e.abort&&e.abort())},p}),createService("book",function(){var r,b={};function a(){for(var e in config)"kotobee"!=e&&delete config[e]}return b.root="",b.currentBook=null,b.initialize=function(){},b.getCoverImgPath=function(e,t){if(t=t||e.path,!e.cover)return"img/ui/defaultCover.png";var n="",n=stg.data.currentLibrary.cloud&&stg.data.currentLibrary.cloud.public?stg.getPublicRoot("book")+e.path+"/EPUB/"+e.cover:$filter("coverPath")(e.cover,t);return e.downloaded&&(native?n=crdv.libEbooksDirectory.nativeURL+t+"/EPUB/"+e.cover:desktop&&(n=ph.normalize(np.getBooksPath()+t+"/"+e.cover))),(desktop||native)&&(e.prepackage&&(n=ph.normalize("books/"+t+"/"+e.cover)),e.downloaded&&(n=n.replace("_thumb.","."))),n=cleanURL(n)},b.getBgImgPath=function(e,t){if(t=t||e.path,!e.cover)return"";var n=stg.getPublicRoot("book");return n+=e.path+"/"+e.bgimg},b.setAllowedChapters=function(e){if(b.allowedChapters=null,e&&e.length){for(var t=e.split(","),n=0;n<t.length;n++)t[n]=t[n];b.allowedChapters=t}},b.reload=function(){b.open(b.currentBook,{defaultIndex:currentIndex})},b.open=function(o,i){if(i=i||{},preview)return modals.hide(),void setTimeout(function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("cantPreviewLibBook")}})},500);var t="download";i.openRemotely?t="open":o.openmethod&&("open"==o.openmethod?t="open":0==o.openmethod.indexOf("download")&&(t="download")),bookPath=function(e,t){if((desktop||native)&&e.prepackage)return bookPath="books/"+e.path+"/";native&&"download"==t?(crdv.vibrate(),bookPath=cleanURL(crdv.libEbooksDirectory.nativeURL+e.path+"/EPUB/")):desktop&&"download"==t?(bookPath=np.getBooksPath()+e.path+"/","mac"==os&&(bookPath="file://"+bookPath)):(bookPath=(stg.data.currentLibrary.cloud.public,config.kotobee.liburl+"books/"),bookPath+=e.path+"/EPUB/");return bookPath}(o,t),b.currentBook=o,modals.hide(),setTimeout(function(){var e;kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),e=function(e){e.success?(b.setAllowedChapters(e.chapters),o.id&&stg.writeSlot("lastBook",o.id),b.loadBook().then(function(){!function(e,o){if(!e.dver||e.dver<2)return o();if(config.noBookOverride)return o();khttp.get(cacheBust(ph.join(bookPath,"_kmeta/config.js"))).success(function(e){if(!e||e.error)return o();if(-1==e.indexOf("var config"))return o();e=e.replace("var config","var bookConfig");var t=document.createElement("script");t.setAttribute("bookconfig",!0);var n=document.getElementsByTagName("head");n.length&&n[0].appendChild(t),t.innerHTML=e,r=r||clone(config),a(),Object.assign(config,bookConfig,{kotobee:config.kotobee}),config.src="book",setConfigDefaults(),design.injectUserCSS(config),design.applyRichTextLibrary(),design.convertTabs(),o&&o()}).error(function(){o&&o()})}(o,function(){var t;stg.data.book.accessmode=o.accessmode,stg.data.book.id=o.id,b.root="/book/"+stg.data.book.id,stg.data.epub.bookThumb=b.getCoverImgPath(o,stg.data.book.path),chromeApp&&(stg.data.chromeAssets[stg.data.book.bookThumb]?stg.data.epub.bookThumb=stg.data.chromeAssets[stg.data.book.bookThumb]:(t=stg.data.epub.bookThumb,delete stg.data.epub.bookThumb,getImgDataSrc(t,function(e){stg.data.epub.bookThumb=e,stg.data.chromeAssets[t]=e}))),kStatus.update();var e="",n=i.defaultIndex;null!=i.defaultUrl&&(n=chapters.indexFromUrl(i.defaultUrl)),null!=n&&(e="/chapter/"+n),$location.path(b.root+"/reader"+e),sync.initialize(),kMiniapps.initialize(),freehand.initialize(),setTimeout(function(){chapters.initialize(n),kotobee.dispatchEvent("bookOpened",stg.data.book)},i.noDelay?0:1e3)})})):kStatus.update()},(native||desktop)&&"download"==t&&o.downloaded?e({success:!0}):backend.hasAccessTo({testagainst:o.id,open:!0},e)},i.noDelay?0:200)},b.removeBookConfigElem=function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++)if(e[t].hasAttribute("bookconfig")){e[t].parentNode.removeChild(e[t]);break}r&&(a(),Object.assign(config,r,{kotobee:config.kotobee}),design.injectUserCSS(config))},b.loadBook=function(w){w=w||{};var s={func:arguments.callee,args:arguments},C=$q.defer();function x(){$filter("contentSrc")(stg.data.toc,ph.join(bookPath,stg.data.packageURL,stg.data.tocPath)),$filter("chapterHtml")(stg.data.toc),function(){var e=stg.data.toc;if(!b.allowedChapters)return;for(var t,n,o=e.getElementsByTagName("a"),i=0;i<b.allowedChapters.length;i++){var r,a=b.allowedChapters[i],s=null;isNaN(a)?((n=a.replace(/['"](.*?)['"]/g,"$1")).match(/\[\*\]$/g)&&(s=!0,n=n.replace(/\[\*\]$/g,"")),n.match(/^index::/g)&&(r=n.replace(/^index::/g,""),t=chapters.getChapterURL(Number(r)),n="")):t=chapters.getChapterURL(Number(a));for(var c=0;c<o.length;c++){var l=null;n&&n==o[c].textContent&&(l=!0),t&&(t==o[c].getAttribute("data-url")&&(l=!0),t==o[c].getAttribute("href")&&(l=!0)),l&&(o[c].setAttribute("data-allow",!0),s&&o[c].setAttribute("data-allow-children",!0))}}for(c=0;c<o.length;c++){if(l=o[c].hasAttribute("data-allow")||o[c].hasAttribute("data-dontshow")||hasClass(o[c],"parentNotRestricted")){if(o[c].removeAttribute("data-allow"),o[c].hasAttribute("data-allow-children"))if((u=o[c].nextElementSibling)&&"ol"==u.nodeName.toLowerCase())for(var d=u.getElementsByTagName("a"),i=0;i<d.length;i++)addClass(d[i],"parentNotRestricted")}else{o[c].className="restricted",o[c].setAttribute("data-index",c);var u,p=document.createElement("label");p.className="restrictedLabel",p.textContent=translit.get("restricted"),o[c].parentNode.appendChild(p),(u=o[c].parentNode.getElementsByTagName("ol")[0])&&o[c].parentNode.appendChild(u)}}for(c=0;c<o.length;c++){var h=o[c].getAttribute("href"),g=getElementsByAttribute(stg.data.epub.manifest,"item","href",h);if(g.length){var f=getElementsByAttribute(stg.data.epub.spine,"itemref","idref",g[0].id);if(f.length&&"restricted"==o[c].className)for(var m=f.length;m--;)if("no"!=f[m].getAttribute("linear")){f[m].setAttribute("linear","no");break}}}for(var v=e.getElementsByClassName("restricted"),c=0;c<v.length;c++)v[c].setAttribute("href","")}(),"files"==config.serialNavMode&&function(){stg.data.toc;for(var e=stg.data.epub.spine.getElementsByTagName("itemref"),t=1;t<e.length;t++){for(var n=null,o=t-1;0<=o;o--)if("no"!=e[o].getAttribute("linear")&&e[o].getAttribute("idref")==e[t].getAttribute("idref")){n=!0;break}n&&e[t].setAttribute("linear","no")}}(),stg.data.book.chapters=stg.data.toc.innerHTML,C.resolve()}return stg.resetBook(),cssParser.clearCache(),jsParser.clearCache(),chapters.clearCache(),khttp.get(cacheBust(ph.join(bookPath,"META-INF/container.xml?v="+readerV))).success(function(e){config.kotobee.encodekey&&!kInteractive.isSDK()&&(e=1.1<=config.v?CryptoJS.AES.decrypt(e,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,e));var t=parseXml(e);stg.data.epub={};try{stg.data.packageURL=t.getElementsByTagName("rootfile")[0].getAttribute("full-path")}catch(e){return kStatus.update(),void kError.update({error:"errorAndCallback",msg:native?"errorLoadingBookNative":"errorLoadingBook",cb:crdv.exit})}design.convertTabs();var n,o,i,r,a,k=config.v,y=native||isKotobeeHosted();o=function(b){var e=w.getInfoOnly?"&info":"";khttp.get(cacheBust(ph.join(bookPath,stg.data.packageURL))+e).success(function(e){if(stg.data.packageOpf=e,"book"==config.kotobee.mode&&!isReaderApp)if(1.3<=k){var t=CryptoJS.MD5(e.replace(/\s+/g,"")).toString();if(config.kotobee.hostPath&&"kotobee"==config.kotobee.hostType&&(t=""),y){if(0!=config.checksum.indexOf(t))return void o()}else{var n=CryptoJS.MD5(b).toString();if(t+n!=config.checksum&&(b=b.replace(/(\S)\n/g,"$1\r\n"),t+CryptoJS.MD5(b).toString()!=config.checksum))return o()}}else if(1.2<=k&&CryptoJS.MD5(e).toString()!=config.checksum)return void o();function o(){kStatus.update(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorLoadingPage")}});var e=document.getElementsByClassName("loaded");e.length&&e[0].parentNode.removeChild(e[0])}config.kotobee.encodekey&&!kInteractive.isSDK()&&(e=1.1<=config.v?CryptoJS.AES.decrypt(e,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,e));var i,r,a=parseXml(e=e.replace(/href="([^"]*?&[^"]*?)"/g,function(e,t){return'href="'+t.replace(/&/g,"")+'"'}));stg.data.epub.metadata=a.getElementsByTagName("metadata")[0],stg.data.epub.manifest=a.getElementsByTagName("manifest")[0],stg.data.epub.spine=a.getElementsByTagName("spine")[0],stg.data.epub.guide=a.getElementsByTagName("guide")[0],stg.data.mediaList=[],stg.data.book.meta={},stg.data.book.version=3;try{for(var s,c,l=0;l<stg.data.epub.metadata.childNodes.length;l++){if(8!=(s=stg.data.epub.metadata.childNodes[l]).nodeType&&"#text"!=s.nodeName){if(s.hasAttribute("name")&&"meta"==s.nodeName.toLowerCase())stg.data.book.meta[s.getAttribute("name")]=s.getAttribute("content");else for(var d=s.hasAttribute("property")?s.getAttribute("property"):s.nodeName,u=d.split(":"),p=stg.data.book.meta,h=0;h<u.length;h++)h==u.length-1?p[u[h].toLowerCase()]=s.innerHTML?s.innerHTML:s.textContent:(p[u[h].toLowerCase()]||(p[u[h].toLowerCase()]={}),p=p[u[h].toLowerCase()]);s.hasAttribute("id")&&(c=(d=s.nodeName.toLowerCase()).split(":")[0],stg.data.book.meta[c]||(stg.data.book.meta[c]={}),stg.data.book.meta[c][s.getAttribute("id")]=s.textContent)}}}catch(e){}stg.data.book.meta.kotobee&&stg.data.book.meta.kotobee.spine&&((i=kInteractive.readRawData(stg.data.book.meta.kotobee.spine))&&i.raw&&((r=document.createElement("div")).innerHTML=i.raw.replace(/\/>/g,"></itemref>"),stg.data.epub.spine=r.children[0]));var g=stg.data.epub.spine.getAttribute("page-progression-direction");g&&(stg.data.book.meta.dir=g);var f=getElementsByAttribute(stg.data.epub.manifest,"item","properties","cover-image");if((0<f.length||stg.data.book.meta.cover&&0<(f=getElementsByAttribute(stg.data.epub.manifest,"item","id",stg.data.book.meta.cover)).length)&&(stg.data.epub.bookThumb=$filter("coverPath")(f[0].getAttribute("href"))),chromeApp&&stg.data.epub.bookThumb&&(stg.data.chromeAssets[stg.data.epub.bookThumb]?stg.data.epub.bookThumb=stg.data.chromeAssets[stg.data.epub.bookThumb]:getImgDataSrc(stg.data.epub.bookThumb,function(e){stg.data.chromeAssets[stg.data.epub.bookThumb]=e,stg.data.epub.bookThumb=e})),w.getInfoOnly)return C.resolve(),C.promise;function m(e,t){t=t||{};for(var n=getElementsByAttribute(stg.data.epub.manifest,"item","media-type",e+"/.*"),o=0;o<n.length;o++){var i,r,a=n[o].getAttribute("href");0!=a.indexOf("js/widgets/")&&(0==a.indexOf("xhtml/pdf")&&-1!=a.indexOf("/page")||((i={}).thumbnail=cleanURL(t.thumb?t.thumb:ph.join(bookPath,stg.data.packageURL,n[o].getAttribute("href"))),i.title=ph.removeExtension(ph.basename(i.thumbnail)),r=n[o].getAttribute("media-type"),i.ext=r.split(e+"/")[1],i.type=e,i.src=cleanURL(ph.join(bookPath,stg.data.packageURL,n[o].getAttribute("href"))),stg.data.mediaList.push(i),chromeApp&&isAbsoluteURLAndNotDataPath(i.thumbnail)&&(stg.data.chromeAssets[i.thumbnail]?i.thumbnail=stg.data.chromeAssets[i.thumbnail]:function(t,n){getImgDataSrc(t.thumbnail,function(e){stg.data.chromeAssets[t.thumbnail]=e,t.thumbnail=e,n&&n()})}(i))))}}stg.initializeSettings(),config.videosInMediaTab&&m("video",{thumb:"img/ui/videoFile.png"}),config.audioInMediaTab&&m("audio",{thumb:"img/ui/audioFile.png"}),config.imagesInMediaTab&&m("image",{});try{stg.data.tocPath=getElementsByAttribute(stg.data.epub.manifest,"item","properties","[s]*nav[s]*")[0].getAttribute("href")}catch(e){var v=stg.data.epub.spine.getAttribute("toc");if(!v)return void x();try{stg.data.book.version=2,stg.data.tocPath=getElementsByAttribute(stg.data.epub.manifest,"item","id",v)[0].getAttribute("href")}catch(e){return void x()}}khttp.get(cacheBust(ph.join(bookPath,stg.data.packageURL,stg.data.tocPath))).success(function(e){if(config.kotobee.encodekey&&!kInteractive.isSDK()&&(e=1.1<=config.v?CryptoJS.AES.decrypt(e,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,e)),2==stg.data.book.version){var t=parseXml(e).getElementsByTagName("navMap");t.length&&(stg.data.toc=function e(t){var n=document.createElement("ol");for(var o=0;o<t.childNodes.length;o++)if(t.childNodes[o]){var i=t.childNodes[o];if(8!=i.nodeType&&"#text"!=i.nodeName&&"navpoint"==i.nodeName.toLowerCase()){for(var r,a,s,c,l=0;l<i.childNodes.length;l++){i.childNodes[l]&&("content"==(c=i.childNodes[l].nodeName.toLowerCase())?a=i.childNodes[l].getAttribute("src"):"navlabel"==c?r=i.childNodes[l].textContent.trim():"navpoint"==c&&(s=s||e(i)))}var d=document.createElement("li"),u=document.createElement("a");u.innerHTML=r||"",u.setAttribute("href",a?ph.join(stg.data.tocPath,a):""),d.appendChild(u),s&&d.appendChild(s),n.appendChild(d)}}return n}(t[0]))}else for(var n=parseHtml(e).getElementsByTagName("nav"),o=0;o<n.length;o++)if(!n[o].hasAttribute("epub:type")||"toc"==n[o].getAttribute("epub:type"))for(var i=n[o].getElementsByTagName("ol"),r=0,a=0;a<i.length;a++){var s=i[a].getElementsByTagName("a");if(!(s.length<r)){r=s.length,stg.data.toc=i[a];for(var c=s.length;c--;)s[c].getAttribute("href")?s[c].setAttribute("href",ph.join(stg.data.tocPath,s[c].getAttribute("href"))):s[c].setAttribute("href","")}}x()}),tinCan.send({verb:"opened",activity:"Book: "+stg.data.book.meta.dc.title})}).error(function(){kError.update({error:"networkError",ref:s})})},i=(n={sharedTemplateJs:y,version:k}).sharedTemplateJs,r=n.version,window.location.origin,a=Math.round(9999*Math.random()),"book"==config.kotobee.mode&&!isReaderApp&&1.3<=r&&!i?khttp.get("js/templates.js?c="+a).success(o).error(function(){kError.update({error:"networkError",ref:ref})}):o()}).error(function(e){kStatus.update(),native||desktop||"file://"!=window.location.origin?kError.update({error:"errorAndCallback",msg:native?"errorLoadingBookNative":"errorLoadingBook",cb:crdv.exit}):kError.update({error:"This browser failed to run the ebook app locally. Please try a different browser, or upload the web files to your server and run the web app online"})}),C.promise},b.getTitleByIndex=function(e){if(stg.data.toc)try{for(var t,n=stg.data.toc.getElementsByTagName("li"),o=[],i=0;i<n.length;i++){n[i]&&((t=n[i].getElementsByTagName("a")).length&&"true"!=t[0].getAttribute("data-dontshow")&&o.push(n[i]))}return o[e].getElementsByTagName("a")[0].textContent}catch(e){}},b.getContentDir=function(){return"ltr"!=stg.data.book.meta.dir&&("rtl"==stg.data.book.meta.dir||"ar"==stg.data.settings.language)?"rtl":"ltr"},b.isRtl=function(){return"rtl"==b.getContentDir()},b}),createService("bookinfo",function(){var o,s,c,l,i={},d=[];function u(e){var t={};return t.background="url('"+e+"')",t["background-size"]="cover",t["background-position"]="center center",t.opacity="1",t.filter="none",t}function p(){f();var e="download"==o||"open"==o;"book"==config.kotobee.mode?(o="loading",Vue.set(s,"privilege",o)):((native||desktop)&&e&&(s.downloaded?(o="open",Vue.set(s,"privilege",o)):"public"!=s.accessmode&&"all"!=s.accessmode&&(o="loading",Vue.set(s,"privilege",o))),native||desktop||!e||"public"!=s.accessmode&&"all"!=s.accessmode&&(o="loading",Vue.set(s,"privilege",o)),"login"==o&&(s.unauthredirect&&Vue.set(s,"redirect",stg.data.currentLibrary.unauthredirect),s.overrideunauthredirect&&Vue.set(s,"redirect",stg.data.currentLibrary.unauthredirect))),m()}function h(t){return"loading"!=o?t?t():null:"book"==config.kotobee.mode?(config.kotobee.payment&&config.kotobee.pricing&&config.kotobee.pricing.purchasable?(Vue.set(s,"price",config.kotobee.pricing.price),Vue.set(s,"price_localized","$"+config.kotobee.pricing.price),o="https:"==location.protocol?"buy":"insecure",Vue.set(s,"privilege",o),s.paymentOptions=payment.initialize(config.kotobee.payment)):f(),m(),$rootScope.$$phase||$rootScope.$apply(),t?t():null):"public"==s.accessmode||"all"==s.accessmode||config.kotobee.payment&&config.kotobee.pricing&&!config.kotobee.pricing.purchasable&&"book"==config.kotobee.mode?t?t():null:(Vue.set(s,"redirect",null),void backend.hasAccessTo({testagainst:s.id},function(e){return e.success?f():e.error&&e.purchasable?(native?payment.isInAppPurchaseEnabled()?payment.handleInAppProduct(s):(o="denied",Vue.set(s,"privilege",o),Vue.set(s,"redirect",stg.data.currentLibrary.unauthredirect),Vue.set(s,"paymentOptions",e.payment),s.overrideunauthredirect&&Vue.set(s,"redirect",s.unauthredirect)):(Vue.set(s,"price",e.price),Vue.set(s,"price_localized","$"+e.price),Vue.set(s,"paymentOptions",e.payment),o="https:"==location.protocol?"buy":"insecure",Vue.set(s,"privilege",o)),s.paymentOptions=payment.initialize(s.paymentOptions)):(o="denied",Vue.set(s,"privilege",o),Vue.set(s,"redirect",stg.data.currentLibrary.unauthredirect),s.overrideunauthredirect&&Vue.set(s,"redirect",s.unauthredirect)),native&&"buy"==o||(m(),$rootScope.$$phase||$rootScope.$apply()),t?t():null}))}function g(e){return stg.data.info||Vue.set(stg.data,"info",{}),stg.data.info["book"+e.id]||Vue.set(stg.data.info,"book"+e.id,{}),stg.data.info["book"+e.id]}function f(){s&&("book"==config.kotobee.mode?o="login":native||desktop?"download"==(o=s.updating?"updating":s.downloaded?"open":g(s).loading?"downloading":g(s).extracting?"extracting":!backend.cloudParam("public")&&!stg.data.user.loggedIn&&"public"!=s.accessmode&&"all"!=s.accessmode&&backend.cloudParam("entry")?"login":"download")&&"open"==s.openmethod&&(o="open"):backend.cloudParam("public")||stg.data.user.loggedIn||"public"==s.accessmode||"all"==s.accessmode?o="open":backend.cloudParam("entry")&&(o="login"),Vue.set(s,"privilege",o))}function m(){c&&c.ui&&(Vue.set(c.ui,"privilege",o),Vue.set(c.ui,"actionBtnIcon",function(){if("open"==o)return"icon kb-book-open size20";if("login"==o)return"icon kb-user size14";if("download"==o)return"icon kb-download size20";if("downloading"==o)return null;if("updating"==o)return null;if("loading"==o)return null;if("buy"==o)return null;if("unavailable"==o)return null}()),Vue.set(c.ui,"actionBtnSpinnerIcon",function(){if("downloading"==o)return"dots";{if("updating"==o)return"dots";if("loading"==o)return"dots"}}()),Vue.set(c.ui,"actionBtnLabel",function(){if("buy"==o){var e=s.pricing;"book"==config.kotobee.mode&&(e=config.kotobee.pricing);var t,n=translit.get("buyWithPrice");return n=n.replace("{{price}}","$"+e.price),e.issubscr&&e.subscrcycle&&(t="",t=7==e.subscrcycle?translit.get("week"):30==e.subscrcycle?translit.get("month"):365==e.subscrcycle?translit.get("year"):translit.get("xDays").replace("{{x}}",e.subscrcycle),n="<span class='subscr'>"+translit.get("buyWithSubscr").replace("{{price}}",e.price).replace("{{cycle}}",t)+"</span>"),n}if("unavailable"==o)return translit.get("bookUnavailable");if("open"==o)return translit.get("read");if("login"==o)return translit.get("loginToRead");if("download"==o)return translit.get("download");if("downloading"==o)return translit.get("downloading");if("updating"==o)return translit.get("updating");if("extracting"==o)return translit.get("extracting");if("loading"==o)return translit.get("pleaseWait");if("denied"==o)return translit.get("bookAccessDenied");if("insecure"==o)return translit.get("securityInfo")}()),Vue.set(c.ui,"actionBtnStyle","buy"==o?"buyBtn":"unavailable"==o?"unavailableBtn":"open"==o||"login"==o?"openBtn":"downloading"==o||"updating"==o||"extracting"==o?"downloadingBtn":"loading"==o?"loadingBtn":"denied"==o?"deniedBtn":"insecure"==o?"insecureBtn":"downloadBtn"))}function r(){i.show(l),$timeout(function(){i.update(s)},800)}return i.redeemCode=function(){modals.hide(),auth.redeemCode({source:"bookinfo"},function(){i.show(l)})},i.show=function(e,t){var n={serviceOb:e,options:t=t||{}};if(d[e.book.id]=n,t.noModal)return i.showInternal(e.book);vueApp.$router.push("/library/book/"+e.book.id)},i.showInternal=function(e){var t=d[e.id].serviceOb,n=(n=d[e.id].options)||{};s=(l=t).book,native&&crdv.vibrate();var o={};for(var i in t.book.meta||(t.book.meta={}),t.book.meta)"object"!=typeof t.book.meta[i]&&(o[i]=t.book.meta[i]);t.book.meta.dc=Object.assign({},t.book.meta.dc,o),!t.book.meta.dc.creator&&t.book.meta.author&&(t.book.meta.dc.creator=t.book.meta.author),t.book.coverStyle||(t.book.coverImg=book.getCoverImgPath(t.book),t.book.coverStyle={"background-image":"url('"+t.book.coverImg+"')"},t.book.bannerStyle={"background-image":"linear-gradient(to bottom, rgba(67, 47, 71, 0.9) 0%, rgba(52, 80, 97, 0.7) 100%), url('"+t.book.coverImg+"')"},t.book.bgimg&&(t.book.bannerStyle=u(book.getBgImgPath(t.book))),chromeApp&&(stg.data.chromeAssets[t.book.coverImg]?t.book.coverStyle=t.book.bannerStyle={"background-image":"url('"+stg.data.chromeAssets[t.book.coverImg]+"')"}:getImgDataSrc(t.book.coverImg,function(e){stg.data.chromeAssets[t.book.coverImg]=e,t.book.coverStyle={"background-image":"url('"+e+"')"},t.book.bgimg||(t.book.bannerStyle=t.book.coverStyle)}),t.book.bgimg&&(stg.data.chromeAssets[t.book.bgImg]?t.book.bannerStyle=u(stg.data.chromeAssets[t.book.bgImg]):getImgDataSrc(book.getBgImgPath(t.book),function(e){stg.data.chromeAssets[t.book.bgImg]=e,t.book.bannerStyle=u(e)}))));var r={};r.book=t.book,r.categoryClicked=t.categoryClicked,r.ui={},r.stage="info",c=r;var a="slide-in-up";"none"==n.animation&&(a="none"),n.noModal?Vue.set(stg.data.modal,"bookInfoOptions",r):modals.show({mode:"bookInfo",dynamic:!0,animation:a,bookInfoOptions:r},function(){kotobee.dispatchEvent("bookInfoPanelOpened",r.book)},function(){vueApp.$router.push("/library")}),p(),function(t){if("library"!=config.kotobee.mode)return;if(!native&&!desktop)return;if(!s.downloaded)return;!function(o){var i=np.getBooksPath()+s.path;"mac"==os&&(i="file://"+i);native&&(i=cleanURL(crdv.libEbooksDirectory.nativeURL+s.path+"/EPUB"));function e(n){khttp.get(cacheBust(ph.join(i,"_kmeta/config.js"))).success(function(e){if(!e)return n();e=e.replace("var config = ","");var t=JSON.parse(e).checksum;if(!t)return n();n(t)}).error(function(){n()})}!function(t){khttp.get(cacheBust(ph.join(i,"ver.txt"))).success(function(e){t(e)}).error(function(){t()})}(function(n){asyncCheck(null!=n,e,[],function(e){var t={};t.bid=s.id,null!=n&&(t.ver=n),null!=e&&(t.checksum=e),backend.checkBookUpdates(t,function(e){if(e){if(null==t.ver&&(desktop?np.writeFile(i+"/ver.txt",e.ver):native&&crdv.writeFile(e.ver,s.path+"/EPUB/ver.txt",{relTo:"library"})),e.latestVer>e.ver)return o(!0);o()}})})})}(function(e){t.updateAvailable=e,$rootScope.$$phase||$rootScope.$apply()})}(r),setTimeout(h,mobile?1e3:500)},i.refetch=function(){if(o="loading",s){if(!stg.data.user||!stg.data.user.loggedIn)return c.stage="info",void modals.show({mode:"success",successOptions:{msg:translit.get("activateAndloginToAccessEbook")}});h()}},i.setBusy=function(e){c&&Vue.set(c,"busy",e)},i.getCurrentBook=function(){return s},i.inAppPurchaseCallback=function(e){function t(){o=e&&e.price?(Vue.set(s,"price",e.priceMicros/1e6),Vue.set(s,"price_localized",e.price),"buy"):"unavailable",Vue.set(s,"privilege",o),m(),$rootScope.$$phase||$rootScope.$apply()}e&&e.loaded&&e.valid&&e.transaction&&e.transaction.id&&payment.isCurrentUserID(e)&&payment.validateInAppPurchase(e,function(e){e&&f(),t()},{cache:!0}),t()},i.update=function(e){s.updating||(Vue.set(s,"updating",!0),i.download(e,function(){Vue.set(s,"updating",!1)}),$rootScope.$$phase||$rootScope.$apply())},i.immediateEnter=function(t,n){(s=t).clicked=!0,p(),h(function(){t.clicked=!1;var e={};n&&(e.defaultUrl=n),"open"==o?book.open(t,e):"download"==o?i.download(t):(modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorNoAccessToBook")}}))})},i.download=function(r,a){function e(e){Vue.set(g(r),"progress",Math.ceil(100*e)),$rootScope.$$phase||$rootScope.$apply()}g(r).loading||(crdv.vibrate(),crdv.toast(translit.get("bookIsDownloading")),g(r).loading=!0,f(),m(),Vue.set(g(r),"progress",0),setTimeout(function(){backend.downloadEbook(r,e,function(i){g(r).loading=null,i?(g(r).extracting=!0,f(),m(),$timeout(function(){var e,t,n,o;e="src.zip",t=r,n=i,o=function(e){i=null,g(r).extracting=null,f(),m(),modals.hide(),$timeout(function(){modals.show({mode:"bookDownloaded",downloadedOptions:{book:r,open:book.open},apply:!0}),$injector.get("library").applyExistingBooks(stg.data.currentLibrary.books),backend.addBookStat({type:"download"}),a&&a()},1e3)},native?crdv.writeEbook(e,t,n,o):desktop&&np.writeEbook(e,t,n,o)})):modals.hide()})},500))},i.prevStage=function(){"paymentMethod"==c.stage?"book"==config.kotobee.mode?c.stage="emailCollection":c.stage="info":"emailCollection"==c.stage&&(c.stage="info")},i.nextStage=function(){if("info"==c.stage){if("book"==config.kotobee.mode)return Vue.set(c,"paymentEmail1",null),Vue.set(c,"paymentEmail2",null),Vue.set(c,"paymentEmailError",null),c.stage="emailCollection";if(!stg.data.user.loggedIn)return c.stage="emailCollection";var e={id:c.book.id,accountemail:stg.data.user.email,amount:c.book.price.toString()};return Vue.nextTick(function(){payment.renderPaypalButton(e,i.refetch)}),c.stage="paymentMethod"}if("emailCollection"==c.stage){if(c.paymentEmailError=null,"login"==c.emailCollectionMethod){if(!c.paymentEmail1)return c.paymentEmailError=translit.get("emailFormatError");if(!c.pwd)return c.paymentEmailError=translit.get("enterYourPwd");Vue.set(c,"verifyingEmail",!0),stg.data.user.email=c.paymentEmail1,stg.data.user.pwd=c.pwd,stg.data.user.rememberMe=!0,backend.login({userInput:!0,dontShowErrorDialog:!0}).then(function(e){if(Vue.set(c,"verifyingEmail",!1),e.error)return stg.data.user.email=stg.data.user.pwd=stg.data.user.rememberMe=null,modals.hide(),void setTimeout(function(){kError.update({error:"s_authError"==e.error?"accessDenied":e.error})});var t={id:c.book.id,amount:c.book.price.toString(),accountemail:c.paymentEmail1};Vue.nextTick(function(){payment.renderPaypalButton(t,i.refetch)}),c.stage="paymentMethod"})}else{if(!c.paymentEmail1||!c.paymentEmail2)return c.paymentEmailError=translit.get("emailFormatError");if(c.paymentEmail1!=c.paymentEmail2)return c.paymentEmailError=translit.get("emailsDontMatch");Vue.set(c,"verifyingEmail",!0),backend.verifyCloudEmail({cloudemail:c.paymentEmail1},function(e){var t;Vue.set(c,"verifyingEmail",!1),e&&"book"==e.mode?c.paymentEmailError=translit.get("emailAlreadyExists"):(t={id:c.book.id,amount:c.book.price.toString(),accountemail:c.paymentEmail1},Vue.nextTick(function(){payment.renderPaypalButton(t,i.refetch)}),c.stage="paymentMethod")})}return!0}},i.action=function(e,t){if("loading"!=o)if("denied"!=o){if("insecure"==o)return modals.hide(),void $timeout(function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("insecureProtocolDesc")}})},500);if("unavailable"!=o)if("buy"!=o){if("open"==o){if(c.updateAvailable)return modals.hide(),void $timeout(function(){modals.show({mode:"bookUpdateAvailable",updateAvailableOptions:{book:s,open:book.open,update:r},apply:!0})},500);book.open(e)}else"login"==o?(modals.hide(),setTimeout(backend.login,1e3)):"download"==o&&i.download(e);f(),m()}else{if(Vue.set(c,"paying",null),i.nextStage())return;var n;t?(Vue.set(c,"paying",t),(n={}).bookOb=e,n.paymentEmail=c.paymentEmail1,n.paymentOptions=s.paymentOptions,payment.makePayment(t,n)):(modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("missingPaymentMethod")}}))}else events.add({action:"bookUnavailableBtnClicked",param:e.name,bid:e.id})}else events.add({action:"accessDeniedBtnClicked",param:e.name,bid:e.id})},i.delete=function(e){var t,n;crdv.toast(translit.get("deletingBook")),crdv.vibrate(),t=e,n=function(){f(),m(),$rootScope.$$phase||$rootScope.$apply()},native?crdv.deleteEbook(t,n):desktop&&np.deleteEbook(t,n)},i.toggleFav=function(e){e.favorite?i.removeFav(e,!0):i.addToFav(e,!0)},i.addToFav=function(e,t){t?Vue.set(e,"favorite",!0):kStatus.update(translit.get("addingToFavorites"),null,{dots:!0}),backend.addtoFav(e,function(){Vue.set(e,"favorite",!0),t||kStatus.update()})},i.removeFav=function(e,t){t?Vue.set(e,"favorite",!1):kStatus.update(translit.get("removingFromFavorites"),null,{dots:!0}),backend.removeFav(e,function(){Vue.set(e,"favorite",!1),t||kStatus.update(),angular.element(document.getElementById("library")).scope().loadFavorites()})},i.copyURL=function(e){var t=window.location.href.split("/#")[0];t+="/#/book/"+e.id,selection.copyToClipboard(t,!0)},i}),createService("cache",function(){var n={},o={};return n.initialize=function(){n.setOb("body",document.getElementsByTagName("body")[0]);var e=document.getElementsByTagName("title"),t=null;e.length?t=e[0]:(t=document.createElement("title"),document.head.appendChild(t)),n.setOb("title",t)},n.setOb=function(e,t){return o[e]=t},n.getOb=function(e){return o[e]},n}),createService("cart",function(){var a={};function r(){modals.hide(),kotobee.popup(translit.get("cartConfirmationMsg"),{title:translit.get("cartTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})}function s(){stg.readSlot("cart",function(e){Vue.set(stg.data,"cartData",e)})}function e(e){a.bids=[];for(var t=0;t<e.length;t++)a.bids.push({type:"book",id:+e[t].bookId,amount:+e[t].bookPrice,bookname:e[t].bookName});for(var n=0;n<stg.data.cartData.length;n++)for(var o=stg.data.cartData[n],i=0;i<e.length;i++){var r=e[i];o.bookId==r.bookId&&(r.bookImgUrl=o.bookImgUrl)}Vue.set(stg.data,"cartData",e),stg.writeSlot("cart",stg.data.cartData),modals.show({mode:"cart",dynamic:!0,animation:"slide-in-up"},function(){})}function i(){Vue.set(stg.data,"cartData",[]),stg.clearSlot("cart",function(){})}return a.initialize=function(){a.currency="$",Vue.set(stg.data,"cartData",[]),s()},a.add=function(e){s();var t={bookId:e.id,bookName:e.name,bookPrice:e.price_localized,bookImgUrl:e.coverImg};if(stg.data.cartData.length){for(var n=[],o=0;o<stg.data.cartData.length;o++){var i=stg.data.cartData[o];if(t.bookId==i.bookId){n.push(!0);break}}n.length||(stg.data.cartData.push(t),stg.writeSlot("cart",stg.data.cartData)),r()}else stg.data.cartData.push(t),stg.writeSlot("cart",stg.data.cartData),r()},a.remove=function(o){stg.data.cartData.forEach(function(e,t,n){e.bookId==o&&n.splice(t,1)}),stg.writeSlot("cart",stg.data.cartData)},a.getTotalPrice=function(){for(var e=[],t=0;t<stg.data.cartData.length;t++){var n=+stg.data.cartData[t].bookPrice.trim();e.push(n)}return e.reduce(function(e,t){return e+t},0)},a.show=function(){a.load(e)},a.load=function(o){"library"==config.kotobee.mode&&stg.readSlot("cart",function(e){for(var t="",n=0;n<e.length;n++){t+=e[n].bookId+","}t=t.replace(/\,$/,""),backend.sendRawPost(config.kotobee.liburl+"library/order/getproducts",{bids:t},{responseType:"json"},function(e){e.error?kotobee.popup(translit.get("cartErrorMessageDesc"),{title:translit.get("cartTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}}):o(e)})})},a.checkout=function(e){modals.hide(),a.currentOrder=e,modals.show({mode:"checkout",dynamic:!0,animation:"slide-in-up"},function(){var e,t;t=cart.currentOrder?{order:cart.currentOrder}:(e=kotobee&&kotobee.user&&kotobee.user.email?kotobee.user.email:"",{items:cart.bids,accountemail:e}),payment.renderPaypalButton(t,i)})},a.pay=function(n){var o=kotobee&&kotobee.user&&kotobee.user.email?kotobee.user.email:"";!function(e,t){if(a.currentOrder)return t(a.currentOrder);$injector.get("backend").createOrder(e,function(e){e.order&&e.order.id?t(e.order):kotobee.popup(translit.get("unexpectedError"),{title:translit.get("checkoutTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})})}({platform:n,items:JSON.stringify(a.bids),accountemail:o},function(e){var t;"moyasar"===n?(t={orderid:e.id,redirecturl:native?"http://localhost:8100":window.location.protocol+"//"+window.location.host+window.location.pathname,price:100*e.amount,name:payment.getOrderName(e)},payment.moyasarSettings.payment(t,i)):"stripe"===n&&payment.stripeMakePayment(payment.initialize(config.kotobee.payment),{order:e},{paymentEmail:o},{id:""},i)})},a.back=function(){modals.hide(),modals.show({mode:"cart",dynamic:!0,animation:"slide-in-up"},function(){})},a}),createService("chapterAPI",function(){var e={},r=[];function t(){var e,t,n,o;arguments.length<2||(e=arguments[0],t={},n=2==arguments.length?arguments[1]:(t=arguments[1],arguments[2]),t.unique&&i(e),o={event:e,cb:n},r.push(o))}function n(e,t){if(e){t=t||{};for(var n=function(e){if(!e)return;for(var t=[],n=r.length;n--;)r[n].event==e&&t.push(r[n]);return t}(e),o=0;o<n.length;o++){var i=n[o];if(i&&i.cb){try{i.cb.apply(this,[t])}catch(e){}if(t.firstMatch)break}}}}function i(e){for(var t=r.length;t--;)e&&r[t].event!=e||r.splice(t,1)}function o(){return compInstances.tabMenu}function a(e){var t=o();t&&t.notebookClicked(e)}function s(){var e=o();e&&e.pdfClicked()}function c(){var e=o();e&&e.printClicked()}function l(){var e=o();e&&e.settingsClicked()}function d(){var e=o();e&&e.searchClicked()}function u(t){var e=o();e&&e.searchClicked(function(){var e;t&&(document.getElementById("readerBody"),(e=compInstances.search).clearResults(),$rootScope.$$phase||$rootScope.$apply(),setTimeout(function(){document.getElementById("searchModalField").value=t,e.search(t)},30))})}function p(){var e=o();e&&e.mediaClicked()}function h(){var e=o();e&&e.chaptersClicked()}function g(){$ionicSideMenuDelegate.close(),nav.fullscreen()}function f(){return stg.data.settings.language}function m(e,t){stg.data.settings.language=e,settings.langChanged(t)}function v(e){translit.setDirection(e)}function b(e){for(var t=compInstances.bookSettings.navAnims,n=0;n<t.length;n++)if(t[n].label==e)return stg.data.settings.navAnim=t[n].val,void settings.saveSettings()}function k(){modals.hide()}function y(){$ionicSideMenuDelegate.close()}function w(){return"undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null}function C(){chapters.nextChapter()}function x(){chapters.prevChapter()}function I(e){chapters.loadChapterByIndex(e)}function E(e){$location.search("vi"),chapters.applyChapterStateFromURL(e,{vIndex:0}),$rootScope.$$phase||$rootScope.$apply()}function S(e,t,n){chapters.preloadChapterFromApi(e,t,n)}function T(){chapters.clearCache()}function O(e){chapters.neverCache(e)}function A(){var e,t,n,o=$ionicScrollDelegate.$getByHandle("content");return o&&(e=o.getScrollPosition()),1==e.zoom&&(!hasClass((t=document.getElementById("epubContainer")).children[0],"scroll")||(n=t.children[0].style.transform.replace(/.*?scale\((.*?)\).*?/g,"$1"))&&(e.zoom=Number(n))),e}function N(e){var t=$ionicScrollDelegate.$getByHandle("content");t&&t.scrollTo(0,0,e)}function L(e,t){var n=$ionicScrollDelegate.$getByHandle("content");n&&n.scrollTo(0,e,t)}function B(e){kMiniapps.openById(e)}function M(e,t){var n=clone(t=t||{});n.content=e,kInteractive.alert(n)}function R(e,t){var n={};n.content=e,isFunction(t)?(n.okBtn="Yes",n.noBtn="No",n.cb=t):(t.okBtn&&(n.okBtn=t.okBtn),t.noBtn&&(n.noBtn=t.noBtn),n.cb=t.cb,n.noBackdrop=t.noBackdrop),kInteractive.confirm(n)}function P(e,t){backend.externalLink(e,t)}function D(e,t){var n=traverser.convertElemsToLocation([t]),o={};o.chapter=chapters.getElemChapterIndex(t),o.location=n.left?n.left:n.right,o.type="content",o.src=t.textContent,o.note=e,stg.addNote(o,function(){notes.addIcon(o)})}function $(e){chapters.disableJsLoading=e}function F(e){chapters.disableCssLoading=e}function H(e,t){scorm.setManual(e,t)}function V(e){e=e||{},tinCan.send(e)}function U(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e.label)throw"'label' variable required.";if(!e.data)throw"'data' variable required.";backend.setUserData(e,t)}function j(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getUserData(e,t)}function _(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getUserList(e,t)}function z(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getUserDataArray({array:JSON.stringify(e)},t)}function q(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";kInteractive.helpers&&kInteractive.helpers.persister&&kInteractive.helpers.persister.instances&&Object.values(kInteractive.helpers.persister.instances).find(function(e){return 1==e.testMode})?backend.setUserDataArray({array:JSON.stringify(e)},function(e){setTimeout(function(){t(e)},5e3)}):backend.setUserDataArray({array:JSON.stringify(e)},t)}function W(e){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getDataPerms(e)}function K(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e.label)throw"'label' variable required.";backend.deleteUserData(e,t)}function X(){kotobee.getDataArray([{}],function(e){!e.hasOwnProperty("error")&&e.length&&kInteractiveCommon.unique(e[0].results.map(function(e){return e.label})).forEach(function(e){e&&kotobee.deleteData({label:e},console.warn)})})}function Y(){kotobee.clearLocalData(),kotobee.clearRemoteData()}function J(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e.to)throw"'to' variable required.";if(!e.message)throw"'message' variable required.";if(!e.subject)throw"'subject' variable required.";if(!e.fromName)throw"'fromName' variable required.";if(!e.fromEmail)throw"'fromEmail' variable required.";backend.sendEmail(e,t)}function G(e,t,n){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e)throw"Event name is required.";2==arguments.length&&isFunction(t)&&(n=t,t=null);var o={};o.event=e,o.data=JSON.stringify(t||{}),events.add({action:"customEvent",param:JSON.stringify(o)},n)}return e.initialize=function(){kotobee.addEventListener=t,kotobee.dispatchEvent=n,kotobee.clearListeners=i,kotobee.openNotebook=a,kotobee.exportPDF=s,kotobee.print=c,kotobee.openSettings=l,kotobee.openSearch=d,kotobee.search=u,kotobee.openMedia=p,kotobee.openChapters=h,kotobee.toggleFullscreen=g,kotobee.getLanguage=f,kotobee.setLanguage=m,kotobee.setDirection=v,kotobee.setTransition=b,kotobee.closePopups=k,kotobee.closeSidepanels=y,kotobee.openMiniapp=B,kotobee.getEnvironment=w,kotobee.nextChapter=C,kotobee.prevChapter=x,kotobee.gotoChapterIndex=I,kotobee.gotoChapterHref=E,kotobee.getChapter=S,kotobee.clearCache=T,kotobee.neverCache=O,kotobee.getScrollPosition=A,kotobee.scrollToTop=N,kotobee.scrollTo=L,kotobee.view={},kotobee.popup=M,kotobee.confirm=R,kotobee.openLink=P,kotobee.addToNotebook=D,kotobee.disableJsLoading=$,kotobee.disableCssLoading=F,kotobee.sendScorm=H,kotobee.sendTinCan=V,kotobee.setData=U,kotobee.getData=j,kotobee.getDataArray=z,kotobee.setDataArray=q,kotobee.getDataPerms=W,kotobee.getUsers=_,kotobee.deleteData=K,kotobee.clearRemoteData=X,kotobee.sendEmail=J,kotobee.triggerEvent=G,kotobee.clearData=Y,kotobee.hasOwnProperty("user")||Object.defineProperty(kotobee,"user",{get:function(){var e=clone(stg.data.user);return e&&(delete e.pwd,delete e.rememberMe,delete e.signatures),e},set:function(e){return null}}),kotobee.hasOwnProperty("book")||Object.defineProperty(kotobee,"book",{get:function(){return stg.data.book},set:function(e){return null}}),kotobee.hasOwnProperty("epub")||Object.defineProperty(kotobee,"epub",{get:function(){return stg.data.epub},set:function(e){return null}}),kotobee.hasOwnProperty("currentPage")||Object.defineProperty(kotobee,"currentPage",{get:function(){return stg.data.currentPageOb},set:function(e){return null}}),kotobee.hasOwnProperty("currentChapter")||Object.defineProperty(kotobee,"currentChapter",{get:function(){return stg.data.currentPageOb},set:function(e){return null}}),kotobee.hasOwnProperty("version")||Object.defineProperty(kotobee,"version",{get:function(){return readerV},set:function(e){return null}}),kotobee.view.hasOwnProperty("swipe")||Object.defineProperty(kotobee.view,"swipe",{get:function(){return!nav.options.swipeDisabled},set:function(e){nav.options.swipeDisabled=!e}}),kotobee.view.hasOwnProperty("doubletap")||Object.defineProperty(kotobee.view,"doubletap",{get:function(){return!nav.options.doubletapDisabled},set:function(e){nav.options.doubletapDisabled=!e}}),kotobee.view.hasOwnProperty("leftMenuOpen")||Object.defineProperty(kotobee.view,"leftMenuOpen",{get:function(){return $ionicSideMenuDelegate.isOpenLeft()}}),kotobee.view.hasOwnProperty("rightMenuOpen")||Object.defineProperty(kotobee.view,"rightMenuOpen",{get:function(){return $ionicSideMenuDelegate.isOpenRight()}}),kotobee.view.hasOwnProperty("scroll")||Object.defineProperty(kotobee.view,"scroll",{get:function(){var e=$ionicScrollDelegate.$getByHandle("content");if(e)return e.getScrollView?e.getScrollView().options.scrollingY:e.enabled},set:function(e){var t=$ionicScrollDelegate.$getByHandle("content");t&&(t.getScrollView&&(t.getScrollView().options.scrollingY=e),t.enabled=e)}}),kotobee.hasOwnProperty("documentation")||Object.defineProperty(kotobee,"documentation",{get:function(){var e=[];e.push({method:"openNotebook()",desc:"Opens the reader's notebook panel."}),e.push({method:"exportPDF()",desc:"Exports the current chapter as a PDF file."}),e.push({method:"print()",desc:"Prints the current chapter."}),e.push({method:"openSettings()",desc:"Opens the reader's settings panel."}),e.push({method:"openSearch()",desc:"Opens the reader's search panel."}),e.push({method:"search(keyword)",desc:"Search for a certain keyword, and display the results in the search panel."}),e.push({method:"openMedia()",desc:"Opens the reader's media panel."}),e.push({method:"openChapters()",desc:"Opens the reader's chapters panel (table of contents)."}),e.push({method:"toggleFullscreen()",desc:"Toggle reader into fullscreen mode."}),e.push({method:"getLanguage()",desc:"Get the reader language. Possible return values: en,fr,es,pt,nl,de,hu,it,sw,ms,no,pl,ro,ru,tr,ar,zh,jp,ko."}),e.push({method:"setLanguage(lang)",desc:"Set the reader language. This method takes the language's 2 character abbreviation as input. Possible values: en,fr,es,pt,nl,de,hu,it,sw,ms,no,pl,ro,ru,tr,ar,zh,jp,ko."}),e.push({method:"setDirection(dir)",desc:'Set the reader layout direction. Provided argument is "ltr" or "rtl".'}),e.push({method:"setTransition(type)",desc:"Set the page transition to one of the following values: flip, card, slide, stack, fade."}),e.push({method:"closePopups()",desc:"Close all displayed popups."}),e.push({method:"closeSidepanels()",desc:"Close any open sidepanels."}),e.push({method:"openMiniapp(id)",desc:"Open a specific miniapp, passing its id."}),e.push({method:"getEnvironment()",desc:"Get all details about the browser and OS"});var t=[];t.push({method:"nextChapter()",desc:"Jump to the next chapter, relative to the current chapter."}),t.push({method:"prevChapter()",desc:"Jump to the previous chapter, relative to the current chapter."}),t.push({method:"gotoChapterIndex(index)",desc:"Jump to a certain chapter, passing its index as input."}),t.push({method:"gotoChapterHref(url)",desc:"Jump to a certain chapter, passing its relative URL as input."}),t.push({method:"getChapter(url, callback, errorCallback)",desc:"Retrieve the chapter object, passing its relative URL as input. This method also takes 2 more arguments: a success callback with the chapter object, and an error callback."}),t.push({method:"clearCache()",desc:"Clear any cached chapter content."}),t.push({method:"neverCache(chapterOb)",desc:"Set the reader never to cache a specific chapter. This will cause chapters to be continuously loaded and never stored in memory. The chapter object is passed an input."}),t.push({method:"getScrollPosition()",desc:"Get the current chapter's scroll position."}),t.push({method:"scrollToTop(animate)",desc:"Scroll to the top of the chapter. This method also takes a second argument, to indicate whether scroll animation should be used."}),t.push({method:"scrollTo(y, animate)",desc:"Scroll to a certain y location. The y location is provided as an input. This method also takes a second argument, to indicate whether scroll animation should be used."});var n=[];n.push({method:"view.doubletap",desc:"Property to enable or disable double tapping (or double clicking) to zoom in."}),n.push({method:"view.swipe",desc:"Property to enable or disable swiping."}),n.push({method:"view.scroll",desc:"Property to enable or disable vertical scrolling."});var o=[];o.push({method:"popup(html, options)",desc:"Display certain HTML content inside the reader's popup. Takes an optional object with the following properties:",args:[{Property:"title",Description:"The text appearing in the title bar of the popup."},{Property:"okBtn",Description:"The label of the default OK button at the footer of the popup."},{Property:"cb",Description:"A callback function, called when the user clicks on OK."},{Property:"raw",Description:"Display only the passed HTML (raw) as a popup, without a frame and OK button. The above properties won't be effective if raw is set to true."},{Property:"noBackdrop",Description:"Don't display a backdrop when the popup is opened."}]}),o.push({method:"confirm(html,callback)",desc:"Display certain content inside a confirmation box. The second argument represents the callback function in case the user confirms.",args:[{Property:"okBtn",Description:"The label of the 'Yes' button at the footer of the popup. Defaults to 'Yes'"},{Property:"noBtn",Description:"The label of the 'No' button at the footer of the popup. Defaults to 'No'"},{Property:"cb",Description:"A callback function, called when the user clicks on the 'Yes' button."},{Property:"noBackdrop",Description:"Don't display a backdrop when the popup is opened."}]}),o.push({method:"openLink(url)",desc:"Open a certain URL inside a sliding panel."}),o.push({method:"addToNotebook(note, element)",desc:"Add certain content to the notebook. The note is provided as the first argument, and the element to attach the note to is provided as the second argument."}),o.push({method:"disableJsLoading(disabled)",desc:"Disable loading any Javascript files from subsequent chapters and pages."}),o.push({method:"disableCssLoading(disabled)",desc:"Disable loading any CSS files from subsequent chapters and pages."});var i=[];i.push({method:"sendScorm(element,value)",desc:"Set a SCORM run-time element with a value. This requires that the ebook is running as a SCORM package inside an LMS."}),i.push({method:"sendTinCan(activityOb)",desc:"Send a Tin Can activity to the LRS configured in the ebook/library settings. Available for cloud ebooks and libraries only."});var r=[];r.push({method:"setData(dataOb, callback)",desc:"Write data into the database for the currently logged in user. You will be able to fully label that data, for easy retrieval later. This methods takes an object with the following options:",args:[{Property:"label",Description:"The label (key) representing this slot of data (required)."},{Property:"data",Description:"The data to write (required)."},{Property:"overwrite",Description:"In case this data exists, overwrite it"},{Property:"unique",Description:"Ensures that only one instance exists for this data item. If other matches exist, they will be removed except the first match."},{Property:"category",Description:"For better organization, set a category for this data. This will make queries more efficient."},{Property:"subcategory",Description:"For further organization, set a subcategory for this data. This will make queries more efficient."},{Property:"options",Description:"Set options for this data. This is treated as normal text, and can be used when querying for data."}]}),r.push({method:"setDataArray(array, callback)",desc:"Set a collection of data items into the database in a single request, for the currently logged in user. It takes an array of objects, each taking the same parameters as 'setData' method above."}),r.push({method:"getData(queryOb, callback)",desc:"Retrieve data for the currently logged in user. It takes an object with the following options, and triggers a callback (the second argument) passing back the array of data.",args:[{Property:"label",Description:"The label (key) representing this slot of data."},{Property:"category",Description:"The category assigned to this data, to use as a search parameter."},{Property:"subcategory",Description:"The subcategory assigned to this data, to use as a search parameter."},{Property:"options",Description:"The options for this data, to use as a search parameter."},{Property:"allUsers",Description:"Expand the scope of search to all users with access to this cloud ebook or library. To use this option, the user must have global data permissions."},{Property:"role",Description:"Search by user role."}]}),r.push({method:"getDataArray(array, callback)",desc:"Send a collection of search queries for the currently logged in user, all in a single request. It takes an array of objects specified in the getData method, in addition to an 'id' object to label the results returned in an array."}),r.push({method:"getDataPerms(callback)",desc:"Get the list of permissions or allowed writing limits for this cloud ebook or library."}),r.push({method:"getUsers",desc:"For logged in users with global data permissions, get an array of all users added to this cloud ebook/library.",args:[{Property:"role",Description:"Limit the results to a specific user role."}]}),r.push({method:"deleteData(queryOb, callback)",desc:"Delete a certain data slot for the currently logged in user. It takes an object with the following options:",args:[{Property:"label",Description:"The label (key) representing this slot of data (required)."},{Property:"category",Description:"The category assigned to this data, to use as a search parameter."},{Property:"subcategory",Description:"The subcategory assigned to this data, to use as a search parameter."},{Property:"options",Description:"Set options for this data. This is treated as normal text, and can be used when querying for data."},{Property:"all",Description:"If this is true, all matching results will be deleted. It not, only the first result is deleted."}]}),r.push({method:"sendEmail(emailOb, callback)",desc:"Send a custom email. Note you must first contact Kotobee Support and have email sending credentials in order to activate email sending through the API. This method takes an object with the following options:",args:[{Property:"to",Description:"The email address of the recipient."},{Property:"message",Description:"The message body to send."},{Property:"html",Description:"An optional boolean specifying whether the message body is HTML formatted. Default: false."},{Property:"subject",Description:"The email subject."},{Property:"fromName",Description:"The sender name."},{Property:"fromEmail",Description:"The sender email."},{Property:"cc",Description:"An optional array of other email addresses to send a copy to."}]}),r.push({method:"triggerEvent(event, params, callback)",desc:"Trigger a custom event to notify subscribers using email, software, or push notifications. The optional params variable holds any kind of data that is needed to be sent as it is to the subscribers"});var a=[];a.push({prop:"epub",desc:"The parsed epub object, showing the metadata, manifest, spine, and book thumbnail."}),a.push({prop:"book",desc:"The book object obtained from the epub, by the reader."}),a.push({prop:"currentChapter",desc:"The current chapter object, containing all its parsed properties."}),a.push({prop:"currentPage",desc:"In the case that a reflowable layout is paginated (displayed without a scrollbar, as single page or double page view), the currently displayed page(s) is(are) returned by this property."}),a.push({prop:"user",desc:"The currently logged in user. Return an object containing his id, name, email, and user role (if exists)."});var s=[];s.push({event:"addEventListener(event, [options], callback)",desc:"Listen to a certain event (string) and call a function once the event is fired. This function takes an optional second argument (options) with the following properties:",args:[{Property:"unique",Description:"If an event listener already exists for this event, it will be removed, before adding the new one."}]}),s.push({event:null,desc:"An event object will be passed to the callback function containing the DOM element and any additional data associated with the event."}),s.push({event:"dispatchEvent(event, [options])",desc:"Fire a certain event. The function takes the event name (as a string) and an optional second argument (options) with the following properties:",args:[{Property:"firstMatch",Description:"Fire the event only for the first event listener registered."}]}),s.push({event:"clearListeners(event)",desc:"Clear all listeners that are listening to a certain event (as a string). If no event is passed, then all listeners attached to the kotobee object are cleared."});var c=[];c.push({event:"initialized",desc:"Triggered when the app is initialized."}),c.push({event:"ready",desc:"Triggered from the document object, whenever the ebook or library initialization is complete. It is fired just once."}),c.push({event:"libraryBooksFetched",desc:"Triggered when  book thumbnails are fetched in a library and displayed. An array is passed back containing the book objects."}),c.push({event:"bookOpened",desc:"Triggered when a book is opened. An object is passed back containing the book object."}),c.push({event:"chapterLoaded",desc:"Triggered whenever a new chapter is loaded and ready for use."}),c.push({event:"chapterViewed",desc:"Similar to chapterLoaded, but is triggered when the chapter is viewed on the screen."}),c.push({event:"textSelected",desc:"Text is selected in the page."}),c.push({event:"textDeselected",desc:"Text is deselected in the page."}),c.push({event:"scrolled",desc:"Triggered whenever a chapter is scrolled. An object is passed back containing the scroll position."}),c.push({event:"transformationChanged",desc:"Triggered when a chapter's scale has changed, through a zoom action."}),c.push({event:"languageChanged",desc:"Triggered when the reader UI language had changed."}),c.push({event:"directionChanged",desc:"Triggered when the reader UI language direction had changed (from left-to-right or right-to-left)."}),c.push({event:"linkClicked",desc:"Triggered when the user clicks on an external link inside any chapter."}),c.push({event:"audioPlayed",desc:"Triggered when the user clicks an audio play button."}),c.push({event:"audioLinkClicked",desc:"Triggered when a text hyperlinked to audio is clicked."}),c.push({event:"videoPlayed",desc:"Triggered when the user clicks a video play button."}),c.push({event:"popup",desc:"Triggered when a link popup is clicked and displayed on the screen."}),c.push({event:"questionPopup",desc:"Triggered when a questions component, set to display in a popup, is opened."}),c.push({event:"questionsSubmitted",desc:"Triggered when a question set is answered and submitted."}),c.push({event:"answerClicked",desc:"Triggered when a question answer box (radiobox, checkbox, textfield, etc) is changed. In the case of drag and drop questions, this even is triggered when an item is dragged into a category box."}),c.push({event:"3dModelViewed",desc:"Triggered when a 3D model is activated."}),c.push({event:"preHighlight",desc:"Triggered when the user highlights a word or phrase. An object is passed containing more information."}),c.push({event:"highlightDeleted",desc:"Triggered when the user deletes a highlight. An object is passed containing more information."}),c.push({event:"preNote",desc:"Triggered when the user adds a note. An object is passed containing more information."}),c.push({event:"noteDeleted",desc:"Triggered when the user deletes a note. An object is passed containing more information."}),c.push({event:"preBookmark",desc:"Triggered when the user adds a bookmark. An object is passed containing more information."}),c.push({event:"bookmarkDeleted",desc:"Triggered when the user deletes a bookmark. An object is passed containing more information."});var l="color: #000; font-weight: bold; font-size:18px",d="color: #224e97; font-size:12px; font-weight:bold",u="color: #224e97; font-size:12px; font-weight:bold",p="margin-left:6px;",h="font-weight:bold;";setTimeout(console.clear.bind(console)),v("%cKotobee Reader API","color: #000; font-weight: bold; font-size:22px;border:solid 1px #000;border-radius:8px;padding:5px 10px;"),v("%cThis documentation lists brief explanations of the different Kotobee Reader API methods, properties, and events, used to interact with the reader and build scalable ebook applications. A backend Developer API is also available for remotely controlling different aspects of your cloud ebooks and libraries, here: http://support.kotobee.com/en/support/solutions/folders/8000082574."),f(),v("%cUI Methods",l),v("%cThese methods are used to interact with the reader's different UI elements and components.",h);for(var g=0;g<e.length;g++)v("%c"+e[g].method,d),v("%c"+e[g].desc,p);f(),v("%cContent Methods",l),v("%cThese methods are used to display/set content in different ways.",h);for(g=0;g<o.length;g++)v("%c"+o[g].method,d),v("%c"+o[g].desc,p),o[g].args&&m(o[g].args);f(),v("%cNavigation Methods",l),v("%cThese methods are used mainly to navigate to different chapters efficiently.",h);for(g=0;g<t.length;g++)v("%c"+t[g].method,d),v("%c"+t[g].desc,p);f(),v("%cView Options",l),v("%cThese properties are used to control viewing options.",h);for(g=0;g<n.length;g++)v("%c"+n[g].method,d),v("%c"+n[g].desc,p);f(),v("%cSCORM / Tin Can Methods",l),v("%cThese methods are used to send progress to an LMS or LRS.",h);for(g=0;g<i.length;g++)v("%c"+i[g].method,d),v("%c"+i[g].desc,p);f(),v("%cCloud Methods",l),v("%cThese methods are used to store and retrieve user data into the database, for that cloud ebook or library. These methods are available for logged in users only.",h);for(g=0;g<r.length;g++)v("%c"+r[g].method,d),v("%c"+r[g].desc,p),r[g].args&&m(r[g].args);f(),v("%cProperties",l),v("%cThese properties are used to describe the book and user.",h);for(g=0;g<a.length;g++)v("%c"+a[g].prop,"color: #224e97; font-size:12px; font-weight:bold"),v("%c"+a[g].desc,p);f(),v("%cEvents Methods",l),v("%cThese methods are used to listen to and manage events fired by kotobee.",h);for(g=0;g<s.length;g++)s[g].event&&v("%c"+s[g].event,u),v("%c"+s[g].desc,p),s[g].args&&m(s[g].args);v("%cEvent types","font-weight:bold;font-size:14px;margin-top:6px;margin-bottom:6px;");for(g=0;g<c.length;g++)v("%c"+c[g].event,u),v("%c"+c[g].desc,p);function f(){v("")}function m(e){setTimeout(console.table.bind(console,e))}function v(e,t){setTimeout(console.log.bind(console,e,t||""))}return null},set:function(e){return null}}),document.dispatchEvent(new Event("kotobeeApiReady"))},e}),createService("chapters",function(){var o,s,c,i,r,g,f,l,d,a,u,m,v={},b=[],p=[],n=[],h=kLog;function k(e){for(var t=0;t<n.length;t++)if(n[t]==e)return 1}function y(t,n){var o={leftOb:{}};v.getPageOb({page:t.index,source:"getNextIndex"},function(e){return e?(e.pages?t.vIndex<e.pages.length-1?(o.leftOb.index=t.index,o.leftOb.vIndex=t.vIndex+1):(o.leftOb.index=t.index+1,o.leftOb.vIndex=0):o.leftOb.index=t.index+1,void n(o)):n()})}function w(t,n){var o={leftOb:{}};if(v.shouldBePaged(t)){if(!t.vIndex||0==t.vIndex)return void v.getPageOb({page:t.index-1,source:"stepBack"},function(e){o.leftOb.index=t.index-1,e.pages&&e.pages.length&&(o.leftOb.vIndex=e.pages.length-1),n(o)});o.leftOb.index=t.index,o.leftOb.vIndex=t.vIndex-1}else o.leftOb.index=t.index-1;n(o)}function C(e){if(!(e<0||e>=stg.data.epub.spine.getElementsByTagName("itemref").length-1)){var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];if(t){var n=t.getAttribute("properties");if(n)for(var o=n.split(" "),i=0;i<o.length;i++)if(0<o[i].indexOf("-spread-"))return o[i].split("-spread-")[1]}}}function x(e){var t=$injector.get("book");$injector.get("chapters");if(t.allowedChapters){for(var n=stg.data.toc.getElementsByTagName("a"),o=[],i=0;i<n.length;i++)"true"!=n[i].getAttribute("data-dontshow")&&o.push(n[i]);return!!hasClass(o[e],"restricted")}}function I(e,t,n){var o=v.cacheLookup(e);if(o)n(o);else{if(existsInArray(e,M))return setTimeout(function(){I(e,t,n)},50);v.preloadChapter(e,t,n)}}function E(){"undefined"!=typeof kotobeeReady&&kotobeeReady(),void 0!==kotobee&&kotobee.ready&&kotobee.ready()}function S(e){for(var t,n=0;n<b.length;n++)b[n](e);if("renderedChapter"==e){try{document.dispatchEvent(new Event("kotobeeChapterLoaded"))}catch(e){}kotobee&&((t=Object.assign({},stg.data.currentPageOb)).container=document.getElementById("spreadL"),kotobee.dispatchEvent("chapterLoaded",t),stg.data.currentRPageOb&&((t=Object.assign({},stg.data.currentRPageOb)).container=document.getElementById("spreadR"),kotobee.dispatchEvent("chapterLoaded",t))),scorm.setBookmark(currentIndex);var o={};o.id="chapter-"+currentIndex,o.description="View chapter: "+stg.data.book.chapter.title,o.learnerResponses="Viewed",o.type="other",o.timestamp=new Date,scorm.setInteractions([o]),events.add({action:"chapterViewed",param:stg.data.book.chapter.title,data:currentIndex}),T()}}function T(){var e=(new Date).getTime(),t=(e-a)/1e3;0!=t&&stg.data.book&&(events.add({action:"activeTime",param:t,data:{title:stg.data.book.chapter.title,index:currentIndex}}),a=e)}function O(){skeleton.isFirstChapter({first:i},function(t){skeleton.isLastChapter({last:o},function(e){Vue.set(stg.data.book.chapter,"notLastChapter",!e),Vue.set(stg.data.book.chapter,"notFirstChapter",!t),$rootScope.$$phase||$rootScope.$apply()})})}function A(){timeOut(function(){kStatus.update(null)},1e3)}function N(e,t,n){khttp.get(cacheBust(e)).success(function(e){config.kotobee.encodekey&&!kInteractive.isSDK()&&(e=1.1<=config.v?CryptoJS.AES.decrypt(e,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,e)),e=(e=e.replace(/<br\s*?\/>/g,"<br>")).replace(/(<)([^ >]+)([^>]*?)(\/>)/g,"$1$2$3></$2>"),t&&t(e)}).error(function(e,t){n&&n()})}v.busy=!0,v.maxIndex=null,v.initialize=function(s){if(document.getElementById("chaptersInner")){u||(u=!0,function(){var e,t;window.onpageshow=window.onfocus=function(){a=(new Date).getTime()},window.onpagehide=window.onblur=function(){T()},void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange");document.addEventListener(t,function(){document[e]?T():a=(new Date).getTime()},!1)}()),config.firstDoublePage||(config.firstDoublePage=0),null==stg.data.settings.pageScroll&&(stg.data.settings.pageScroll=!0),context.initialize(),$injector.get("annotations").reset(),a=(new Date).getTime(),currentIndex=null,Vue.set(stg.data,"currentPageOb",null),v.maxIndex=stg.data.epub.spine.getElementsByTagName("itemref").length,o=v.maxIndex;for(var e=stg.data.epub.spine.getElementsByTagName("itemref"),t=e.length;t--;)if(!e[t].hasAttribute("linear")||"no"!=e[t].getAttribute("linear")){o=t+1;break}for(t=i=0;t<e.length;t++)if(!e[t].hasAttribute("linear")||"no"!=e[t].getAttribute("linear")){i=t;break}v.displayTOC(),backend.addBookStat({type:"view"}),r||(translit.addListener(function(){var e=document.getElementById("chaptersInner");e&&replaceHTML(e,stg.data.book.chapters?stg.data.book.chapters:'<h5 class="panelEmpty"><i class="icon kb-notice vAlignMiddle size20"></i><span class="hSpace5"></span>'+translit.get("noTOC")+"</h5>")}),r=!0);for(var n=document.getElementById("chaptersInner").getElementsByClassName("restricted"),t=0;t<n.length;t++)n[t].addEventListener("click",function(e){var t={ch:e.currentTarget.textContent,chIndex:e.currentTarget.getAttribute("data-index"),currentCh:stg.data.book.chapter.title};events.add({action:"restrictedTocClicked",param:JSON.stringify(t)})});$filter("bookSetup")(),v.showLoader(),v.resetPages(),v.preloadEdgeChapters(function(){var r=0,a=0;if(null!=v.startChapter){var e=v.getRedirectUrl(v.startChapter,{hash:v.startHash,vIndex:v.startVIndex});return $location.path(e),v.hideLoader(),void($rootScope.$$phase||$rootScope.$apply())}stg.readSlot("lastLoc"+stg.getBookId(),function(i){stg.readSlot("lastLocY"+stg.getBookId(),function(e){config.preserveLoc&&"app"!=config.kotobee.mode&&(r=i?Number(i):0,a=e?Number(e):0),stg.data.user&&null!=stg.data.user.lastchap&&(r=Number(stg.data.user.lastchap));var t=scorm.getBookmark();t&&(r=Number(t)),null!=s&&(r=s);var n={};a&&(n.scroll=a);var o=v.loadChapterByIndex(r,n);o&&o.then&&o.then(function(){v.hideLoader()})})})})}else setTimeout(v.initialize,50)},v.displayTOC=function(){var e=document.getElementById("chaptersInner");e&&(replaceHTML(e,stg.data.book.chapters?stg.data.book.chapters:'<h5 class="panelEmpty"><i class="icon kb-notice vAlignMiddle size20"></i><span class="hSpace5"></span>'+translit.get("noTOC")+"</h5>"),stg.data.book.meta&&cache.setOb("title",replaceHTML(cache.getOb("title"),stg.data.book.meta.dc.title)))},v.preloadEdgeChapters=function(t){v.getPageOb({page:i,source:"preloadEdgeChapters"},function(e){v.getPageOb({page:o-1,source:"preloadEdgeChapters"},function(e){c=s=null,e.pages&&(s=e.pages.length)<=1?v.getPageOb({page:o-2,source:"preloadEdgeChapters2"},function(e){e.pages&&(c=e.pages.length),t()}):t()})})},v.displayChapters=function(){var e;stg.data.widescreen&&!config.notebookTab||((e=$ionicSideMenuDelegate.$getByHandle("menus"))._instances[0].left.width=e._instances[0].right.width=$ionicSideMenuDelegate.menuWidth,e._instances[0].left.el.style.width=e._instances[0].right.el.style.width="330px",stg.data.widescreen&&(stg.data.settings.rtl?(e._instances[0].right.width=480,e._instances[0].right.el.style.width="480px"):(e._instances[0].left.width=480,e._instances[0].left.el.style.width="480px")),mobile&&$injector.get("nav").resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleRight():$ionicSideMenuDelegate.toggleLeft(),native&&crdv.vibrate())},v.clearCache=function(){p=[]},v.neverCache=function(e){e&&(k(e.url)||n.push(e.url))},v.hideLoader=function(){var e=document.getElementById("ebookLoaderAnim");e&&addClass(e,"hide")},v.showLoader=function(){var e=document.getElementById("ebookLoaderAnim");e&&removeClass(e,"hide")},v.addListener=function(e){b.push(e)},v.removeListener=function(e){for(var t=b.length;t--;)b[t]==e&&b.splice(t,1)},v.redirectToHashPage=function(i,e){var r,a=e.leftOb;a.pages&&a.pages.length&&(r=parseHtml(a.raw?a.raw:a.content),$filter("contentVirt")("parse",r.getElementById("epubContent"),function(){var e,t,n,o=r.getElementById(i);o||(e=r.getElementsByName(i)).length&&(o=e[0]),o&&(t=traverser.convertElemsToLocation([o],r.getElementById("epubContent")).left,n=traverser.getPageByLocation(a,t),v.loadChapterByIndex(a.index,{hash:i,vIndex:n}))}))},v.getRedirectUrl=function(e,t){t=t||{};var n=$injector.get("book").root+"/reader/chapter/"+e;return t.hash&&(n+="/"+t.hash),t.vIndex&&(n+="?vi="+t.vIndex),n},v.redirect=function(e,t){t=t||{};var n=v.getRedirectUrl(e,t);v.getCurrentHash();$location.path(n);try{document.dispatchEvent(new Event("kotobeeBeforeChapterLoaded"))}catch(e){}kotobee.dispatchEvent("beforeChapterLoaded"),kotobee.dispatchEvent("kotobeeBeforeChapterLoaded"),$rootScope.$$phase||$rootScope.$apply()},v.getCurrentHash=function(){var e=$location.path().replace(/\?.*/g,"").split("/"+currentIndex+"/");if(!(e.length<2))return e[1]},v.loadLocation=function(a,e){var s=$q.defer();e=e||{};var n=!a.match(/[^0-9.]/g);return v.showLoader(),v.getPageOb({page:e.index},function(i){if(!i.pages||!i.pages.length){if(n){var e=traverser.getElemsByLocation(a);if(!e[0])return s.resolve();virt.safeScrollToElem("content",e[0],!0)}else virt.safeAnchorScroll("content",a,!0);return v.hideLoader(),s.resolve()}if(n){var t=traverser.getPageByLocation(i,a);return v.loadChapterByIndex(i.index,{vIndex:t}),s.resolve()}var r=parseHtml(i.raw?i.raw:i.content);$filter("contentVirt")("parse",r.getElementById("epubContent"),function(){var e,t,n=r.getElementById(a);n||(t=r.getElementsByName(a)).length&&(n=t[0]),n&&(e=traverser.convertElemsToLocation([n],r.getElementById("epubContent")).left);var o=0;return e&&(o=traverser.getPageByLocation(i,e)),v.loadChapterByIndex(i.index,{vIndex:o}),s.resolve()})}),s.promise},v.indexFromUrl=function(e,t){var n;if(t=t||{},e){var o=ph.getHash(e);t.hash&&(o=t.hash),e=ph.removeHash(ph.normalize(e));for(var i=stg.data.epub.manifest.getElementsByTagName("item"),r=0;r<i.length;r++)if(ph.removeHash(ph.normalize(i[r].getAttribute("href")))==e){n=i[r].getAttribute("id");break}i=stg.data.epub.spine.getElementsByTagName("itemref");for(var a,s=t.order?t.order:1,r=0;r<i.length;r++)if(i[r].getAttribute("idref")==n&&i[a=r].getAttribute("id")==o){if(--s)continue;return r}return a}},v.arePagesAppearingTogether=function(t,n,o){var i=v.getCurrentView(n.index),r=t.vIndex;r<0&&t.pages&&t.pages.length&&(r+=t.pages.length),isNaN(r)&&(r=null);var e,a,s,c=n.vIndex;if(c<0&&n.pages&&n.pages.length&&(c+=n.pages.length),isNaN(c)&&(c=null),n.index==t.index&&n.vIndex==t.vIndex)return o(!0);e=t.index,a=t.vIndex,s=function(e){if(function(e,t){if(e.index>t.first.index&&e.index<t.last.index)return!0;if(t.first.index==t.last.index&&e.index==t.first.index){if(e.vIndex>t.first.vIndex&&e.vIndex<t.last.vIndex)return!0}else{if(e.index==t.first.index&&e.vIndex>t.first.vIndex)return!0;if(e.index==t.last.index&&e.vIndex<t.last.vIndex)return!0}}(n,e))return o(!0);if("double"!=i.view)return o();if("rfl"==t.layout){if(t.index==n.index&&r==c+1)return o(!0);if(n.pages&&1==n.pages.length&&t.index==n.index+1&&0==r)return o(!0)}return"fxl"==t.layout&&t.index==n.index+1?o(!0):o()},skeleton.getNextLinearIndex({index:e,vIndex:a},function(t){skeleton.getPrevLinearIndex({index:e,vIndex:a},function(e){t.leftOb.index,e.leftOb.index;s({first:e.leftOb,last:t.leftOb})})})},v.getNextIndexOld=function(t,n){var o={},e=v.getCurrentView(t.index);if(o.leftOb={index:t.index+1,vIndex:0},t.vIndex||(t.vIndex=0),"double"==e.view)if(o.double=!0,"rfl"==t.layout)if(2<=t.pages.length-1-t.vIndex)o.leftOb.index=t.index,o.leftOb.vIndex=t.vIndex+2;else{if(t.pages.length-1-t.vIndex!=1)return void v.getPageOb({page:t.index+1,source:"getNextIndex"},function(e){1==e.pages.length?(o.leftOb.vIndex=0,o.leftOb.index=t.index+2):(o.leftOb.vIndex=1,o.leftOb.index=t.index+1),n(o)});o.leftOb.index=t.index+1,o.leftOb.vIndex=0}else o.leftOb.index++;else"rfl"!=t.layout||stg.data.settings.pageScroll||(1<=t.pages.length-1-t.vIndex?(o.leftOb.index=t.index,o.leftOb.vIndex=t.vIndex+1):(o.leftOb.index=t.index+1,o.leftOb.vIndex=0));return n(o),o},v.getElemChapterIndex=function(e,t){var n;return t=t||{},"single"==stg.data.currentView||traverseToTop(e,"spreadL")?n=currentIndex:traverseToTop(e,"spreadR")&&(n=stg.data.currentRPageOb.index),t.ignoreAnchors&&(n=v.getUnanchoredIndex(n)),n},v.getElemChapterTitle=function(e){return"single"!=stg.data.currentView&&!traverseToTop(e,"spreadL")&&traverseToTop(e,"spreadR")?stg.data.currentRPageOb.title:stg.data.currentPageOb.title},v.getElemChapterFilename=function(e){return"single"!=stg.data.currentView&&!traverseToTop(e,"spreadL")&&traverseToTop(e,"spreadR")?ph.relative(ph.join(bookPath,stg.data.packageURL),stg.data.currentRPageOb.url):stg.getChapterFilename()},v.getUnanchoredIndex=function(e){var t=v.getChapterURL(e);if(t)return t=ph.removeHash(t),v.indexFromUrl(t)},v.getNextIndex=function(e,t){var n=v.getCurrentView(e.index,{vIndex:e.vIndex});y(e,function(e){return e?void("double"!=n.view||e.leftOb.index>=o-1?t(e):y(e.leftOb,t)):t()})},v.getPrevIndexOld=function(t,n){var o={};o.leftOb={index:t.index-1,vIndex:0},t.vIndex||(t.vIndex=0);if("double"==v.getCurrentView(t.index-1,{}).view)if(o.double=!0,config.firstDoublePage||(config.firstDoublePage=0),"rfl"==t.layout)if(1<t.vIndex)o.leftOb.index=t.index,o.leftOb.vIndex=t.vIndex-2,o.leftOb.index<config.firstDoublePage&&o.leftOb.vIndex++;else{if(1!=t.vIndex)return void v.getPageOb({page:t.index-1,source:"getPrevIndex"},function(e){1==e.pages.length?(o.leftOb.index=t.index-2,o.leftOb.vIndex=-1,o.leftOb.index<config.firstDoublePage&&(o.leftOb.index=t.index-1,o.leftOb.vIndex=0)):(o.leftOb.index=t.index-1,o.leftOb.vIndex=t.vIndex-2,o.leftOb.index<config.firstDoublePage&&(o.leftOb.vIndex=t.vIndex-1)),n(o)});o.leftOb.index=t.index-1,o.leftOb.vIndex=-1,o.leftOb.index<config.firstDoublePage&&(o.leftOb.index=t.index,o.leftOb.vIndex=0)}else o.leftOb.index=t.index-2,o.leftOb.index<config.firstDoublePage&&(o.leftOb.index=t.index-1);else"rfl"!=t.layout||stg.data.settings.pageScroll||(0<t.vIndex?(o.leftOb.index=t.index,o.leftOb.vIndex=t.vIndex-1):(o.leftOb.index=t.index-1,o.leftOb.vIndex=-1));return n(o),o},v.getPrevIndex=function(e,t){w(e,function(e){"double"!=v.getCurrentView(e.leftOb.index,{vIndex:e.leftOb.vIndex}).view||e.leftOb.index<=i?t(e):w(e.leftOb,t)})},v.nextChapter=function(n,o){n=n||{},skeleton.isLastChapter(null,function(e){e?crdv.toast(translit.get("inLastChapter")):(context.interruptAnimation(),skeleton.getNextIndex({index:currentIndex,vIndex:currentVIndex},function(e){if(!e)return null;if(e.leftOb.index=context.nextLinearIndex(e.leftOb.index),n.skipRestricted&&x(e.leftOb.index))return currentIndex=e.leftOb.index,v.nextChapter(n,o);e.leftOb.index>=stg.data.epub.spine.getElementsByTagName("itemref").length-1&&crdv.toast(translit.get("inLastChapter"));var t=stg.data.epub.spine.getElementsByTagName("itemref")[e.leftOb.index].getAttribute("id");$rootScope.renderScope.applyHeader("default"),null!=e.leftOb.vIndex&&(t=null),v.redirect(e.leftOb.index,{hash:t,vIndex:e.leftOb.vIndex}),$rootScope.$$phase||$rootScope.$apply(),o&&o(e)}))})},v.prevChapter=function(o,i){o=o||{},skeleton.isFirstChapter(null,function(e){e?crdv.toast(translit.get("inFirstChapter")):(context.interruptAnimation(),skeleton.getPrevIndex({index:currentIndex,vIndex:currentVIndex},function(e){e.vIndex;if(e.leftOb.index<0&&(e.leftOb.index=0),e.leftOb.index=context.prevLinearIndex(e.leftOb.index),o.skipRestricted&&x(e.leftOb.index))return currentIndex=e.leftOb.index,v.prevChapter(o,i);e.leftOb.index<0&&crdv.toast(translit.get("inFirstChapter"));var t=stg.data.epub.spine.getElementsByTagName("itemref")[e.leftOb.index];$rootScope.renderScope.applyHeader("default");var n=t.getAttribute("id");null!=e.leftOb.vIndex&&(n=null),v.redirect(e.leftOb.index,{hash:n,vIndex:e.leftOb.vIndex}),$rootScope.$$phase||$rootScope.$apply(),i&&i(e)}))})},v.getCurrentView=function(e,t){var n=(t=t||{}).returnType;if(null!=e){var o=skeleton.getCurrentView(e,t);if(o)return r(o);if(e<config.firstDoublePage)return r({view:null,index:e});var i=stg.data.settings.viewMode;return"single"==i?r({view:null,index:e,scroll:stg.data.settings.pageScroll}):"double"!=i?"auto"==i?"left"==C(e)&&"right"==C(e+1)?r({view:"double",index:e}):"right"==C(e)&&"left"==C(e-1)?r({view:"double",index:e-1}):r({view:null,index:e,scroll:stg.data.settings.pageScroll}):r({view:null,index:e,scroll:stg.data.settings.pageScroll}):config.singleViewOnPortrait&&1.3*window.innerWidth<window.innerHeight?r({view:null,index:e}):r(skeleton.isSingle(e,t.vIndex)?{view:null,index:e}:{view:"double",index:e})}function r(e){return e.view||(e.view="single"),"view"==n?(t.cb&&t.cb(e.view),e.view):"page"==n?(t.cb&&t.cb(e.page),e.page):(t.cb&&t.cb(e),e)}},v.loadChapterByIndex=function(i,r){var a=(a=(r=r||{}).deferred)||$q.defer();return null==i&&(i=currentIndex),i<0?(a.resolve(),a.promise):(i>v.maxIndex&&(i=v.maxIndex-1),x(i)?(currentIndex=i,v.nextChapter({skipRestricted:!0})):(v.showLoader(),v.getPageOb({page:i,source:"loadChapterByIndex"},function(o){return o?void v.getSurroundingPages({index:o.index,vIndex:r.vIndex},function(){v.hideLoader();var e={index:i,vIndex:r.vIndex};if(skeleton.normalize(e),!r.hash&&(e.index!=i||null!=e.vIndex&&e.vIndex!=r.vIndex))return v.loadChapterByIndex(e.index,{hash:r.hash,vIndex:e.vIndex,reload:r.reload,deferred:a}),a.promise;var n=v.getChapterURL(i),t=!1;if(0==n.indexOf("#")&&(t=!0),r.hash&&o.pages&&o.pages.length&&(t=!0),t)return v.loadLocation(r.hash,{index:i,source:"from loadChapterByIndex"}).then(function(e){});r.leftOb=o,r.leftOb.index=i,r.leftOb.currentVIndex=r.leftOb.vIndex,r.leftOb.vIndex=r.vIndex,asyncCheck(!(o.pages&&r.leftOb.vIndex>=o.pages.length-1),v.getPageOb,[{page:i+1,source:"loadChapterByIndex"}],function(){v.planPageMapping(r,function(e){if((e=e||{}).redirect)return v.redirect(e.redirect.index,{hash:r.hash,vIndex:r.vIndex,reload:r.reload,deferred:a}),a.promise;if(r.deferred=null,stg.data.currentPageOb||Vue.set(stg.data,"currentPageOb",r.leftOb),v.urlMatchesIndex(n,currentIndex)&&!r.reload&&currentVIndex==r.vIndex){currentIndex=i,O();var t=r.hash;return(t=t||ph.getHash(r.leftOb.url))?v.loadLocation(t,{index:currentIndex,source:"from loadChapterByIndex2"}).then(function(){v.highlightCurrentTocChapter()}):($ionicScrollDelegate.$getByHandle("content").scrollTop(!0),v.highlightCurrentTocChapter()),Vue.set(stg.data.book.chapter,"url",n),Vue.set(stg.data.book.chapter,"absoluteURL",ph.join(bookPath,stg.data.packageURL,stg.data.book.chapter.url)),a.resolve(),a.promise}context.startTransition(r,a)})})}):v.loadChapterByIndex(0,r)}),a.promise))},v.getSurroundingPages=function(e,t){if("single"==stg.data.settings.viewMode)return t();if(!e)return t();var n=skeleton.getJoint(e.index,e.vIndex);if(n&&1<n.length)return v.getPageOb({page:e.index-1},t);asyncCheck(n,v.getPageOb,[{page:e.index}],function(){v.getPageOb({page:e.index+1},function(){v.getPageOb({page:e.index-1},t)})})},v.planPageMapping=function(t,e){var n=v.getCurrentView(t.leftOb.index,{vIndex:t.leftOb.vIndex});if(n.index==t.leftOb.index)if(v.shouldBePaged(t.leftOb)||"double"==n.view)if(t.view="double",t.rightOb||(t.rightOb={}),"fxl"==t.leftOb.layout){v.getChapterURL(t.leftOb.index+1)?(t.rightOb.index=t.leftOb.index+1,t.rightOb.url=ph.join(bookPath,stg.data.packageURL,v.getChapterURL(t.leftOb.index+1))):t.rightOb=null,r()}else{if(t.rightOb.url=t.leftOb.url,t.leftOb.viewport=$injector.get("spread").getViewport(t.leftOb),t.vIndex=Number(t.vIndex),isNaN(t.vIndex)&&(t.vIndex=0),t.leftOb.vIndex=t.vIndex,t.vIndex<0||t.vIndex>=t.leftOb.pages.length){var o=0;return t.vIndex<0&&(o=t.vIndex),t.vIndex=t.leftOb.pages.length+o,t.leftOb.vIndex=t.leftOb.pages.length+o,t.rightOb.vIndex=t.leftOb.vIndex+1,t.rightOb.index=t.leftOb.index,void e({redirect:{index:n.index}})}if(t.leftOb.content=t.leftOb.pages[t.vIndex].content,"single"==n.view)return t.rightOb=null,void r();if(t.vIndex+1<t.leftOb.pages.length)t.rightOb=clone(t.leftOb),t.rightOb.vIndex=t.vIndex+1,t.rightOb.index=t.leftOb.index,t.rightOb.content=t.leftOb.pages[t.rightOb.vIndex].content,r();else{if(t.leftOb.index>=v.maxIndex-1)return t.rightOb=null,void r();t.rightOb.index=t.leftOb.index+1;var i=v.getChapterURL(t.rightOb.index);v.getPageOb({page:t.rightOb.index},function(e){t.rightOb=e,t.rightOb.vIndex=0,t.rightOb.url=ph.join(bookPath,stg.data.packageURL,i),t.rightOb.pages&&t.rightOb.pages.length&&(t.rightOb.content=t.rightOb.pages[0].content),t.rightOb.viewport=$injector.get("spread").getViewport(t.rightOb),r()})}}else t.view="single","fxl"!=t.leftOb.layout&&(t.leftOb.viewport=null),t.leftOb.raw&&(t.leftOb.content=t.leftOb.raw),r();else e({redirect:{index:n.index}});function r(){e&&e({url:t.leftOb.url})}},v.getCacheOrPreload=I,v.currentUrlMatchesVIndex=function(e){return getQueryStringValue("vi")==e},v.urlMatchesIndex=function(e,t){if(null!=t){e=ph.normalize(e);ph.getHash(e);var n,o=ph.removeHash(e),i=stg.data.epub.spine.getElementsByTagName("itemref")[t];if(i){for(var r=stg.data.epub.manifest.getElementsByTagName("item"),a=0;a<r.length;a++)r[a].getAttribute("id")==i.getAttribute("idref")&&(n=r[a].getAttribute("href"));return!!n&&ph.removeHash(ph.normalize(n))==ph.removeHash(ph.normalize(o))}}},v.applyChapterStateFromURL=function(e,t){var n,o;t=t||{},0!=e.indexOf("#")?(n=ph.getHash(e),null!=(o=t.index?t.index:v.indexFromUrl(e))&&($rootScope.renderScope.applyHeader("default"),v.redirect(o,{hash:n,vIndex:t.vIndex}),$rootScope.$$phase||$rootScope.$apply())):v.redirect(currentIndex,{hash:e.substr(1)})},v.loadChapterByURL=function(n,o){var e=ph.relative(ph.join(bookPath,stg.data.packageURL),n.leftOb.url);n=n||{};var t=$q.defer(),i=n.hash?n.hash:ph.getHash(e),r=n.leftOb.index;if(0==e.indexOf("#")&&(i=e.substr(1)),null!=r){if(!n.reload&&v.urlMatchesIndex(e,currentIndex)&&currentVIndex==n.vIndex)return currentIndex=r,O(),i?(o&&o(),v.loadLocation(i,{index:currentIndex,source:"from loadChapterByUrl"})):(vueApp.$route.params.hash&&$ionicScrollDelegate.$getByHandle("content").scrollTop(!0),t.resolve(),o&&o(),t.promise);desktop&&require("nw.gui").App.clearCache(),kInteractive.clearAudioVideo(document),currentVIndex=n.vIndex;var a=v.getCurrentView(r,{vIndex:currentVIndex});stg.data.currentView=a.view,m=null==currentIndex;var s,c=currentIndex;return currentIndex=r=a.index,O(),Vue.set(stg.data,"currentPageOb",n.leftOb),Vue.set(stg.data,"currentRPageOb",n.rightOb),delete n.leftOb.currentVIndex,!mobile||(s=$ionicScrollDelegate.$getByHandle("content"))&&s.resize(),v.busy=!0,cache.getOb("epubContainer").style.pointerEvents="none",v.loadChapterByURLRaw(n).then(function(e){var t;v.busy=!1,!n.scroll||(t=$ionicScrollDelegate.$getByHandle("content"))&&t.scrollTo(0,n.scroll,!1),config.kotobee.cloudid&&(config.kotobee.public||backend.setLastChapter()),setTimeout(function(){virt.reset(n.scroll?n.scroll:0,function(){cache.getOb("epubContainer").style.pointerEvents=null,i?v.loadLocation(i,{index:currentIndex,source:"loadChapterByURLRaw"}).then(function(){!m&&currentIndex==c||(v.disableJsLoading||jsParser.replaceScript(e||[]),kInteractive.postRender(document)),S("renderedChapter"),v.highlightCurrentTocChapter(),A(),E(),o&&o()}):(v.disableJsLoading||jsParser.replaceScript(e||[]),kInteractive.postRender(document),S("renderedChapter"),v.highlightCurrentTocChapter(),A(),E(),o&&o())},30)})})}o&&o()},v.cacheLookup=function(e,t){if(!k(e))for(var n=0;n<p.length;n++)if(p[n].url==ph.removeHash(e)){var o=p[n];return p.splice(n,1),p.push(o),o}},v.removeFromCache=function(e,t){for(var n=0;n<p.length;n++)if(p[n].url==ph.removeHash(e)&&p[n].view==t)return void p.splice(n,1)},v.addToCache=function(e,t){var n;t=t||{},e.url=ph.removeHash(e.url),k(e.url)||((n=v.cacheLookup(e.url,e.view))?t.update&&(n.url=e.url,n.title=e.title,n.viewport=e.viewport,n.content=e.content,n.layout=e.layout,n.styles=e.styles,e.script&&(n.script=e.script)):(20<p.length&&p.shift(),t.lowPriority?p=[e].concat():p.push(e)))},v.loadChapterByURLRaw=function(u){u=u||{};var e=ph.relative(ph.join(bookPath,stg.data.packageURL),u.leftOb.url),p=$q.defer();Vue.set(stg.data.book.chapter,"url",e),Vue.set(stg.data.book.chapter,"absoluteURL",ph.join(bookPath,stg.data.packageURL,stg.data.book.chapter.url));ph.getHash(stg.data.book.chapter.url);virt.disable(),virt.lock(),kStatus.update(null);var h=[];return function(t){var n;if(n=v.cacheLookup(stg.data.book.chapter.absoluteURL,"single"))return copyObjToObj(n,t.leftOb,{onlyIfNotExists:!0}),t.leftOb.cached=!0,i();var o={showError:!0,deferred:p,view:t.view,id:t.id,view:null};function i(){var e;"single"!=t.view&&t.rightOb?(e=t.rightOb.url,(n=v.cacheLookup(e,"single"))?(copyObjToObj(n,t.rightOb,{onlyIfNotExists:!0}),t.rightOb.cached=!0,r(t)):v.preloadChapter(e,o,function(e){copyObjToObj(e,t.rightOb,{onlyIfNotExists:!0}),r(t)})):r(t)}v.preloadChapter(stg.data.book.chapter.absoluteURL,o,function(e){copyObjToObj(e,t.leftOb,{onlyIfNotExists:!0}),i()})}(u),p.promise;function r(i){var r=(i=i||{}).leftOb.title,a=(i.leftOb.content,i.leftOb.bodyClass),s=i.leftOb.viewport,e=(i.leftOb.styles,i.leftOb.script,i.leftOb.layout),c=i.isCached,l=i.leftOb,d=i.rightOb;l&&(h=h.concat(l.script)),d&&(h=h.concat(d.script)),makeArrayUnique(h),r=r||l.title,Vue.set(stg.data.book.chapter,"title",r),Vue.set(stg.data.book.chapter,"viewport",s),Vue.set(stg.data.book.chapter,"layout",e),Vue.set(stg.data.book.chapter,"view",i.view),Vue.set(stg.data.book.chapter,"paged",v.shouldBePaged(l)),O(),Vue.nextTick(function(){tinCan.send({verb:"navigated",activity:(currentIndex?"Chapter "+currentIndex+": ":"")+r}),mobile||!m&&Boolean(s)==Boolean(stg.data.book.chapter.viewport)||$injector.get("nav").resetEpubContainer(s);var e=document.getElementById("epubInner");i.source="from chapters",pauseVideoAndAudio(context.populateSpreads(e,i)),cache.setOb("epubContent",document.getElementById("epubContent")),cache.getOb("epubContainer").focus(),c||context.setContentSize(cache.getOb("epubContent"),u),a&&addClass(cache.getOb("epubContent").getElementsByTagName("section")[0],a);var t=document.getElementById("chapters");removeClass(t,["rfl","fxl","double","single"]),addClass(t,stg.data.book.chapter.viewport?"fxl":"rfl"),addClass(t,i.view),(stg.data.book.chapter.paged?addClass:removeClass)(t,"paged");var n=cache.getOb("epubContainer");removeClass(n,["rfl","fxl","double","single"]),addClass(n,stg.data.book.chapter.viewport?"fxl":"rfl"),addClass(n,i.view),(stg.data.book.chapter.paged?addClass:removeClass)(n,"paged"),chapters.disableCssLoading||(c||(cssParser.replaceStyles(""),cssParser.replaceStyles(l.styles.replace(/#spreadR/g,"#spreadL"),{append:!0}),d&&d.viewport&&cssParser.replaceStyles(d.styles.replace(/#spreadL/g,"#spreadR"),{append:!0})),cssParser.replaceStyles("#epubContainer div#epubContent, #epubContainer.stylesEnabled div#epubContent { background-color:#e7e3d9 !important;}",{append:!0})),config.preserveLoc&&"app"!=config.kotobee.mode&&stg.writeSlot("lastLoc"+stg.getBookId(),currentIndex),stg.writeSlot("lastLocY"+stg.getBookId(),0);for(var o=0;o<b.length;o++)b[o]("newChapter");$filter("contentJs")(c).then(function(){selection.reset(),virt.unlock(),p.resolve(h)})})}},v.preloadChapterFromApi=function(e,t){return v.preloadChapter(ph.join(bookPath,stg.data.packageURL,e),{},t)},v.loadAndDecrypt=function(e,t,n){return N(ph.join(bookPath,stg.data.packageURL,e),t,n)};var t,L,B,M=[];function R(e,t){var n=(e=e||{}).first,o=e.page,i=e.vIndex;null==o&&(o=currentIndex),null==i&&(i=currentVIndex),"single"==v.getCurrentView(o,{vIndex:i}).view?v.shouldBePaged(e.page?e:stg.data.currentPageOb)?t(o<=n&&0==currentVIndex):t(o<=n):stg.data.currentPageOb.pages?t(o<=n&&0==currentVIndex):t(o<=n)}function P(e,t){var n=(e=e||{}).max,o=e.page,i=e.vIndex,r=e.view;return null==o&&(o=currentIndex,i=currentVIndex,r=v.getCurrentView(o,{returnType:"view"})),"single"==r?(null==e.index&&(e.index=e.page),v.shouldBePaged(null!=e.page?e:stg.data.currentPageOb,r)?a(n-1<=o&&s-1<=i):a(n-1<=o)):a(n-1<=o?!s||s-2<=i:n-2<=o&&(!(s&&c-1<=i)||s<=1));function a(e){return t&&t(e),e}}function D(){var e=ph.removeHash(window.location.href),t=document.getElementsByTagName("base");if(t.length)for(var n=0;n<t.length;n++)if(t[n].getAttribute("href")){e=window.location.origin+"/"+t[n].getAttribute("href");break}return 0<=e.indexOf("chrome-extension://")||isAbsoluteURLPath(stg.data.book.chapter.absoluteURL)?stg.data.book.chapter.absoluteURL:"/"==stg.data.book.chapter.absoluteURL[0]?getDomainFromURL(e)+stg.data.book.chapter.absoluteURL:ph.join(e,stg.data.book.chapter.absoluteURL)}function $(){return"library"==config.kotobee.mode?stg.data.paths.private+"books/"+stg.data.book.chapter.absoluteURL.split("/books/")[1]:stg.data.paths.private+stg.data.book.chapter.absoluteURL.substr(1)}return v.preloadChapter=function(g,f,m){var e={func:arguments.callee,args:arguments};f=f||{},M.push(g),N(g,function(e){var a=parseHtml(e),s="",t=a.getElementsByTagName("body");t.length&&(s=t[0].className);for(var c=$filter("contentHtml")(a,g),n=a.getElementsByTagName("meta"),l=null,o=0;o<n.length;o++){var i=n[o].getAttribute("name");if(i&&"viewport"==i.toLowerCase()){l={};var r=n[o].getAttribute("content");if(!r)break;for(var d=r.split(","),u=0;u<d.length;u++){var p=d[u].split("=");p[1]&&(p[1]=p[1].replace("px",""),l[p[0].trim()]=Number(p[1].trim()))}l.width||l.height||(l=null)}}var h=l?"fxl":"rfl";$filter("js")(a).then(function(r){$filter("styles")(a,{path:g,id:f.id}).then(function(e){var t,n,o=a.getElementsByTagName("title");o.length?t=o[0].textContent.trim():(n=a.getElementsByTagName("h1")).length&&(t=n[0].textContent.trim()),t=t||stg.data.book.meta.dc.title;var i={url:g,title:t,bodyClass:s,viewport:l,layout:h,content:c.outerHTML,styles:e,script:r};f.dontCache||v.addToCache(i,f),removeFromArray(g,M),m&&m(i)})})},function(){removeFromArray(g,M),f.showError&&(kError.update({error:"networkError",ref:e}),f.deferred&&f.deferred.reject({}),A())})},v.clearContent=function(){document.getElementById("epubInner")&&replaceHTML("epubInner",""),T()},v.getChapterURL=function(e){var t;null==e&&(e=currentIndex),e<0&&(e=0);try{var n=stg.data.epub.spine.getElementsByTagName("itemref");if(e>=n.length)return;t=n[e]}catch(e){}var o=getElementsByAttribute(stg.data.epub.manifest,"item","id",t.getAttribute("idref"))[0].getAttribute("href"),i=t.getAttribute("id");return i&&(o+="#"+i),o},v.isFirstChapter=function(e){R({first:0},e)},v.isFirstVisibleChapter=function(e){R({first:i},e)},v.isLastChapter=function(e){return P({max:v.maxIndex},e)},v.isLastVisibleChapter=function(e){return P({max:o},e)},v.isLastVisibleSingleChapter=function(e,t,n){return P({max:o,page:e,vIndex:t,view:"single"},n)},v.getPageOb=function(e,n){var o=(e=e||{}).page;null==o&&(o=currentIndex);var t=v.getChapterURL(o);if(!t)return n?n():null;I(ph.join(bookPath,stg.data.packageURL,t),{},function(t){return t.index=o,"fxl"==t.layout&&(t.spread=C(t.index)),t.nonlinear=function(e){if(stg.data.epub.spine){var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];return t?"no"==t.getAttribute("linear"):void 0}}(t.index),t.pages||"fxl"==t.layout||!v.shouldBePaged(t)||e.dontParse?(skeleton.add(t),n?n(t):null):void $injector.get("spread").parseReflowableChapter(t,function(e){return t.pages=e.pages,t.raw=e.raw,skeleton.add(t),n?n(t):null})})},v.shouldBePaged=function(e,t){return(!e||"fxl"!=e.layout)&&("double"==stg.data.settings.viewMode||("single"==stg.data.settings.viewMode?!stg.data.settings.pageScroll:(!t&&e&&(t=v.getCurrentView(e.index).view),"single"!=t||!stg.data.settings.pageScroll)))},v.convertPDF=function(){var e,t={func:arguments.callee,args:arguments};function n(u){(u=u||{}).scale||(u.scale=100),u.range||(u.range="chapter");var p=D();isKotobeeHosted()&&config.kotobee.cloudid&&!config.kotobee.public&&(p=$()),-1!=window.location.href.indexOf("http://localhost:8080/#/book/")&&(p=$());var e=stg.data.book.chapter.title,h={url:p,filename:e};kStatus.update(translit.get("pleaseWait"),null,{dots:!0,timeoutDuration:12e4}),backend.createRequest(config.kotobee.liburl+"library/pdf/status",{},function(e){return"converting"==e.status?(kStatus.update(),kStatus.showAndHide(translit.get("pdfInProgress"),2500)):void backend.createRequest(config.kotobee.liburl+"link/pdfgenerate/url",h,function(e){if(!e)return kStatus.update(),void kError.update({error:"networkError",ref:t});var d=e;asyncCheck(!u.includeNotes,stg.getHlights,[],function(l){asyncCheck(!u.includeNotes,stg.getNotes,[],function(e){g&&g.parentNode&&g.parentNode.removeChild(g),(g=document.createElement("iframe")).setAttribute("style","display:none"),g.setAttribute("name","pdfFrame"),document.body.appendChild(g),f&&f.parentNode&&f.parentNode.removeChild(f),(f=document.createElement("form")).setAttribute("style","visibility:hidden:position:absolute"),f.setAttribute("method","post"),f.setAttribute("action",d),f.setAttribute("target","pdfFrame"),addFormHiddenInput("url",p,f),addFormHiddenInput("filename",stg.data.book.chapter.title,f),addFormHiddenInput("fileext","pdf",f),addFormHiddenInput("scale",u.scale,f),addFormHiddenInput("range",u.range,f),u.includeNotes&&addFormHiddenInput("includenotes",!0,f);var t=backend.getAuthVars();for(var n in t)t[n]&&addFormHiddenInput(n,t[n],f);if("book"==u.range&&(stg.data.book.id?addFormHiddenInput("bid",stg.data.book.id,f):addFormHiddenInput("bookpath",bookPath.replace(/^.*\/(f\d*?)\/.*$/g,"$1"),f)),e){for(var o=0;o<e.length;o++){e[o]&&e[o].location&&(r=String(e[o].location).split(","),e[o].locationDec=Number("0."+addDigitsToArray(r[0].split("."),3).join("")))}e=e.sort(function(e,t){return e.locationDec>t.locationDec?1:-1});for(var i=[],o=0;o<e.length;o++)"book"!=u.range&&e[o].chapter!=currentIndex||i.push({chapter:e[o].chapter,note:e[o].note,src:e[o].src});addFormHiddenInput("notes",JSON.stringify(makeObjectArrayUnique(i)),f)}if(l){for(var r,o=0;o<l.length;o++){l[o]&&l[o].location&&(-1!=(r=String(l[o].location)).indexOf(",")&&(r=r.split(",")[0]),-1!=r.indexOf("-")&&(r=r.split("-")[0]),l[o].locationDec=Number("0."+addDigitsToArray(r.split("."),3).join("")))}l=l.sort(function(e,t){return e.locationDec>t.locationDec?1:-1});for(var a=[],o=0;o<l.length;o++)"book"!=u.range&&l[o].chapter!=currentIndex||a.push({chapter:l[o].chapter,color:l[o].color,src:l[o].src,location:l[o].location});addFormHiddenInput("hlights",JSON.stringify(makeObjectArrayUnique(a)),f)}addFormHiddenInput("format",config.pdfMode?config.pdfMode:"imgpdf",f);var s=config.kotobee.encodekey&&!kInteractive.isSDK();function c(){g&&g.parentNode&&g.parentNode.removeChild(g),f&&f.parentNode&&f.parentNode.removeChild(f),kStatus.update()}l&&l.length&&(s=!0),asyncCheck(!s,N,[stg.data.book.chapter.absoluteURL],function(e){s&&addFormHiddenInput("data",h.data=e,f),document.body.appendChild(f),setTimeout(function(){backend.validatePdfConversion(h,function(e){return e.error?(modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorConvertingPDF")}}),void c()):(f.submit(),void setTimeout(function(){var t=setInterval(function(){var e=d.replace(/(https?:\/\/.*?\/).*/g,"$1");backend.createRequest(e+"library/pdf/status",{},function(e){"converting"!=e.status&&(clearInterval(t),c())})},2e3)},4e3))})})})})})})})}preview?kError.update({error:"savePdfUnsupportedInPreview"}):desktop||native||(config.pdfsavingOptions||config.pdfbooksaving?(e={scale:100,range:"chapter",submit:function(){modals.hide(),n(e)}},modals.show({mode:"pdfSave",pdfSaveOptions:e})):n())},v.pdfPrintOld=function(){preview?kError.update({error:"savePdfUnsupportedInPreview"}):desktop||native||(kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),window.location.href="https://www.kotobee.com/link/pdfgenerate?url="+D(),setTimeout(function(){kStatus.update()},4e3))},v.printAsBitmap=function(){var i={func:arguments.callee,args:arguments};var r=D();isKotobeeHosted()&&config.kotobee.cloudid&&!config.kotobee.public&&(r=$());var a=stg.data.book.chapter.title,e={url:r,filename:a};kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),backend.createRequest(config.kotobee.liburl+"link/pdfgenerate/url",e,function(e){if(!e)return kStatus.update(),void kError.update({error:"networkError",ref:i});var t=e;function n(){try{var e=this.contentWindow;setTimeout(function(){e.__container__=this,e.focus(),e.print(),kStatus.update()},2500)}catch(e){kStatus.update()}}l&&l.parentNode&&l.parentNode.removeChild(l),(l=document.createElement("iframe")).setAttribute("style","display:none"),l.setAttribute("name","printFrame"),l.id="printContainer",l.style.visibility="hidden",l.style.position="fixed",l.style.right="0",l.style.bottom="0",document.body.appendChild(l),d&&d.parentNode&&d.parentNode.removeChild(d),(d=document.createElement("form")).setAttribute("style","visibility:hidden:position:absolute"),d.setAttribute("method","post"),d.setAttribute("action",t),d.setAttribute("target","printFrame"),addFormHiddenInput("url",r,d),addFormHiddenInput("filename",stg.data.book.chapter.title,d),addFormHiddenInput("fileext","pdf",d),addFormHiddenInput("print",!0,d),addFormHiddenInput("format","imghtml",d);var o=config.kotobee.encodekey&&!kInteractive.isSDK();asyncCheck(!o,N,[stg.data.book.chapter.absoluteURL],function(e){o&&addFormHiddenInput("data",e,d),document.body.appendChild(d);var t={url:r,filename:a};backend.validatePdfConversion(t,function(e){return e.error?v.print({force:!0}):(d.submit(),void setTimeout(function(){kStatus.update()},8e3))}),l.onload=n})})},v.print=function(e){native||mobile||(kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),closePrintIframe(),N(D(),function(e){var t=ph.removeFilename(D());e=(e=(e=e.replace("<head>","<head><meta http-equiv=\"Content-Security-Policy\" content=\"default-src * gap://ready file: filesystem: data:; style-src * 'self' 'unsafe-inline' filesystem: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' kotobee: https://*.amazonaws.com https://*.google.com https://*.googleapis.com https://*.youtube.com https://*.stripe.com https://*.paypal.com https://*.kotobee.com http://*.youtube.com https://*.ytimg.com http://*.ytimg.com;img-src * filesystem: data: blob: android-webview-video-poster:\">")).replace("<head>","<head><script> window.onload = function() { window.print(); setTimeout(parent.closePrintIframe,1000); }<\/script>")).replace("<head>","<head><base href='"+t+"/'/>");var n=document.createElement("iframe");return n.id="printContainer",n.style.visibility="hidden",n.style.position="fixed",n.style.right="0",n.style.bottom="0",n.setAttribute("srcdoc",e),document.body.appendChild(n),void kStatus.update()}))},v.regenerateSpreads=function(e,n){var o;e=e||{},v.shouldBePaged(stg.data.currentPageOb)&&(v.regeneratingSpreads?L=!0:(L=!1,cache.getOb("epubContainer").style.opacity=0,v.showLoader(),stg.data.currentPageOb.pages&&stg.data.currentPageOb.pages.length&&(o=currentVIndex/stg.data.currentPageOb.pages.length),t&&clearTimeout(t),t=setTimeout(function(){v.regeneratingSpreads=!0,B&&clearTimeout(B),B=setTimeout(function(){v.regeneratingSpreads=!1,v.regenerateSpreads(e,n)},2e4),v.resetPages(),v.preloadEdgeChapters(function(){v.getPageOb({page:currentIndex},function(e){var t={};t.viewMode=stg.data.settings.viewMode,t.vIndex=currentVIndex,o&&e.pages&&(t.vIndex=Math.floor(e.pages.length*o),t.vIndex!=currentVIndex&&$location.search({vi:t.vIndex})),t.reload=!0,v.loadChapterByIndex(currentIndex,t).then(function(){v.regeneratingSpreads=!1,clearTimeout(B),L?setTimeout(function(){L=!1,v.regenerateSpreads(t,n)},100):(n&&n(),cache.getOb("epubContainer").style.opacity=1,v.hideLoader())})})})},e.resize?600:30)))},v.resetPages=function(e){e=e||{};for(var t=0;t<p.length;t++)p[t].pages=null;return skeleton.reset(),e.buildChapterMode||stg.data.book.meta.rendition&&"pre-paginated"==stg.data.book.meta.rendition.layout||"double"!=stg.data.settings.viewMode&&stg.data.settings.pageScroll?skeleton.initialize({first:i,last:o}):void 0},v.getIndexFromTocElem=function(t){var e=t.getAttribute("href");try{if(0==e.indexOf("#"))return e.split("/reader/chapter/")[1].split("/")[0]}catch(e){try{return t.getAttribute("data-index")}catch(e){}}for(var n=document.getElementById("chaptersInner").getElementsByTagName("a"),o=0,i=0;i<n.length&&(n[i].getAttribute("href")!=e||"restricted"==n[i].className||(o++,t!=n[i]));i++);return v.indexFromUrl(t.getAttribute("href"),{order:o})},v.highlightCurrentTocChapter=function(){if(mobile&&$injector.get("nav").resize(),stg.data.currentPageOb){var e=stg.data.currentPageOb.index;if(stg.data.book){stg.data.book.chapter.url;for(var t=document.getElementById("chaptersInner").getElementsByTagName("a"),n=[],o=0;o<t.length;o++)h(v.getIndexFromTocElem(t[o]),e),v.getIndexFromTocElem(t[o])==e&&n.push({elem:t[o],id:ph.getHash(t[o].getAttribute("href"))});v.deApplySelectedChapter(),n.length&&v.applySelectedChapter(function e(t){try{if("none"!=t.style.display)return t;if(t.previousElementSibling)return e(t.previousElementSibling);if("none"!=t.parentNode.style.display)return e(t.parentNode);var n=t.parentNode.previousElementSibling.getElementsByTagName("li");return e(n[n.length-1])}catch(e){return t}}(n[0].elem.parentNode))}}},v.applySelectedChapter=function(e,t){if(e&&(null==t&&(t=!0),addClass(e,"selected"),addClass(e,"currentChapter"),t)){for(var n,o=e,i=cache.getOb("chaptersContent");(e=e.parentNode)&&e!=i;)"li"==e.nodeName.toLowerCase()&&(addClass(e,"expanded"),addClass(e,"containsSelection"));overflowScroll?i.scrollTo?i.scrollTo(0,Math.round(getTopOffsetRelativeTo(o,i)),!0):i.scrollTop=Math.round(getTopOffsetRelativeTo(o,i)):(n=$ionicScrollDelegate.$getByHandle("chapters"))&&n.scrollTo(0,Math.round(o.offsetTop-i.parentNode.offsetHeight/2),!1)}},v.deApplySelectedChapter=function(){for(var e=cache.getOb("chaptersContent"),t=e.getElementsByClassName("containsSelection"),n=t.length;n--;)removeClass(t[n],"containsSelection");for(var o=e.getElementsByClassName("selected"),n=o.length;n--;)removeClass(o[n],"selected");for(n=(o=e.getElementsByClassName("currentChapter")).length;n--;)o[n].removeAttribute("name")},v.elemInChapterElem=function(e,t){return!(stg.data.currentPageOb.index!=t||!hasParentWithId(e,"spreadL",99))||(!(!stg.data.currentRPageOb||stg.data.currentRPageOb.index!=t||!hasParentWithId(e,"spreadR",99))||void 0)},v.mightCrashOnIos=function(e){if(mobile&&ios){var t=/iPhone OS (\d+)/g.exec(window.navigator.userAgent);if(!t)return;if("15"==t[1]||"16"==t[1]){if(0==window.location.search.indexOf("?ioscompatible"))return!0;if(2e3<e.length&&400<e.split(" ").length)return!0}}},v}),createService("context",function(){var O,A,N,y,L={};function o(n,o){var i;null!=stg.data.currentPageOb.currentVIndex&&(isNaN(stg.data.currentPageOb.currentVIndex)||(i=stg.data.currentPageOb.vIndex,stg.data.currentPageOb.vIndex=currentVIndex)),skeleton.getNextLinearIndex({index:stg.data.currentPageOb.index,vIndex:stg.data.currentPageOb.vIndex},function(t){null!=i&&(stg.data.currentPageOb.vIndex=i);var e=t?[n,t.leftOb]:null;asyncCheck(!t,O.arePagesAppearingTogether,e,function(e){return e&&t?o("next"):(null!=currentVIndex&&(stg.data.currentPageOb.vIndex=currentVIndex),void skeleton.getPrevLinearIndex({index:stg.data.currentPageOb.index,vIndex:stg.data.currentPageOb.vIndex},function(e){null!=i&&(stg.data.currentPageOb.vIndex=i),O.arePagesAppearingTogether(n,e.leftOb,function(e){return o(e?"prev":null)})}))})})}function i(e,t){if((e=e||{}).reload)return t&&t();var n=cache.getOb("epubContainer");null!=n.style.opacity&&(n.style.opacity=null,O.hideLoader()),native&&(n.scrollTop=0);var o=document.getElementsByClassName("activeSlidePage");if(!o.length)return t&&t();var i=o[0];"navSlide"==stg.data.settings.navAnim||"navStack"==stg.data.settings.navAnim?i.style.transform=null:"navFade"==stg.data.settings.navAnim?i.style.opacity=null:"navFlip"==stg.data.settings.navAnim?autoprefixTransform(i,null):"navBookBlock"==stg.data.settings.navAnim&&(deleteTransform(i),deleteTransform(n),n.style.opacity=null);for(var r=0;r<n.children.length;r++)if("shadow"==n.children[r].className){n.removeChild(n.children[r]);break}removeClass(i,"anim"),removeClass(i,"activeSlidePage");var a='<h3 id="ebookLoaderAnim"><div class="splashSpinner large"><div class="dot1"></div><div class="dot2"></div></div></h3>';document.getElementById("nextPage").innerHTML=a,document.getElementById("prevPage").innerHTML=a,t&&t()}function r(o,i){var r,e;function a(){i(N)}N?i(cssParser.applyRoot(o,N)):(e=(r=isKotobeeHosted())?"/bundles/vijualib/templates/reader/cloud/lib/ionic/release/css/ionic.min.css":"lib/ionic/release/css/ionic.min.css",khttp.get(e).success(function(e){var t,n;A=e,r?khttp.get("/bundles/vijualib/templates/reader/cloud/css/styles.min.css").success(function(e){N=e,a()}).error(function(){i(cssParser.applyRoot(o,N))}):(t="css/styles.min.css",(n="http://localhost:8080"==window.location.origin)&&(t="css/style.css"),khttp.get(t).success(function(e){N=e,n?khttp.get("css/base.css").success(function(e){N=e+" "+N,khttp.get("css/kotobeeInteractive.css").success(function(e){N+=e,a()}).error(function(){a()})}).error(function(){a()}):a()}).error(function(){i(cssParser.applyRoot(o,N))}))}).error(function(){i(cssParser.applyRoot(o,N))}))}function a(t,n){t=t||{};t.container&&(O.shouldBePaged(t.leftOb)&&(t.leftOb&&(t.leftOb.viewport=$injector.get("spread").getViewport(t.leftOb)),t.rightOb&&(t.rightOb.viewport=$injector.get("spread").getViewport(t.rightOb))),t.simulate?s(t,n):O.getPageOb({page:t.leftOb.index},function(e){copyObjToObj(e,t.leftOb,{onlyIfNotExists:!0}),t.leftOb.pages&&t.leftOb.vIndex<0&&(t.leftOb.vIndex+=t.leftOb.pages.length),t.rightOb?O.getPageOb({page:t.rightOb.index},function(e){copyObjToObj(e,t.rightOb,{onlyIfNotExists:!0}),t.rightOb.pages&&t.rightOb.vIndex<0&&(t.rightOb.vIndex+=t.rightOb.pages.length),s(t,n)}):s(t,n)}))}function s(t,e){t.id=Math.round(999*Math.random());var n=t.container,a=t.leftOb,o=t.rightOb,i=a.url,r=ph.removeHash(window.location.href),s=document.createElement("html"),c=document.createElement("head");ios&&(c.innerHTML="<meta http-equiv=\"Content-Security-Policy\" content=\"default-src * filesystem: data:; style-src 'self' 'unsafe-inline' filesystem: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.youtube.com http://*.youtube.com https://*.ytimg.com http://*.ytimg.com;img-src * filesystem: data: file:\">"),s.appendChild(c);var l=document.getElementsByTagName("base");if(l.length)for(var d=0;d<l.length;d++){var u=l[d].getAttribute("href");if(u){r=0==u.indexOf("/")||isAbsoluteURLPath(u)?u:ph.join(window.location.origin,u);break}}var p=document.createElement("base");function h(e){var t="";A&&(t+=A);var n=!mobile&&!a.viewport,o=" body{margin:0; padding-top:0px;} #epubContainer{padding-top:0px;position:absolute;top:0;left:0;right:0;bottom:0 !important}";mobile||(o+="body, #epubContainer{padding-top:1px;}"),t+=o,t+="html,#epubContainer{overflow-y:"+(n?"auto":"hidden")+"}",t+="#epubContainer.rtl{direction:rtl}",t+="#epubScroller{position: static;height: 100%;width: 100%;box-sizing: border-box;transform-origin:left top;direction:ltr}",n&&(t+="#epubContainer{overflow:auto !important}"),mobile&&(t+=" #epubContent ::-webkit-scrollbar {display: none;} #epubContent {-ms-overflow-style: none;overflow: -moz-scrollbars-none;}");var i=cache.getOb("epubContainer").getElementsByClassName("scroll")[0],r={left:0};return i&&(r=getElemPadding(i,{computed:!0})),t+="#epubScroller{padding:"+r.left+"px}",a.viewport&&a.viewport.width&&(t+="#epubContent{width:"+a.viewport.width+"px;height:"+a.viewport.height+"px; overflow:hidden; position: relative;}",t+="html{overflow-x:"+(mobile?"hidden":"auto")+"}",t+=" #epubInner{height:0;} ",t+=" #spreadL,#spreadR{position:absolute !important; top:0 !important;font-size: 1em !important;overflow:hidden;}"),a.viewport||mobile||(t+="#epubScroller{overflow:auto}"),t+=" html{overflow-x:hidden} ",t+=" #epubContent{padding:0px; line-height: 1.6;} ",t+=" #epubContent{box-sizing:border-box; font-size:"+stg.data.settings.textSize+" !important;}",t+=" #epubContent.hide{display:block !important}",t+=" #epubContent section{margin-top:0 !important}",stg.data.settings.textSize&&(t+=" #epubContent{font-size: "+stg.data.settings.textSize+"}"),t+=N,t=(t+=e=(e=e||"").replace(/#spreadL /g,"")).replace("background-color:#e7e3d9 !important;","")}function g(){var e=arguments[2];if(0==e.indexOf('"')&&(e=e.split('"')[1]),0==e.indexOf("'")&&(e=e.split("'")[1]),0==e.indexOf("&quot;")&&(e=e.split("&quot;")[1]),!e||!e.trim())return arguments[0];if(-1!=e.indexOf("http://"))return arguments[0];if(-1!=e.indexOf("https://"))return arguments[0];if(0==e.indexOf("data:"))return arguments[0];if(0==e.indexOf("kotobee:"))return arguments[0];var t=1<e.split(" ").length,n=1<(e='"'+ph.relative(ph.removeFilename(i),e)+'"').split(" ").length;return!t&&n&&(e='"'+e+'"'),arguments[1]+cleanURL(e)+arguments[3]}0==i.indexOf("/")||isAbsoluteURLPath(i)?p.setAttribute("href",cleanURL(ph.removeFilename(i)+"/")):p.setAttribute("href",cleanURL(ph.join(r,ph.removeFilename(i))+"/")),t.simulate||c.appendChild(p);var f=document.createElement("div");f.className="stylesEnabled",f.id="epubContainer";var m=document.createElement("div");m.id="epubScroller",m.className="scroll",f.appendChild(m);var v=document.createElement("div");function b(e){e=(e=(e=(e=e||"").replace(/<div class="answer correct">/g,'<div class="answer">')).replace(/<div class="correct">/g,"<div>")).replace(/<p class="explanation">.*?<\/p>/g,""),t.simulate||(e=e.replace(/(style=".*?url\()(.+?)(\).*?")/g,g));isKotobeeHosted();isReaderApp||t.simulate||(e=(e=e.replace(/src="(.*?)"/g,function(e,t){return isAbsoluteURLPath(t)?'src="'+t+'"':'src="'+ph.relative(i,t)+'"'})).replace(/xlink:href="(?!http[s]?\:\/\/)([^"]*)?"/g,function(e,t){return'xlink:href="'+ph.relative(i,t)+'"'}));a.title;return native&&mobile&&(e=e.replace(/(<img[^>]*src=)"(.*?)"/g,function(e,t){return t+'"'+cleanURL(arguments[2])+'"'})),e}v.id="epubInner",m.appendChild(v);var k,y=document.createElement("style");y.setAttribute("type","text/css"),a.pages&&null!=a.vIndex?a.content=a.pages[a.vIndex].content:!a.content&&a.raw&&(a.content=a.raw),a.content=b(a.content),o&&(o.pages&&null!=o.vIndex?o.content=o.pages[o.vIndex].content:!o.content&&o.raw&&(o.content=o.raw),o.content=b(o.content)),t.cached=!1,v=L.populateSpreads(v,t),O.disableCssLoading||(t.cached||(a.styles=a.styles.replace(/#spreadR/g,"#spreadL"),t.simulate||(a.styles=a.styles.replace(/(url\()(.*?)(\))/g,g)),o&&(o.styles=o.styles.replace(/#spreadL/g,"#spreadR"),t.simulate||(o.styles=o.styles.replace(/(url\()(.*?)(\))/g,g)))),a.styles,k=h(a.styles),!t.cached&&o&&(k+=" "+h(o.styles),o.styles),y.innerHTML=k,c.appendChild(y));for(var w=v.getElementsByTagName("audio"),d=w.length;d--;){try{w[d].pause(),w[d].children.length||(w[d].src="")}catch(e){}var C=w[d].parentNode;C.previousSibling&&hasClass(C.previousSibling,"playBtn")&&removeClass(C.previousSibling,"hide"),C.removeChild(w[d])}for(var x=v.getElementsByTagName("video"),d=x.length;d--;){try{x[d].pause(),x[d].children.length||(x[d].src="")}catch(e){}var I=x[d].parentNode;I.previousSibling&&hasClass(I.previousSibling,"playBtn")&&removeClass(I.previousSibling,"hide"),I.removeChild(x[d])}var E=document.createElement("body");stg.data.settings.rtl&&addClass(E,"rtl"),addClass(E,a.layout),addClass(E,t.view),addClass(E,"transitionFrame"),E.appendChild(f),s.appendChild(E);var S,T=document.createElement("iframe");T.setAttribute("srcdoc",s.outerHTML),T.style.visibility="hidden",(detectIE()||native&&ios)&&(S="javascript: window.frameElement.getAttribute('srcdoc');",T.setAttribute("src",S),T.contentWindow&&(T.contentWindow.location=S)),T.onload=function(){T.style.visibility="visible",B(T,t)},n&&(n.innerHTML="",n.appendChild(T),e&&e(T))}function B(e,t){var n,o,i,r,a,s,c=(t=t||{}).leftOb,l={},d=!!t.rightOb,u=e.contentDocument,p=u.getElementById("epubContent"),h=u.getElementById("epubContainer");L.setContentSize(p,t),c.viewport?(l.epubContainer=h,l.epubContent=p,l.viewport=c.viewport,l.view=d?"double":"single",l.stylesFromEpubContent=!0,n=h.children[0],o=!1,compInstances.pan&&("fxl"==c.layout&&(o=!0),d||"double"!=stg.data.settings.viewMode||(o=!0)),o&&(l.viewport.double=d,r=compInstances.pan.getBestFit("width",l.viewport),config.fitToScreen&&(i=compInstances.pan.getBestFit("height",l.viewport),r=r.scale<i.scale?r:i),r.translate3d[0]<0&&(r.translate3d[0]=0),r.translate3d[1]<0&&(r.translate3d[1]=0),autoprefixTransform(n,"translate3d("+r.translate3d[0]+"px,"+r.translate3d[1]+"px,0px) scale("+r.scale+")"),autoprefixTransformOrigin(n,"top left;")),n.style.height="100%",vueExclude&&$injector.get("nav").fxlAdjustAlignment(l)):(deleteTransform(p),(a=u.getElementById("spreadL")).style.width=a.style.height=null,(s=u.getElementById("spreadR"))&&s.parentNode.removeChild(s))}return L.initialize=function(){O=$injector.get("chapters")},L.startTransition=function(t,n){kotobee.dispatchEvent("preTransition",t),i(t),requestAnimationFrame(function(){var e={animID:y=Math.round(1e4*Math.random()),reload:t.reload,pageOb:t.leftOb};!function m(v,b){v=v||{};if(v.reload)return void(b&&b());var k=cache.getOb("epubContainer");if(null==currentIndex)return k.style.opacity=0,O.showLoader(),void(b&&b());o(v.pageOb,function(t){if(!t)return k.style.opacity=0,v.pageOb.index!=currentIndex&&O.showLoader(),void(b&&b());var n=document.getElementById(t+"Page");n.style.opacity=null;var e,o,i,r,a,s,c,l,d,u,p=n.getElementsByTagName("iframe");if(p.length){var h,g=p[0].contentDocument.getElementById("epubContent"),f=p[0].srcdoc;if(g||!f)p[0].style.visibility="visible",!g||"fxl"==(h=$injector.get("nav").viewFromElem(g)).layout&&B(p[0],h);else if(requestAnimationFrame)return void requestAnimationFrame(function(){m(v,b)})}"navSlide"==stg.data.settings.navAnim?(book.isRtl()?n.style.transform="translate3d("+("next"==t?"-":"")+k.offsetWidth+"px,0,0)":n.style.transform="translate3d("+("next"==t?"":"-")+k.offsetWidth+"px,0,0)",requestAnimationFrame(function(){function e(){n.removeEventListener("transitionend",e),v.animID==y&&(autoprefixTransform(k,null),removeClass(k,"anim"),b&&b())}v.animID==y&&(book.isRtl()?autoprefixTransform(k,"translate3d("+("next"==t?"":"-")+k.offsetWidth+"px,0,0)"):autoprefixTransform(k,"translate3d("+("next"==t?"-":"")+k.offsetWidth+"px,0,0)"),n.style.transform="translate3d(0,0,0)",addClass(k,"anim"),addClass(n,"anim"),addClass(n,"activeSlidePage"),n.addEventListener("transitionend",e))})):"navStack"==stg.data.settings.navAnim?setTimeout(function(){v.animID==y&&(book.isRtl()?autoprefixTransform(k,"translate3d("+("next"==t?"":"-")+k.offsetWidth+"px,0,0)"):autoprefixTransform(k,"translate3d("+("next"==t?"-":"")+k.offsetWidth+"px,0,0)"),n.style.transform="translate3d(0,0,0)",addClass(k,"anim"),addClass(n,"anim"),addClass(n,"activeSlidePage"),setTimeout(function(){v.animID==y&&(autoprefixTransform(k,null),removeClass(k,"anim"),b&&b())},330))},30):"navFade"==stg.data.settings.navAnim?(n.style.left=0,n.style.opacity=1,addClass(n,"anim"),addClass(n,"activeSlidePage"),setTimeout(function(){v.animID==y&&b&&b()},330)):"navFlip"==stg.data.settings.navAnim?(addClass(k,"anim"),book.isRtl()?(autoprefixTransform(k,"next"==t?"rotateY(90deg)":"rotateY(-90deg)"),autoprefixTransform(n,"next"==t?"rotateY(-90deg)":"rotateY(90deg)")):(autoprefixTransform(k,"next"==t?"rotateY(-90deg)":"rotateY(90deg)"),autoprefixTransform(n,"next"==t?"rotateY(90deg)":"rotateY(-90deg)")),k.style.opacity=0,setTimeout(function(){v.animID==y&&(autoprefixTransform(n,null),addClass(n,"anim"),addClass(n,"activeSlidePage"),setTimeout(function(){v.animID==y&&(removeClass(k,"anim"),autoprefixTransform(k,null),b&&b())},630))},30)):"navBookBlock"==stg.data.settings.navAnim&&((e=document.createElement("div")).className="shadow",e.style.opacity=0,e.appendChild(document.createElement("div")),k.appendChild(e),addClass(k,"anim"),book.isRtl()?autoprefixTransform(k,"next"==t?"rotateY(90deg)":"rotateY(-90deg)"):autoprefixTransform(k,"next"==t?"rotateY(-90deg)":"rotateY(90deg)"),o=k.style.transform||k.style.webkitTransform||k.style.mozTransform,i="right",stg.data.book.chapter.viewport&&(r=$injector.get("nav").getFxlFit(),i=r.innerWidth+r.marginLeft+"px"),a="left",stg.data.book.chapter.viewport&&(a=k.style.paddingLeft||"left"),autoprefixTransformOrigin(k,"rotateY(90deg)"==o?i+" top":a+" top"),k.style.opacity=0,addClass(n,"anim"),addClass(n,"activeSlidePage"),(s=document.createElement("div")).className="shadow",s.style.opacity=.7,n.appendChild(s),e.style.opacity=0,e.style.height=k.scrollHeight+"px",s.style.width=k.style.width,s.style.height=k.style.height,stg.data.book.chapter.viewport&&(s.style.right=e.style.right="auto",s.style.marginLeft=e.style.marginLeft=k.style.paddingLeft,e.style.width=k.style.width,v.pageOb.viewport||(n.style.opacity=0)),s.style.marginRight=k.style.marginRight,s.style.marginBottom=k.style.marginBottom,(c=getElemMargin(k)).top||(c.top=0),l=getComputedStyle(k).paddingTop.split("px"),s.style.marginTop=Number(c.top)+Number(l[0])+"px",d=getComputedStyle(k).backgroundColor,(u="rgba(0,0,0,0)"==(d=d.replace(/ /g,"")))&&(k.style.backgroundColor="#fff"),setTimeout(function(){v.animID==y&&(s.style.opacity=null,setTimeout(function(){e.style.opacity=.4,setTimeout(function(){autoprefixTransformOrigin(k,null),s.parentNode&&s.parentNode.removeChild(s),e.parentNode&&e.parentNode.removeChild(e),v.animID==y&&(removeClass(k,"anim"),k.style.opacity=null,u&&(k.style.backgroundColor=null),autoprefixTransform(k,null),b&&b())},430)},200))},30))})}(e,function(){O.loadChapterByURL(t,function(){setTimeout(function(){e.animID==y&&i(t,function(){function o(n,o,i){n&&O.getPageOb({page:n.leftOb.index},function(e){var t;e&&((t={}).leftOb=clone(e),t.vIndex=n.leftOb.vIndex,t.vIndex<0&&e.pages&&e.pages.length&&(t.vIndex+=e.pages.length),O.planPageMapping(t,function(e){r(t.leftOb.url,function(e){t.styles=e,t.container=document.getElementById(o),t.view=O.getCurrentView(t.leftOb.index,t.leftOb).view,t.source="from preloadchapters",a(t,i)})}))})}var i;i=t,O.isFirstChapter(function(n){O.isLastChapter(function(e){var t;e||(t={index:i.leftOb.index,vIndex:i.leftOb.vIndex},skeleton.getNextLinearIndex(i.leftOb,function(e){O.getSurroundingPages(e?e.leftOb:null,function(){o(e,"nextPage")})})),n||(t={index:i.leftOb.index,vIndex:i.leftOb.vIndex},skeleton.getPrevLinearIndex(t,function(e){O.getSurroundingPages(e?e.leftOb:null,function(){o(e,"prevPage")})}))})}),n&&n.resolve()})},500)})})})},L.interruptAnimation=function(){i()},L.simulateChapter=function(o,i){r(o.url,function(e){var t=document.createElement("div"),n={};n.styles=e,n.styles+="#spreadL{left:0 !important;width:auto !important;height:auto !important;position:static !important;}",n.styles+="#epubContent{width:auto !important;height: auto !important;}",n.container=t,n.leftOb=clone(o),O&&("double"==O.getCurrentView(n.leftOb.index).view&&(n.rightOb={},n.rightOb.content="<div><sections class='blankForSimulation'></sections></div>",n.rightOb.styles="",n.rightOb.layout="rfl"),n.simulate=!0,a(n,i))})},L.nextLinearIndex=function(e){for(var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];t&&t.hasAttribute("linear")&&"no"==t.getAttribute("linear");){if(++e>=t.length-1)return e;t=stg.data.epub.spine.getElementsByTagName("itemref")[e]}return e},L.prevLinearIndex=function(e){for(var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];t&&t.hasAttribute("linear")&&"no"==t.getAttribute("linear");){if(--e<0)return 0;t=stg.data.epub.spine.getElementsByTagName("itemref")[e]}return e},L.populateSpreads=function(e,t){var n=0;"rfl"==(t=t||{}).leftOb.layout&&"double"==t.view&&(n=config.spreadSpacing?config.spreadSpacing:0);var o,i,r=t.leftContent?t.leftContent:t.leftOb.content;t.cached||((a=document.createElement("div")).innerHTML=t.leftContent?t.leftContent:t.leftOb.content,copyAttributes(o=a.children[0],i=o.children[0]),removeClass(i,"adjustedLineHeight"),i.id="spreadL",i.style.transform=i.style.transformOrigin=i.style.height=null,t.leftOb.viewport?(i.style.left="0px",i.style.width=t.leftOb.viewport.width+"px",i.style.height=t.leftOb.viewport.height+"px",book.isRtl()&&(i.style.left="auto",i.style.right="0px")):(i.style.left=null,i.style.width=null,i.style.height=null),addClass(i,t.leftOb.layout),t.leftOb.bodyClass&&addClass(a.getElementsByTagName("section")[0],t.leftOb.bodyClass),r=a.innerHTML);var a,s,c,l=replaceHTML(e,r);if(t.rightOb){if(1<l.children[0].children.length)for(var d=0;d<l.children[0].children.length;d++)if("spreadR"==l.children[0].children[d].id){c=l.children[0].children[d];break}c||((a=document.createElement("div")).innerHTML=t.rightContent?t.rightContent:t.rightOb.content,copyAttributes(s=a.children[0],c=s.children[0]),removeClass(c,"adjustedLineHeight"),c.id="spreadR",c.style.transform=c.style.transformOrigin=c.style.height=null,l.children[0].appendChild(c)),t.rightOb.viewport&&(t.leftOb.viewport&&(c.style.left=t.leftOb.viewport.width+n+"px",book.isRtl()&&(c.style.right=c.style.left,c.style.left="auto")),c.style.width=t.rightOb.viewport.width+"px",c.style.height=t.rightOb.viewport.height+"px",addClass(c,t.rightOb.layout))}return l},L.test=function(e){},L.setContentSize=function(e,t){var n=(t=t||{}).leftOb,o=t.rightOb;e.style.width=e.style.height=null;var i=0;"rfl"==t.leftOb.layout&&"double"==t.view&&(i=config.spreadSpacing?config.spreadSpacing:0);var r,a,s=n.viewport;s&&(s.width&&(r=s.width,o&&o.viewport&&(r+=o.viewport.width+i),e.style.width=r+0+"px"),s.height&&(a=s.height,o&&o.viewport&&(a=Math.max(a,o.viewport.height)),e.style.height=a+0+0+"px"))},L}),createService("crdv",function(){var i,l={};function e(){!function(){try{var t=10;window.waitForAndCallHandlerFunction=function(e){"function"==typeof window.handleOpenURL?(cordova.exec(null,null,"LaunchMyApp","clearIntent",[]),window.handleOpenURL(e)):0<t--&&setTimeout(function(){waitForAndCallHandlerFunction(e)},500)},window.triggerOpenURL=function(){cordova.exec(waitForAndCallHandlerFunction,null,"LaunchMyApp","checkIntent",[])};var e={getLastIntent:function(e,t){cordova.exec(e,t,"LaunchMyApp","getLastIntent",[])}};window.handleOpenURL=function(e){window.dispatchEvent(new CustomEvent("cordovaHandleOpenUrl",{detail:e}))},window.launchmyapp=e,triggerOpenURL()}catch(e){}}();try{MobileAccessibility.setTextZoom(100,function(e){})}catch(e){}try{StatusBar&&(StatusBar.overlaysWebView(!1),ios?StatusBar.styleDefault():StatusBar.styleLightContent())}catch(e){}try{document.addEventListener("deviceready",function(){},!1)}catch(e){}try{navigator.splashscreen&&setTimeout(function(){navigator.splashscreen.hide()},1e3)}catch(e){}try{mobile&&native&&"undefined"!=typeof Keyboard&&Keyboard.hideFormAccessoryBar(!1)}catch(e){}}function t(e){stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()}function n(e){if(!(e=e||{}).canceled)if(kInteractive.frameIsOpen)kInteractive.closeFrame();else if(kInteractive.alertIsOpen)kInteractive.closeAlert();else if(kInteractive.videoIsFullscreen)kInteractive.closeFullscreenVideo();else{if(!modals.shown()){var t=vueApp.$route.name;return"library"==t?compInstances.library.androidBackBtnClicked(e):"reader"==t?compInstances.reader.androidBackBtnClicked(e):"forgotPwd"==t?compInstances.forgotPwd.androidBackBtnClicked(e):"register"==t?compInstances.register.androidBackBtnClicked(e):void modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}modals.hide()}}function f(){try{return cordova,1}catch(e){return}}function r(i,r,a,s){try{kStatus.updateProgress(0),i.getEntries(function(e){var o=0;!function t(){var n;o>=e.length?i.close(function(){a&&a()}):(kStatus.updateProgress(o/e.length),n=e[o],o++,n.getData(new zip.BlobWriter,function(e){try{if("/"==n.filename.substr(-1))return void t();l.writeFile(e,ph.join(r,n.filename),{relTo:"library"},function(){t()})}catch(e){s&&s()}},function(e,t){}))}()})}catch(e){s&&s()}}function s(e){switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:0;break;case FileError.NOT_FOUND_ERR:0;break;case FileError.SECURITY_ERR:0;break;case FileError.INVALID_MODIFICATION_ERR:0;break;case FileError.INVALID_STATE_ERR:0;break;default:0}}return l.initialize=function(c){f()?(stg.data.cordova=!0,document.addEventListener("deviceready",function(){e(),$rootScope.$$phase||$rootScope.$apply();stg.copyLocalToNativeStorage(),sleep.initialize(),l.cleanHtml(),l.initAds(),l.initDirectories({},function(){khttp.get("permit.json").success(function(a){function s(){var e={error:"errorAndCallback",msg:"noAppPermit",cb:l.exit};kError.update(e),$rootScope.$$phase||$rootScope.$apply()}("udid"==a.type?window.plugins.uniqueDeviceID.get:"mac"==a.type?window.MacAddress.getMacAddress:window.plugins.imeiplugin.getImei)(function(e){e||s();try{for(var t,n=a.list.split("\n"),o=0;o<n.length;o++){var i=n[o].trim().split(" ")[0].trim(),r=n[o].trim().split("/")[0].trim();if(i==e||r==e){t=!0;break}}}catch(e){return void s()}(t?c:s)()},s)}).error(function(){c()})}),document.addEventListener("menubutton",t,!1),document.addEventListener("backbutton",n,!1),$rootScope.$$phase||$rootScope.$apply()},!1)):c()},l.cleanHtml=function(){for(var e=document.getElementsByTagName("link"),t=e.length;t--;)"shortcut icon"==e[t].getAttribute("rel")&&e[t].parentNode.removeChild(e[t])},l.initDirectories=function(n,o){function i(e){if(l.initError=1,l.docDirectory.nativeURL!=cordova.file.dataDirectory)return l.initError=2,window.resolveLocalFileSystemURL(cordova.file.dataDirectory,function(e){l.initError=3,l.initDirectories({useDir:e},o)});l.initError=4}n=n||{},window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(LocalFileSystem.TEMPORARY,10485760,function(e){l.cacheDirectory=e.root,window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){l.docDirectory=e.root,n.useDir&&(l.docDirectory=n.useDir);var t="kotobeeReader";isReaderApp?t="kotobeeReaderApp":config.kotobee.cloudid&&(t+=config.kotobee.cloudid),l.docDirectory.getDirectory(t,{create:!0},function(e){l.appDirectory=e,l.appDirectory.getDirectory("library",{create:!0},function(e){l.libEbooksDirectory=e,l.appDirectory.getDirectory("temp",{create:!0},function(e){l.tempDirectory=e,l.appDirectory.getDirectory("local",{create:!0},function(e){l.localDirectory=e,l.localDirectory.getDirectory("books",{create:!0},function(e){l.localBooksDirectory=e,l.localDirectory.getDirectory("thumbs",{create:!0},function(e){l.localThumbsDirectory=e,l.libEbooksDirectory.getFile(".nomedia",{create:!0},function(){l.localDirectory.getFile(".nomedia",{create:!0},function(){o()},i)},i)},i)},i)},i)},i)},i)},i)},i)},i)},l.resolvePath=function(t,n,o){window.resolveLocalFileSystemURL(t,function(e){o(e,n)},function(e){n=ph.basename(t)+"/"+n,t=ph.removeBase(t),l.resolvePath(t,n,o)})},l.backBtnPressed=n,l.showKeyboard=function(){try{if(!f())return;Keyboard.show()}catch(e){}},l.hideKeyboard=function(){try{Keyboard.hide()}catch(e){}},l.tts=function(e,t){var n={text:e,rate:(config.ttsRate?config.ttsRate:100)/100};config.defaultTtsLanguage&&(n.locale=config.defaultTtsLanguage);try{"iOS"==window.device.platform&&(n.rate+=.5)}catch(e){}TTS.speak(n,function(){t(!0)},function(e){l.toast(translit.get("ttsUnavailableMsg")),t(!1)})},l.toast=function(e,t){var n,o;f()&&(n=2e3,(t=t||{}).long&&(n=4e3),t.duration&&(n=t.duration),(o=document.getElementById("kReaderToast"))||((o=document.createElement("div")).id="kReaderToast",document.body.appendChild(o),setTimeout(function(){o.className="fadeIn"},30)),removeClass(o,"fadeOut"),o.innerHTML=e,i&&clearTimeout(i),i=setTimeout(l.hideToast,n))},l.hideToast=function(){var e;!f()||(e=document.getElementById("kReaderToast"))&&(hasClass(e,"fadeOut")||(addClass(e,"fadeOut"),e.addEventListener("transitionend",function(){hasClass(e,"fadeOut")&&e.parentNode&&e.parentNode.removeChild(e)})))},l.copyToClipboard=function(e){if(f())try{cordova.plugins.clipboard?cordova.plugins.clipboard.copy(e):window.plugins.clipboard.copy(e),l.toast(translit.get("copiedToClipboard"))}catch(e){}},l.share=function(e){if(f())try{window.plugins.socialsharing.share(e)}catch(e){}},l.fileExists=function(e,t){window.resolveLocalFileSystemURL(e,function(){t&&t(!0)},function(){t&&t(!1)})},l.removeFile=function(e,n){l.resolvePath(ph.removeFilename(e),ph.basename(e),function(e,t){e.getFile(t,{},function(e){e.remove(function(e){n&&n()})})})},l.removeDirectory=function(e,t){window.resolveLocalFileSystemURL(e,function(e){e.removeRecursively(function(){t&&t()})})},l.createPDF=function(u,p,h){try{var e;document.body.querySelector('script[src*="pdf/pdf"]')?t():((e=document.createElement("script")).src=rootDir+"lib/pdf/pdf.js",e.addEventListener("load",t),document.body.appendChild(e))}catch(e){}function g(){return document.body.dir&&"rtl"===document.body.dir}function t(){var e=new jspdf.jsPDF("p","pt","a4"),t=isArabic(u);t&&(u=u.replace("<html>",'<html lang="ar">'));var n=parser.parseFromString(u,"text/html");t&&n.querySelectorAll("*").forEach(function(e){var t;-1===["BR","HR"].indexOf(e.nodeName)&&((t=e)&&[].slice.call(t.children).forEach(function(e){[].slice.call(e.childNodes).forEach(function(e){var t,n,o;3===e.nodeType&&isArabic(e.textContent)&&""!==e.textContent.trim()&&(e.textContent=normalize(e.textContent),t=/[\u0600-\u06FF\u0750-\u077F]+/g,n=e.textContent.match(t),Array.isArray(n)&&n.length&&(o=n.map(function(e){return"<span style=\"font-family: 'Amiri-Regular'; float: right; text-align: right;\">"+e.trim()+"</span>"}).join(""),e.textContent=e.textContent.replace(t,"").replace(/'|"|:/g,""),e.parentNode.insertAdjacentHTML("beforeend","<span dir='rtl'>"+o+"</span>")))})}),e.style.wordWrap="initial")});var o,i=!0,r=0,a=0,s=n.querySelector("h1"),c=document.createElement("h1");c.innerHTML=s.innerHTML,document.body.appendChild(c),r+=c.offsetHeight,document.body.removeChild(c),n.querySelectorAll("h2,p,div").forEach(function(e){(c=document.createElement(e.nodeName.toLowerCase())).innerHTML=e.innerHTML,document.body.appendChild(c),e.textContent.match(/[--]+/g)&&(e.style.fontFamily="NotoSansCJKjp-Regular");var t=c.offsetHeight;document.body.removeChild(c),o=a*t,(i&&842<=r+o||!i&&842<=o)&&(i=!1,a=0,e.style.pageBreakAfter="always"),a++});var l=n.getElementById("container");l.style.width="550px",n.querySelector("body").style.width="550px";var d=g();d&&(document.body.dir="ltr"),e.html(l,{x:20,y:20,margin:[0,0,0,0],callback:function(e){if(f())return t=p,n=function(){d&&!g()&&(document.body.dir="rtl")},void function(o){return new Promise(function(e,t){var n=new FileReader;n.readAsDataURL(o),n.onload=function(){e(n.result)},n.onerror=function(e){t(e)}})}(e.output("blob")).then(function(e){window.plugins.socialsharing.shareWithOptions({files:["df:"+t+";"+e]},void 0,void 0)}).catch(function(e){n&&n()});try{setTimeout(function(){e.save(p),d&&!g()&&(document.body.dir="rtl"),h&&h({success:!0})},1e3)}catch(e){h&&h({error:!0,data:e})}var t,n}}).catch(function(e){h&&h({error:!0,data:e})})}},l.exit=function(){f()&&(navigator.app?navigator.app.exitApp():navigator.device&&navigator.device.exitApp())},l.vibrate=function(e){f()&&(config.noVibration||(e=e||28,ios||(ios&&(e/=4),"high"==config.vibrationIntensity?e=40:"medium"==config.vibrationIntensity?e=28:"low"==config.vibrationIntensity&&(e=15),navigator&&navigator.vibrate?navigator.vibrate(e):navigator&&navigator.notification&&navigator.notification.vibrate&&navigator.notification.vibrate(e))))},l.deleteEbook=function(t,n){l.libEbooksDirectory.getDirectory(t.path,{},function(e){e.removeRecursively(function(){for(var e=0;e<stg.data.downloaded.length;e++)stg.data.downloaded[e].path==t.path&&(t.downloaded=!1,stg.data.downloaded.splice(e,1),e--);stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,function(){n()})},function(e){})},s)},l.writeEbook=function(n,o,e,i){var r=e;e=null,l.libEbooksDirectory.getDirectory(o.path,{create:!0},function(e){var t=ph.join(o.path,n);l.writeFile(r,t,{relTo:"library"},function(){l.unzipViaPlugin(ph.join(l.libEbooksDirectory.nativeURL,t),ph.join(l.libEbooksDirectory.nativeURL,o.path,"EPUB"),function(e){Vue.set(o,"downloaded",!0),stg.data.downloaded.push(o),$injector.get("library").applyExistingBooks(stg.data.currentLibrary.books),stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,function(){r=null,i()})},function(e){})})})},l.unzip=function(e,t,n,o){l.unzipViaPlugin(url,t,n,o)},l.unzipBlob=function(e,t,n,o){zip.workerScriptsPath="lib/zip/",zip.createReader(new zip.BlobReader(e),function(e){r(e,t,n,o)})},l.unzipViaPlugin=function(e,t,n,o){zip.unzip(e,t,n,o)},l.unzipData64=function(e,t,n,o){zip.workerScriptsPath="lib/zip/",setTimeout(function(){zip.createReader(new zip.Data64URIReader(e),function(e){setTimeout(function(){r(e,t,n,o)},100)})},100)},l.writeFile=function(r,e,t,a){t=t||{};var n=l.appDirectory;"library"==t.relTo&&(n=l.libEbooksDirectory),t.parentDir&&(n=t.parentDir),"number"==typeof r&&(r+="");var o=ph.basename(e);try{l.getDirEntryRecursively(ph.normalize(e),n,function(e){try{e.getFile(o,{create:!0,exclusive:!1},function(e){e.createWriter(function(n){var o=r.byteLength?r.byteLength:r.size,i=0;function t(){var e=Math.min(4194304,o-i);try{var t=r.slice(i,i+e)}catch(e){}n.write(t),i+=e}n.onwrite=function(e){i<o?t():(r=null,a&&a(!0))},n.onerror=function(e){r=null,a&&a(!1)},t()},s)},function(e,t){})}catch(e){}})}catch(e){}},l.getDirEntryRecursively=function(e,t,n){t=t||l.appDirectory;var o,i=e.split("/");1!=i.length?(o=i[0],t.getDirectory(o,{create:!0},function(e){i.shift();var t=i.join("/");l.getDirEntryRecursively(t,e,n)},function(e){})):n(t)},l.openInNativeBrowser=function(e,t){e=e.toString();try{for(var n=e.replace(/\?.*/gi,""),o=["pdf","doc","docx","epub","odt","xls","ppt","pptx","mp3","mp4","exe","pkg"],i=0;i<o.length;i++)if(new RegExp(".*."+o[i]+"$","i").test(n)){t=!0;break}try{if(cordova.InAppBrowser){if(t)return window.cordova.InAppBrowser.open(e,"_system","location=no");l.toast("  "+translit.get("loadingExternalPage")+"  ",{duration:4e3});var r=ios?"yes":"no",a=cordova.InAppBrowser.open(e,"_blank","location=no,hidden=no,clearcache=yes,closebuttoncaption=Go back to App,toolbar="+r+",presentationstyle=formsheet");return a.addEventListener("loadstart",function(){}),a.addEventListener("loadstop",function(){ios||l.hideToast()}),void a.addEventListener("loaderror",function(){if(!ios){try{a&&a.close()}catch(e){}l.hideToast(),l.toast("  "+translit.get("errorLoadingPage")+"  ",{long:!0})}})}}catch(e){}try{if(window.inAppBrowserXwalk){return void window.inAppBrowserXwalk.open(e,{toolbarColor:"#FFFFFF",toolbarHeight:"40",closeButtonText:"< Close",closeButtonSize:"25",closeButtonColor:"#000000",openHidden:!1})}}catch(e){}return void window.open(e,"_system")}catch(e){}},l.initAds=function(){try{if("undefined"==typeof admob)return;if(!admob)return}catch(e){return}config.kotobee.admobId&&(admob.setOptions({publisherId:config.kotobee.admobId}),admob.createBannerView())},l.mobileDownload=function(t){var o;f()&&cordova.plugins.fileOpener2&&((o=new XMLHttpRequest).open("GET",cleanURL(t.replace("../../","epub/EPUB/"))),o.responseType="arraybuffer",o.addEventListener("error",function(e){}),o.addEventListener("load",function(){var n=o.response,e="";switch(device.platform.toLowerCase()){case"android":e=cordova.file.externalRootDirectory;break;case"ios":e=cordova.file.documentsDirectory}window.resolveLocalFileSystemURL(e,function(e){e.getFile(ph.basename(t),{create:!0,exclusive:!1},function(t){t.createWriter(function(e){e.write(n),e.onwriteend=function(){var e=t.toURL();cordova.plugins.fileOpener2.open(e,n.type,{error:function(){},success:function(){}})},e.onerror=function(e){}},function(e){})},function(e){})},function(e){})}),o.send())},l.bookDownloaded=function(e,t){l.fileExists(l.libEbooksDirectory.nativeURL+"/"+e.path,t)},l.readFile=function(e,t,n){t=t||{};var o=new FileReader;return"data"==t.type?o.readAsDataURL(e):o.readAsText(e),o.onloadend=function(){n&&n()},o.onerror=function(e){},o},l.getBlobJs=function(e,o,n){var t;f()&&(t=cordova.file.applicationDirectory+"www/"+e,n=n||function(e){},window.resolveLocalFileSystemURL(t,function(e){e.file(function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result,n=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"}));o(n)},t.onerror=n,t.readAsText(e)},n)},n))},l.readList=function(e,t){e.createReader().readEntries(t)},l.write=function(e,t,n){e.create(t,{create:!0},function(e){e.getFile(function(e){e.createWriter(function(e){e.onwriteend=function(){n&&n()},e.onerror=function(e){},fwriterile.write(content)})})})},l.testInit=function(){l.resolvePath(qfOb.assetsPath,"",function(e){D=e}),D.createReader().readEntries(function(e){D1=e}),D1[0].createReader().readEntries(function(e){D2=e}),D2[0].createReader().readEntries(function(e){D3=e}),D3[0].createReader().readEntries(function(e){D4=e})},l.test1=function(e){e=e||"https://www.quranflash.com/v3/assets/audio/verses/Hudhaify/002001.mp3";var t=qfOb.assetsPath+"Audio/test1.mp3";backend.downloadBinaryFile(e,t,{},function(){})},l.test2=function(e){e=e||"https://filesamples.com/samples/audio/mp3/sample3.mp3";var t=qfOb.assetsPath+"Audio/test2.mp3";backend.downloadBinaryFile(e,t,{},function(){})},l.test3=function(e){e=e||"https://enterprise.quranflash.com/file.zip";var t=qfOb.assetsPath+"Audio/test3.zip";backend.downloadBinaryFile(e,t,{},function(){crdv.unzipViaPlugin(t,qfOb.assetsPath+"Audio",function(e){})})},l.test4=function(e){e=e||"https://quranflash.fra1.digitaloceanspaces.com/assets/audio/verses/Qasim/001.zip?X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=OTZAZEJRFKMUSBV6W655%2F20220328%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20220328T140417Z&X-Amz-SignedHeaders=host&X-Amz-Expires=86400&X-Amz-Signature=faea875da8af567f8e3cefb57bb958d3b5c93431df922a9fe3dce9a36afdea71";var t=qfOb.assetsPath+"Audio/test4.zip";backend.downloadBinaryFile(e,t,{},function(){crdv.unzipViaPlugin(t,qfOb.assetsPath+"Audio",function(e){})})},l.test5=function(e,t){e=e||"https://enterprise.quranflash.com/asset/audio/Akhdar/1",fileEntry,t=t||qfOb.assetsPath+"Audio/test5.zip",(new FileTransfer).download(e,t,function(e){crdv.unzipViaPlugin(t,qfOb.assetsPath+"Audio",function(e){})},function(e){})},l}),createService("cssParser",function(){var r,w={},o=[];function C(e){e=e.replace(/\r?\n|\r/g," ");var t,n=[],o="key",i=[0],r=n,a=[r];function s(e){return e=e||1,i[i.length-e]}for(var c=0;c<e.length;c++)t=t||{},"}"==e[c]?("properties"==o&&(t.properties=e.substring(s(),c).trim(),t.keys&&t.keys.length&&(t.keys[t.keys.length-1]=t.keys[t.keys.length-1].trim()),r.push(t)),"key"==o&&1<a.length&&(a.pop(),r=a[a.length-1]),t=null,o="key",i.push(c+1)):"{"==e[c]?("properties"==o&&(t.children||(t.children=[]),t.keys&&t.keys.length&&(t.keys[t.keys.length-1]=t.keys[t.keys.length-1].trim()),n.push(t),r=t.children,a.push(r),(t={keys:[]}).keys.push(e.substring(s(),c).trim())),i.push(c+1),o="properties"):"key"==o&&(t.keys||(t.keys=[""]),","==e[c]?t.keys.push(""):t.keys[t.keys.length-1]+=e[c]);return n}return w.clearCache=function(){o=[]},w.inject=function(i,b,e){b=b||{};var r="",a=0;function s(e,t){for(var n=0;n<o.length;n++)if(o[n].url==e&&o[n].id==t)return o.push(o[n]),o[n]}function k(e){7<o.length&&o.shift(),o.push(e)}function y(e){var t=e;return t=(t=(t=(t=(t=t.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"")).replace(/ {2,}/g," ")).replace(/ ([{:}]) /g,"$1")).replace(/([;,]) /g,"$1")).replace(/ !/g,"!")}!function t(f,n){if(!f)return f={},void v();if("path"==f.type){var m=f.val;if(!m||0<=m.indexOf("EPUB/css/kotobeeInteractive.css"))return void v();var e=s(m,b.id);e?v(e.val):khttp.get(f.dontCache?m:cacheBust(m)).success(function(e){o(e,m,"url")}).error(function(){v()})}else o(f.val,f.root);function o(e,t,n){if(!e)return v();if(config.dontParseCss)return"url"==n&&k({url:m,val:e,id:b.id}),void v(e);if(workers.supported()){var o={};return o.data=e,o.rootPath=t,o.cssOb=f,o.desktop=desktop,o.native=native,o.mobile=mobile,void workers.call("cssParser","parse",[o],function(e){"url"==n&&k({url:m,val:e,id:b.id}),v(e)})}e=(e=(e=(e=(e=(e=(e=w.applyRoot(t,e)).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/<!--/g,"")).replace(/-->/g,"")).replace(/@charset.*?;/g,"")).replace(/@namespace.*?;/g,"")).replace(/:root{/g,"html{");var i="spreadL";b.id&&(i=b.id);var r=(f.parentClass?f.parentClass:"#epubContainer.stylesEnabled")+" #"+i,a=C(e),s="";try{for(var c=0;c<a.length;c++){var l=g(a[c].keys);if(s+=l.joined,s+="{",a[c].children&&a[c].children.length)for(var d=0;d<a[c].children.length;d++){var u,p=g(a[c].children[d].keys);s+=p.joined,s+="{"+a[c].children[d].properties+"}",!p.hasBody||(u=h(a[c].properties))&&(s+="#epubContainer{"+u+"}")}a[c].properties&&(s+=a[c].properties),s+="}",!l.hasBody||(u=h(a[c].properties))&&(s+="#epubContainer{"+u+"}")}}catch(e){}function h(e){if(e){for(var t=e.split(";"),n="",o=0;o<t.length;o++)t[o]&&-1!=t[o].trim().indexOf("background")&&(n=t[o].trim().replace(/url\(.*?\)/g,"")+";");return n}}function g(e){for(var t,n={},o=0;o<e.length;o++){e[o]&&(0!=(t=e[o].trim()).indexOf("body")?0!=t.indexOf("html")?0!=t.indexOf("@media")&&0!=t.indexOf("@")&&isNaN(t[0])&&"from"!=t&&"to"!=t&&(e[o]=r+" "+t):e[o]=t.replace("html",r):(e[o]=t.replace("body",r),0==e[o].indexOf("html")&&(e[o]=e[o].replace("html",r)),n.hasBody=!0))}return n.joined=e.join(","),n}e=y(e=s),"url"==n&&k({url:m,val:e,id:b.id}),v(e)}function v(e){e&&(r+=e),++a<i.length?t(i[a],n):n&&n(r)}}(i[a],e)},w.applyRoot=function(r,e){if(e){return e.replace(/url\((.*?)\)/g,function(e,t){if(!t||!t.trim())return e;var n="";if(0==t.indexOf('"')?(t=t.substr(1,t.length-2),n='"'):0==t.indexOf("'")&&(t=t.substr(1,t.length-2),n="'"),-1!=t.indexOf("http://"))return e;if(-1!=t.indexOf("https://"))return e;if(0==t.indexOf("data:"))return e;if(0==t.indexOf("kotobee:"))return e;var o=1<t.split(" ").length,i=1<(t=ph.join(r,t)).split(" ").length;return!o&&i&&(n='"'),"url("+n+cleanURL(t)+n+")"})}},w.getStyles=function(){return r},w.replaceStyles=function(e,t){var n;t=t||{};for(var o=document.getElementsByTagName("style"),i=0;i<o.length;i++)if(null!=o[i].getAttribute("kotobee")){n=o[i];break}r=e,t.append&&(r=n.innerHTML+" "+e),n=replaceHTML(n,r)},w.hideStyles=function(){removeClass(cache.getOb("epubContainer"),"stylesEnabled")},w.showStyles=function(){addClass(cache.getOb("epubContainer"),"stylesEnabled")},w.stylize=function(e,t){var n=document.getElementById(e);if(n){for(var o=n.getAttribute("style"),i=Object.keys(t),r=o?o+";":"",a=0;a<i.length;a++)r+=i[a]+":"+t[i[a]]+";";n.setAttribute("style",r)}},w}),createService("design",function(){var t,o,e={};return e.getBgStyle=function(){var e;return t||(e="",isKotobeeHosted()&&(e=publicRoot),"stretch"==(t={"background-image":'url("'+(config.splashBg?e+"imgUser/"+config.splashBg:"none")+'")',"background-color":config.splashBgColor?config.splashBgColor:"#3f3248",color:(config.splashColor?config.splashColor:"#fff")+" !important","background-size":config.splashBgSize?config.splashBgSize:"cover"})["background-size"]&&(t["background-size"]="100% 100%")),t},e.convertTabs=function(){if(config.tabs){config.customTabs=[];for(var e=0;e<config.tabs.length;e++){var t,n,o,i=document.createElement("div");i.setAttribute("data-kotobee",config.tabs[e]),config.customTabs[e]=kInteractive.readData(i),config.customTabs[e]&&config.customTabs[e].icon&&(t="",isKotobeeHosted()&&(t=publicRoot),isReaderApp&&(t=ph.join(bookPath,"_kmeta")+"/"),o=cleanURL(t+"imgUser/"+config.customTabs[e].icon),"book"==config.src&&(o=native||desktop?cleanURL(bookPath+"_kmeta/imgUser/"+config.customTabs[e].icon):(n=bookPath.split("/books/")[1].split("/")[0],config.kotobee.public?cleanURL(stg.data.paths.private+"books/"+n+"/EPUB/_kmeta/imgUser/"+config.customTabs[e].icon):cleanURL(config.kotobee.liburl+"books/"+n+"/EPUB/_kmeta/imgUser/"+config.customTabs[e].icon))),config.customTabs[e].iconStyle={"background-image":'url("'+o+'")'})}}},e.injectUserCSS=function(n){function t(){for(var e=document.getElementsByTagName("style"),t=0;t<e.length;t++)if(e[t].hasAttribute("user")){e[t].innerHTML=$interpolate(o)(n);break}}o?t():khttp.get(cacheBust(rootDir+"css/user.css")).success(function(e){o=e,t()})},e.applyRichTextLibrary=function(){for(var e,t,n=document.getElementsByTagName("script"),o=0;o<n.length;o++)if(n[o].getAttribute("src")&&0<=n[o].getAttribute("src").indexOf("quill/quill.min.js")){e=n[o];break}for(var i,r,a,s=document.getElementsByTagName("link"),o=0;o<s.length;o++)if(s[o].getAttribute("href")&&0<=s[o].getAttribute("href").indexOf("quill/quill.snow.css")){t=s[o];break}config.htmlInNotes?(i=document.getElementsByTagName("head")[0],e||((r=document.createElement("script")).src=rootDir+"lib/quill/quill.min.js",i.appendChild(r)),t||((a=document.createElement("link")).setAttribute("rel","stylesheet"),a.setAttribute("href",rootDir+"lib/quill/quill.snow.css"),i.appendChild(a))):(e&&e.parentNode.removeChild(e),t&&t.parentNode.removeChild(t))},e.stylize=function(e,t){cssParser.stylize(e,t)},e}),createService("events",function(){var e={};return e.initialize=function(){},e.add=function(e,t){readerV<1.5||(e.target=e.currentTarget=e.elem,kotobee.dispatchEvent(e.action,e),e.disableRemote||backend.addEvent(e,t))},e}),createService("htmlParser",function(){var e={wrapOrphans:function(e){var t=[],n=e.getElementsByTagName("body")[0];if(n){for(var o=0;o<n.childNodes.length;o++)3==n.childNodes[o].nodeType&&t.push(n.childNodes[o]);for(o=0;o<t.length;o++){var i=t[o],r=document.createElement("span");r.textContent=i.textContent,i.nextSibling?n.insertBefore(r,i.nextSibling):n.appendChild(r),n.removeChild(i)}}},parse:function(e){var t=[],n=[];t.push(/([< \/][^>]*?>)((\s*[^<\s]+\s+?)+)([^<\s]+\s*)(<)/g),n.push(/(>)([^<\n]*?[^<]+?)(<[^\/])/g),n.push(/(<\/[^>]*?>)([^<]*?)(<\/)/g);for(var o=0;o<t.length;o++){var i=t[o];e=e.replace(i,function(e,t){if(t.match(/<[^>]*?class="[^"]*?parsed.*?>/g))return e;if(0==t.indexOf("<pre"))return e;if(0==t.indexOf("<code"))return e;if(0==t.indexOf("<script"))return e;var n="",o=arguments[2].split(" ");""==o[o.length-1]&&o.splice(-1,1),o.push(arguments[4]);for(var i=0;i<o.length;i++){var r=i==o.length-1?"":" ";n+="<span>"+o[i]+r+"</span>"}return t+n+"<"})}for(o=0;o<n.length;o++)e=e.replace(n[o],function(e,t){return arguments[2].trim()?t+("<span>"+arguments[2]+"</span>")+arguments[3]:e});return e=e.replace(/(<a [\s\S]*?)(>)/g,'$1 onclick="return false;" $2'),native&&mobile&&(e=e.replace(/(<img[^>]*src=)"(.*?)"/g,function(e,t){return t+'"'+cleanURL(arguments[2])+'"'})),e}};return e}),createService("initializer",function(){var l,r,o,a={},t=[];function s(e,t){e.className="",setTimeout(function(){e.className="icon fa fa-cog fa-spin size16",setTimeout(t,400)},500)}function c(){var o=require("nw.gui");l=l||new o.Menu({type:"menubar"});var e=new o.Menu;e.append(c({label:translit.get("exit")},a)),l.append(c({label:translit.get("file")},a,e));for(var t=new o.Menu,n=new o.Menu,i=stg.data.languages,r=0;r<i.length;r++)n.append(c({label:i[r].label},s));function a(e){this.label.toLowerCase()==translit.get("exit").toLowerCase()&&o.App.quit()}function s(e){var t=this.label;setTimeout(function(){for(var e=0;e<stg.data.languages.length;e++)if(stg.data.languages[e].label==t)return stg.data.settings.language=stg.data.languages[e].val,settings.langChanged(),void($rootScope.$$phase||$rootScope.$apply())},300)}function c(e,t,n){return t&&(e.click=t),n&&(e.submenu=n),new o.MenuItem(e)}t.append(c({label:translit.get("language")},a,n)),l.append(c({label:translit.get("settings")},a,t)),o.Window.get().menu=l}function h(e,t){return function(e){var t=new URLSearchParams("?"+e.slice(1)).get("id_token")||null;if(t&&sso&&sso.parseJWT){var n=sso.parseJWT(t);if(n&&n.iss)return-1!==n.iss.indexOf("microsoft")}}(e)?"microsoft":t.get("provider")||""}return a.initialize=function(){var i;a.initialized||a.initializing||(stg.data.initPath=$location.path(),$location.path("/"),i=function(){$ionicPlatform.ready(function(){var e=null==config.startupScreenDelay?700:1e3*config.startupScreenDelay;config.noLoadingScreen&&(e=0),setTimeout(function(){var e;e=function(){removeClass(document.body,"loading")},function e(t){if(preview&&-1!=window.location.href.indexOf("&screenshot")&&0<=window.location.href.indexOf("&startup"))return;return t();if("localhost"==location.hostname)return t();var n=document.getElementById("iconDetector");if(preview&&-1!=window.location.href.indexOf("&screenshot"))return void(-(n.style.opacity=1)==window.location.href.indexOf("&startup")&&t&&t());s(n,function(){o=o||setTimeout(function(){n.style.opacity=1,t&&t()},8e3),n.offsetWidth<10?setTimeout(function(){e(t)},1e3):(clearTimeout(o),n.style.opacity=1,setTimeout(function(){t&&t()},1e3))})}(function(){backend.initialize().then(function(){!function(e){var t;config.kotobee.cloudid&&(t=!0);isKotobeeHosted()&&(t=!0);"kotobee"==config.kotobee.hostType&&(t=!0);config.kotobee.offline&&(t=!1);isReaderApp&&(t=!1);t?backend.getS3Paths(e):e()}(function(){"library"==config.kotobee.mode||isReaderApp||("book"==config.kotobee.mode?(bookPath="epub/",preview&&(bookPath=config.kotobee.bookPath),bookPath=bookPath||"epub/"):"app"==config.kotobee.mode||(kStatus.update(),kError.update({error:"errorAndCallback",msg:"cantReadConfigFile",cb:crdv.exit}))),auth.authenticate(),e&&e()})}),$timeout(function(){$ionicPlatform.registerBackButtonAction(function(e){var t=$ionicHistory.currentView();kInteractive.frameIsOpen?kInteractive.closeFrame():kInteractive.alertIsOpen?kInteractive.closeAlert():kInteractive.videoIsFullscreen?kInteractive.closeFullscreenVideo():"forgotPwd"==t.stateId||"register"==t.stateId?$ionicHistory.goBack():"library"==t.stateId&&isReaderApp?$location.path("/app"):modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}}),$rootScope.$apply()},101)},500),$rootScope.$apply(),a.initialized=!0,a.initializing=!0,kotobee.dispatchEvent("initialized"),function(){for(var e=0;e<t.length;e++)t[e].apply(this,arguments)}()})},e)})},a.initializing=!0,stg.initialize(),np.initialize(),chapterAPI.initialize(),crdv.initialize(function(){workers.initialize(),design.injectUserCSS(config);var e=a.getLogo();a.playAudio(),a.displayBg(),backend.addListener("pathsChanged",a.playAudio),backend.addListener("pathsChanged",a.displayBg);for(var t=document.getElementsByTagName("link"),n=0;n<t.length;n++)if("shortcut icon"==t[n].getAttribute("rel")){if(!t[n].getAttribute("href")){var o=config.icon?config.icon:e.logo;try{desktop&&np.require("nw.gui").App.manifest.window.icon&&(o=np.require("nw.gui").App.manifest.window.icon)}catch(e){}t[n].setAttribute("href",o)}break}cache.initialize(),tinCan.initialize(),scorm.initialize(),events.initialize(),autohide.initialize(),freehand.initialize(),annotations.initialize(),login.initialize(),nav.initialize(),cart.initialize(),tts.initialize(),stg.initializeSettings(function(){settings.langChanged(),window.addEventListener("message",function(e){var t=e.data&&"string"==typeof e.data?e.data.split(":"):[""];if("next"==t[0])chapters.nextChapter();else if("prev"==t[0])chapters.prevChapter();else if("notebook"==t[0])angular.element(document.getElementById("tabMenu")).scope().notebookClicked();else if("goto"==t[0])$location.path($injector.get("library").root+"/reader/chapter/"+Number(t[1]));else if("zoom"==t[0])for(var n=document.getElementsByTagName("meta"),o=0;o<n.length;o++)"viewport"==n[o].getAttribute("name")&&n[o].setAttribute("content","initial-scale="+t[1])},!1),window.kbOpenChapterURL=function(e){e&&(isAbsoluteURLPath(e)?window.location.href=e:(e=ph.join(stg.data.book.chapter.url,e),chapters.applyChapterStateFromURL(e)))},window.addEventListener("keydown",function(e){if("a"==e.key&&(e.ctrlKey||e.metaKey)){var t=e.target;if(!t||!t.nodeName)return;"input"!=t.nodeName.toLowerCase()&&"textarea"!=t.nodeName.toLowerCase()||t.select()}}),desktop&&c(),native||(document.onkeydown=function(e){"app"!=config.kotobee.mode&&document.activeElement&&"epubContainer"==document.activeElement.id&&(modals.shown()||kotobee.disableKeyboardInteraction||(e=e||window.event).shiftKey||("37"==e.keyCode?(stg.data.settings.rtl?chapters.nextChapter():chapters.prevChapter(),$rootScope.$$phase||$rootScope.$apply()):"39"==e.keyCode&&(stg.data.settings.rtl?chapters.prevChapter():chapters.nextChapter(),$rootScope.$$phase||$rootScope.$apply())))}),vueExclude&&cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("loading")+"..")),translit.addListener(function(){desktop&&function(){if(l)for(;l.items.length;)l.removeAt(0);c()}(),r||vueExclude&&(stg.data.book||stg.data.book.meta||cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("loading")+"..")))}),r=!0,i&&i()})}))},a.displayBg=function(){design.stylize("home",design.getBgStyle())},a.playAudio=function(){var e,t,n,o;config.audio&&(document.bgAudio||(e="",isKotobeeHosted()&&(e=publicRoot),t=e+"imgUser/"+config.audio,(n=document.createElement("audio")).setAttribute("data-dontclose",!0),n.setAttribute("controls","true"),n.setAttribute("autoplay","true"),n.setAttribute("src",t),config.audioLoop&&n.setAttribute("loop","true"),n.setAttribute("data-tap-disabled","false"),(o=document.createElement("source")).src=t,n.appendChild(o),n.appendChild(document.createTextNode("Your browser does not support the audio element")),n.oncanplay=function(){kInteractive.tinCan({verb:"played",activity:"Audio: "+t})},n.play(),document.bgAudio=n))},a.getLogo=function(){var e="";return isKotobeeHosted()&&(e=publicRoot),{logo:config.logo?e+"imgUser/"+config.logo:rootDir+"img/ui/defaultWelcomeLogoNew.png",slogan:config.slogan?config.slogan:""}},a.addListener=function(e){t.push(e)},a.handleRedirect=function(e){var t,n,o,i,r=!1,a=new URLSearchParams(window.location.search),s=h(e,a),c=a.get("state")||"",l=a.get("payment")||"",d=a.get("success")||"",u=a.get("book_id")||"",p=a.get("user_id")||"";return s?(n=(t=new URLSearchParams("?"+e.slice(1))).get("id_token")||"-",o=t.get("access_token")||"-",(n||o)&&(r=!0,$location.path("/authredirect/"+s+"/"+encodeURIComponent(n)+"/"+encodeURIComponent(o)))):c?(r=!0,window.location.replace(getBaseSuffix())):l&&d&&p&&(r=!0,i="/payment/"+l+"/"+("true"==d?"success":"cancel"),u&&(i+="/"+u),i+="/"+p,$location.path(i)),r},a}),createService("jsParser",function(){var u,o,i,e={},n=[];return e.clearCache=function(){n=[]},e.inject=function(a,e){var s=[];function c(e){for(var t=0;t<n.length;t++)if(n[t].url==e)return n.push(n[t]),n[t]}function l(e){5<n.length&&n.shift(),n.push(e)}function d(){for(var e,t=0;t<s.length;t++){s[t]&&(0<=s[t].indexOf("window.location.href")&&(e=/window\.location\.href[\s]*?=(.*?)[;\n]/g,s[t]=s[t].replace(e,"try { kbOpenChapterURL($1); } catch(er){};")),0<=s[t].indexOf("event.stopPropagation()")&&(e=/event\.stopPropagation\(\)/g,s[t]=s[t].replace(e,"void(0)")),0<=s[t].indexOf("<![CDATA[")&&(e=/<!\[CDATA\[/g,s[t]=s[t].replace(e,"//<![CDATA["),e=/\]\]>/g,s[t]=s[t].replace(e,"//]]>")))}}(function e(t,n){if(!t)return void r();{function o(e){e&&s.push(e),r()}var i;"code"==t.mode?(s.push(t.val),r()):(i=c(t.val))?o(i.val):khttp.get(cacheBust(t.val)).success(function(e){l({url:t.val,val:e}),o(e)}).error(function(){o()})}function r(){++u<a.length?e(a[u],n):(d(),n&&n(s))}})(a[u=0],e)},e.getScript=function(){return o},e.replaceScript=function(e){if(o=e,i&&i.length)for(var t=0;t<i.length;t++)i[t].parentNode&&i[t].parentNode.removeChild(i[t]);i=[];for(t=0;t<e.length;t++){var n=document.createElement("script");n.setAttribute("kotobee",""),n.setAttribute("type","text/javascript"),n.innerHTML=e[t],i.push(n);try{document.head.appendChild(n)}catch(e){}try{try{document.dispatchEvent(new Event("DOMContentLoaded"))}catch(e){}}catch(e){}}},e}),createService("kError",function(){var o={},i=[];return o.modal=null,o.update=function(e){var t;if(e)switch(e.error){case"s_authError":"library"==config.kotobee.mode&&backend.cloudParam("entry")?t={mode:"loginPanel",dynamic:!0,animation:"slide-in-up",loginOptions:{errorReason:e.reason}}:$injector.get("login").toLoginScreen();break;case"networkError":t={mode:"networkError",errorOptions:{ref:e.ref,retry:o.retry}};break;case"localonlyError":t={mode:"localOnlyError",errorOptions:{ref:e.ref,retry:o.retry}};break;case"errorAndCallback":t={mode:"generalError",errorOptions:{msg:translit.get(e.msg),cb:e.cb}};break;case"ssoEmailError":t={mode:"ssoEmailError",errorOptions:{provider:{name:e.provider},cb:e.cb}};break;default:t={mode:"generalError",errorOptions:{msg:translit.get(e.error)}}}for(var n=0;n<i.length;n++)i[n].error==e.error&&i[n].func(t);t&&modals.show(t)},o.retry=function(e){modals.hideAll(),setTimeout(function(){e&&e.func&&e.func.apply(null,e.args)},100)},o.detect=function(e,t){i.push({error:e,func:t})},o.removeDetection=function(e,t){for(var n=0;n<i.length;n++)if(t==i[n].func&&e==i[n].error)return void i.splice(n,1)},o}),createService("khttp",function(){var e={};return e.get=function(e){var t=$q.defer();return(native||desktop)&&-1==e.indexOf("http")&&-1!=e.indexOf("?")&&(e=e.split("?")[0]),backend.sendRawPost(cleanURL(e),{},{ignoreCredentials:!0,method:"GET"},function(e){return e&&"d_connectionTimedOut"!=e.error&&"networkError"!=e.error?void t.resolve(e):t.reject()}),t.promise},e.post=function(e,t,n){var o=$q.defer();return backend.sendRawPost(cleanURL(e),t,n,function(e){return e?void o.resolve(e):o.reject()}),o.promise},e}),createService("kMiniapps",function(){var service={},miniappsConfig={},log=kLog;function openPreviewApp(){if(previewParams&&previewParams.appfolder)for(var e=0;e<stg.data.miniapps.length;e++)if(stg.data.miniapps[e].folder==previewParams.appfolder){document.getElementById("readerHeader");return compInstances.headerDefault.miniappsClicked(),void setTimeout(function(){service.openFromMenu(stg.data.miniapps[e])},1e3)}}function validate(e,t){if(kInteractive.isSDK())return 1;var n,o=e.join(";");"book"==config.kotobee.mode?n=CryptoJS.MD5(stg.data.packageOpf.replace(/\s+/g,"")+o).toString():"library"==config.kotobee.mode&&(n=CryptoJS.MD5(config.kotobee.cloudid+o).toString());return n==t[window.atob("Y2hlY2tzdW0=")]}return service.initialize=function(ob){var book,appids,miniapps,css,root;ob=ob||{},ob.mode||(ob.mode="book"),config.disableMiniapps||(book=$injector.get("book"),"library"==config.kotobee.mode&&"book"==ob.mode&&config.noBookOverride||(appids=[],miniapps=[],Vue.set(stg.data,"miniapps",miniapps),css="",root=service.getRoot(),khttp.get(cacheBust(root+"miniapps.js")).success(function(miniappScript){if(miniappScript&&!miniappScript.error){eval(miniappScript);var json=miniappJson.apps,arr=[];for(var item in json)arr.push({folder:item,code:json[item]});arr.length&&next(0)}function next(index){if(index>=arr.length)return finalize();var folder=arr[index].folder;khttp.get(cacheBust(root+"miniapps/"+folder+"/config.js")).success(function(configScript){function proceed(dataJson){dataJson=dataJson||{},eval(configScript);var configJson=window.miniappConfig;"string"==typeof configJson&&(configJson=JSON.parse(configJson));var appid=configJson.appid;appids.push(appid);var regex=new RegExp("{{"+appid+"Root}}","g"),regexEncoded=new RegExp(encodeURIComponent("{{"+appid+"Root}}"),"g"),code=arr[index].code,code=code.replace(regex,root+"miniapps/"+folder);code=code.replace(regexEncoded,root+"miniapps/"+folder),code=code.replace(/{{www}}/g,root+"../..");try{eval(code)}catch(e){return void next(++index)}var miniappClass=window.miniappOutput;if(css+=arr[index].css,!miniappClass.open)return next(++index);var lang=translit.getLang();"fr"!=lang&&"es"!=lang&&"ar"!=lang&&(lang="en"),miniapps.push({appid:appid,folder:folder,appClass:miniappClass,configJson:configJson,dataJson:dataJson}),delete window.miniappConfig,delete window.miniappOutput,next(++index)}kInteractive.isSDK()?proceed():khttp.get(cacheBust(root+"miniapps/"+folder+"/userdata/data.json")).success(proceed).error(proceed)})}function finalize(){var e;validate(appids,miniappJson)&&((e=document.createElement("style")).setAttribute("data-miniapps","stylesheet"),e.setAttribute("type","text/css"),e.innerHTML=css,document.body.appendChild(e),$rootScope.$$phase||$rootScope.$apply(),preview&&setTimeout(openPreviewApp,1e3))}})))},service.openFromMenu=function(e){e.appClass.externalLink||service.open(e),$ionicSideMenuDelegate.isOpenLeft()?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},service.openById=function(t){(stg.data.miniapps||[]).forEach(function(e){e.appid==t&&service.open(e)})},service.open=function(e){e.appClass&&e.appClass.open&&(kInteractive.events&&kInteractive.events.add({action:"miniappOpened",param:e.appid,data:e}),e.appClass.open())},service.getRoot=function(){var e,t;return"library"==config.src?t="undefined"!=typeof publicRoot?publicRoot:"./":(t=bookPath+"_kmeta/",isKotobeeHosted()&&(t=isAbsoluteURLPath(bookPath)?bookPath+"_kmeta/":config.kotobee.public?publicRoot+"epub/_kmeta/":(e=publicRoot.split("/books/")[1].split("/")[0],config.kotobee.liburl+"books/"+e+"/EPUB/epub/_kmeta/"))),t},service}),createService("kStatus",function(){var e,s={},c=1e4;function l(){e&&(clearTimeout(e),e=null)}function d(){l(),c&&(e=setTimeout(function(){s.update().then(function(){s.showAndHide(translit.get("statusTimeoutError"),3e3)})},c))}return s.update=function(e,t,n){var o,i=$q.defer();if((n=n||{}).dots&&(e+=' <ion-spinner icon="dots" class="loadingSpinner"></ion-spinner>'),n.progress&&(e+='<div class="loadingProgress"></div>'),c=n.timeoutDuration?n.timeoutDuration:1e4,l(),e){d();var r={template:e};for(var a in n)r[a]=n[a];!function(e){var t=document.getElementById("ionicLoading");{var n;t||((t=document.createElement("div")).id="ionicLoading",document.getElementById("kotobeeVue").appendChild(t),(n=new compClasses.ionicLoading).$mount(t))}(n=compInstances.ionicLoading).show&&n.show(e)}(r),s.updateProgress()}else(o=compInstances.ionicLoading)&&o.hide();return timeOut(function(){i.resolve()},t||250),i.promise},s.updateProgress=function(e){1<(e=e||0)&&(e=1);var t=document.getElementsByClassName("loadingProgress");t.length&&(t[0].style.width=Math.round(100*e)+"%"),0<e&&d()},s.showAndHide=function(e,t){s.update(e,t).then(function(){s.update()})},s}),createService("landing",function(){return{}}),createService("library",function(){var r,a={},t=[];function s(e){e=e||{},a.maxResults=e.large?40:20}function c(){for(var e=0;e<t.length;e++)t[e].apply(this,arguments)}return a.root="",a.run=0,a.initialize=function(e){a.setBrowserTitle(),a.run++,s(),t=[],a.readDownloadedBooks(function(){a.readPrepackagedBooks(function(){c("initialized"),e&&e()})})},a.setMax=function(e){a.maxResults=e},a.setBrowserTitle=function(){stg.data.currentLibrary&&cache.setOb("title",replaceHTML(cache.getOb("title"),stg.data.currentLibrary.name?stg.data.currentLibrary.name:translit.get("library")))},a.addListener=function(e){t.push(e)},a.getEbooks=function(n,o,i){c("preload",n=n||{}),backend.getS3PathsIf(!stg.data.paths,function(e){return!e||e.error?(c("postload",n,e={empty:!0}),o?o(e):null):(r=Math.round(1e5*Math.random()),n.more?(t=(t=n.contentkey?{large:!0}:{})||{},a.maxResults+=t.large?20:6):s(n.contentkey?{large:!0}:{}),n.sort=stg.data.sortOb.method.data,n.sortDir=stg.data.sortOb.method.dir,n.max=a.maxResults,void backend.getEbooks(n,r,function(e,t){t==r?(document.getElementById("libraryThumbs"),e.error||(n.sections&&(e=function(e){Vue.set(stg.data.currentLibrary,"sections",e);for(var t=[],n=0;n<e.length;n++)for(var o=0;o<e[n].books.length;o++)t.push(e[n].books[o]);return t}(e)),a.applyExistingBooks(e,n),a.applyCoverImgs(e),payment.registerInAppProducts(e),function(e){try{kotobee.dispatchEvent("libraryBooksFetched",e),n.favs?stg.data.favorites=e:stg.data.currentLibrary.books=e}catch(e){}}(e)),e&&e.length||(e.empty=!0),c("postload",n,e),o&&o(e)):i&&i()}));var t})},a.applyCoverImgs=function(e){var t={};if(stg.data.currentLibrary.books){for(var n=0;n<stg.data.currentLibrary.books.length;n++)t[stg.data.currentLibrary.books[n].id]=stg.data.currentLibrary.books[n];for(n=0;n<e.length;n++)t[e[n].id]&&(e[n].coverImg=t[e[n].id].coverImg)}},a.readDownloadedBooks=function(o){try{return native||desktop?stg.readSlot("downloaded"+stg.getBookId(!0),function(e){stg.data.downloaded=e;for(var n=0;n<stg.data.downloaded.length;n++)Vue.set(stg.data.downloaded[n],"downloaded",!0),Vue.delete(stg.data.downloaded[n],"coverImg"),Vue.delete(stg.data.downloaded[n],"coverStyle"),Vue.delete(stg.data.downloaded[n],"bannerStyle");n=stg.data.downloaded.length-1;!function t(){if(n<0)return stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,o);(desktop?np:crdv).bookDownloaded(stg.data.downloaded[n],function(e){e||stg.data.downloaded.splice(n,1),t(--n)})}()}):o?o():null}catch(e){stg.data.downloaded=[]}stg.data.downloaded||(stg.data.downloaded=[]),o&&o()},a.readPrepackagedBooks=function(t){if(!native&&!desktop)return t?t():null;Vue.set(stg.data,"prepackaged",[]),khttp.get("books/books.json").success(function(e){return e?(Vue.set(stg.data,"prepackaged",e),void(t&&t())):t?t():null}).error(function(e){return t?t():null})},a.applyExistingBooks=function(e,t){if(t=t||{},(native||desktop)&&!t.catid&&!t.favs&&(e||stg.data.currentLibrary&&(e=stg.data.currentLibrary.books),e)){for(var n=[],o=[],i=0;i<stg.data.downloaded.length;i++)n.push(stg.data.downloaded[i].id);for(i=0;i<stg.data.prepackaged.length;i++)o.push(stg.data.prepackaged[i].id);for(i=n.length;i--;)2<=s(n[i],n)&&(downloaded.splice(i,1),n.splice(i,1));for(i=0;i<o.length;i++)e.unshift(Object.assign({downloaded:!0},stg.data.prepackaged[i]));for(i=0;i<n.length;i++)e.unshift(Object.assign({},stg.data.downloaded[i]));for(var r=[],i=0;i<e.length;i++)r.push(e[i].id);for(var a,i=e.length;i--;){2<=s(r[i],r)&&(a=existsInArray(r[i],r,{index:!0}),Object.assign(e[a],e[i]),e.splice(i,1),r.splice(i,1))}}function s(e,t){for(var n=0,o=0;o<t.length;o++)t[o]==e&&n++;return n}},a}),createService("login",function(){var n={};function t(e,t,n,o){e&&t&&(n||o)&&(Vue.set(stg.data,"user",{email:t,loggedIn:!0}),backend.login({accessToken:n,idToken:o,ssoProvider:e}).then(function(e){stg.data.sso.ssoBusy=!1,e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):i(!0)}).catch(function(e){}))}function i(e){function t(e){!stg.data.user.email&&stg.data.sso&&stg.data.sso.oauth?n.toLoginScreen():(modals.hide(),e&&e.error&&!backend.cloudParam("allowlogin")||auth.startup())}!backend.cloudParam("public")&&!backend.cloudParam("entry")||backend.cloudParam("allowlogin")?e?t():backend.login({dontShowErrorDialog:backend.cloudParam("public")&&backend.cloudParam("allowlogin")}).then(t):auth.startup()}return n.initialize=function(){vueApp.$on("SignIn",function(e){sso.signInBrowser(e,t)})},n.start=function(){config.kotobee&&config.kotobee.sso?sso.initialize(function(){var e;!stg.data.user.email&&stg.data.sso&&stg.data.sso.oauth?(e=stg.data.sso.oauth.provider,sso.getSSOEmail(e,function(e){i()})):i()}):i()},n.logout=function(){config.kotobee&&config.kotobee.sso&&stg.data.sso.oauth&&sso.signOutBrowser(stg.data.sso.oauth.provider),stg.data.user.rememberMe=!1},n.toLoginScreen=function(){config.kotobee.landing?$injector.get("book").loadBook({getInfoOnly:!0}).then(function(){$location.path("/landing")}):$location.path("/login"),setTimeout(function(){$ionicHistory.clearHistory();var e=document.getElementById("chapters");e&&e.parentNode.removeChild(e)},1e3)},n}),createService("markers",function(){var n={},o=new Array,e={};function a(e,t){var n=Number(e.style.top.split("px")[0]),o=Number(t.style.top.split("px")[0]);return Math.abs(n-o)<10}return n.addMarker=function(e){o.push(e),n.refreshMarker(e)},n.deleteMarker=function(e){for(var t=0;t<o.length;t++)o[t].id==e&&o.splice(t,1)},n.windowResize=function(){(function(){if($location.path()&&0<=$location.path().indexOf("/reader"))return!1;return!0})()||e.width==window.innerWidth&&e.height==window.innerHeight||(n.refreshMarkers(),e.width=window.innerWidth,e.height=window.innerHeight)},n.refreshMarkers=function(){for(var e=0;e<o.length;e++)n.refreshMarker(o[e])},n.refreshMarkerById=function(e){for(var t=0;t<o.length;t++)if(o[t].id==e)return void n.refreshMarker(o[t])},n.getMarker=function(e){for(var t=0;t<o.length;t++)if(o[t].id==e)return o[t]},n.refreshMarker=function(e){var t=e.target();if(t&&e.elem){var n="",o="page";(hasClass(e.elem,"contentSideNoteMarker")||hasClass(e.elem,"contentBookMarker"))&&(o="side");var i=cache.getOb("epubContainer").getElementsByClassName("scroll")[0],r=cache.getOb("epubContent");if(i){var a=t.getBoundingClientRect(),s=i.getBoundingClientRect(),c=r.getBoundingClientRect(),l=getElemPadding(cache.getOb("epubContainer")),d=0,u=0,p=1,h=cache.getOb("epubContainer").__vue__.getScrollProxy().getPosition(),d=i.scrollTop,u=i.scrollLeft;d=h.top,u=(u=h.left)||0,d=d||0;var g=$injector.get("nav");stg.data.book.chapter.viewport&&(p=g.getFxlScale());var f,m,v=(a.top+d-(s.top+0))/p;if("side"==o){f=0;var b,k=Number(l.left)+(c.left-s.left+u),y=s.right-c.right+u;(b=stg.data.book.chapter.viewport||k<y?k:y)<30&&(b=30),stg.data.settings.rtl&&(m=0,f=null),f-=k}else{if(0==e.elem.offsetWidth)return;f=(a.left+u-s.left)/p}null!=v&&(n+="top: "+(v+e.offsetTop)+"px; "),null!=f&&(n+="left: "+(f+e.offsetLeft)+"px; "),null!=m&&(n+="right: "+(m-e.offsetLeft)+"px; "),null!=b&&(n+="width: "+b+"px; ");var w=1/p;""!=(n+="transform:translateZ(0) scale("+w+");-webkit-transform:translateZ(0) scale("+w+");-moz-transform:translateZ(0) scale("+w+");")&&(e.elem.style.cssText=n),e.callback&&e.callback()}}},n.checkMarkerExistsAtSameLocation=function(i,r){stg.getNotes(function(e){for(var t=0;t<e.length;t++){var n=e[t];if("page"==n.type){var o=document.getElementById("knote"+n.nid);if(o&&o!=i&&a(o,i))return r(!0)}}stg.getBookmarks(function(e){for(var t=0;t<e.length;t++){var n=e[t],o=document.getElementById("bookmark"+n.bmid);if(o&&(o!=i&&a(o,i)))return r(!0)}r()})})},n.show=function(){for(var e=0;e<o.length;e++)o[e].elem.style.visibility="shown"},n.hide=function(){for(var e=0;e<o.length;e++)o[e].elem.style.visibility="hidden"},window.addEventListener("resize",n.windowResize,!0),n}),createService("media",function(){var e={};return e.show=function(e){"image"==e.type?(tinCan.send({verb:"viewed image",activity:e.title?e.title:e.thumbnail}),modals.show({mode:"image",dynamic:!0,animation:"slide-in-up",image:e,large:e.large})):"video"==e.type?(tinCan.send({verb:"viewed video",activity:e.title?e.title:e.thumbnail}),modals.show({mode:"video",animation:"slide-in-up",video:e,large:e.large},null,pauseVideoAndAudio)):"audio"==e.type&&(tinCan.send({verb:"listened to audio",activity:e.title?e.title:e.thumbnail}),modals.show({mode:"audio",animation:"slide-in-up",audio:e,large:e.large},null,pauseVideoAndAudio))},e.hide=function(){modals.hide()},e}),createService("modals",function(){var o,n,i,t,r,a={},s=[],c={animation:"zoom-in",focusFirstInput:!1,backdropClickToClose:!1};function l(){t&&clearTimeout(t),r=!1,i&&i._closedCb&&i._closedCb(),s.shift(),u(),function(){for(var e=document.getElementsByClassName("modal-backdrop"),t=e.length;t--;)hasClass(e[t],"hide")&&e[t].parentNode.removeChild(e[t])}()}a.setScope=function(e){vueExclude||((n=e).hideModal=a.hide,o||d(),n.$on("modal.shown",function(e){i&&i._cb&&i._cb(e.target||e)}),n.$on("modal.hidden",function(e){t&&clearTimeout(t),i&&i._closeCb&&i._closeCb(event.target),setTimeout(function(){s.shift(),u(),function(){for(var e=document.getElementsByClassName("modal-backdrop"),t=e.length;t--;)hasClass(e[t],"hide")&&e[t].parentNode.removeChild(e[t])}()},500)}))},a.getScope=function(){return n};var d=function(){var e,t=$q.defer();return vueExclude?((e=clone(c)).scope=n,$ionicModal.fromTemplateUrl(kTemplate("system/modals.html"),e).then(function(e){o=e,t.resolve()})):t.resolve(),t.promise};function u(){if(i=null,s.length){var e=s[0];if(e){if((i=e).hidden)return s.shift(),u();c.backdropClickToClose=!!e.backdropClickToClose&&e.backdropClickToClose,e.animation||(e.animation="zoom-in"),(e.large?addClass:removeClass)(document.body,"largeModal"),d().then(function(){vueExclude?n.modal=e:Vue.set(stg.data,"modal",e),(vueExclude||o)&&(vueExclude&&o.show(),n.$$phase||n.$apply(),i&&i.timeLimit&&(t=setTimeout(function(){var e=i;a.hide(i);var t={wait:function(){a.hide(),a.show(e)}};a.show({mode:"waitTimeout",timeoutOptions:t})},i.timeLimit)),setTimeout(function(){e.cb&&e.cb(o)},750))})}}}return a.show=function(e,t,n){if(!vueExclude||o)return e._cb=t,e._closedCb=n,s.push(e),r||1==s.length&&u(),e;d().then(function(){a.show(e)})},a.obShown=function(e){return i==e},a.shown=function(){return vueExclude?o.isShown():stg.data.modal&&stg.data.modal.mode},a.hideAll=function(e){s=[],a.hide(null,e)},a.hide=function(e,t){if(vueExclude&&!o)return t?t():null;e?i==e?(stg.data.modal&&stg.data.modal.mode?(stg.data.modal.mode=null,r=!0,stg.data.modal._hiddenCb=l):l(),native&&$injector.get("crdv").hideKeyboard()):e.hidden=!0:(stg.data.modal&&stg.data.modal.mode?(stg.data.modal.mode=null,stg.data.modal._hiddenCb=l,r=!0):l(),native&&$injector.get("crdv").hideKeyboard()),t&&t()},a}),createService("nav",function(){var t,s,c,l,e,C={},o=15,i=0,n={},r=[];function a(e,t){for(var n=0;n<r.length;n++)r[n].event==e&&r[n].func(t)}function d(e){"newChapter"==e&&((s=$ionicScrollDelegate.$getByHandle("content")).scrollTo(0,0,!1),stg.data.book.chapter.viewport&&C.fxlZoomFit({noAnim:!0,immediateScrollRefresh:!0,dir:config.fitToScreen?null:"x"}),setTimeout(markers.refreshMarkers,1e3))}function u(){var e;config.hideTOCAtWidescreen||(e=1300<=n.width,stg.data.widescreen!=e&&(a("widescreenChanged"),Vue.set(stg.data,"widescreen",e)),e?(addClass(document.body,"widescreen"),$ionicSideMenuDelegate.close()):removeClass(document.body,"widescreen"),$rootScope.$$phase||$rootScope.$apply())}function p(e){var t;vueExclude&&(t=cache.getOb("epubContainer"),"margin"==e?(t.style.paddingLeft&&(t.style.setProperty("margin-left",t.style.paddingLeft,"important"),t.style.paddingLeft=null),t.style.paddingTop&&(t.style.setProperty("margin-top",t.style.paddingTop,"important"),t.style.paddingTop=null)):(t.style.marginLeft&&(t.style.setProperty("padding-left",t.style.marginLeft,"important"),t.style.marginLeft=null),t.style.marginTop&&(t.style.setProperty("padding-top",t.style.marginTop,"important"),t.style.marginTop=null)))}function h(e){var t,n;vueExclude&&(e=e||C.getFxlScale(),t=C.getFxlFit(null,"from fxlRefreshHorizontalVerticalScrolling"),n=s.getScrollView().options,e*t.widthFit<=t.widthFit?n.scrollingX=!1:n.scrollingX=!0,e*t.widthFit<=t.heightFit?n.scrollingY=!1:n.scrollingY=!0)}function g(e){if(!C.options.swipeDisabled&&!(o<i||mobile&&function(){var e=document.getElementById("readerBody").style.transform||document.getElementById("readerBody").style.webkitTransform;if(e&&"translate3d(0px, 0px, 0px)"!=e&&"translate3d(0px, 0, 0)"!=e)return!0}())){var t=stg.data.book.chapter.viewport?1:.8,n=stg.data.book.chapter.viewport?100:70;if(!(Math.abs(e.gesture.velocityX)<t||Math.abs(e.gesture.distance)<n||1<e.gesture.touches.length))return 1}}function f(){return!($location.path()&&0<=$location.path().indexOf("/reader"))}function m(){e&&clearTimeout(e),e=setTimeout(function(){kotobee.dispatchEvent("transformationChanged")},500)}function v(e,t){vueExclude&&(e=C.getFxlFit({scale:e/t}),cache.getOb("epubContainer").style.setProperty("padding-left",+e.marginLeft+"px","important"))}function b(){return(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozExitFullscreen?document.mozExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),1)}return C.options={},C.initialize=function(e){t||(window.addEventListener("resize",C.windowResize,!0),n.width=window.innerWidth,n.height=window.innerHeight,mobile||u(),chapters.addListener(d),t=!0,C.addListener("widescreenChanged",function(){setTimeout(C.fxlZoomFit,400)}),document.body.addEventListener("keyup",function(e){27==e.keyCode&&b()}))},C.resetEpubContainer=function(e){},C.addListener=function(e,t){r.push({event:e,func:t})},C.windowResize=function(){f()||n.width==window.innerWidth&&n.height==window.innerHeight||(C.fxlZoomFit(),n.width=window.innerWidth,n.height=window.innerHeight,mobile||u(),chapters.regenerateSpreads({resize:!0}))},C.getScroller=function(){return s},C.transformstart=function(){C.transforming=!0,stg.data.book.chapter.viewport&&(function(e){{var t;e||(t=cache.getOb("epubContainer"),(e=t.getElementsByClassName("scroll")).length&&(e=e[0]))}e&&deleteTransformOrigin(e)}(),c=(new Date).getTime(),l=C.getFxlScale(),p("margin"))},C.transformend=function(){if(C.transforming=!1,!f()){if(stg.data.book.chapter.viewport){var e=(new Date).getTime(),t=C.getFxlScale();if(mobile&&t<l&&e-c<800)return void C.fxlZoomFit();var n=C.getFxlFit(null,"from transformend").bestFit;t<n?($ionicScrollDelegate.$getByHandle("content").zoomTo(n,!0),t=n):3<t&&($ionicScrollDelegate.$getByHandle("content").zoomTo(3,!0),t=n),h(3),setTimeout(markers.refreshMarkers,1e3),C.repaint()}else{if(!config.textSizeControls)return;var o=s.getScrollPosition().zoom,i=settings.getTextSize(),r=Math.round(o*i*10)/10;r<.2&&(r=.2),stg.data.settings.textSize=r+"em",settings.updateTextSize(),settings.writeTextSize(),s.zoomTo(1,!0);var a=angular.element(cache.getOb("epubContent")).scope();a.header.mode="textSize",a.$$phase||a.$apply(),setTimeout(markers.refreshMarkers,1e3)}m()}},C.repaint=function(){redrawForChrome(cache.getOb("epubContent"))},C.resize=function(){(s=s||$ionicScrollDelegate.$getByHandle("content"))&&s.resize()},C.swipeRight=function(e){f()||g(e)&&(s.resize(),native&&crdv.vibrate(),stg.data.settings.rtl?chapters.nextChapter():chapters.prevChapter())},C.swipeLeft=function(e){f()||g(e)&&(s.resize(),native&&crdv.vibrate(),stg.data.settings.rtl?chapters.prevChapter():chapters.nextChapter())},C.dragStart=function(){f()||(stg.data.book.chapter.viewport||s.zoomTo(1,!1),i=0,s.freezeScroll(!1))},C.drag=function(e){i++},C.tap=function(e){a("tap",e)},C.fxlToggleTapZoom=function(e){if(vueExclude){try{if(!e.gesture.srcEvent.isTrusted)return}catch(e){}var t,n,o,i,r;C.options.doubletapDisabled||cache.getOb("epubContent")&&stg.data.book.chapter.viewport&&stg.data.book.chapter.viewport.width&&(t=C.getFxlScale(),n=C.getFxlFit(null,"from fxlToggleTapZoom").bestFit,null==(o=s.getScrollView().options.minZoom)&&(o=t-1),Math.round(100*t)!=Math.round(100*n)&&o<t?C.fxlZoomFit():(i=2*C.getFxlFit(null,"from fxlToggleTapZoom").bestFit,r=C.getFxlFit(null,"from fxlToggleTapZoom"),$ionicScrollDelegate.$getByHandle("content").zoomTo(i,!0,e.gesture.center.pageX-r.marginLeft,e.gesture.center.pageY-r.marginTop),selection.reset(),v(i,r.bestFit),p("margin"),h(i)),setTimeout(markers.refreshMarkers,1e3),setTimeout(C.repaint,1e3),m())}},C.fxlZoomIn=function(e){selection.reset();var t=1.2*C.getFxlScale();$ionicScrollDelegate.$getByHandle("content").zoomTo(t,!0)},C.fxlZoomOut=function(e){selection.reset();var t=.8*C.getFxlScale();$ionicScrollDelegate.$getByHandle("content").zoomTo(t,!0),p("margin"),h(t),setTimeout(markers.refreshMarkers,1e3),m()},C.fxlZoomFit=function(e){var t,n,o;s&&(e=e||{},cache.getOb("epubContent")&&stg.data.book&&stg.data.book.chapter.viewport&&stg.data.book.chapter.viewport.width&&(selection.reset(),e.dir||(t=clone(stg.data.book.chapter.viewport),"double"==stg.data.book.chapter.view&&(t.double=!0),n=compInstances.pan.getBestFit("width",t),o=compInstances.pan.getBestFit("height",t),e.dir=o.scale>n.scale?"x":"y"),"y"==e.dir?s.fitToHeight(!e.noAnim,{disableEvents:!0}):s.fitToWidth(!e.noAnim,{top:!0,disableEvents:!0}),setTimeout(markers.refreshMarkers,1e3),m()))},C.fxlAdjustAlignment=function(e){(e=e||{}).epubContent||(e.epubContent=cache.getOb("epubContent")),e.epubContainer||(e.epubContainer=cache.getOb("epubContainer"));var t=C.getFxlFit(e,"from fxlAdjustAlignment"),n=getElemMargin(e.epubContent,{computed:!0});"auto"==n.left&&(n.left=0),"auto"==n.top&&(n.top=0);var o=e.newScale?e.newScale:t.widthFit;autoprefixTransform(e.epubContent,"scale("+o+")"),autoprefixTransformOrigin(e.epubContent,-n.left+"px "+-n.top+"px"),vueExclude&&(e.epubContainer.style.marginLeft=e.epubContainer.style.marginRight=null,e.epubContainer.style.paddingLeft=e.epubContainer.style.paddingRight=null,e.epubContainer.style.setProperty("padding-left",t.marginLeft+"px","important"),e.epubContainer.style.setProperty("padding-top",t.marginTop+"px","important"));e.epubContainer.getElementsByClassName("scroll")[0];e.epubContainer.style.width=t.outerWidth+"px"},C.getSpreadHeight=function(e){for(var t=0,n=0;n<e.children.length;n++){var o=e.children[n];o.id&&0==o.id.indexOf("spread")&&(t=Math.max(t,Number(o.style.height.split("px")[0])))}return t},C.getSpreadWidth=function(e){for(var t=0,n=0;n<e.children.length;n++){var o=e.children[n];o.id&&0==o.id.indexOf("spread")&&(t+=Number(o.style.width.split("px")[0]))}return t},C.viewFromElem=function(e){for(var t={maxHeight:0,totalWidth:0},n=0;n<e.children.length;n++){var o,i,r,a=e.children[n];a.id&&0==a.id.indexOf("spread")&&(o=Number(a.style.height.split("px")[0]),r={width:i=Number(a.style.width.split("px")[0]),height:o},"spreadL"==a.id?(t.leftOb||(t.leftOb={}),t.leftOb.viewport=r,t.leftOb.layout=hasClass(a,"fxl")?"fxl":"rfl",t.layout=t.leftOb.layout):"spreadR"==a.id&&(t.view="double",t.rightOb||(t.rightOb={}),t.rightOb.left=Number(a.style.left.split("px")[0]),t.rightOb.viewport=r,t.rightOb.layout=hasClass(a,"fxl")?"fxl":"rfl"),t.maxHeight=Math.max(o,t.maxHeight),t.totalWidth+=i)}return t.leftOb&&t.rightOb&&t.rightOb.left&&(t.totalWidth+=t.rightOb.left-t.leftOb.viewport.width),t},C.getFxlFit=function(e,t){(e=e||{}).viewport||(e.viewport=stg.data.book.chapter.viewport);var n={};e.epubContent||(e.epubContent=cache.getOb("epubContent"));var o=(o=e.view)||stg.data.currentView,i={x:0};e.epubContainer||(e.epubContainer=cache.getOb("epubContainer"));var r=e.epubContainer.getElementsByClassName("scroll");r.length&&(i=getElemPadding(r[0],{computed:!0}),n.scrollContainer=r[0]),"auto"==i.x&&(i.x=0),"auto"==i.y&&(i.y=0);var a=getElemMargin(e.epubContent,{computed:!0}),s=getElemPadding(e.epubContent,{computed:!0}),c=a.x,l=a.y;"auto"==c&&(c=0),"auto"==l&&(l=0);s.x,s.y;e.scale||(e.scale=1);var d,u=e.viewport.width*e.scale+c,p=e.viewport.height+l;"double"==o&&(u=(d=C.viewFromElem(e.epubContent)).totalWidth,p=d.maxHeight);var h=document.getElementById("readerBody"),g=document.getElementById("readerHeader"),f=document.getElementById("tabMenu"),m=h.getBoundingClientRect().width,v=h.getBoundingClientRect().height;mobile&&"alwaysShow"!=config.autohideReaderMode&&"showOnScroll"!=config.autohideReaderMode||(v-=g.getBoundingClientRect().height+f.getBoundingClientRect().height),e.includeScrollPadding||(m-=i.x,v-=i.y);var b,k,y=m/u,w=v/p;return n.readerWidth=m,n.readerHeight=v,n.widthFit=y,n.heightFit=w,config.fitToScreen?(n.bestFit=w<y?w:y,n.bestFitType=w<y?"vertical":"horizontal"):(1<=(b=y)&&(b=1),k=w/b,n.bestFitType="vertical",k<1&&.7<=k&&(b=w,n.bestFitType="vertical"),n.bestFit=b),n.bestFit=n.bestFit/n.widthFit,n.innerWidth=u,n.innerHeight=p,n.outerWidth=m,n.outerHeight=v,n.marginLeft=Math.round((n.outerWidth-n.widthFit*n.bestFit*n.innerWidth)/2),n.marginTop=Math.round((n.outerHeight-n.widthFit*n.bestFit*n.innerHeight)/2),n.marginTop<0&&(n.marginTop=0),n},C.getFxlScale=function(){return $ionicScrollDelegate.$getByHandle("content").getScrollPosition().zoom},C.fullscreen=function(){var e=document.body;b()||(e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen())},C.openInBrowser=function(e){native?crdv.openInNativeBrowser(e):desktop?require("nw.gui").Shell.openExternal(e):window.open(e,"_blank")},C}),createService("np",function(){var o,r,i,a,s,c,l,d,u,p={},h=kLog;return p.initialize=function(e){if(desktop){try{o=require("nw.gui"),i=require("child_process"),r=i.exec,a=o.Window.get(),process.cwd(),process.env.HOME||process.env.USERPROFILE,u=require("path"),s=u.dirname(process.execPath),c=o.App.dataPath,l=c+"/temp",d=c+"/Books";try{a.removeAllListeners()}catch(e){h("ERROR "+e,1)}a.on("close",function(){p.exitConfirmation()})}catch(e){}var t,n;t=function(){p.createIfNotExists(d),p.createIfNotExists(l),e&&e()},(n=document.createElement("script")).setAttribute("src",isRelease?"npmModules.min.js":"js/app/npmModules.js"),n.addEventListener("load",function(){t&&t()}),document.body.appendChild(n)}else e&&e()},p.existsSync=function(e){return fs.existsSync(e)},p.createIfNotExists=function(t,n){desktop&&fs.exists(t,function(e){e?n&&n():p.createIfNotExists(ph.parent(t),function(){fs.mkdirSync(t),n&&n()})})},p.createIfNoParentsExists=function(t,n){desktop&&fs.exists(t,function(e){e?n&&n():p.createIfNoParentsExists(ph.parent(t),function(){fs.mkdirSync(t),n&&n()})})},p.writeEbook=function(e,i,t,r){desktop&&p.createTempDir(function(n){var o=new FileReader;o.onload=function(){var e=ph.join(n,"book.zip");"mac"==os&&(e=n+"/book.zip"),fs.writeFileSync(e,Buffer.from(new Uint8Array(o.result)));var t=ph.join(d,i.path);"mac"==os&&(t=d+"/"+i.path),p.extractZip(e,t,function(){Vue.set(i,"downloaded",!0),stg.data.downloaded.push(i),$injector.get("library").applyExistingBooks(stg.data.currentLibrary.books),stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,function(){p.removeDirectory(n,function(){r&&r()})})})},o.readAsArrayBuffer(t)})},p.deleteEbook=function(t,n){p.removeDirectory(ph.join(d,t.path),function(){for(var e=0;e<stg.data.downloaded.length;e++)stg.data.downloaded[e].path==t.path&&(t.downloaded=!1,stg.data.downloaded.splice(e,1),e--);stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,function(){n&&n()})})},p.bookDownloaded=function(e,t){var n=fs.existsSync(d+"/"+e.path);return t&&t(n),n},p.fileExists=function(e,t){fs.exists(e,function(e){t(e)})},p.removeFile=function(e,t){p.removeDirectory(e,t)},p.removeDirectory=function(e,t){rimraf(e,function(e){t&&t(e)})},p.extractZip=function(e,t,n){"mac"==os||"linux"==os?p.extractZipViaCli(e,t,n):p.extractZipViaNpmModule(e,t,n)},p.extractZipViaCli=function(e,t,o){var i=r('unzip "'+e+'" -d "'+t+'"',{cwd:s,maxBuffer:512e4},function(e,t,n){i.kill(),o(e)})},p.extractZipViaNpmModule=function(e,t,n){var o=new decompressZip(e);o.on("error",function(e){n&&n(!1)}),o.on("extract",function(e){n&&n(!0)}),o.on("progress",function(e,t){}),o.extract({path:t,restrict:!1,filter:function(e){return"SymbolicLink"!==e.type}})},p.require=function(e){return"nw.gui"==e?o:"child_process"==e||"exec"==e?r:"path"==e?u:"fs"==e?fs:void 0},p.readFile=function(e){return isAbsoluteURLPath(e)||(e=process.mainModule.filename.split("index.html")[0]+e),fs.readFileSync(e)+""},p.writeFile=function(e,t,n){fs.writeFileSync(e,t,n)},p.createTempDir=function(t){var n=l+"/f"+randStr(5);p.fileExists(n,function(e){e?p.createTempDir(t):fs.mkdir(n,function(){t(n)})})},p.openLink=function(e){o.Shell.openExternal(e)},p.getBooksPath=function(){return d+"/"},p.writeArrayBuffer=function(e,t,n,o){var i=arrayBufferToBuffer(e);p.existsSync(ph.removeFilename(t))||fs.mkdirSync(ph.removeFilename(t),{recursive:!0}),fs.open(t,"w",function(e,t){if(e)throw"error opening file: "+e;fs.write(t,i,0,i.length,null,function(e){e?o&&o(!1):fs.close(t,function(){o&&o(!0)})})})},p.copy=function(n,e,t,o){if((t=t||{}).replace)for(var i=0;i<t.replace.length;i++)n=n.replace(t.replace[i].key,t.replace[i].val);t.header&&(n=t.header+n),t.footer&&(n+=t.footer),t.encoding||(t.encoding="ascii"),n=(n+="").replace(/\xA0/g," "),n=utf8Encode(n),fs.writeFile(e,n,t.encoding,function(e,t){o&&o(n)})},p.exit=function(){stg.getActions(function(e){var t;e&&e.length?(modals.hide(),(t={title:"confirmation",msg:"annotationsSyncExitWarning",barStyle:"bar-dark"}).btns=[{label:"delete",style:"button-assertive",func:function(){o.App.quit()}},{label:"cancel",func:function(){modals.hide()}}],modals.show({mode:"confirm",confirmOptions:t})):o.App.quit()})},p.exitConfirmation=function(){kotobee.confirm(translit.get("exitConfirmationMsg"),{okBtn:translit.get("yes"),noBtn:translit.get("cancel"),noBackdrop:!1,cb:function(){o.App.quit()}})},p}),createService("payment",function(){var a={},l="http://localhost:8100",t=!1;function s(e){return"b"+("library"==config.kotobee.mode?e.id:"0")+"xid"+config.kotobee.cloudid}function o(e){return t?"android.test.purchased":e&&e.pricing&&e.pricing[device.platform.toLowerCase()+"inappid"]||""}function i(e){if("function"==typeof $injector.get("bookinfo").getCurrentBook){var t=$injector.get("bookinfo").getCurrentBook();return t&&o(t)==e.id}}function r(e){return a.isInAppPurchaseEnabled()&&(e&&e!="com.kotobee."+stg.data.currentLibrary.subdomain)}function c(e){"function"==typeof $injector.get("bookinfo").inAppPurchaseCallback&&$injector.get("bookinfo").inAppPurchaseCallback(e)}function d(e){i(e)&&$injector.get("bookinfo").refetch(),e.finish(),$injector.get("bookinfo").setBusy(!1)}a.initialize=function(e){var n,t;if(e)return stg.data.payment||(stg.data.payment={}),Array.isArray(e)&&(n={},e.forEach(function(e){var t;e.enabled&&(delete(t=Object.assign({},e)).provider,t.params&&t.params.clientsecret&&delete t.params.clientsecret,(native||"paypal"!=e.provider)&&"paypal"==e.provider||(n[e.provider]=t))}),e=n),e.none=!0,e.stripe&&(delete e.none,native||document.head.querySelector("#stripe-sdk")||((t=document.createElement("script")).id="stripe-sdk",t.src="https://js.stripe.com/v3/",document.head.appendChild(t))),e.paypal&&(delete e.none,native||document.head.querySelector("#paypal-sdk")||((t=document.createElement("script")).id="paypal-sdk",t.src="https://www.paypal.com/sdk/js?client-id="+e.paypal.params.clientid+"&disable-funding=card",document.head.appendChild(t))),e.moyasar&&(delete e.none,native||u.sdk()),a.isInAppPurchaseEnabled()&&(store.verbosity=store.QUIET,store.error(function(e){$injector.get("bookinfo").setBusy(!1),store.verbosity,store.QUIET})),e},a.getPaymentOptions=function(){var e=config.kotobee.payment?Object.keys(config.kotobee.payment).map(function(e){return{gateway:e,logo:stg.data.payment?stg.data.payment[e+"Logo"]:null}}):[];return e=native?e.filter(function(e){return-1!=e.gateway.indexOf("inapp")}):e.filter(function(e){return-1==e.gateway.indexOf("inapp")})},a.getOrderName=function(e){return e&&e.orderitems&&Array.isArray(e.orderitems)&&e.orderitems.length?e.orderitems.map(function(e){return e.book&&e.book.name?e.book.name:e.subscr&&e.subscr.name?e.subscr.name:"N/A"}).join(", "):"N/A"},a.renderPaypalButton=function(o,n){!function(){var e="#paypal-button-container";{var t;native||((t=document.body.querySelector(e))||((t=document.createElement("div")).id=e.slice(1),document.body.querySelector("#paypal-button-wrapper").appendChild(t)),t.innerHTML="",waitFor("paypal",function(){paypal.Buttons({style:{color:"blue",label:"pay"},createOrder:function(e,n){return new Promise(function(t,n){if(o.order)return t(o.order);var e={platform:"paypal",accountemail:o.accountemail};"library"===config.kotobee.mode&&(e.items=JSON.stringify(o.items?o.items:[{type:"book",id:o.id}])),backend.createOrder(e,function(e){return e.order&&e.order.id?void t(e.order):n()})}).then(function(e){var t={payer:{email_address:o.accountemail?o.accountemail:stg.data.user.email},purchase_units:[{reference_id:e.id,amount:{value:e.amount,currency_code:"USD",breakdown:{item_total:{value:e.amount,currency_code:"USD"}}},redirect_urls:{return_url:config.kotobee.liburl+"library/payment/paypalsuccess",cancel_url:config.kotobee.liburl},items:[{name:a.getOrderName(e),unit_amount:{value:e.amount,currency_code:"USD"},quantity:"1",sku:e.product}]}]};return n.order.create(t)})},onApprove:function(e,t){return t.order.capture().then(function(e){backend.sendRawPost(config.kotobee.liburl+"library/payment/paypalsuccess",{checkoutid:e.id,bid:o.id},{responseType:"json"},function(e){e.error?(modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get(e.error)}})):n&&n()})})},onError:function(e){if(-1!==e.toString().toLowerCase().indexOf("unauthorized order"))return modals.hide(),void setTimeout(function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("paypalUnauthorizedOrder")}})},0);modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorProcessingPayment")}})}}).render(e)}))}}()},a.registerInAppProducts=function(e){a.isInAppPurchaseEnabled()&&(e.forEach(function(e){var t=o(e);!store.get(t)&&r(t)&&(store.register({id:t,alias:s(e),type:store.CONSUMABLE}),store.when(t).updated(function(e){i(e)&&(e.state==store.APPROVED&&a.isCurrentUserID(e)&&e.finish(),c(e))}),store.when(t).approved(function(n){i(n)&&a.validateInAppPurchase(n,function(e,t){e?d(n):($injector.get("bookinfo").setBusy(!1),modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get(t.error.message)}}))})}),store.when(t).cancelled(function(e){}))}),store.refresh().finished(function(){}).cancelled(function(){}).failed(function(e){}))},a.isInAppPurchaseEnabled=function(){return!!native&&(!!config.kotobee.payment&&(!!window.store&&(config.kotobee.payment.iosinapp||config.kotobee.payment.androidinapp)))},a.isCurrentUserID=function(e){return!!e.additionalData&&e.additionalData.applicationUsername==stg.data.user.id},a.handleInAppProduct=function(e){var t,n;a.isInAppPurchaseEnabled()&&(!r(t=o(e))||(n=store.get(t))&&n.loaded&&!n.valid?c():store.update())},a.validateInAppPurchase=function(n,o,i){try{i=i||{},n&&n.id?"function"!=typeof o?o(!1,{code:store.INTERNAL_ERROR,error:{message:translit.get("internalError")}}):n.transaction?(t=n.transaction,(r=function(e){var t;e?o(!0,n.transaction):(i.cache&&(t=JSON.parse(sessionStorage.getItem("transaction"+n.transaction.id)||"{}")),t?a(t):backend.sendRawPost(config.kotobee.liburl+"library/payment/inapp",{id:n.id,cloudid:n.transaction.cloudid,priceMicros:n.priceMicros,currency:n.currency,transactionType:n.transaction.type,transactionReceipt:n.transaction.receipt,transactionPurchaseToken:n.transaction.purchaseToken,transactionAppStoreReceipt:n.transaction.appStoreReceipt,applicationUsername:String(stg.data.user.id)},{requestType:"json",responseType:"json"},a))})&&(t&&t.id||r(!1),stg.readSlot("in-app-transactions",function(e){r(e.find(function(e){return e.uid=stg.data.user.id&&e.tid==t&&e.type==t.type}))}))):o(!1,{code:store.INVALID_PAYLOAD,error:{message:translit.get("invalidTransaction")}}):o(!1,{code:store.NEED_MORE_DATA,error:{message:translit.get("invalidProductId")}})}catch(e){o(!1,{code:store.NEED_MORE_DATA,error:{message:e.message||e.toString()}})}var t,r;function a(e){var t;i.cache&&sessionStorage.setItem("transaction"+n.transaction.id,JSON.stringify(e)),e.error?o(!1,{code:e.error.code?store[e.error.code]:0,error:{message:translit.get(e.error.message||e.error.toString())}}):e.success?(n.transaction&&n.transaction.id&&(t=n.transaction,stg.readSlot("in-app-transactions",function(e){e.push({uid:stg.data.user.id,tid:t.id,type:t.type}),stg.writeSlot("in-app-transactions",e.filter(function(t,e,n){return n.findIndex(function(e){return e.uid==t.uid&&e.tid==t.tid&&e.type==t.type})==e}))})),o(!0,n.transaction)):o(!1,{code:store.INVALID_PAYLOAD,error:{message:translit.get("invalidTransaction")}})}},a.makePayment=function(n,o){var e,i=o.bookOb;if(-1==n.indexOf("inapp")){"paypal"!=n&&(e={platform:n,accountemail:o.paymentEmail},"library"===config.kotobee.mode&&(e.items=JSON.stringify([{type:"book",id:i.id}])),backend.createOrder(e,function(e){if(e.order&&e.order.id){if("moyasar"===n){var t={orderid:e.order.id,redirecturl:native?l:window.location.protocol+"//"+window.location.host+window.location.pathname,price:100*o.bookOb.price,name:o.bookOb.name||"N/A"};return u.payment(t)}"stripe"===n&&a.stripeMakePayment(o.paymentOptions,{order:e.order},o,i)}}))}else{if(!window.store)return;var t=s(i),r=store.get(t);r&&r.loaded&&(r.canPurchase||r.owned)&&(store.getApplicationUsername()||(store.applicationUsername=""+stg.data.user.id),store.order(t).error(function(e){$injector.get("bookinfo").setBusy(!1)}),$injector.get("bookinfo").setBusy(!0))}};var u={delay:2e3,url:null,sdk:function(){var e,t,n,o;document.getElementById("moyasar-style")||((e=document.createElement("link")).id="moyasar-style",e.rel="stylesheet",e.href="https://cdn.moyasar.com/mpf/1.5.0/moyasar.css",document.head.appendChild(e)),document.getElementsByClassName("mysr-form")[0]||((t=document.createElement("div")).className="mysr-form",(n=document.createElement("div")).className="moyasar-form-warpper",(o=document.createElement("button")).type="button",o.className="moyasar-form-warpper--closeBtn",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path></svg>',o.addEventListener("click",function(e){n&&"block"==n.style.display&&u.resetMoyasar()}),n.appendChild(o),n.appendChild(t),document.body.appendChild(n)),[{src:"https://polyfill.io/v3/polyfill.min.js?features=fetch",id:"moyasar-polyfill"},{src:"https://cdn.moyasar.com/mpf/1.5.0/moyasar.js",id:"moyasar-sdk"}].forEach(function(e){var t;document.getElementById(e.id)||((t=document.createElement("script")).id=e.id,t.src=e.src,document.body.appendChild(t))})},payment:function(o,i){var e;native||(u.resetMoyasar(),u.sdk(),e={element:".mysr-form",amount:o.price,currency:"USD",description:o.name,publishable_api_key:config.kotobee.payment.moyasar.params.clientid,methods:["creditcard","applepay","stcpay"],apple_pay:{country:"SA",label:o.name,validate_merchant_url:"https://mystore.com/checkout/applepay/validate-merchant"},supported_networks:["mada","visa","mastercard","amex"],metadata:o,callback_url:config.kotobee.liburl+"library/payment/moyasar_redirect?orderid="+o.orderid,on_redirect:function(e){u.url=e},on_completed:function(e){var t=config.kotobee.liburl+"library/payment/moyasar_save_payment",n="&orderid="+o.orderid+"&paymentid="+e.id;u.ajax(t,n,i)},on_failure:function(e){}},Moyasar.init(e),u.showMoyasar())},ajax:function(e,t,n){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){var e;4===o.readyState&&(4===o.readyState&&200<=o.status&&o.status<=299?(e=JSON.parse(o.responseText)).success?(n&&n(),u.success()):e.error&&u.error(e.error):u.error())},o.onerror=function(e){u.error(e)},o.send(t)},success:function(){setTimeout(function(){null!==u.url&&window.location.replace(u.url)},u.delay)},error:function(e){u.tryAgain()},tryAgain:function(){u.resetMoyasar(),kotobee.popup(translit.get("moyasarErrorMessageDesc"),{title:translit.get("moyasarErrorMessageTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})},resetMoyasar:function(){u.url=null;var e=document.getElementsByClassName("moyasar-form-warpper")[0];e&&e.remove();var t=Array.from(document.getElementsByClassName("paymentOption"));t.length&&t.forEach(function(e){var t;!e||(t=e.getElementsByTagName("a")[0])&&-1===t.className.split(" ").indexOf("enableBtn")&&(t.className+=" enableBtn")})},showMoyasar:function(){var e=document.getElementsByClassName("moyasar-form-warpper")[0];e&&(e.style.display="block")}};return a.moyasarSettings=u,a.stripeMakePayment=function(r,e,a,t,s){var n=config.kotobee.liburl+"library/payment/getstripesession",c={url:native?l:window.location.protocol+"//"+window.location.host+window.location.pathname,gateway:"stripe"};c.orderid=e.order.id,backend.sendRawPost(n,c,{responseType:"json"},function(e){var t,n,o,i;e.error||(e.success?(s&&s(),native?(t="var script = document.createElement('script');                      script.src = 'https://js.stripe.com/v3/';                      script.onload = function() {                          var stripe = Stripe('"+r.stripe.params.clientid+"');                          stripe.redirectToCheckout({                              sessionId:'"+e.session+"'                          }).then(function(result) {                              console.error(result.error.message);                          });                      };                      document.head.appendChild(script);",n=t,cordova.InAppBrowser&&(o="location=no,hidden=no,clearsessioncache=yes,clearcache=yes,closebuttoncaption=Go back to App,toolbar="+(ios?"yes":"no")+",presentationstyle=formsheet",(i=cordova.InAppBrowser.open("about:blank","_blank",o)).addEventListener("loadstart",function(e){var t,n,o;0===e.url.indexOf(l)&&(i.close(),t=new URL(e.url),o="/payment/"+(n=new URLSearchParams(t.search)).get("gateway")+"/success/"+n.get("book_id")+"/"+n.get("user_id"),modals.hide(),$location.path(o),$ionicHistory.clearHistory())}),i.addEventListener("loadstop",function(){i.executeScript({code:n})}),i.addEventListener("loaderror",function(e){if(!ios)try{i&&i.close()}catch(e){}}),i.addEventListener("exit",function(e){}))):waitFor("Stripe",function(){Stripe(r.stripe.params.clientid).redirectToCheckout({sessionId:e.session}).then(function(e){})})):(c.cloudid=config.kotobee.cloudid,c.accountemail=a.paymentEmail))})},a}),createService("popovers",function(){var n,o,t={},i=[];t.setScope=function(e){vueExclude||(o=e,n||r())};var r=function(){var t=$q.defer();return vueExclude?(o=o||$rootScope,$ionicPopover.fromTemplateUrl(kTemplate("system/popovers.html"),{scope:o}).then(function(e){n=e,t.resolve()})):t.resolve(),t.promise};function a(){var e;0!=i.length&&((e=i.shift()).animation||(e.animation="zoom-in"),vueExclude?n&&(n.isShown()||n.show(e.event)):Vue.set(stg.data,"popover",e))}return t.show=function(e){!vueExclude||n?(i.push(e),1==i.length&&a()):r().then(function(){t.show(e)})},t.shown=function(){return!!n&&(stg.data.popover&&stg.data.popover.mode)},t.hide=function(){vueExclude&&!n||(vueExclude?(o.popover=null,n&&n.hide()):stg.data.popover&&(stg.data.popover.mode=null),a())},t}),createService("scorm",function(){var h,g,f={};function r(){a.doLMSCommit("")}function m(e,t,n){var o=v(e+"."+t+"."+n);return o&&""!=o||(o=v(e+"_"+t+"."+n)),o}function v(e){return a.doLMSGetValue(e)}function b(e,t){return a.doLMSSetValue(e,t)}f.initialize=function(){if(!(config.v<1.2)){try{if(!scormEnabled)return}catch(e){return}a.doLMSInitialize(""),1.2==(g=a.getAPIVersion())?"not attempted"==v("cmi.core.lesson_status")&&(b("cmi.core.lesson_status","browsed"),r()):"not attempted"==v("cmi.completion_status")&&(b("cmi.completion_status","unknown"),r()),h=function(){try{var e=v("cmi.suspend_data");return JSON.parse(e)}catch(e){return[]}}();try{for(var e=0;e<config.scorm.objectives.length;e++){for(var t=Number(v("cmi.objectives._count")),n=t=t||0,o=config.scorm.objectives[e],i=0;i<t;i++)m("cmi.objectives",i,"id")==o.id&&(n=i);b("cmi.objectives."+n+".id",o.id),1.2!=g&&b("cmi.objectives."+n+".description",o.name)}}catch(e){}r()}},f.setBookmark=function(e,t){try{if(!scormEnabled)return}catch(e){return}b(1.2==g?"cmi.core.lesson_location":"cmi.location",e),t||r()},f.getBookmark=function(){try{if(!scormEnabled)return}catch(e){return}return v(1.2==g?"cmi.core.lesson_location":"cmi.location")},f.setInteractions=function(e){try{if(!scormEnabled)return}catch(e){return}for(var t=0;t<e.length;t++){for(var n=h.length,o=0;o<h.length;o++)h[o].id==e[t].id&&(n=o);h[n]=e[t],f.setInteraction(n,e[t],!0)}!function(){if(!h.length)return;for(var e=Number(v("cmi.objectives._count")),t={},n=0;n<h.length;n++)t[h[n].qid]=h[n];for(n=0;n<e;n++){var o=v("cmi.objectives."+n+".id");if(o){var i=0;for(var r in t)t[r].objective==o&&(i+=t[r].scoreMax);f.setObjective({id:o,scoreMax:i},!0),f.setObjective({id:o,scoreRaw:0},!0)}}i=0;for(var r in t)i+=t[r].scoreMax;b(1.2==g?"cmi.core.score.max":"cmi.score.max",i),b(1.2==g?"cmi.core.score.min":"cmi.score.min",0),b(1.2==g?"cmi.core.score.raw":"cmi.score.raw",0);for(var a=0;a<h.length;a++){for(var s,c,l=h[a],d=null,u=null,n=0;n<e;n++)l.objective==m("cmi.objectives",n,"id")&&(d=l.objective,u=n);d&&(s=(s=Number(v("cmi.objectives."+u+".score.raw")))||0,(c={}).id=d,c.scoreRaw=l.result*l.weighting+s,c.scoreMin=0,c.scoreScaled=c.scoreRaw/c.scoreMax,c.completionStatus="unknown",c.successStatus="unknown",f.setObjective(c,!0));var p=Number(v(1.2==g?"cmi.core.score.raw":"cmi.score.raw"));p=p||0,b(1.2==g?"cmi.core.score.raw":"cmi.score.raw",l.result*l.weighting+p)}}(),function(e){try{b("cmi.suspend_data",JSON.stringify(e))}catch(e){}}(h),r()},f.setInteraction=function(e,t,n){try{if(!scormEnabled)return}catch(e){return}var o,i;t.id&&b("cmi.interactions."+e+".id",t.id),t.result&&b("cmi.interactions."+e+".result",t.result),t.correctResponses&&b("cmi.interactions."+e+".correct_responses.0.pattern",t.correctResponses),t.type&&b("cmi.interactions."+e+".type",t.type),t.weighting&&b("cmi.interactions."+e+".weighting",t.weighting),t.objective&&b("cmi.interactions."+e+".objectives.0.id",t.objective),1.2==g?(t.timestamp&&b("cmi.interactions."+e+".time",function(e){var t=e.getSeconds();t<10&&(t="0"+t);var n=e.getMinutes();n<10&&(n="0"+n);var o=e.getHours();return o<10&&(o="0"+o),o+":"+n+":"+t}(t.timestamp)),t.latency&&b("cmi.interactions."+e+".latency",function(e){var t=Math.floor(e/3600);e-=60*t*60;var n=Math.floor(e/60);return(e-=60*n)<10&&(e="0"+e),t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n+":"+e}(t.latency)),t.learnerResponses&&b("cmi.interactions."+e+".student_response",t.learnerResponses)):(t.timestamp&&b("cmi.interactions."+e+".timestamp",(o=t.timestamp,(i=o.toISOString().split(".")).splice(i.length-1,1),i.join("."))),t.latency&&b("cmi.interactions."+e+".latency",function(e){var t=e,n=Math.floor(t/31104e3),t=e-31104e3*n,o=Math.floor(t/2592e3);t=e-2592e3*o;var i=Math.floor(t/86400);t=e-86400*i;var r=Math.floor(t/3600);t=e-3600*r;var a=Math.floor(t/60);return"P"+n+"Y"+o+"M"+i+"DT"+r+"H"+a+"M"+(e-60*a)+"S"}(t.latency)),t.learnerResponses&&b("cmi.interactions."+e+".learner_responses",t.learnerResponses),t.description&&b("cmi.interactions."+e+".description",t.description)),n||r()},f.setObjective=function(e,t){try{if(!scormEnabled)return}catch(e){return}for(var n=Number(v("cmi.objectives._count")),o=n,i=0;i<n;i++)m("cmi.objectives",i,"id")==e.id&&(o=i);null!=e.id&&b("cmi.objectives."+o+".id",e.id),null!=e.scoreRaw&&b("cmi.objectives."+o+".score.raw",e.scoreRaw),null!=e.scoreMin&&b("cmi.objectives."+o+".score.min",e.scoreMin),null!=e.scoreMax&&b("cmi.objectives."+o+".score.max",e.scoreMax),1.2==g?null!=e.successStatus&&b("cmi.objectives."+o+".status",e.successStatus):(null!=e.description&&b("cmi.objectives."+o+".description",e.description),null!=e.successStatus&&b("cmi.objectives."+o+".success_status",e.successStatus),null!=e.completionStatus&&b("cmi.objectives."+o+".completion_status",e.completionStatus),null!=e.scoreScaled&&b("cmi.objectives."+o+".score.scaled",e.scoreScaled)),t||r()},f.setManual=function(e,t){b(e,t),r()},f.interactionExistsOld=function(e){try{if(!scormEnabled)return}catch(e){return}for(var t=Number(v("cmi.interactions._count")),n=0;n<t;n++)if(m("cmi.interactions",n,"id")==e)return!0},f.interactionExists=function(e){try{if(!scormEnabled)return}catch(e){return}for(var t=0;t<h.length;t++)if(h[t].id==e)return!0};var a={version:"Auto",API:!(f.objectiveExists=function(e){try{if(!scormEnabled)return}catch(e){return}for(var t=Number(v("cmi.objectives._count")),n=0;n<t;n++)if(m("cmi.objectives",n,"id")==e)return!0}),scormVersions:["Auto","1.2","2004"],setAPIVersion:function(e){e=e||"Auto";var t=a.scormVersions.indexOf(e.toString());return-1<t&&(a.version=a.scormVersions[t]),a.version},getAPIVersion:function(){return a.version},isAvailable:function(){return!0},doLMSInitialize:function(){return a.cmiBooleanToJs(a.getAPICall("LMSInitialize","Initialize")(""))},doLMSFinish:function(){return a.cmiBooleanToJs(a.getAPICall("LMSFinish","Terminate")(""))},doLMSGetValue:function(e){return a.getAPICall("LMSGetValue","GetValue")(e)},doLMSSetValue:function(e,t){return a.cmiBooleanToJs(a.getAPICall("LMSSetValue","SetValue")(e,t))},doLMSCommit:function(){return a.cmiBooleanToJs(a.getAPICall("LMSCommit","Commit")(""))},doLMSGetLastError:function(){return a.getAPICall("LMSGetLastError","GetLastError")()},doLMSGetErrorString:function(e){return a.getAPICall("LMSGetErrorString","GetErrorString")(e.toString())},doLMSGetDiagnostic:function(e){return a.getAPICall("LMSGetDiagnostic","GetDiagnostic")(e.toString())},LMSIsInitialized:function(){return a.API},ErrorHandler:function(){return a.getAPICall("LMSGetLastError","GetLastError")()},cmiBooleanToJs:function(e){return"1"===e||1===e||"true"===e||!0===e},getAPIHandle:function(){var e=window;e.parent&&e.parent!=e&&a.findAPI(e.parent),!a.API&&e.top.opener?a.findAPI(e.top.opener):a.API},findAPI:function(e){for(var t=0;t<500;t++){if(e.API&&("1.2"===a.version||"Auto"===a.version)){a.API=e.API,a.version="1.2";break}if(e.API_1484_11&&("2004"===a.version||"Auto"===a.version)){a.API=e.API_1484_11,a.version="2004";break}e.parent&&e.parent!=e&&(t++,e=e.parent)}},getAPICall:function(e,t){if(!a.API&&(a.getAPIHandle(),!a.API))return function(){};switch(a.version){case"2004":return function(){return a.API[t].apply(a.API,arguments)};case"1.2":return function(){return a.API[e].apply(a.API,arguments)}}}};return f}),createService("sdk",function(){var e={};return e.initialize=function(){},e}),createService("search",function(){var a,c={};function s(e,r,a,t){if(e)if(0!=e.children.length){for(var n=0;n<e.children.length;n++)0!=i(e.children[n])&&(t=!1,hasClass(e.children[n],"k-section")&&virt.checkIfRequiresParse(e.children[n]),s(e.children[n],r,a,!0));t&&o(e)}else 0<i(e)&&o(e);function o(e){for(var t=e,n=traverser.convertElemsToLocation([t],r).left,o='<span class="searchItem">'+t.textContent+"</span>",i=(o.toLowerCase().indexOf(c.key.toLowerCase()),o.length+Math.round((70-o.length)/2));t.previousSibling&&!(o.length>=i);)t.previousSibling.textContent&&(o=t.previousSibling.textContent+o),t=t.previousSibling;o.length;for(t=e;t.nextSibling&&!(70<=o.length);)t.nextSibling.textContent&&(o+=t.nextSibling.textContent),t=t.nextSibling;c.result[a]&&c.result[a].matches&&c.result[a].matches.push({chapter:a,elem:e,hint:o.trim(),location:n})}function i(e){var t=c.normalize(e.textContent),n=c.normalize(c.key),o="gi";return c.isMatchCase&&(o="g"),c.isExactWord?(t.match(new RegExp("^"+n+"\\s|\\s"+n+"\\s|\\s"+n+"$",o))||[]).length:(t.match(new RegExp(n,o))||[]).length}}function l(){c.result=c.cleanArr(c.result);for(var e=0,t=c.result.length;t--;)if(c.result[t])for(var n=c.result[t].matches.length;n--;)e++;return e}function d(i,r){var e=stg.data.epub.spine.getElementsByTagName("itemref");return i>e.length-1?r(!1):(i=a[i],chapters.getPageOb({page:i,dontParse:!0},function(e){var t=document.createElement("div"),n=parseHtml(e.raw?e.raw:e.content),o=n.getElementById("epubContent");t.appendChild(o);n.getElementsByTagName("title");c.result[i]=[],c.result[i].title=e.title,c.result[i].matches=[],$filter("contentVirt")("parse",o,function(e){s(e,e,i),r(!0)})}))}return c.start=function(e,t){var n;c.key=e.key,c.isExactWord=e.isExactWord,c.isMatchCase=e.isMatchCase,e.array?c.result=e.array:c.result=new Array,c.result=c.cleanArr(c.result),"all"==e.mode?function(t,n){var o=0;t.start&&(o=t.start);a=function(){for(var n=[],e=stg.data.epub.spine.getElementsByTagName("itemref"),t=0;t<e.length;t++)n.push(chapters.getUnanchoredIndex(t));return n=n.filter(function(e,t){return n.indexOf(e)==t})}();var i=l(),r=function(e){t.limit&&l()-i>=t.limit?n({results:c.result,more:!0,key:c.key}):e?d(++o,r):n({results:c.result,key:c.key})};d(o,r)}(e,t):"chapter"==e.mode&&(n=cache.getOb("epubContent"),c.result[currentIndex]=[],c.result[currentIndex].matches=[],s(n,n,currentIndex),t({results:c.result,key:c.key}))},c.removeHighlights=function(){for(var e=document.getElementsByClassName("searchItemHighlight"),t=e.length;t--;)removeClass(e[t],"searchItemHighlight")},c.searchItemClicked=function(e,t,n){t=t||{};var o=e.item,i=e.index,r=e.matches;function a(){kStatus.update(translit.get("pleaseWait"),null,{dots:!0});var t=o.chapter,n=o.location;chapters.getPageOb({page:t},function(e){c.removeHighlights(),kotobee.addEventListener("processedRoute",s),chapters.redirect(t,{hash:n}),$rootScope.$$phase||$rootScope.$apply()})}function s(){kStatus.update(),kotobee.clearListeners("processedRoute"),r.index=i,$rootScope.renderScope.applyHeader("searchItems"),n&&n()}modals.hide(),t.timer?timeOut(a,300):a()},c.normalize=function(e){e=(e=(e=(e=(e=e.replace(/(|||)/g,"")).replace(/()/g,"")).replace(/(|)/g,"")).replace(/()/g,"")).replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"");for(var t=0;t<10;t++)e.replace(String.fromCharCode(1632+t),String.fromCharCode(48+t));return e},c.cleanArr=function(e){return e.filter(function(e){return e})},c}),createService("selection",function(){var o,n,r,a,c,l,d,u,p,s,h,g,f,m,v,b,k,y,w,C,t,x={};function I(e){return 0<parents(e,{stopAtIds:["spreadL","spreadR"],filterByClass:"ki-noHighlight"}).length}x.getLocation=function(){return v},x.elementDown=function(e,t){if(!(t.touches&&1<t.touches.length)){s=e;var n=!0;mobile||("a"==e.nodeName.toLowerCase()&&(n=!1),I(e)&&(n=!1),e.parentNode&&"a"==e.parentNode.nodeName.toLowerCase()&&(n=!1),n&&addClass(e,"highlightOver")),redrawForChrome(s.parentElement);var o=mobile&&!mobileDebug?400:50;if(n||(o*=4),g&&clearTimeout(g),mobile&&!mobileDebug){if(!t.touches||!t.touches.length)return;m=t.touches[0],w=m.clientX,C=m.clientY}else w=t.clientX,C=t.clientY,m=t;g=setTimeout(x.elementHeld,o),document.body.addEventListener(mobile&&!mobileDebug?"touchend":"mouseup",x.elementUp),document.body.addEventListener(mobile&&!mobileDebug?"touchmove":"mousemove",E)}};var E=function(e){e&&e.touches&&1<e.touches.length||(m=mobile&&!mobileDebug?e.touches[0]:e,g&&clearTimeout(g),"activated"==b&&e.stopPropagation())};x.elementUp=function(e){e&&e.touches&&1<e.touches.length||(s&&(mobile||removeClass(s,"highlightOver"),s=null,g&&clearTimeout(g)),t&&removeClass(cache.getOb("epubContent"),"disableEvents"),t=!1,document.body.removeEventListener(mobile&&!mobileDebug?"touchend":"mouseup",x.elementUp),document.body.removeEventListener(mobile&&!mobileDebug?"touchmove":"mousemove",E),$rootScope.$$phase||$rootScope.$apply())},x.elementHeld=function(){s&&($injector.get("nav").transforming||stg.data.pinching||m&&(Math.abs(m.clientX-w)>(mobile?30:10)||Math.abs(m.clientY-C)>(mobile?30:10)||I(s)||(addClass(s,"highlightSelected"),$(s),x.elementUp())))};var S=["p","div","ol","ul","table","h1","h2","h3","h4","h5","h6","h7","blockquote","sections","section","article","dl","form","pre","img","footer"];function T(e){c=e.parents1,l=e.parents2,d=e.index1,u=e.index2,p=e.commonParent,f=e.reversed}function O(e){return 8==e.nodeType||"#text"==e.nodeName||"br"==e.nodeName.toLowerCase()||0==e.offsetWidth}x.getBlocksArray=function(t){t=t||{};for(var e=document.getElementsByClassName("highlightSelected"),n=[],o={acceptNode:function(e){return-1==S.indexOf(e.nodeName.toLowerCase())||t.hasText&&!function(e){for(var t=e.getElementsByTagName("img"),n=0;n<t.length;n++)if(t[n].getAttribute("alt").trim())return!0;return e.textContent.trim()}(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},i=document.createTreeWalker(cache.getOb("epubContent"),NodeFilter.SHOW_ELEMENT,o),r=i.firstChild();r;){var a=n.length?n[n.length-1].elem:null;a&&a.contains(r)&&n.pop();var s={elem:r};e&&e.length&&r.contains(e[0])&&(s.current=!0),n.push(s),r=i.nextNode()}return n},x.getSelectedText=function(e){var o=[];e=e||document.getElementsByClassName("highlightSelected"),[].slice.call(e).forEach(function(e){o.push(e.cloneNode(!0))}),o.forEach(function(e,t){var n;"IMG"===e.nodeName?e.getAttribute("alt")&&((n=document.createElement("p")).textContent=e.getAttribute("alt"),o.splice(t,1,n)):[].slice.call(e.getElementsByTagName("img")).forEach(function(e){var t;e.getAttribute("alt")&&((t=document.createElement("p")).textContent=e.getAttribute("alt"),e.replaceWith(t))})});for(var t="",n=0;n<o.length;n++)t+=o[n].textContent;return t},x.expand=function(){r=r.parentNode,T(traverser.analyzeNodes(r,a)),r=a=p,L(),mobile&&A(),N()},x.extendRight=function(e){if(e||"rtl"!=getComputedStyle(r).direction){if(f){var t=traverser.nextTextNode(r,cache.getOb("epubContent"));if(O(r=t.parentNode))return void x.extendRight(e)}else{t=traverser.nextTextNode(a,cache.getOb("epubContent"));if(O(a=t.parentNode))return void x.extendRight(e)}T(traverser.analyzeNodes(r,a)),L(),mobile&&A(),N()}else x.extendLeft(!0)},x.extendLeft=function(e){if(e||"rtl"!=getComputedStyle(r).direction){if(f){var t=traverser.prevTextNode(r,cache.getOb("epubContent"));if(O(a=t.parentNode))return void x.extendLeft(e)}else{t=traverser.prevTextNode(r,cache.getOb("epubContent"));if(O(r=t.parentNode))return void x.extendLeft(e)}T(traverser.analyzeNodes(r,a)),L(),mobile&&A(),N()}else x.extendRight(!0)},x.newChapter=function(){mobile&&(markers.deleteMarker("anchor1Marker"),markers.deleteMarker("anchor2Marker"),o=x.createAnchorMarker("anchor1"),n=x.createAnchorMarker("anchor2"),addClass(o,"disable"),addClass(n,"disable"))};var A=function(){markers.refreshMarkerById("anchor1Marker"),markers.refreshMarkerById("anchor2Marker")},N=function(){return v=traverser.convertElemsToLocation(document.getElementsByClassName("highlightSelected"))};x.refreshSelectionLocation=N;var L=function(){try{if(e(),addClass(r,"highlightSelected"),addClass(a,"highlightSelected"),r==a)return void(v={left:traverser.getAbsoluteIndex(r)});if(r==p)return void(v={left:traverser.getAbsoluteIndex(r)});if(a==p)return void(v={left:traverser.getAbsoluteIndex(a)});B(f?a:r,f?r:a)}catch(e){}},B=function(e,t,n){var o;if("first"==(n=n||"first")){if(e.parentNode==p)return void B(e,t,"second");for(o=e;(o=o.nextSibling)&&o;)"#text"!=o.nodeName&&8!=o.nodeType&&addClass(o,"highlightSelected");B(e.parentNode,t,"first")}else if("second"==n){if(t.parentNode==p)return void B(e,t,"third");for(o=t;(o=o.previousSibling)&&o;)"#text"!=o.nodeName&&8!=o.nodeType&&addClass(o,"highlightSelected");B(e,t.parentNode,n)}else if("third"==n){var r,a=f?l[u-1]:c[d-1],s=f?c[d-1]:l[u-1];for(i=0;i<p.childNodes.length;i++)if(a!=p.childNodes[i]){if(s==p.childNodes[i])break;r&&"#text"!=p.childNodes[i].nodeName&&8!=p.childNodes[i].nodeType&&addClass(p.childNodes[i],"highlightSelected")}else r=!0}},e=function(){try{var e=document.getElementsByClassName("highlightSelected");if(!e)return;for(var t=e.length;t--;)removeClass(e[t],"highlightSelected");mobile&&virt.forceRepaint()}catch(e){}};function M(e){var t=1;return stg.data.book.chapter.viewport&&(t=$injector.get("nav").getFxlScale()),e.getBoundingClientRect().width/t}x.listener=null,x.addSpanAtCloseTag=function(){var e=document.createElement("span"),t=f?r:a;return t.parentNode.insertBefore(e,t.nextSibling),e},x.getSelectedNodes=function(){return document.getElementsByClassName("highlightSelected")},x.reset=function(){e(),mobile&&(o&&(addClass(o,"disable"),addClass(n,"disable")),n&&(removeClass(o,"tween"),removeClass(n,"tween"))),f=b=null,x.listener&&x.listener("deactivated")},x.deleteNoteMarker=function(e){var t=document.getElementById("knote"+e);t&&t.parentNode&&t.parentNode.removeChild(t),markers.deleteMarker("noteMarker"+e)},x.getNoteMarker=function(e){return markers.getMarker("noteMarker"+e)},x.createAnchorMarker=function(o){var t=document.createElement("span");return t.setAttribute("id",o+"Marker"),t.setAttribute("anchor",o),addClass(t,"anchorMarker"),cache.getOb("epubMeta").appendChild(t),t.addEventListener(mobileDebug?"mousedown":"touchstart",function(e){addClass(h=t,"selected"),y=null,document.addEventListener(mobileDebug?"mousemove":"touchmove",R),k&&clearInterval(k),k=setInterval(P,60),document.addEventListener(mobileDebug?"mouseup":"touchend",D),addClass(cache.getOb("epubContent"),"defaultCursor"),b="anchorDragged",mobile&&addClass(cache.getOb("epubContainer"),"disableScroll"),e.stopPropagation()}),markers.addMarker({id:o+"Marker",elem:t,offsetTop:-45,offsetLeft:-10,target:function(){var e,t,n=0;if("anchor1"==o){if(!(e=r))return void(this.offsetLeft=-10);try{t="rtl"==getComputedStyle(e).direction}catch(e){}n=f?t?0:M(e):t?M(e):0}else{if(!(e=a))return void(this.offsetLeft=-10);try{t="rtl"==getComputedStyle(e).direction}catch(e){}n=f?t?M(e):0:t?0:M(e)}return this.offsetLeft=-10+n,e}}),t},x.createNoteMarker=function(n,e,t){if(t=t||{},!document.getElementById("knote"+n.nid)){var o=document.createElement("span");o.setAttribute("id","knote"+n.nid),addClass(o,t.class?t.class:"contentNoteMarker"),cache.getOb("epubMeta").appendChild(o);var i=(i=0)||0;return i=-18,markers.addMarker({id:"noteMarker"+n.nid,elem:o,offsetTop:i,target:function(){return hasClass(this.elem,"contentNoteMarker")?this.offsetLeft=M(e)-13:this.offsetLeft=0,hasClass(this.elem,"contentNoteMarker")||this.offsetTop<10&&(this.offsetTop=10),e},callback:function(){var t=this;markers.checkMarkerExistsAtSameLocation(this.elem,function(e){return e?(t.offsetTop+=39,void markers.refreshMarker(t)):n.callback?n.callback():void 0})}}),o}},x.deleteBookMarker=function(e){var t=document.getElementById("bookmark"+e);t&&t.parentNode&&t.parentNode.removeChild(t),markers.deleteMarker("bookMarker"+e)},x.createBookMarker=function(n,e){var t=document.createElement("span");t.setAttribute("id","bookmark"+n.bmid),addClass(t,"contentBookMarker"),cache.getOb("epubMeta").appendChild(t);var o=(o=0)||0;return markers.addMarker({id:"bookMarker"+n.bmid,elem:t,offsetLeft:0,offsetTop:o,target:function(){return this.offsetTop<10&&(this.offsetTop=10),e},callback:function(){var t=this;markers.checkMarkerExistsAtSameLocation(this.elem,function(e){return e?(t.offsetTop+=39,void markers.refreshMarker(t)):n.callback?n.callback():void 0})}}),t},x.embedAnchorMarker=function(e){};var R=function(e){(y=e).stopPropagation()},P=function(e){try{if(e&&e.stopPropagation(),mobile){if("anchorDragged"!=b)return;if(!y)return}var t,n;if(n=mobile?(t=mobileDebug?y:y.targetTouches[0],document.elementFromPoint(t.clientX,Math.round(t.clientY+o.offsetHeight/2))):e.target,cache.getOb("epubContent")==n)return;if(!cache.getOb("epubContent").contains(n))return;if(1<(n.textContent.match(new RegExp(" ","g"))||[]).length)return;if(mobile)if("anchor1"==h.getAttribute("anchor")){if(r==n)return;r=n}else{if(a==n)return;a=n}else a=n;T(traverser.analyzeNodes(r,a)),L(),redrawForChrome(r.parentElement),redrawForChrome(a.parentElement),mobile&&A()}catch(e){}},D=function(e){try{var t=cache.getOb("epubContainer");document.removeEventListener(mobile&&!mobileDebug?"touchend":"mouseup",D),mobile?(document.removeEventListener(mobileDebug?"mousemove":"touchmove",R),removeClass(h,"selected"),clearInterval(k),removeClass(t,"disableScroll")):t.removeEventListener("mousemove",P),removeClass(cache.getOb("epubContent"),"defaultCursor"),h=null,v=N(),b="selectionFixed",x.listener&&x.listener(b),e.stopPropagation()}catch(e){}},$=function(e){try{var t=cache.getOb("epubContainer");r=a=e,mobile?(removeClass(o,"disable"),removeClass(n,"disable"),timeOut(function(){addClass(o,"tween"),addClass(n,"tween")},100),A()):(t.addEventListener("mousemove",P),document.addEventListener("mouseup",D)),N(),b="activated",x.listener&&x.listener(b)}catch(e){}};return x.active=function(){return"selectionFixed"==b||"activated"==b},x.copyToClipboard=function(t,e){if((config.clipboardCopy||e)&&(t=t||x.getSelectedText()))if(native)$injector.get("crdv").copyToClipboard(t);else if(desktop){require("nw.gui").Clipboard.get().set(t,"text"),kStatus.showAndHide(translit.get("copiedToClipboard"),500)}else{var n=document.createElement("textarea");document.body.appendChild(n),n.value=t,n.focus(),n.select();try{document.execCommand("Copy"),$injector.get("kStatus").showAndHide(translit.get("copiedToClipboard"),500)}catch(e){$injector.get("modals").show({mode:"flashUnsupported",flashOb:{text:t}}),setTimeout(function(){document.getElementById("clipboardText").focus(),document.getElementById("clipboardText").select()},200)}n.remove()}},x}),createService("settings",function(){var e={};return e.pinchActive=!1,e.stylesInitialize=function(){},e.initialize=function(){e.stylingChanged(),e.lineAdjustChanged(),e.updateTextSize(),markers.refreshMarkers()},e.getTextSize=function(){return Number(stg.data.settings.textSize.slice(0,-2))},e.viewModeChanged=function(){spread.applyMode(stg.data.settings.viewMode)},e.updateTextSize=function(){try{var e=cache.getOb("epubContent"),t=cache.getOb("epubContent").style;if(t.fontSize==stg.data.settings.textSize)return;t.fontSize=stg.data.settings.textSize;for(var n=0;n<e.children.length;n++)try{e.children[n].style.fontSize="1em"}catch(e){}var o=cache.getOb("epubContainer"),i=e.parentNode.parentNode,r=i.style.webkitTransform||i.style.mozTransform||i.style.transform,a=overflowScroll?cache.getOb("epubContainer").scrollTop:Number(r.split(",")[1].slice(0,-2)),s=e.offsetHeight,c=o.offsetTop,l=o.offsetHeight;s+a<l+c?virt.safeScroll("content",0,c+s-l,!0):s<l&&$ionicScrollDelegate.$getByHandle("content").scrollTop(!1),virt.reset()}catch(e){}},e.writeTextSize=function(){stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings,function(){markers.refreshMarkers()})},e.stylingChanged=function(){stg.data.settings.styling?cssParser.showStyles():cssParser.hideStyles(),markers.refreshMarkers()},e.saveSettings=function(){stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings)},e.langChanged=function(e){$injector.get("nav").fxlZoomFit(),stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings,function(){translit.setLang(stg.data.settings.language,e),markers.refreshMarkers()}),backend.setLang({lang:stg.data.settings.language})},e.lineAdjustChanged=function(){(stg.data.settings.lineAdjust?addClass:removeClass)(cache.getOb("epubContent"),"adjustedLineHeight"),markers.refreshMarkers()},e.sync=function(){sync.onOnline(function(){native?crdv.toast(translit.get("syncComplete")):modals.show({mode:"success",successOptions:{msg:translit.get("syncComplete")}})})},e}),createService("skeleton",function(){var r,a,d={},s=[],c=[];function u(){var e=stg.data.settings.viewMode;return"double"==e&&config.singleViewOnPortrait&&1.3*window.innerWidth<window.innerHeight&&(e="single"),e}function p(e){s=[],(e=e||{}).firstBone||(e.firstBone=l());for(var t=e.firstBone,n=u(),o=e.lastJoint;t;){var i=[];if(t.joint=i,"single"==n?i.push(t):"double"==n?(i.push(t),o&&delete t.alone,t.alone||t.index>=config.firstDoublePage&&t.next&&(i.push(t=t.next),t.joint=i)):"auto"==n&&i.push(t),o&&((i.prev=o).next=i),s.push(i),o=null,t.next&&(o=i),e.lastBone==t)break;t=function(e,t){t=t||{};if(e.next)return e.next;if(t.connectedOnly)return;return h(e.index+1)}(t,e)}return s[s.length-1]}function l(e){var t;e=e||0;for(var n=0;n<c.length;n++)c[n].index<e||(!t||c[n].index<t.index||c[n].index==t.index&&c[n].vIndex<t.vIndex)&&(t=c[n]);return t}function i(e){for(var t,n=0;n<c.length;n++)c[n].index>e||(!t||c[n].index>t.index||c[n].index==t.index&&c[n].vIndex>t.vIndex)&&(t=c[n]);return t}function h(e){var t,n,o=i();if(o)for(;e<=o.index;){if(t&&(e=t.index+1),n=d.getBone(e))return n;t=null,e++}}return d.reset=function(){c=[],s=[]},d.initialize=function(e){d.reset();for(var t=(e=e||{}).first;t<e.last;t++)d.add({index:t})},d.trace=function(){var e=-1;for(;;){var t=h(e+1);if(!t)break;var n=function(e){0;var t;for(;e;)e.index,e.vIndex,(e=(t=e).next)&&0;return t}(t);e=n.index}var o=-1;for(;;){var i=function(e){var t=h(e);if(t)return t.joint}(o+1);if(!i)break;var r=function(e,t){t=t||"";var n;for(;e;){t+=" [";for(var o=0;o<e.length;o++)t+=e[o].index+"."+e[o].vIndex+",";t=t.substr(0,t.length-1)+"]",(e=(n=e).next)&&(t+="->")}return n}(i);o=r[r.length-1].index}},d.add=function(e){var t,n,o,i,r=d.getBone(e.index);if(r){var a=e.pages&&e.pages.length;if(r.total&&a)return;if(!r.total&&!a)return;d.remove(r)}if(e.pages&&e.pages.length)for(var s=0;s<e.pages.length;s++)(i={}).index=e.index,i.vIndex=s,i.total=e.pages.length,t&&((i.prev=t).next=i),c.push(i),t=i,0==s&&(n=i),s==e.pages.length-1&&(o=i);else(i={}).index=e.index,i.vIndex=null,c.push(i),n=o=i;!function(e,t){var n=d.getBone(e.index-1);{var o;n&&(1<(o=n).total&&(o=d.getBone(e.index-1,n.total-1)),(o.next=e).prev=o)}var i,r,a=d.getBone(t.index+1);a&&((a.prev=t).next=a);if("double"==u()){var s=d.getJoint(e.index-1),c=d.getJoint(t.index+1);if(s)return p();var l=t.total?t.total:1;if(c&&1==c.length&&c[0].index>=config.firstDoublePage&&(i=!0),c){if(i||l%2==0&&(r=!0),i&&l%2==1&&(r=!0),r)return p();e.alone=!0}}p()}(n,o)},d.remove=function(e){e.prev&&e.prev.next&&(e.prev.next=null),e.next&&e.next.prev&&(e.next.prev=null);for(var t=0;t<c.length;t++)if(c[t]==e)return void c.splice(t,1)},d.getBone=function(e,t){for(var n=0;n<c.length;n++)if(c[n].index==e){if(null==t)return c[n];if(c[n].vIndex==t)return c[n]}},d.normalize=function(e){var t,n,o;"double"==d.getCurrentView(e.index,e).view&&(null!=e.vIndex?(t=d.getJoint(e.index,e.vIndex))&&(n=t[0].index,o=t[0].vIndex,(n!=e.index||null!=o&&o!=e.vIndex)&&(e.index=n,null!=o&&(e.vIndex=o))):(e.index-config.firstDoublePage)%2==1&&e.index--)},d.getJoint=function(e,t){for(var n=0;n<s.length;n++)for(var o=0;o<s[n].length;o++)if(s[n][o].index==e){if(t<=-1&&s[n][o].total&&(t+=s[n][o].total),null==t)return s[n];if(null==s[n][o].vIndex)return s[n];if(s[n][o].vIndex==t)return s[n]}},d.nextJoint=function(e,t){var n=d.getBone(e,t);if(n){var o=n.joint.next;if(o)return{index:o.index,vIndex:o.vIndex}}},d.prevJoint=function(e,t){var n=d.getBone(e,t);if(n){var o=n.joint.prev;if(o)return{index:o.index,vIndex:o.vIndex}}},d.getNextLinearIndex=function(n,o){var i=stg.data.epub.spine.getElementsByTagName("itemref"),e=i[n.index];r=r||e.getAttribute("idref"),d.getNextIndex(n,function(e){if(!e)return o({leftOb:n});if(e.leftOb.index>=i.length-1)return o(e);var t=i[e.leftOb.index];if(t){if(null==e.leftOb.vIndex&&t.getAttribute("idref")==r)return d.getNextLinearIndex({index:e.leftOb.index,vIndex:e.leftOb.vIndex},o);if("no"==t.getAttribute("linear"))return d.getNextLinearIndex({index:e.leftOb.index,vIndex:e.leftOb.vIndex},o)}return r=null,o(e)})},d.getNextIndex=function(e,t){var n={},o=d.getJoint(e.index,e.vIndex);return o?(o&&o.next?n.leftOb={index:o.next[0].index,vIndex:o.next[0].vIndex}:n.leftOb={index:o[o.length-1].index+1,vIndex:0},t&&t(n),n):t?t():null},d.getPrevLinearIndex=function(n,o){if(0==n.index){if(null==n.vIndex)return o({leftOb:n});if(0==n.vIndex)return o({leftOb:n})}var i=stg.data.epub.spine.getElementsByTagName("itemref"),e=i[n.index];a=a||e.getAttribute("idref"),d.getPrevIndex(n,function(e){if(!e)return o({leftOb:n});var t=i[e.leftOb.index];if(t){if(null==e.leftOb.vIndex&&t.getAttribute("idref")==a)return d.getPrevLinearIndex({index:e.leftOb.index,vIndex:e.leftOb.vIndex,source:"first"},o);if("no"==t.getAttribute("linear"))return d.getPrevLinearIndex({index:e.leftOb.index,vIndex:e.leftOb.vIndex,source:"second"},o)}return a=null,o(e)})},d.getPrevIndex=function(e,t){var n={},o=d.getJoint(e.index,e.vIndex);return o?(o&&o.prev?n.leftOb={index:o.prev[0].index,vIndex:o.prev[0].vIndex}:(n.leftOb={index:o[0].index-1,vIndex:-1},n.leftOb.index<0&&(n.leftOb.index=0),n.leftOb.vIndex<0&&(n.leftOb.vIndex=null==e.vIndex?null:0)),t&&t(n),n):t?t():null},d.isSingle=function(e,t){var n=d.getJoint(e,t);if(n)return 1==n.length},d.getCurrentView=function(e,t){var n=d.getJoint(e,t.vIndex);if(n){var o={};return o.view=1==n.length?"single":"double",o.index=e,o}},d.isLastChapter=function(e,t){var n=null==(e=e||{}).index?currentIndex:e.index,o=null==e.vIndex?currentVIndex:e.vIndex;return t(d.getJoint(n,o)==i(e.last).joint)},d.isFirstChapter=function(e,t){return e=e||{},t(d.getJoint(currentIndex,currentVIndex)==l(e.first).joint)},d.isNeighbor=function(e,t){for(var n=d.getJoint(currentIndex,currentVIndex),o=n.next,i=n.prev,r=0;r<2;r++){var a=[o,i][r],s=["next","prev"][r];if(a)for(var c=0;c<a.length;c++)if(a[c].index==e.index){if(null==a[c].vIndex)return t(s);if(a[c].vIndex==e.vIndex)return t(s)}}t()},d}),createService("sleep",function(){var e={};function t(){var e=document.getElementById("preventSleepingContainer");if(e){var t=e.getElementsByTagName("video")[0];if(t)return t}return null}return e.initialize=function(){config&&config.noSleep&&(function(){isKotobee&&void 0!==kotobee?kotobee.addEventListener("chapterLoaded",function(){e.enableSleep()}):window.addEventListener("load",function(){e.enableSleep()});document.addEventListener("resume",function(){e.enableSleep()})}(),initializer.initialized?e.setup():kotobee.addEventListener("initialized",e.setup))},e.setup=function(){var e,t,n,o="preventSleepingContainer";document.getElementById(o)||((e=document.createElement("div")).id=o,e.style.cssText="position: absolute !important;top: 0px !important;left: 0px !important;display: inline-block !important;z-index: -2 !important;",(t=document.createElement("video")).loop=!0,t.autoplay=!0,t.muted=!0,t.playsInline=!0,t.setAttribute("webkit-playsinline","true"),t.style.cssText="width: 1px !important;height: 1px !important;",(n=document.createElement("source")).setAttribute("src",rootDir+"img/ui/blank_vid.mp4"),n.setAttribute("type","video/mp4"),t.appendChild(n),e.appendChild(t),setTimeout(function(){document.body.appendChild(e)},500))},e.enableSleep=function(){var e=t();e&&e.play()},e.disableSleep=function(){var e=t();e&&e.pause()},e}),createService("spread",function(){var t={};function y(e){try{if("span"==e.nodeName.toLowerCase())return!1;if(e.style){if("always"==e.style.pageBreakBefore||"always"==getComputedStyle(e).pageBreakBefore)return e;if(e.previousSibling&&e.previousSibling.nodeName&&"span"!=e.previousSibling.nodeName.toLowerCase()&&e.previousSibling.style&&("always"==e.previousSibling.style.pageBreakAfter||"always"==getComputedStyle(e).pageBreakAfter))return e}for(var t=0;t<e.childNodes.length;t++){var n=y(e.childNodes[t]);if(n)return n}}catch(e){}return!1}function w(e,t){var n,o,i=getFilteredChildIndex(t);0<i&&(n=e.parentNode,i!=(o=getFilteredChildIndex(e))&&(n.getAttribute("kb-offset")||n.setAttribute("kb-offset",i-o)))}return t.initialize=function(){},t.applyMode=function(e){"double"==e?t.activateDblPage():"single"==e?t.activateSinglePage():"auto"==e&&t.activateAutoPage()},t.activateSinglePage=function(){var e;chapters.shouldBePaged(stg.data.currentPageOb)?chapters.regenerateSpreads():(chapters.resetPages({buildChapterMode:!0}),e={viewMode:"single",reload:!0},chapters.loadChapterByIndex(currentIndex,e,function(){}))},t.activateDblPage=function(){var e;chapters.shouldBePaged(stg.data.currentPageOb)?chapters.regenerateSpreads():(chapters.resetPages({buildChapterMode:!0}),e={viewMode:"double",reload:!0},chapters.loadChapterByIndex(currentIndex,e,function(){}))},t.activateAutoPage=function(){"double"==chapters.getCurrentView(currentIndex,{vIndex:currentVIndex}).view?t.activateDblPage():t.activateSinglePage()},t.getViewport=function(e){e=e||{};var t=document.getElementById("readerBody"),n=document.getElementById("readerHeader"),o=document.getElementById("tabMenu"),i=t.getBoundingClientRect().width,r=t.getBoundingClientRect().height;mobile&&"alwaysShow"!=config.autohideReaderMode&&"showOnScroll"!=config.autohideReaderMode&&"showOnTap"!=config.autohideReaderMode||(r-=n.getBoundingClientRect().height+o.getBoundingClientRect().height);var a=(a=chapters.getCurrentView(e.index,{vIndex:e.vIndex}))||{view:"double"},s={},c=config.spreadSpacing?config.spreadSpacing:0;return"double"==a.view?s.width=Math.round((i-c)/2):(s.width=i,"double"==stg.data.settings.viewMode&&(s.width=i/2),1.3*window.innerWidth<window.innerHeight&&(s.width=i)),s.height=r,s},t.parseReflowableChapter=function(e,l){e.raw&&!e.pages&&(e.content=e.raw),$injector.get("context").simulateChapter(e,function(a){var s=t.getViewport(e),c={pages:[]};c.pageWidth=s.width,c.pageHeight=s.height,c.url=e.url,c.index=e.index,a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.zIndex=-1,a.style.visibility="hidden",a.setAttribute("data-index",c.index),document.body.appendChild(a),a.addEventListener("error",function(e){}),a.addEventListener("load",function(){var e=a.contentDocument.documentElement,n=e.getElementsByTagName("body")[0];n.style.width=s.width+"px",n.style.height=2*s.height+"px";var t=e.getElementsByTagName("style")[0].innerHTML;c.supportsPageBreakStyles=0<=t.indexOf("page-break-after")||0<=t.indexOf("page-break-before");var o=a.contentDocument.getElementById("spreadR");o&&o.parentNode.removeChild(o),a.contentDocument.getElementById("epubScroller").style.overflowY="hidden";var i=a.contentDocument.getElementById("epubContent"),r=i.outerHTML;$filter("contentVirt")("parse",i,function(){var e=function(e,o){o.pages||(o.pages=[]);o.index||(o.index=0);o.lastStop||(o.lastStop=document.createElement("div"));var t=o.lastStop,n=[];e.style.width=o.pageWidth+"px";var i=e,r=+o.pageHeight,a=getElemMargin(e,{computed:!0}),s=getElemPadding(e,{computed:!0}),c=a.top,l=a.bottom,d=s.top,u=s.bottom;"auto"==c&&(c=0);"auto"==l&&(l=0);"auto"==d&&(d=0);"auto"==u&&(u=0);c=c||0;l=l||0;d=d||0;u=u||0;a=Number(a),s=Number(s);var p=c+d,h=l+u,g=traverseToBottom(e,"epubContent");for(;;){if(0,!i||8==i.nodeType){if("continue"==k())continue;break}var f=getBoundingBox(i);if(f.bottom<r-h){if(o.supportsPageBreakStyles&&y(i)){if(b(i),r=f.bottom+o.pageHeight-p-h,"break"==k())break;continue}var m=i.cloneNode(!0);if(t.appendChild(m),n.length&&w(m,i),"break"==k())break}else if(function(e){if(!e.childNodes.length)return!1;if(e.className.indexOf&&0<=e.className.indexOf("kInteractive")){if(hasClass(e,"video"))return!1;if(hasClass(e,"gallery"))return!1;if(hasClass(e,"audio"))return!1;if(hasClass(e,"widget"))return!1;if(hasClass(e,"widget"))return!1;if(hasClass(e,"threed"))return!1}return!0}(i)){m=cloneNodeAttributes(i);t.appendChild(m),n.length&&w(m,i),t=t.childNodes[t.childNodes.length-1],i=i.childNodes[0]}else if(b(i),"break"==k())break}function v(e){if(!e)return"";o.url;for(var t=getElementsByAttribute(e,"*","src"),n=0;n<t.length;n++){t[n].getAttribute("src");0}return e.outerHTML}function b(e){r=f.top+o.pageHeight-p-h,t&&(n.length,n.push({content:v(traverseToTop(t,"epubContent")),lastLocation:traverser.convertElemsToLocation([e],g).left})),(t=function(e){0;var t,n=parents(e);for(var o=0;o<n.length-1;o++){var i;"#document"!=n[o].nodeName.toLowerCase()&&"html"!=n[o].nodeName.toLowerCase()&&(i=cloneNodeAttributes(n[o]),t=t?(t.appendChild(i),w(i,n[o]),t.childNodes[0]):i)}return t}(e)).appendChild(e.cloneNode(!0))}function k(){return i.nextSibling?(i=i.nextSibling,"sibling"):i.parentNode&&"body"!=i.nodeName.toLowerCase()?(i=i.parentNode,t=t.parentNode?t.parentNode:traverseToBottom(t,"epubContent"),k()):(t&&n.push({content:v(traverseToTop(t,"epubContent"))}),"break")}{1==n.length&&(i=traverseToBottom(e,"epubContent"),n[0].content=v(i))}return n}(n,c);a.parentNode.removeChild(a);var t={};t.pages=e,t.raw=r,t.viewport=s,l(t)})})})},t}),createService("sso",function(){var l,d={},u=["facebook","google","auth0"],i="http://localhost:8100";function t(e){config.kotobee.sso[e]&&(stg.data.sso[e]=!0,stg.data.sso[e+"Logo"]=rootDir+"img/ui/sso/"+e+".png")}function r(e){if(!stg.data.sso.oauth)return null;var t=Object.assign({},stg.data.sso.oauth);return t.provider==e?t:null}function p(e,t){var n=getBaseSuffix();return native&&(n=i,n+=window.location.pathname),t||(n+="?provider="+e),config.ssoRedirectUrl&&(localStorage.kotobeeRedirect=JSON.stringify({url:n.split("?")[0],provider:e}),n=config.ssoRedirectUrl),n}function h(e,n){if(native){if(cordova.InAppBrowser){if(e.provider&&-1!=u.indexOf(e.provider))return cordova.InAppBrowser.open(e.url,"_system","location=yes"),void window.addEventListener("cordovaHandleOpenUrl",function(e){var t;e&&e.detail&&n&&(t=new URL(e.detail),n(t))},{once:!0});var o=cordova.InAppBrowser.open(e.url,"_blank",e.options);o.addEventListener("loadstart",function(e){var t;0===e.url.indexOf(i)&&(o.close(),t=new URL(e.url),n&&n(t))}),o.addEventListener("loaderror",function(e){if(!ios)try{o&&o.close()}catch(e){}}),o.addEventListener("exit",function(e){})}}else window.location.replace(e.url)}return d.initialize=function(e){l=ios?"yes":"no",stg.data.sso||(stg.data.sso={}),Object.keys(config.kotobee.sso).forEach(t),e&&e()},d.setTokens=function(e,t,n){stg.data.sso||(stg.data.sso={});var o={provider:e,idToken:t,accessToken:n};stg.data.sso.oauth=o},d.getSSOEmail=function(n,o){var e,t=r(n);if(t)switch(n){case"facebook":var i={fields:"id,email",access_token:t.accessToken};$injector.get("backend").sendRawPost("https://graph.facebook.com/v7.0/me",i,{ignoreCredentials:!0,queryString:!0,responseType:"json"},function(e){var t;e?(t=e.email,Vue.set(stg.data.user,"email",t),Vue.set(stg.data.user,"loggedIn","string"==typeof e.email),t||kError.update({error:"ssoEmailError",provider:n.toCamelCase()}),o(t)):o()});break;case"microsoft":!t.idToken||(e=d.parseJWT(t.idToken))&&e.email&&Vue.set(stg.data.user,"email",e.email);default:o()}else o()},d.signInBrowser=function(r,a){var e,t;switch(r){case"okta":var n=("/"==config.kotobee.sso[r].params.domain.slice(-1)?config.kotobee.sso[r].params.domain.slice(0,-1):config.kotobee.sso[r].params.domain)+"/oauth2/default/v1/authorize";break;case"google":n="https://accounts.google.com/o/oauth2/v2/auth";break;case"microsoft":n="https://login.microsoftonline.com/common/oauth2/v2.0/authorize";break;case"facebook":n="https://www.facebook.com/v7.0/dialog/oauth",e="token",t="public_profile email";break;case"auth0":n="https://"+config.kotobee.sso[r].params.domain.replace(/http[s]?:\/\//g,"")+"/authorize";break;case"fusionauth":n="https://"+config.kotobee.sso[r].params.domain.replace(/http[s]?:\/\//g,"")+"/oauth2/authorize"}e=encodeURIComponent(e||"token id_token"),t=encodeURIComponent(t||"openid profile email");var s=randStr(11,""),o=p(r);"microsoft"==r&&(o=o.replace(/\/\?.*/,"/")),native&&-1!=u.indexOf(r)&&(o=config.kotobee.liburl+"sso/index.html?provider="+r);var i="";if(native)try{i="-appid-"+BuildInfo.packageName.replace(/\./g,"")}catch(e){i=""}var c=n+"?client_id="+config.kotobee.sso[r].params.clientid+"&response_type="+e+"&scope="+t+"&state="+uuid+i+"&nonce="+s+"&redirect_uri="+encodeURIComponent(o);"fusionauth"===r&&config.kotobee.sso[r].params.tenantid&&(c+="&tenant_id="+config.kotobee.sso[r].params.tenantid),h({url:c,options:"location=no,hidden=no,clearsessioncache=yes,clearcache=yes,closebuttoncaption=Go back to App,toolbar="+l+",presentationstyle=formsheet",provider:r},function(e){var t,n,o,i=new URLSearchParams(e.hash.slice(1));i.get("state").split("-appid-")[0]!=uuid||(t=i.get("access_token")||"",n=i.get("id_token")||"",d.setTokens(r,n,t),n?(o=d.parseJWT(n)).nonce!=s||a&&(a(r,o.email,t,n),modals.hide(),$location.path("/loading"),$ionicHistory.clearHistory(),auth.startup()):t&&"facebook"===r&&d.getSSOEmail(r,function(e){e?a&&(a(r,e,t,n),modals.hide(),$location.path("/loading"),$ionicHistory.clearHistory(),auth.startup()):(modals.hide(),kError.update({error:"ssoEmailError",provider:r.toCamelCase()}))}))})},d.signOutBrowser=function(e){var t="location=no,hidden=yes",n=r(e);if(n)switch(e){case"okta":h({url:o=("/"==config.kotobee.sso[e].params.domain.slice(-1)?config.kotobee.sso[e].params.domain.slice(0,-1):config.kotobee.sso[e].params.domain)+"/oauth2/default/v1/logout?id_token_hint="+n.idToken+"&state="+uuid+"&post_logout_redirect_uri="+encodeURIComponent(p(e,!0)),options:t});break;case"google":$injector.get("backend").sendRawPost("https://oauth2.googleapis.com/revoke",{token:n.accessToken},{ignoreCredentials:!0},function(e){native||(delete stg.data.sso.oauth,$injector.get("login").toLoginScreen())});break;case"microsoft":native||(delete stg.data.sso.oauth,$injector.get("login").toLoginScreen());break;case"facebook":$injector.get("backend").sendRawPost("https://graph.facebook.com/v7.0/me/permissions",{token:n.accessToken},{method:"delete",ignoreCredentials:!0},function(e){native||(delete stg.data.sso.oauth,$injector.get("login").toLoginScreen())});break;case"auth0":"/"==config.kotobee.sso[e].params.domain.slice(-1)?config.kotobee.sso[e].params.domain.slice(0,-1):config.kotobee.sso[e].params.domain;h({url:o="https://"+config.kotobee.sso[e].params.domain+"/v2/logout?client_id="+config.kotobee.sso[e].params.clientid+"&returnTo="+p(e,!0),options:t});break;case"fusionauth":"/"==config.kotobee.sso[e].params.domain.slice(-1)?config.kotobee.sso[e].params.domain.slice(0,-1):config.kotobee.sso[e].params.domain;var o="https://"+config.kotobee.sso[e].params.domain+"/oauth2/logout?client_id="+config.kotobee.sso[e].params.clientid+"&post_logout_redirect_uri="+p(e,!0);config.kotobee.sso[e].params.tenantid&&(o+="&tenant_id="+config.kotobee.sso[e].params.tenantid),h({url:o,options:t})}},d.parseJWT=function(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)},d}),createService("stg",function(){var a={data:{},view:{}};return a.initialize=function(){vueExclude&&($rootScope.data=a.data,$rootScope.view=a.view),a.reset(),a.setLanguages(),a.setSort(),preview&&a.clearSlots()},a.initializeSettings=function(t){try{a.readSlot("settings"+a.getBookId(!0),function(e){Vue.set(a.data,"settings",e),0==a.data.settings.length&&Vue.set(a.data,"settings",{}),n()})}catch(e){Vue.set(a.data,"settings",{}),n()}function n(){a.applyDefaultSettings();try{if(config.defaultLanguage&&(Vue.set(a.data.settings,"language",config.defaultLanguage),a.langChanged()),Vue.set(a.data.settings,"navAnim",config.defaultNavAnim?config.defaultNavAnim:"navBookBlock"),Vue.set(a.data.settings,"viewMode",config.defaultViewMode?config.defaultViewMode:"auto"),Vue.set(a.data.settings,"pageScroll",null==config.defaultPageScroll||config.defaultPageScroll),!preview)return void a.readSlot("settings"+a.getBookId(!0),function(e){e&&(e.language&&(Vue.set(a.data.settings,"language",e.language),a.langChanged()),e.navAnim&&Vue.set(a.data.settings,"navAnim",e.navAnim),e.viewMode&&Vue.set(a.data.settings,"viewMode",e.viewMode)),config.forcedLanguage&&(Vue.set(a.data.settings,"language",config.forcedLanguage),a.langChanged()),config.forcedViewMode&&Vue.set(a.data.settings,"viewMode",config.viewMode=config.forcedViewMode),config.forcedNavAnim&&Vue.set(a.data.settings,"navAnim",config.navAnim=config.forcedNavAnim),t&&t()})}catch(e){}t&&t()}},a.langChanged=function(){"ar"==a.data.settings.language?Vue.set(a.data.settings,"rtl",!0):Vue.set(a.data.settings,"rtl",!1)},a.reset=function(){a.resetBook(),a.resetLibrary()},a.setSort=function(){var e={method:null,model:null,options:[{name:"dateAddedNewestFirst",data:"date",dir:"desc",val:"dateDesc"},{name:"dateAddedOldestFirst",data:"date",dir:"asc",val:"dateAsc"},{name:"titleA-Z",data:"name",dir:"asc",val:"titleAsc"},{name:"titleZ-A",data:"name",dir:"desc",val:"titleDesc"},{name:"categoryA-Z",data:"cat",dir:"asc",val:"catAsc"},{name:"categoryZ-A",data:"cat",dir:"desc",val:"catDesc"},{name:"viewsHighestFirst",data:"views",dir:"desc",val:"viewsDesc"},{name:"viewsLowestFirst",data:"views",dir:"asc",val:"viewsAsc"},{name:"ratingHighestFirst",data:"rating",dir:"desc",val:"ratingAsc"},{name:"ratingLowestFirst",data:"rating",dir:"asc",val:"ratingDesc"}]};Vue.set(a.data,"sortOb",e)},a.setLanguages=function(){var e=[{label:"English",val:"en"},{label:"Franais",val:"fr"},{label:"Espaol",val:"es"},{label:"Portugus",val:"pt"},{label:"Nederlands",val:"nl"},{label:"Deutsch",val:"de"},{label:"Magyar",val:"hu"},{label:"Italiano",val:"it"},{label:"Svenska",val:"sw"},{label:"Melayu",val:"ms"},{label:"Norsk",val:"no"},{label:"Polski",val:"pl"},{label:"Romn",val:"ro"},{label:"P",val:"ru"},{label:"Trke",val:"tr"},{label:"Cymraeg",val:"cy"},{label:"",val:"ar"},{label:"",val:"zh-cn"},{label:"",val:"zh-tw"},{label:"",val:"jp"},{label:"",val:"ko"}];if(config.languageAllowed)for(var t=e.length;t--;)existsInArray(e[t].val,config.languageAllowed)||e.splice(t,1);Vue.set(a.data,"languages",e)},a.resetBook=function(){Vue.set(a.data,"epub",{}),Vue.set(a.data,"toc",""),Vue.set(a.data,"mediaList",[]),Vue.set(a.data,"packageURL",""),Vue.set(a.data,"book",{}),Vue.set(a.data.book,"chapter",{}),Vue.set(a.data,"chromeAssets",[])},a.resetLibrary=function(){Vue.set(a.data,"downloaded",[]),Vue.set(a.data,"favorites",[]),Vue.set(a.data,"currentLibrary",{})},a.applyDefaultSettings=function(){a.data.settings&&(a.data.settings.styling||Vue.set(a.data.settings,"styling",!0),a.data.settings.textSize||Vue.set(a.data.settings,"textSize","1em"),a.data.settings.lineAdjust||Vue.set(a.data.settings,"lineAdjust",!0),a.data.settings.language||Vue.set(a.data.settings,"language","en"),null==config.viewModeOptional&&(config.viewModeOptional=!0),null==config.pageScrollOptional&&(config.pageScrollOptional=!0),null==config.navAnimOptional&&(config.navAnimOptional=!0),null==config.languageOptional&&(config.languageOptional=!0))},a.getBookId=function(e){if(config.kotobee.cloudid)return"book"==config.kotobee.mode?"_"+config.kotobee.cloudid:"library"==config.kotobee.mode?"_"+config.kotobee.cloudid+"_"+(!e&&a.data.book?a.data.book.id:""):void 0;var t,n="",o="";try{t=a.data.book.meta.dc.identifier}catch(e){}if(desktop)var i=require("nw.gui"),o=t||i.App.manifest.name+(i.App.manifest.rand?i.App.manifest.rand:"");else if(native)o=t||(cordova.rand?cordova.rand:"");else{o=(o=(o=(o=location.href.split("#")[0]).replace("https://","http://")).replace("http://www.","http://")).replace("http://","");try{n=e?"":t||a.data.book.meta.dc.title}catch(e){}}var r="_"+(o+n).replace(/[\/\s:#]/g,"");return config.ignoreQueryStringInLocalStorage&&(r=r.replace(/\?.*/g,"")),r},a.isManipulated=function(e){if(!e.file&&e.chapter==currentIndex&&e.chaptername!=a.data.currentPageOb.title)return!0;if(ph.removeExtension(e.file)==ph.removeExtension(a.getChapterFilename())){if(e.chapter!=currentIndex)return!0;if(e.chaptername!=a.data.currentPageOb.title)return!0}},a.isManipulatedOld=function(e){var t=0;return e.chapter!=currentIndex&&t++,e.chaptername!=a.data.currentPageOb.title&&t++,"library"==config.kotobee.mode&&e.file!=a.getChapterFilename()&&t++,1==t||2==t},a.addBookmark=function(o,i){a.readSlot("bookmark"+a.getBookId(),function(e){var t=e;function n(e){e&&(t=e),o.chapter=currentIndex,o.chaptername||(o.chaptername=a.data.currentPageOb.title),o.file||(o.file=a.getChapterFilename()),o.cloudid=config.kotobee.cloudid,t.push(o),a.writeSlot("bookmark"+a.getBookId(),t,function(){return sync.queue("bookmark/add",o),i&&i(!0),!0})}null!=o.bmid?a.deleteBookmark(o.bmid,null,n):a.uniqueId(t,"bmid",function(e){o.bmid=e,n()})})},a.getChapterFilename=function(){try{return a.data.book.chapter.url}catch(e){return a.data.currentPageOb.url.replace(/.*?\/(xhtml\/.*)/g,"$1")}},a.getBookmarks=function(t){a.readSlot("bookmark"+a.getBookId(),function(e){t&&t(e)})},a.deleteBookmark=function(o,i,r){a.readSlot("bookmark"+a.getBookId(),function(e){for(var t=0;t<e.length;t++)if(e[t].bmid==o){var n=e[t];return e.splice(t,1),void a.writeSlot("bookmark"+a.getBookId(),e,function(){i||sync.queue("bookmark/delete",n),r&&r(e)})}r&&r(e)})},a.addSketch=function(i,r){try{a.readSlot("sketch"+a.getBookId(),function(o){function e(e){e&&(o=e),null==i.chapter&&(i.chapter=currentIndex),i.chaptername||(i.chaptername=a.data.currentPageOb.title),i.file||(i.file=a.getChapterFilename()),i.cloudid=config.kotobee.cloudid;var t={};for(var n in i)"event"!=n&&(t[n]=i[n]);o.push(t),a.writeSlot("sketch"+a.getBookId(),o,function(){return sync.queue("freehand/add",t),r&&r(!0),!0})}null!=i.id?a.deleteSketch(i.id,null,e):e()})}catch(e){}return!0},a.getSketches=function(t){a.readSlot("sketch"+a.getBookId(),function(e){t&&t(e)})},a.deleteSketch=function(o,i,r){a.readSlot("sketch"+a.getBookId(),function(e){for(var t=0;t<e.length;t++)if(e[t].id==o){var n=e[t];return e.splice(t,1),void a.writeSlot("sketch"+a.getBookId(),e,function(){i||sync.queue("freehand/delete",n),r&&r(e)})}r&&r(e)})},a.deleteNote=function(o,i,r){a.readSlot("note"+a.getBookId(),function(e){for(var t=0;t<e.length;t++)if(e[t].nid==o){var n=e[t];return e.splice(t,1),void a.writeSlot("note"+a.getBookId(),e,function(){i||sync.queue("note/delete",n),r&&r(e)})}r&&r(e)})},a.addNote=function(i,r){try{a.readSlot("note"+a.getBookId(),function(o){function t(e){e&&(o=e),null==i.chapter&&(i.chapter=currentIndex),i.chaptername||(i.chaptername=a.data.currentPageOb.title),i.file||(i.file=a.getChapterFilename()),i.cloudid=config.kotobee.cloudid;var t={};for(var n in i)"event"!=n&&(t[n]=i[n]);o.push(t),a.writeSlot("note"+a.getBookId(),o,function(){return sync.queue("note/add",t),r&&r(!0),!0})}null!=i.nid?a.deleteNote(i.nid,null,t):a.uniqueId(o,"nid",function(e){i.nid=e,t()})})}catch(e){}return!0},a.getNotes=function(e){a.readSlot("note"+a.getBookId(),e)},a.deleteHlight=function(o,i,r){a.readSlot("hlight"+a.getBookId(),function(e){for(var t=0;t<e.length;t++)if(e[t].hid==o){var n=e[t];return e.splice(t,1),void a.writeSlot("hlight"+a.getBookId(),e,function(){i||sync.queue("hlight/delete",n),r&&r(e)})}r&&r(e)})},a.addHlight=function(o,i){a.readSlot("hlight"+a.getBookId(),function(t){function n(e){e&&(t=e),null==o.chapter&&(o.chapter=currentIndex),o.chaptername||(o.chaptername=a.data.currentPageOb.title),o.file||(o.file=a.getChapterFilename()),o.cloudid=config.kotobee.cloudid,t.push(o),a.writeSlot("hlight"+a.getBookId(),t,function(){return sync.queue("hlight/add",o),i&&i(!0),!0})}null!=o.hid?a.deleteHlight(o.hid,null,n):a.uniqueId(t,"hid",function(e){o.hid=e,n()})})},a.getHlightById=function(n,o){a.getHlights(function(e){for(var t=0;t<e.length;t++)if(e[t].hid==n)return o&&o(e[t]),e[t]})},a.getHlights=function(e){a.readSlot("hlight"+a.getBookId(),e)},a.addAction=function(t,n){a.readSlot("actions"+a.getBookId(),function(e){e.push(t),a.writeSlot("actions"+a.getBookId(),e,function(){return n&&n(!0),!0})})},a.deleteAction=function(n,o){a.readSlot("actions"+a.getBookId(),function(e){for(var t=0;t<e.length;t++)if(JSON.stringify(n)==JSON.stringify(e[t]))return e.splice(t,1),void a.writeSlot("actions"+a.getBookId(),e,function(){return o&&o(e),e});o&&o(e)})},a.getActions=function(e){a.readSlot("actions"+a.getBookId(),e)},a.readSlot=function(t,n){var o;if(chromeApp)chrome.storage.local.get(t,function(e){e=!e||isEmpty(e)?[]:e[t],n&&n(e)});else if(native)try{NativeStorage.getItem(t,function(e){e||n([]);var t=JSON.parse(e);n&&n(t)},function(e){n&&n([])})}catch(e){i()}else i();function i(){if(!(o=localStorage[t])||"undefined"==o)return n&&n([]),1;var e=JSON.parse(o);return n&&n(e),e}},a.writeSlot=function(e,t,n){if(chromeApp){var o={};o[e]=t,chrome.storage.local.set(o,function(){n&&n()})}else if(native)try{NativeStorage.setItem(e,JSON.stringify(t),function(){n&&n()},function(e){i()})}catch(e){i()}else i();function i(){localStorage[e]=JSON.stringify(t),n&&n()}},a.clearSlot=function(e,t){if(chromeApp)chrome.storage.local.remove(e,function(){t&&t()});else if(native)try{NativeStorage.remove(e,function(){t&&t()},function(){n()})}catch(e){}else n();function n(){delete localStorage[e],t&&t()}},a.clearSlots=function(i){if(chromeApp)chrome.storage.local.clear(i);else if(native)try{NativeStorage.clear(i,function(){e()})}catch(e){}else e();function e(){var n=[];for(var e in localStorage)n.push(e);var o=-1;!function e(){o++;if(o>=n.length)return void(i&&i());var t=n[o];0!=t.indexOf("note_")&&0!=t.indexOf("bookmark_")&&0!=t.indexOf("hlight_")&&0!=t.indexOf("settings_")||a.clearSlot(t,e)}()}},a.copyLocalToNativeStorage=function(){if(native)try{for(var e in localStorage)NativeStorage.setItem(e,localStorage[e]),delete localStorage[e]}catch(e){}},a.uniqueId=function(e,n,o){var i=0;n=n||"id";for(var t=0;t<e.length;t++)Number(e[t][n])>i&&(i=Number(e[t][n]));a.readSlot("actions"+a.getBookId(),function(e){for(var t=0;t<e.length;t++)Number(e[t].data[n])>i&&(i=Number(e[t].data[n]));return o&&o(i+1),i+1})},a.getPublicRoot=function(e){var t="";return a.data.paths&&("book"==config.kotobee.mode||"book"==e?t=a.data.paths.books:"library"!=config.kotobee.mode&&"library"!=e||(t=a.data.paths.libraries)),t=t||""},a}),createService("sync",function(){var r,a,e,t,n,o,i,s,c={},l={transformRequest:angular.identity,headers:{"Content-Type":void 0}};function d(){a.data.syncing||(Vue.set(a.data,"syncing",!0),$rootScope.$$phase||$rootScope.$apply())}function u(){a.data.syncing&&(Vue.set(a.data,"syncing",!1),$rootScope.$$phase||$rootScope.$apply())}return c.initialize=function(){config.kotobee.cloudid&&(a=a||$injector.get("stg"),e=e||$injector.get("bookmarks"),t=t||$injector.get("notes"),n=n||$injector.get("hlights"),i=i||$injector.get("chapters"),o=o||$injector.get("freehand"),a.getActions(function(e){r=e,window.addEventListener?(window.addEventListener("offline",c.onOffline,!1),window.addEventListener("online",c.onOnline,!1)):(document.addEventListener("offline",c.onOffline,!1),document.addEventListener("online",c.onOnline,!1))}))},c.trigger=function(){c.offline()?c.onOffline():c.onOnline()},c.offline=function(){if($injector.get("backend").cloudParam("sync"))try{return"NONE"==navigator.network.connection.type.toUpperCase()&&"UNKNOWN"==navigator.network.connection.type.toUpperCase()}catch(e){return!1}},c.onOffline=function(){$injector.get("backend").cloudParam("sync")},c.onOnline=function(e){$injector.get("backend").cloudParam("sync")&&(s||c.applyChanges(function(){d(),$injector.get("annotations").sync({},function(){u(),e&&"function"==typeof e&&e()})}))},c.queue=function(e,t){var n;a&&config.kotobee.cloudid&&(config.kotobee.public||(n={type:e,data:clone(t)},r.push(n),a.addAction(n,function(){c.offline()||s||c.applyChanges()})))},c.applyChanges=function(e){if(u(),$injector.get("backend").cloudParam("sync")&&a&&a.data.user&&(a.data.user.email||a.data.user.code))try{var t={func:arguments.callee,args:arguments};if(0==r.length)return s=!1,e?e():null;d(),s=!0;var n=r[0],o=getFormData($injector.get("backend").getAuthVars());for(var i in n.data)o.append(i,n.data[i]);$http.post(config.kotobee.liburl+"library/"+n.type,o,l).success(function(e){r.splice(0,1),a.deleteAction(n,function(){c.applyChanges()})}).error(function(e){s=!1,setTimeout(u,300),kError.update({error:"syncOnConnectionMsg",ref:t})})}catch(e){}},c}),createService("tinCan",function(){var e={};return e.initialize=function(){},e.send=function(e){!function(e){try{if(!config.gAnalyticsID&&!config.gAnalyticsMeasurementId)return;if(!ga)return}catch(e){return}config.gAnalyticsID&&ga("send","event",e.activity,e.verb,stg.data.book.meta.dc.title);config.gAnalyticsMeasurementId&&gtag("event","send",{activity:e.activity,verb:e.verb,title:stg.data.book.meta.dc.title})}(e),backend.cloudParam("tincan")&&(e.name=stg.data.user.name?stg.data.user.name:"User",stg.data.user.email?e.email=stg.data.user.email:stg.data.user.code&&(e.email=stg.data.user.code+"@promocode"),backend.tincan(e))},e}),createService("tooltip",function(){var a,e={show:function(e,t){a&&clearTimeout(a);var n=document.getElementsByClassName("kTooltip")[0];n||(n=document.createElement("div"),document.body.appendChild(n));var o=Number(e.getAttribute("data-tooltipOffset")),i=e.getAttribute("data-tooltipFlow"),r=e.getBoundingClientRect();n.className="kTooltip",i&&addClass(n,i),n.style.left=r.left+r.width/2+"px",n.style.top=n.style.bottom=null,n.style.top="bottom"==i?r.bottom+o+"px":r.top-o+"px",n.textContent=translit.get(t)},hide:function(){a&&clearTimeout(a),a=setTimeout(function(){for(var e=document.getElementsByClassName("kTooltip");e.length;)e[0].parentNode.removeChild(e[0])},300)}};return e}),createService("translit",function(){var i,r,a={},o={},s=[];return a.addListener=function(e){s.push(e)},a.setLangOld=function(e){i=e},a.setDirection=function(e){var t,n,o,i,r;"rtl"!=e&&"ltr"!=e||(t=$injector.get("stg")).data.settings&&(n=t.data.settings.rtl,"rtl"==e?(Vue.set(t.data.settings,"rtl",!0),cache.getOb("body")&&addClass(cache.getOb("body"),"rtl"),cache.getOb("body")&&cache.getOb("body").setAttribute("dir","rtl")):(Vue.set(t.data.settings,"rtl",!1),cache.getOb("body")&&removeClass(cache.getOb("body"),"rtl"),cache.getOb("body")&&cache.getOb("body").setAttribute("dir","ltr")),(o=document.getElementById("spreadR"))&&"double"==t.data.currentView&&(i=document.getElementById("spreadL"),(n&&"rtl"!=e||!n&&"rtl"==e)&&(r=i.style.cssText,i.style.cssText=o.style.cssText,o.style.cssText=r)),$rootScope.$$phase||$rootScope.$apply(),setTimeout(function(){var e=$injector.get("chapters");e.displayTOC(),e.highlightCurrentTocChapter(),kotobee.dispatchEvent&&kotobee.dispatchEvent("directionChanged",t.data.settings.rtl)},200))},a.setLangArray=function(e){r=e},a.setLang=function(n,o){$injector.get("backend").getServerLang({lang:n}).success(function(e){r=e;var t=i||"en";i=n,stg.data&&(stg.data.lc||Vue.set(stg.data,"lc",0),stg.data.lc=Number(stg.data.lc)+1),a.setDirection("ar"==n?"rtl":"ltr"),kotobee.dispatchEvent&&kotobee.dispatchEvent("languageChanged",{from:t,to:i}),function(){for(var e=0;e<s.length;e++)s[e](i)}(),o&&o()}).error(function(e,t){o&&o()})},a.getLang=function(){return i},a.get=function(e,t){if(!r)return e;if(!i)return e;if(r[e]&&(e=r[e]),t)for(var n=0;n<t.length;n++)e=$interpolate(e)(t[n]);return e},a.replaceString=function(e,t){r&&(r[e]=t,stg.data&&(stg.data.lc||Vue.set(stg.data,"lc",0),stg.data.lc=Number(stg.data.lc)+1))},a.getOld=function(e,t){if(o[i][e]&&(e=o[i][e]),t)for(var n=0;n<t.length;n++)e=$interpolate(e)(t[n]);return e},a}),createService("traverser",function(){var l={};function r(e,t){var n=(n=(t=t||{}).root)||cache.getOb("epubContent"),o=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,d,!1),i=[],r=c(e.from,{root:n,skipLevels:1}),a=c(e.to,{root:n,skipLevels:1}),r=r||o.firstChild(),a=a||o.lastChild();if(!function(e,t){var n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,d,!1);var o=n.firstChild();var i=l.getAbsoluteIndex(o,t);i.index="0."+i.index,n.currentNode=t;var r=n.lastChild();var a=l.getAbsoluteIndex(r,t);if(a.index="0."+a.index,s(e.from,i.index)&&s(e.to,i.index))return;if(c(e.from,a.index)&&c(e.to,a.index))return;return!0;function s(e,t){for(var n=e.split("."),o=t.split("."),i=0;i<n.length;i++){if(Number(n[i])>Number(o[i]))return;if(Number(n[i])<Number(o[i]))return 1;if(null==o[i])return}return 1}function c(e,t){for(var n=e.split("."),o=t.split("."),i=0;i<n.length;i++){if(Number(n[i])<Number(o[i]))return;if(Number(n[i])>Number(o[i]))return 1;if(null==o[i])return 1}return 1}}(e,n))return i;for(var s=o.currentNode=r;s&&(i.push(s),s!=a);)s=o.nextNode();return i}function d(e){return e.children&&e.children.length?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}function c(e,t){var n=(t=t||{}).root;t.skipLevels&&(e=e.substr(2*t.skipLevels));var o=e.split("."),i=n,r=1;t.skipLevels&&(r-=t.skipLevels);for(var a=0;a<o.length;a++)if(i){var s=Number(o[a]),c=0;i.hasAttribute("kb-offset")&&(c=Number(i.getAttribute("kb-offset")));var l=i.children[s-c];if(a==r&&l&&virt.checkIfRequiresParseAndAnnotations(l),i.parentNode&&-1!=i.parentNode.className.indexOf("kInteractive questions")&&o.length-a==2&&(i=i.children[0]),!l&&!i.children.length)break;i=l}return i}return l.getElemsByLocation=function(e,t){t=t||{};var n,o=[],i=e.split("-");return 1<i.length?(o=r(n={from:i[0],to:i[1]},{root:t.root?t.root:document.getElementById("spreadL")}),"double"==stg.data.currentView&&(o=o.concat(r(n,{root:document.getElementById("spreadR")})))):o=function(e,t){var n=new Array,o=t.root;o=o||cache.getOb("epubContent");if("double"==stg.data.currentView){for(var i=[],r=0;r<e.length;r++){var a=e[r];a="1"+a.substr(1),i.push(a)}e=e.concat(i)}for(r=0;r<e.length;r++){var s;e[r]&&((s=c(e[r],{root:o}))&&n.push(s))}return n}(i=e.split(","),t),o},l.getPageByLocation=function(e,t){var n=e.pages;if(n&&n.length){for(var o=0;o<n.length-1;o++){if(function(e,t){var n=e.split("."),o=t.split(".");if(e==t)return 0;for(var i=0;i<n.length;i++){if(Number(n[i])>Number(o[i]))return 1;if(Number(n[i])<Number(o[i]))return-1}return n.length>o.length?1:-1}(t,n[o].lastLocation)<=0)return o}return n.length-1}},l.getAbsoluteIndex=function(e,t){t=t||cache.getOb("epubContent");for(var n="";e!=t;){n=function(e){var t=0;for(e&&e.parentNode&&e.parentNode.hasAttribute("kb-offset")&&(t=Number(e.parentNode.getAttribute("kb-offset")));e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}(e)+"."+n;e=e.parentNode}var o="left";return""==n?{index:"",side:o}:("1"==n[0]&&(n="0"+n.substr(1),o="right"),{index:n.substr(0,n.length-1),side:o})},l.convertElemsToLocation=function(e,t){t=t||cache.getOb("epubContent");for(var n="",o="",i="",r="",a=0;a<e.length;a++){var s=l.getAbsoluteIndex(e[a],t);"left"==s.side?(n+=(n?",":"")+s.index,0==a&&(i=s.index),a==e.length-1&&(i+="-"+s.index)):(o+=(o?",":"")+s.index,0==a&&(r=s.index),a==e.length-1&&(r+="-"+s.index))}return i&&-1==i.indexOf("-")&&r&&0==r.indexOf("-")&&(r=i+=r),{left:n,right:o,leftRange:i,rightRange:r}},l.getTopCornerLocation=function(){return l.convertElemsToLocation([l.getTopCornerElement()]).left},l.getTopCornerElement=function(){for(var e=cache.getOb("epubContent"),t=cache.getOb("epubContainer"),n=e.children[0],o=$ionicScrollDelegate.$getByHandle("content").getScrollPosition().top+25,i=new Array,r=n.getElementsByClassName("k-section"),a=0;a<r.length;a++)hasClass(r[a],"cNone")||i.push(r[a]);for(var s,c=document.getElementById("readerHeader").offsetHeight+10,a=0;a<i.length;a++)for(var l=i[a].getElementsByTagName("*"),d=0;d<l.length;d++)if(!l[d].children.length){var u=l[d].getBoundingClientRect();if(u.bottom>c){if(u.top>c&&u.top<c+10)return l[d];var p=u.top-c;if(!s){s={elem:l[d],bounds:u,distance:p};continue}if(0<p&&p<50)return l[d];p<s.distance&&u.bottom<c+t.offsetHeight&&(s={elem:l[d],bounds:u,distance:p})}}if(s)return s.elem;for(a=0;a<i.length;a++)if(0<i[a].offsetTop-o)return i[a];return i[0]},l.analyzeNodes=function(e,t){for(var n,o=new Array,i=new Array,r=cache.getOb("epubContent").parentNode,a=e;o.push(a),(a=a.parentNode)!=r;);for(a=t;i.push(a),(a=a.parentNode)!=r;);for(var s=function(){for(var e=0;e<o.length;e++)for(var t=0;t<i.length;t++)if(i[t]==o[e])return[i[t],e,t]}(),c=s[0],l=s[1],d=s[2],u=0;u<c.childNodes.length;u++){if(c.childNodes[u]==o[l-1]){n=!1;break}if(c.childNodes[u]==i[d-1]){n=!0;break}}var p={};return p.parents1=o,p.parents2=i,p.index1=l,p.index2=d,p.commonParent=c,p.reversed=n,p},l.nextTextNode=function(e,t){for(t=t||e;!e.nextSibling;)if((e=e.parentNode)==t)return;for(e=e.nextSibling;e.childNodes[0];)e=e.childNodes[0];return"#text"==e.nodeName&&e.textContent.trim()?e:l.nextTextNode(e,t)},l.prevTextNode=function(e,t){for(t=t||e;!e.previousSibling;)if((e=e.parentNode)==t)return;for(e=e.previousSibling;e.childNodes.length;)e=e.childNodes[e.childNodes.length-1];return"#text"==e.nodeName&&e.textContent.trim()?e:l.prevTextNode(e,t)},l}),createService("view",function(){var e={};return e.generate=function(){var e=stg.data.currentLibrary,t=stg.data.currentLibrary.cloud,n=stg.view;n.registration={},n.registration.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.inregistration,n.registration.promocode&&(n.registration.promocodeMandatory=e.promocodesettings.inregistrationmandatory),n.topmenu={},n.topmenu.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.intopmenu,n.topmenu={},n.topmenu.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.intopmenu,n.bookinfo={},n.bookinfo.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.inbookinfo},e}),createService("virt",function(){var e,l,t,n,d={};d.lock=function(){l=!0},d.unlock=function(){l=!1},d.enable=function(){e||l||(e=!0,n&&clearInterval(n),t=setInterval(o,60),o())},d.disableAfter=function(e){n&&clearInterval(n),n=setInterval(function(){d.disable(),clearInterval(n)},e)},d.disable=function(){e&&(l||(e=!1,clearInterval(t)))};var o=function(){l||$filter("contentVirt")()};return d.reset=function(e,t){l||(d.reveal(!0),$filter("contentVirt")("reset"),$filter("contentVirt")(null,e,function(){d.reveal(!1),t&&t()}))},d.checkIfRequiresParse=function(e){hasClass(e,"parsed")||$filter("contentVirt")("parse",e)},d.checkIfRequiresParseAndAnnotations=function(e){hasClass(e,"parsed")||$filter("contentVirt")("parseAndAnnotations",e)},d.reveal=function(e){l||$filter("contentVirt")(e?"reveal":"undoReveal")},d.safeAnchorScroll=function(e,t,n){if(!l){var o=$q.defer();d.reveal(!0);var i=document.getElementById(t);return d.safeScrollToElem(e,i,n),timeOut(function(){d.reset(),o.resolve()},1300),o.promise}},d.safeScroll=function(e,t,n,o){if(!l){var i=$q.defer();return o=o||!0,d.reveal(!0),$ionicScrollDelegate.$getByHandle(e).scrollTo(Math.round(t),Math.round(n),o),timeOut(function(){d.reset(),i.resolve()},1300),i.promise}},d.safeScrollToElem=function(e,t,n){if(t&&!l){d.reveal(!0);var o=cache.getOb("epubContainer"),i=0,r=getComputedStyle(o).paddingTop;r&&(i=Number(r.split("px")[0]));var a,s=$ionicScrollDelegate.$getByHandle(e).getScrollPosition().top;mobile?(mobile||native)&&("auto"==getComputedStyle(o).overflowY?s=o.scrollTop:(a=getComputedStyle(o).overflowY,o.style.overflowY="auto",s=o.scrollTop,o.style.overflowY=a)):"auto"==getComputedStyle(o).overflowY&&(s=o.scrollTop);var c=s-(o.getBoundingClientRect().top+i)-25;return d.safeScroll(e,0,t.getBoundingClientRect().top+c,n)}},d.forceRepaint=function(){try{var e=document.createTextNode(" ");document.body.appendChild(e),setTimeout(function(){},0)}catch(e){}},d}),createService("workers",function(e){var o,i,r,t,n={},a=[],s=[],c=[];function l(e){t=!0}n.initialize=function(){if(g()){try{if(native)return void(t=!0);function e(){o.addEventListener("error",l,!1),i.addEventListener("error",l,!1),r.addEventListener("error",l,!1),o.addEventListener("message",p,!1),i.addEventListener("message",p,!1),r.addEventListener("message",p,!1)}0,o=new Worker(rootDir+"js/workers/cssParser.js"),i=new Worker(rootDir+"js/workers/htmlParser.js"),r=new Worker(rootDir+"js/workers/search.js"),e()}catch(e){t=!0}navigator.serviceWorker&&navigator.serviceWorker.register("service-worker.js")}};var d=0;function u(e){var t,n;e.length&&(t=e[0].args,n=e[0].id,h(t[0]).postMessage({func:t[1],params:t[2],id:n}))}function p(e){var t=function(e){if(e==o)return a;if(e==i)return s;if(e==r)return c}(e.target),n=t[0].args[3];n&&n(e.data.data),t.shift(),u.apply(this,[t])}function h(e){return"cssParser"==e?o:"htmlParser"==e?i:"search"==e?r:void 0}function g(){return!t&&"undefined"!=typeof Worker}return n.call=function(e,t,n,o){var i,r;++d,h(e)&&(r=[e,t,n,o],(i=function(e){if("cssParser"==e)return a;if("htmlParser"==e)return s;if("search"==e)return c}(e)).push({args:r,id:d}),1==i.length&&u(i))},n.supported=g,n}),createService("$ionicScrollDelegate",function(){var e={};return e.$getByHandle=function(e){var t=document.getElementsByClassName("delegate-"+e);if(t.length)return t[0].__vue__.getScrollProxy()},e}),createService("$ionicSideMenuDelegate",function(){var o={},i=[];function n(e){var t=r();t&&t.applyTransform(e)}function r(){var e=document.getElementsByClassName("menu-content");if(e.length)return e[0].__vue__}return o.menuWidth=330,o.add=function(e,t){var n=o.$getByHandle(e);n&&o.remove(n),i.push({id:e,instance:t})},o.remove=function(e){for(var t=0;t<i.length;t++)if(i[t]==e)return i.splice(t,1)},o.$getByHandle=function(e){for(var t=[],n=0;n<i.length;n++)i[n].id==e&&t.push(i[n].instance);return{_instances:t}},o.toggleLeft=function(){var e,t=r();t&&(e=t.$parent.left.width,n.bind(this)((o.isOpenLeft()?0:1)*e))},o.toggleRight=function(){var e,t=r();t&&(e=t.$parent.right.width,n.bind(this)((o.isOpenRight()?0:-1)*e))},o.isOpen=function(){return o.isOpenLeft()||o.isOpenRight()},o.close=function(){n.bind(this)(0)},o.isOpenLeft=function(){var e=r();if(e){var t=e.$parent.left.width;return e.getTransform()=="translate3d("+t+"px, 0px, 0px)"}},o.isOpenRight=function(){var e=r();if(e){var t=e.$parent.right.width;return e.getTransform()=="translate3d("+-t+"px, 0px, 0px)"}},o}),createService("bookmarks",function(){var i,a={};return a.addBookmarksFromOffline=function(e){for(var t=cache.getOb("epubContent"),n=0;null!=(t=t.previousSibling);)n++;var o=[];o.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&o.push(stg.data.currentRPageOb.index);for(var i=0;i<o.length;i++)for(var r=0;r<e.length;r++)e[r].chapter==o[i]&&String(e[r].location).split(".")[1]==n&&a.addIcon(e[r])},a.addBookmark=function(){var e={};e.chapter=currentIndex,e.chaptername||(e.chaptername=stg.data.currentPageOb.title),e.file||(e.file=stg.getChapterFilename()),e.location=traverser.getTopCornerLocation(),kotobee.dispatchEvent("preBookmark",e),stg.addBookmark(e,function(){a.addIcon(e),crdv.toast(translit.get("bookmarked"))})},a.addBookmarksFromSync=function(i,r){a.deleteAll(!0,function(){var o=-1;!function e(){var t,n;++o>=i.length?r&&r():(t=i[o],n=function(){o%100==0?setTimeout(e,10):e()},stg.readSlot("bookmark"+stg.getBookId(),function(e){e=e||[],ph.removeExtension(t.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(e,"bmid",t.bmid)||a.addIcon(t)),e.push(t),stg.writeSlot("bookmark"+stg.getBookId(),e,function(){var e;stg.isManipulated(t)&&stg.addBookmark(e=Object.assign(t,{chapter:null,chaptername:null,file:null}),function(){a.addIcon(e)}),n&&n()})}))}()})},a.addIconIfNotShown=function(e){a.addIcon(e)},a.addIcon=function(n){var o,e,t=traverser.getElemsByLocation(n.location);t[0]&&((o=selection.createBookMarker(n,t[0])).className="contentBookMarker",o.setAttribute("bmid",n.bmid),o.setAttribute("bloc",t[0].offsetTop),o.addEventListener("tap",function(e){e.stopImmediatePropagation()}),o.addEventListener("click",function(e){virt.safeScrollToElem("content",o,!0);var t={};t.bmid=this.getAttribute("bmid"),t.location=this.getAttribute("bloc")}),o.addEventListener("click",function(e){var t=[{name:translit.get("delete"),func:function(){a.delete(n.bmid),popovers.hide()}},{name:translit.get("cancel"),func:function(){popovers.hide()}}];popovers.show({mode:"popoverList",listOb:t,backdropClickToClose:!1})}),mobile||((e=document.createElement("span")).className="editIcon icon kb-close",e.addEventListener("click",function(e){e.stopPropagation(),a.confirmDeletion(function(){a.delete(n.bmid),modals.hide()})}),e.addEventListener("tap",function(e){e.stopImmediatePropagation()}),o.appendChild(e),o.addEventListener("mouseover",function(e){addClass(o,"edit"),o.addEventListener("mouseout",function(e){removeClass(o,"edit")})})))},a.confirmDeletion=function(e){if(i)return e();modals.hide();var t={title:"confirmation",msg:"bookmarkDeleteConfirm",barStyle:"bar-dark"},n={label:"delete",style:"button-assertive",func:function(){t.dontAskChecked&&(i=!0),e&&e(),modals.hide()}},o={label:"cancel",func:function(){t.dontAskChecked&&(i=!0),modals.hide()}};t.dontAsk=!0,t.btns=[n,o],modals.show({mode:"confirm",confirmOptions:t})},a.delete=function(e,t,n){selection.deleteBookMarker(e),stg.deleteBookmark(e,t,n),kotobee.dispatchEvent("bookmarkDeleted",e)},a.deleteAll=function(o,i){stg.getBookmarks(function(t){var n=-1;!function e(){n++;if(n>=t.length)return void(i&&i());a.delete(t[n].bmid,o,function(){n%100==0?setTimeout(e,30):e()})}()})},a}),createService("freehand",function(){var i,r,a,n,s={},c=[],t=[],o={},e={brushes:[2,4,6,8,10,12],colors:["yellow","red","blue","green","black"],smoothing:[1,2,3,4,5]};function l(){var e,t=cache.getOb("epubContainer");t&&((i=i||document.getElementById("freehandCanvasLeft"))||((i=document.createElement("canvas")).className="freehandCanvas",i.id="freehandCanvasLeft",i.width=t.offsetWidth,i.height=t.offsetHeight,i.addEventListener("mousedown",g),i.addEventListener("touchstart",g),n=i.getContext("2d")),(e=d(document.getElementById("spreadL")))&&e.appendChild(i),"double"==stg.data.currentView&&((r=r||document.getElementById("freehandCanvasRight"))||((r=document.createElement("canvas")).className="freehandCanvas",r.id="freehandCanvasRight",r.width=t.offsetWidth,r.height=t.offsetHeight,r.addEventListener("mousedown",g),r.addEventListener("touchstart",g),n=r.getContext("2d")),(e=d(document.getElementById("spreadR")))&&e.appendChild(r)))}function d(e){if(e)return getElementsByAttribute(e,"div","id","fxlChapter")[0]}function u(e){return!((e=e||{}).checkLayout&&stg.data.book&&"fxl"!=stg.data.book.chapter.layout||!config.freehand&&!preview)}function p(){var e=d(document.getElementById("spreadL"));e&&(i.width=removePx(e.style.width),i.height=removePx(e.style.height),"double"==stg.data.currentView&&r&&(e=d(document.getElementById("spreadR")),r.width=removePx(e.style.width),r.height=removePx(e.style.height)),function(){for(var e=0;e<c.length;e++){var t=function(e){if("double"==stg.data.currentView&&stg.data.currentRPageOb&&stg.data.currentRPageOb.index==e)return r.getContext("2d");return i.getContext("2d")}(c[e].chapter);t.beginPath();var n=c[e].points[0];"pen"==c[e].type?t.globalCompositeOperation="source-over":"eraser"==c[e].type&&(t.globalCompositeOperation="destination-out"),t.moveTo(n[0],n[1]),t.strokeStyle="orange",t.lineWidth=5,c[e].style&&c[e].style.color&&(t.strokeStyle=c[e].style.color),c[e].style&&c[e].style.brush&&(t.lineWidth=c[e].style.brush),t.lineCap="round",t.lineJoin="round";for(var o=1;o<c[e].points.length;o++)!function(e,t,n,o,i,r){void 0===i&&(i=.3);void 0===r&&(r=.6);var a,s,c,l=0,d=t,u=n;s=(c=o)?(l=function(e,t){return(t[1]-e[1])/(t[0]-e[0])}(d,c),a=(c[0]-u[0])*-i,a*l*r):a=0;e.bezierCurveTo(+d[0],+d[1],u[0]+a,u[1]+s,u[0],u[1])}(t,c[e].points[o-1],c[e].points[o],c[e].points[o+1]);t.stroke()}}())}function h(e){if(e.touches){var t=e.touches[0],n=getBoundingBox(a),o=Number(a.getAttribute("width")),i=Number(a.getAttribute("height"));return{offsetX:(t.pageX-n.left)*o/n.width,offsetY:(t.pageY-n.top)*i/n.height}}return{offsetX:e.offsetX,offsetY:e.offsetY}}function g(e){e.stopPropagation(),(a=e.currentTarget).addEventListener("mousemove",f),a.addEventListener("mouseup",m),a.addEventListener("touchmove",f),a.addEventListener("touchend",m);var t=h(e);(n=a.getContext("2d")).beginPath(),n.moveTo(t.offsetX,t.offsetY),n.strokeStyle=s.currentStyle.color,n.lineWidth=s.currentStyle.brush,n.lineCap="round",n.lineJoin="round",(o={type:s.mode,points:[],style:clone(s.currentStyle)}).points.push([t.offsetX,t.offsetY])}function f(e){e.stopPropagation(),"pen"==s.mode?n.globalCompositeOperation="source-over":"eraser"==s.mode&&(n.globalCompositeOperation="destination-out");var t=h(e);n.lineTo(t.offsetX,t.offsetY),n.stroke(),o.points.push([t.offsetX,t.offsetY])}function m(e){e.stopPropagation(),a.removeEventListener("mousemove",f),a.removeEventListener("mouseup",m),n.closePath(),function(e,t){for(var n=[],o=0;o<e.points.length;o+=t)n.push(e.points[o]);e.points=n}(o,s.smoothing),o.chapter=function(e){if(i==e)return stg.data.currentPageOb.index;if("double"==stg.data.currentView&&r==e)return stg.data.currentRPageOb.index}(a),o.chaptername=function(e){if(i==e)return stg.data.currentPageOb.title;if("double"==stg.data.currentView&&r==e)return stg.data.currentRPageOb.title}(a),o.file=function(e){if(i==e)return ph.relative(ph.join(bookPath,stg.data.packageURL),stg.data.currentPageOb.url);if("double"==stg.data.currentView&&r==e)return ph.relative(ph.join(bookPath,stg.data.packageURL),stg.data.currentRPageOb.url)}(a),c.push(o),t=clone(c),v(),p()}function v(){for(var e={},t=0;t<c.length;t++)e[c[t].chapter]=c[t];for(var n in e){var o={},i=clone(e[n]);delete i.chapter,delete i.chaptername,delete i.file,o.data=LZString.compressToUTF16(JSON.stringify(i)),o.chapter=n,o.chaptername=e[n].chaptername,o.file=e[n].file,stg.addSketch(o)}}return s.initialize=function(){u()&&(function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++)if(e[t].getAttribute("src")&&0<=e[t].getAttribute("src").indexOf("lz-string/lz-string.min.js"))return;var n=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=rootDir+"lib/lz-string/lz-string.min.js",n.appendChild(o)}(),s.defs=e,s.currentStyle={color:"blue",brush:3},s.smoothing=2,window.addEventListener("resize",function(){u({checkLayout:!0})&&!function(){if($location.path()&&0<=$location.path().indexOf("/reader"))return!1;return!0}()&&(l(),p(),s.deactivate(),$rootScope.$$phase||$rootScope.$apply())}))},s.addSketchesFromOffline=function(e){if(config.freehand||preview){s.initNewChapter();for(var t=cache.getOb("epubContent");null!=(t=t.previousSibling);)0;var n=[];n.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&n.push(stg.data.currentRPageOb.index);for(var o=0;o<n.length;o++)for(var i=0;i<e.length;i++)e[i].chapter==n[o]&&s.loadAndDisplay(e[i])}},s.activate=function(){l(),s.mode="pen",addClass(i,"active"),i.addEventListener("mousedown",g),i.addEventListener("touchstart",g),"double"==stg.data.currentView&&r&&(addClass(r,"active"),r.addEventListener("mousedown",g),r.addEventListener("touchstart",g)),$rootScope.renderScope.applyHeader("freehand")},s.deactivate=function(){removeClass(i,"active"),i.removeEventListener("mousedown",g),i.removeEventListener("touchstart",g),"double"==stg.data.currentView&&r&&(removeClass(r,"active"),r.removeEventListener("mousedown",g),r.removeEventListener("touchstart",g)),$rootScope.renderScope.applyHeader("default")},s.initNewChapter=function(){u({checkLayout:!0})&&(l(),c=[],p())},s.loadAndDisplay=function(e){l();var t,n=e.data;n&&n.length&&((t=JSON.parse(LZString.decompressFromUTF16(n))).chapter=e.chapter,t.chaptername=e.chaptername,t.file=e.file,t.id=e.id,c.push(t)),p()},s.clear=function(){for(var e=0;e<c.length;e++)stg.deleteSketch(c[e].id);c=[],i.getContext("2d").clearRect(0,0,i.width,i.height),"double"!=stg.data.currentView||r&&r.getContext("2d").clearRect(0,0,r.width,r.height)},s.undo=function(){0!=c.length&&(c=t.slice(0,c.length-1),v(),p())},s.redo=function(){t.length<=c.length||(c.push(t[c.length]),v(),p())},s.addSketchesFromSync=function(i,r){if(!u({checkLayout:!0}))return r?r():r;s.deleteAll(!0,function(){try{s.initNewChapter()}catch(e){}var o=-1;!function e(){if(++o>=i.length)return r?r():r;var t,n;t=i[o],n=function(){o%100==0?setTimeout(e,10):e()},stg.readSlot("sketch"+stg.getBookId(),function(e){e=e||[],ph.removeExtension(t.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(e,"id",t.id)||s.loadAndDisplay(t)),e.push(t),stg.writeSlot("sketch"+stg.getBookId(),e,function(){var e;stg.isManipulated(t)&&stg.addSketch(e=Object.assign(t,{chapter:null,chaptername:null,file:null}),function(){s.loadAndDisplay(e)}),n&&n()})})}()})},s.deleteAll=function(o,i){stg.getSketches(function(t){var n=-1;!function e(){n++;if(n>=t.length)return void(i&&i());s.delete(t[n].id,o,function(){n%100==0?setTimeout(e,30):e()})}()})},s.delete=function(e,t,n){stg.deleteSketch(e,t,n)},s}),createService("hlights",function(){var i,a={};return a.addHlightsFromOffline=function(e){for(var t=cache.getOb("epubContent"),n=0;null!=(t=t.previousSibling);)n++;var o=[];o.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&o.push(stg.data.currentRPageOb.index);for(var i=0;i<o.length;i++)for(var r=0;r<e.length;r++)e[r].chapter==o[i]&&String(e[r].location).split(".")[1]==n&&a.addHlight(e[r])},a.addHlightsFromSync=function(i,r){a.deleteAll(!0,function(){var o=-1;!function e(){var t,n;++o>=i.length?r&&r():(t=i[o],n=function(){o%100==0?setTimeout(e,10):e()},stg.readSlot("hlight"+stg.getBookId(),function(e){e=e||[],ph.removeExtension(t.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(e,"hid",t.hid)||a.addHlight(t)),e.push(t),stg.writeSlot("hlight"+stg.getBookId(),e,function(){var e;stg.isManipulated(t)&&stg.addHlight(e=Object.assign(t,{chapter:null,chaptername:null,file:null}),function(){a.addHlight(e)}),n&&n()})}))}()})},a.addHlight=function(e){for(var t=document.getElementsByClassName("hlight"+e.hid),n=t.length;n--;)t[n].style.backgroundColor=null,removeClass(t[n],"contentHlightBG"),removeClass(t[n],"hlight"+e.hid);for(n=(t=$injector.get("annotations").getMatchingElements(e)).length;n--;)t[n]&&("double"==stg.data.currentView&&!chapters.elemInChapterElem(t[n],e.chapter)||(addClass(t[n],"contentHlightBG"),addClass(t[n],"hlight"+e.hid),t[n].style.backgroundColor=e.color));return a},a.showPopup=function(i,r){i=i||[];var e={save:function(e){for(var t=0;t<i.length;t++){var n=i[t];null==n.chapter&&(n.chapter=chapters.getElemChapterIndex(selection.getSelectedNodes()[0])),n.chaptername||(n.chaptername=chapters.getElemChapterTitle(selection.getSelectedNodes()[0])),n.file||(n.file=stg.getChapterFilename()),n.color=e,null==n.src&&(n.src=selection.getSelectedText());var o=t==i.length-1;kotobee.dispatchEvent("preHighlight",n),stg.addHlight(n,function(){a.addHlight(n),o&&timeOut(function(){modals.hide(),r&&r(!0),$rootScope.$$phase||$rootScope.$apply()},300)})}}};e.color=i[0].color?i[0].color:"#fffb85",i[0].hid&&(e.remove=function(){for(var e=0;e<i.length;e++)a.delete(i[0].hid,null,function(){e==i.length-1&&timeOut(function(){modals.hide(),r&&r()},300)})}),modals.show({mode:"hlight",hlightOptions:e})},a.confirmDeletion=function(e){if(i)return e();modals.hide();var t={title:"confirmation",msg:"hlightDeleteConfirm",barStyle:"bar-dark"},n={label:"delete",style:"button-assertive",func:function(){t.dontAskChecked&&(i=!0),e&&e(),modals.hide()}},o={label:"cancel",func:function(){t.dontAskChecked&&(i=!0),modals.hide()}};t.dontAsk=!0,t.btns=[n,o],modals.show({mode:"confirm",confirmOptions:t})},a.delete=function(e,t,n){for(var o=document.getElementsByClassName("hlight"+e),i=o.length;i--;)i==o.length-1&&removeClass(o[i],"last"),removeClass(o[i],"contentHlightBG"),o[i].style.backgroundColor=null,removeClass(o[i],"hlight"+e);stg.deleteHlight(e,t,n),kotobee.dispatchEvent("highlightDeleted",e)},a.deleteAll=function(o,i){stg.getHlights(function(t){var n=-1;!function e(){n++;if(n>=t.length)return void(i&&i());a.delete(t[n].hid,o,function(){n%100==0?setTimeout(e,30):e()})}()})},a}),createService("notes",function(){var i,r,c={};function l(n,o){c.getCurrentNotes(function(e){for(var t=0;t<e.length;t++)if(e[t].nid==n)return o(e[t]);return o()})}function a(e,t){c.confirmDeletion(function(){c.delete(e,null,function(){$timeout(function(){modals.hide(),t&&t()},300)})})}function s(t){var i=this.obs,r=this.cb,a=this.public;asyncCheck(!a,c.confirmPublic,[],function(){for(var e=0;e<i.length;e++){var n=i[e];n.chapter||(n.chapter=chapters.getElemChapterIndex(selection.getSelectedNodes()[0],{ignoreAnchors:!0})),n.chaptername||(n.chaptername=chapters.getElemChapterTitle(selection.getSelectedNodes()[0])),n.file||(n.file=stg.getChapterFilename()),n.location||(n.location=traverser.getTopCornerLocation()),n.type||(n.type="page"),n.src||(n.src="content"==n.type?selection.getSelectedText():""),n.nid=t.nid,t.date?n.date=t.date:delete n.date,n.dateLocal=t.dateLocal;var o=null==n.nid;o&&(n.dateLocal=new Date,delete n.date),n.note=t.note,a?n.public=!0:delete n.public;kotobee.dispatchEvent("preNote",n),stg.addNote(n,function(){var e,t;o?c.addIcon(n):(d(selection.getNoteMarker(n.nid).elem),(t=(e=traverser.getElemsByLocation(n.location))[e.length-1])&&d()),$timeout(function(){modals.hide(),r&&r(!0)},300)})}})}function d(){}return c.addNotesFromOffline=function(e){for(var t=cache.getOb("epubContent"),n=0;null!=(t=t.previousSibling);)n++;var o=[];o.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&o.push(stg.data.currentRPageOb.index);for(var i=0;i<o.length;i++)for(var r=0;r<e.length;r++)e[r].chapter==o[i]&&String(e[r].location).split(".")[1]==n&&c.addIcon(e[r])},c.addNotesFromSync=function(i,r){c.deleteAll(!0,function(){var o=-1;!function e(){var t,n;++o>=i.length?r&&r():(t=i[o],n=function(){o%100==0?setTimeout(e,10):e()},stg.readSlot("note"+stg.getBookId(),function(e){e=e||[],ph.removeExtension(t.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(e,"nid",t.nid)||c.addIcon(t)),e.push(t),stg.writeSlot("note"+stg.getBookId(),e,function(){var e;stg.isManipulated(t)&&stg.addNote(e=Object.assign(t,{chapter:null,chaptername:null,file:null}),function(){c.addIcon(e)}),n&&n()})}))}()})},c.getCurrentNotes=function(o){for(var i=[],e=cache.getOb("epubContent"),r=0;null!=(e=e.previousSibling);)r++;var a=[];a.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&a.push(stg.data.currentRPageOb.index),stg.readSlot("note"+stg.getBookId(),function(e){for(var t=0;t<a.length;t++)for(var n=0;n<e.length;n++)e[n].chapter==a[t]&&String(e[n].location).split(".")[1]==r&&i.push(e[n]);o(i)})},c.getCurrentNotesByLocation=function(n,o){var i=[];if(!n)return o([]);c.getCurrentNotes(function(e){for(var t=0;t<e.length;t++)e[t].location==n&&i.push(e[t]);i.sort(function(e,t){var n=phpDateToJS(e.date?e.date:e.dateLocal);return phpDateToJS(t.date?t.date:t.dateLocal)<n?1:-1}),o(i)})},c.addNotesFromQuestions=function(e,t){for(var n=e.elem.getElementsByClassName("ques"),o=[],i=[],r=0;r<n.length;r++){var a=n[r],s=a.getElementsByClassName("questionTxt");s.length||(s=a.getElementsByTagName("p"));for(var c=s[0].textContent,l=a.getElementsByClassName("ans"),d=0;d<l.length;d++){var u,p=l[d];p.className.split(" ");"radio"==p.type?u="mcq":"checkbox"==p.type?u="mmcq":"text"!=p.type&&"textarea"!=p.type||(u="sa");var h=function(e){for(var t=e.split(" "),n=0;n<t.length;n++)if(t[n]&&0==t[n].trim().indexOf("knote"))return t[n].trim().split("knote")[1]}(p.className),g="";if("mcq"==u||"mmcq"==u){if(!p.checked){h&&i.push({nid:h,elem:p});continue}g=p.nextElementSibling.textContent}if("sa"==u){if(""==p.value){h&&i.push({nid:h,elem:p});continue}g=p.value}var f={};f.chapter||(f.chapter=chapters.getElemChapterIndex(p,{ignoreAnchors:!0})),f.chaptername||(f.chaptername=chapters.getElemChapterTitle(p)),f.file||(f.file=chapters.getElemChapterFilename()),f.location||(f.location=traverser.convertElemsToLocation([p],e.root).left,e.rootIndex&&(f.location=e.rootIndex+"."+f.location)),f.type||(f.type="content"),f.src||(f.src=c),f.note=g,h&&(f.nid=h),o.push({ob:f,elem:p})}}function m(e){e>=i.length?t&&t():stg.deleteNote(i[e].nid,null,function(){removeClass(i[e].elem,"knote"+i[e].nid),m(++e)})}!function e(t){if(t>=o.length)return void m(0);stg.addNote(o[t].ob,function(){addClass(o[t].elem,"knote"+o[t].ob.nid),e(++t)})}(0)},c.addIcon=function(n,e){if("page"==n.type){if(!(r=traverser.getElemsByLocation(n.location))[0])return;var t,o=selection.createNoteMarker(n,r[0],{class:"contentSideNoteMarker"});d(),o.addEventListener("click",function(t){virt.safeScrollToElem("content",o,!0),l(this.id.split("knote")[1],function(e){c.noteClicked([e]),t.stopImmediatePropagation()})}),o.addEventListener("tap",function(e){e.stopImmediatePropagation()}),o.addEventListener("hold",function(e){var t=[{name:translit.get("edit"),func:function(){popovers.hide(),c.noteClicked([n])}},{name:translit.get("delete"),func:function(){stg.deleteNote(n.nid,null,function(){selection.deleteNoteMarker(n.nid),popovers.hide()})}},{name:translit.get("cancel"),func:function(){popovers.hide()}}];popovers.show({mode:"popoverList",listOb:t,backdropClickToClose:!1})}),mobile||((t=document.createElement("span")).className="editIcon icon kb-close",t.addEventListener("click",function(e){c.confirmDeletion(function(){stg.deleteNote(n.nid,null,function(){selection.deleteNoteMarker(n.nid),kotobee.dispatchEvent("noteDeleted",n)})}),e.stopImmediatePropagation()}),t.addEventListener("tap",function(e){e.stopImmediatePropagation()}),o.appendChild(t),o.addEventListener("mouseover",function(e){addClass(o,"edit"),o.addEventListener("mouseout",function(e){removeClass(o,"edit")})}))}if("content"==n.type){for(var i,r=$injector.get("annotations").getMatchingElements(n,{root:e}),a=0;a<r.length;a++)r[a]&&addClass(r[a],"knote"+n.nid);if(1==r.length&&r[0]){var s=r[0].type;if("radio"==s||"checkbox"==s)return void(r[0].checked=!0);if("text"==s||"textarea"==s)return void(r[0].value=n.note)}for(a=0;a<r.length;a++)r[a]&&("double"==stg.data.currentView&&!chapters.elemInChapterElem(r[a],n.chapter)||addClass(i=r[a],"contentNoteBG"));if(!i)return;d(),addClass(i,"last"),$timeout(function(){try{var e=selection.createNoteMarker(n,i);e&&(e.onclick=function(t){var e=this.getAttribute("id");l(e.split("knote")[1],function(e){c.noteClicked([e]),t.stopImmediatePropagation(),t.preventDefault()})},e.addEventListener("tap",function(e){e.stopImmediatePropagation()}))}catch(e){}})}},c.confirmDeletion=function(e){if(i)return e();modals.hide();var t={title:"confirmation",msg:"noteDeleteConfirm",barStyle:"bar-dark"},n={label:"delete",style:"button-assertive",func:function(){t.dontAskChecked&&(i=!0),e&&e(),modals.hide()}},o={label:"cancel",func:function(){t.dontAskChecked&&(i=!0),modals.hide()}};t.dontAsk=!0,t.btns=[n,o],modals.show({mode:"confirm",confirmOptions:t})},c.confirmPublic=function(e){if(r)return e();modals.hide();var t={title:"confirmation",msg:"notePublicConfirm",barStyle:"bar-dark"},n={label:"ok",style:"button-positive",func:function(){t.dontAskChecked&&(r=!0),e&&e(),modals.hide()}},o={label:"cancel",func:function(){t.dontAskChecked&&(r=!0),modals.hide()}};t.dontAsk=!0,t.btns=[n,o],modals.show({mode:"confirm",confirmOptions:t})},c.noteClicked=function(n,o){try{n=n||[{}],c.getCurrentNotesByLocation(n[0]?n[0].location:null,function(e){var t={};t.cb=o,t.obs=n,t.save=s,t.note={},t.delete=a,t.allNotes=e,modals.show({mode:"note",dynamic:!0,animation:"slide-in-up",noteOptions:t,event:n[0].event})})}catch(e){}},c.noteClickedOld=function(t,n){try{t=t||[{}];var e={};e.cb=n,e.obs=t,e.save=s,t[0]&&t[0].note&&(Object.assign(e,t[0]),e.delete=function(){c.confirmDeletion(function(){for(var e=0;e<t.length;e++)c.delete(t[0],null,function(){e==t.length-1&&$timeout(function(){modals.hide(),n&&n()},300)})})}),modals.show({mode:"note",dynamic:!0,animation:"slide-in-up",noteOptions:e,event:t[0].event})}catch(e){}},c.delete=function(e,t,n){var o=e.nid;selection.deleteNoteMarker(o);for(var i=document.getElementsByClassName("knote"+o),r=i.length;r--;){var a=i[r];r==i.length-1&&(removeClass(i[r],"last"),c.deleteNoteAttribute(i[r])),removeClass(i[r],"knote"+o),-1==a.className.indexOf("knote")&&removeClass(a,"contentNoteBG")}stg.deleteNote(o,t,n),kotobee.dispatchEvent("noteDeleted",o)},c.deleteAll=function(o,i){stg.getNotes(function(t){var n=-1;!function e(){n++;if(n>=t.length)return void(i&&i());c.delete(t[n],o,function(){n%100==0?setTimeout(e,30):e()})}()})},c.deleteNoteAttribute=function(e){},c.notebookClicked=function(e){native&&crdv.vibrate(),overflowScroll||nav.resize(),modals.show({mode:"notebook",dynamic:!0,scope:e,animation:"slide-in-up",cb:function(){}})},c}),createService("tts",function(){var n,a,s,c={};function o(e,t){t=t||0;var n=window.speechSynthesis.getVoices();if(!n.length)return!(20<t)&&setTimeout(function(){o(e,++t)},50);e(n)}function l(e){var n=[],o=20,i=0,r=o,a=e.split(" ");return function e(){var t=a.map(function(e,t){if(i<=t&&t<r)return e.trim()}).join(" ");n.push(t.trim()),i<=a.length&&r<=a.length?(i=r,r+=o,e()):n=n.filter(function(e){return""!=e})}(),n}return c.initialize=function(){chapters.addListener(function(e){native||"newChapter"==e&&($rootScope.renderScope.applyHeader("default"),c.reset())})},c.pause=function(){c.paused?(window.speechSynthesis.resume(),c.paused=!1,Vue.set(stg.data,"ttsPaused",!1)):(window.speechSynthesis.pause(),c.paused=!0,Vue.set(stg.data,"ttsPaused",!0))},c.nextParagraph=function(){s&&(a>=s.length-1||c.readFromHere(a+1))},c.prevParagraph=function(){s&&0!=a&&c.readFromHere(a-1)},c.reset=function(){window.speechSynthesis.cancel(),selection.reset();for(var e=cache.getOb("epubContent").getElementsByClassName("ttsBG");e.length;)removeClass(e[0],"ttsBG");n&&clearInterval(n)},c.start=function(e,t){c.reset(),window.speechSynthesis.speak(e),Vue.set(stg.data,"ttsPaused",!1),c.paused=!1,t&&addClass(t,"ttsBG"),n=setInterval(function(){window.speechSynthesis.speaking||(c.paused=!1,clearInterval(n),stg.data.settings.ttsAuto&&c.nextParagraph())},500)},c.readFromHere=function(e){if(config.tts){if(desktop)return kError.update({error:"speechUnsupportedInDesktop"});if(preview)return kError.update({error:"speechUnsupportedInPreview"});$rootScope.renderScope.applyHeader("tts"),s=selection.getBlocksArray({hasText:!0});var i,r=selection.getSelectedText();if(null==(a=e))for(var t=0;t<s.length;t++)if(s[t].current){a=t;break}if(null==a&&(a=0),a<0&&(a=0),a>s.length-1&&(a=s.length-1),r=selection.getSelectedText([s[a].elem]))if(native&&"undefined"!=typeof TTS)crdv.tts(r,function(e){});else try{"speechSynthesis"in window&&SpeechSynthesisUtterance?(kStatus.showAndHide(translit.get("preparingVoice"),600,{dots:!0}),window.speechSynthesis.cancel(),window.ttsProcessedText=[],i=new SpeechSynthesisUtterance,o(function(e){i.rate=(config.ttsRate?config.ttsRate:100)/100;var t=config.defaultTtsLanguage?config.defaultTtsLanguage:"en-US";"id-ID"===t&&(mobile&&!native?t="in_ID":!mobile&&!desktop&&e[0]&&e[0].voiceURI&&-1!==e[0].voiceURI.indexOf("moz-tts")&&(t="id"));var n=e.filter(function(e){return e.lang==t});function o(e){var t;function n(e){window.ttsProcessedText.length&&(i.text=window.ttsProcessedText[e],c.start(i,s[a].elem))}i.lang=e.lang,i.voice=e,window.ttsProcessedText=l(r),window.ttsProcessedText.length&&(n(t=0),i.onend=function(){t<window.ttsProcessedText.length-1&&n(++t)})}stg.readSlot("ttsLang",function(t){return"string"==typeof t&&(n=e.filter(function(e){return e.lang==t})).length?o(n[0]):void tts.ttsChangeUserLang(null,o)})})):kError.update({error:"speechUnsupported"})}catch(e){kError.update({error:"speechUnsupported"})}}},c.read=function(){if(config.tts){if(desktop)return kError.update({error:"speechUnsupportedInDesktop"});if(preview)return kError.update({error:"speechUnsupportedInPreview"});s=null;var i,r=selection.getSelectedText();if(r)if(native&&"undefined"!=typeof TTS)crdv.tts(r,function(e){});else try{"speechSynthesis"in window&&SpeechSynthesisUtterance?(kStatus.showAndHide(translit.get("preparingVoice"),600,{dots:!0}),window.speechSynthesis.cancel(),window.ttsProcessedText=[],i=new SpeechSynthesisUtterance,o(function(e){i.rate=(config.ttsRate?config.ttsRate:100)/100;var t=config.defaultTtsLanguage?config.defaultTtsLanguage:"en-US";"id-ID"===t&&(mobile&&!native?t="in_ID":!mobile&&!desktop&&e[0]&&e[0].voiceURI&&-1!==e[0].voiceURI.indexOf("moz-tts")&&(t="id"));var n=e.filter(function(e){return e.lang==t});function o(e){var t;function n(e){window.ttsProcessedText.length&&(i.text=window.ttsProcessedText[e],c.start(i))}i.lang=e.lang,i.voice=e,window.ttsProcessedText=l(r),window.ttsProcessedText.length&&(n(t=0),i.onend=function(){t<window.ttsProcessedText.length-1&&n(++t)})}stg.readSlot("ttsLang",function(t){return"string"==typeof t&&(n=e.filter(function(e){return e.lang==t})).length?o(n[0]):void tts.ttsChangeUserLang(null,o)})})):kError.update({error:"speechUnsupported"})}catch(e){kError.update({error:"speechUnsupported"})}}},c.ttsChangeUserLang=function(e,i){o(function(n){e=e||{};var n=window.speechSynthesis.getVoices(),o={};o.voices=n,o.error=null,o.lang=e.lang?e.lang:"en-US",o.save=function(){o.error=null;var e,t=n.filter(function(e){return e.lang===o.lang});t.length?(e=t[0],i&&i(e),stg.writeSlot("ttsLang",o.lang),c.langSelected=!0,setTimeout(modals.hide,50)):o.error=!0},modals.show({mode:"ttsVoices",ttsOptions:o})})},c.showOptions=function(t,i){t=t||{},stg.readSlot("ttsLang",function(e){t.lang=e,o(function(n){var n=window.speechSynthesis.getVoices(),o={};o.voices=n,o.error=null,o.lang=t.lang?t.lang:"en-US",o.save=function(){settings.saveSettings(),o.error=null;var e,t=n.filter(function(e){return e.lang===o.lang});t.length?(e=t[0],i&&i(e),stg.writeSlot("ttsLang",o.lang),c.langSelected=!0,setTimeout(modals.hide,50)):o.error=!0},modals.show({mode:"ttsOptions",ttsOptions:o})})})},c});var compInstances={},compClasses={};compClasses.bookItem=Vue.component("bookItem",{data:function(){return{imgLoading:!0,loaded:null}},template:getTemplate("components/bookItem.html"),mounted:function(){(compInstances.bookItem=this).init()},props:["book"],methods:{init:function(){},bookClicked:function(e){var t;e&&e.url&&(t=e.url),this.$emit("bookClicked",this.book,t)}}}),compClasses.bookmarkItem=Vue.component("bookmarkItem",{data:function(){return{imgLoading:!0}},template:getTemplate("components/bookmarkItem.html"),mounted:function(){(compInstances.bookmarkItem=this).init()},props:["item"],computed:{},methods:{init:function(){},deleteBookmark:function(e,t){inherited(this.$parent,"deleteBookmark",[e,t])},noteItemClicked:function(e){inherited(this.$parent,"noteItemClicked",[e])}}}),function(){var r,e;compClasses.bookSection=Vue.component("bookSection",{data:function(){return{loading:null}},template:getTemplate("components/bookSection.html"),mounted:function(){(compInstances.bookSection=this).init(),window.addEventListener("resize",this.resize)},destroyed:function(){window.removeEventListener("resize",this.resize)},computed:{contentComp:function(){return this.$parent.$parent}},props:["section"],methods:((e={init:function(){},resize:function(e){this.scrolled()},bookClicked:function(e){this.$emit("bookClicked",e)}}).scrolled=function(n){var e,t,o,i=this;n&&(this.contentComp.freeze=!0,r&&clearTimeout(r),r=setTimeout(function(){i.contentComp.freeze=!1},200)),i.loading||i.section.books.length>=i.section.total||(t=(e=i.$el.getElementsByClassName("bookList")[0]).children[0],.9<(e.scrollLeft+t.offsetWidth)/e.scrollWidth&&(i.loading=!0,o={catid:i.section.id,offset:i.section.books.length,max:20,sections:0,sort:stg.data.sortOb.method.data,sortDir:stg.data.sortOb.method.dir},backend.getEbooks(o,null,function(e){for(var t=0;t<e.length;t++)i.section.books.push(e[t]);i.loading=!1,Vue.nextTick(function(){i.scrolled(n)})})))},e.scrollstart=function(){},e.scrollend=function(){},e)})}(),function(){function e(){var n=this;$timeout(function(){var t;n.book.coverImg||(Vue.set(n.book,"coverImg",book.getCoverImgPath(n.book)),chromeApp&&(stg.data.chromeAssets[n.book.coverImg]?n.book.coverImg=stg.data.chromeAssets[n.book.coverImg]:(t=n.book.coverImg,delete n.book.coverImg,getImgDataSrc(t,function(e){n.book.coverImg=e,stg.data.chromeAssets[t]=e,n.$apply()}))))})}var t;compClasses.bookThumb=Vue.component("bookThumb",{data:function(){return{imgLoading:!0}},template:getTemplate("components/bookThumb.html"),mounted:function(){(compInstances.bookThumb=this).init()},props:["book"],updated:function(){this.updated()},methods:((t={}).init=function(){e.bind(this)()},t.updated=function(){e.bind(this)()},t.coverLoaded=function(e){this.imgLoading=!1;var t,n=this.$el;this.$parent.loaded=!0,!config.bookThumbShadow||(t=n.getElementsByClassName("bookShadow")).length&&(t[0].style.transform="scale("+n.width/n.parentNode.offsetWidth+")")},t)})}(),compClasses.categoryList=Vue.component("categoryList",{data:function(){return{}},template:getTemplate("components/categoryList.html"),mounted:function(){(compInstances.categoryList=this).init()},props:["rtl","list","odd","level"],methods:{init:function(){},categoryClicked:function(e){this.$emit("catClicked",e)}}}),window.closableModal={methods:{hideModal:function(){modals.hide()}}},compClasses.hlightItem=Vue.component("hlightItem",{data:function(){return{imgLoading:!0}},template:getTemplate("components/hlightItem.html"),mounted:function(){(compInstances.hlightItem=this).init()},props:["item"],computed:{},methods:{init:function(){},deleteHlight:function(e,t){inherited(this.$parent,"deleteHlight",[e,t])},noteItemClicked:function(e){inherited(this.$parent,"noteItemClicked",[e])}}}),function(){var e;compClasses.infiniteList=Vue.component("infiniteList",{data:function(){return{header:null,footer:null,freeze:null}},template:getTemplate("components/infiniteList.html"),props:["scroll","autoscroll","overflowScroll","padding","pullToRefresh","infiniteLoading","pullText","pullIcon","noDataText","hasHeader","hasFooter","delegateHandle"],mounted:function(){(compInstances.infiniteList=this).init()},computed:{classArray:function(){var e=[];return e.push("scroll-content"),e.push(this.overflowScroll?"overflow-scroll":""),e.push(this.header?"has-header":""),e.push(this.footer?"has-footer":""),e}},watch:{freeze:function(){this.$refs.vueScroller&&(this.$refs.vueScroller.scroller.options.scrollingY=!this.freeze,this.$refs.vueScroller.scroller.__enableScrollY=!this.freeze)}},methods:((e={}).init=function(){var n,o=this;this.header=this.hasHeader,this.footer=this.hasFooter,function(){for(var e=this.$el.parentNode,t=0;t<e.children.length;t++)null==this.header&&hasClass(e.children[t],"bar-header")&&(this.header=!0),null==this.footer&&hasClass(e.children[t],"bar-footer")&&(this.footer=!0)}.bind(this)(),this.$refs.vueScroller&&MutationObserver&&(n=this.$refs.vueScroller.$el.children[0],new MutationObserver(function(e){ob=window.transform.parse(n.style.transform);var t={target:{scrollTop:-ob.translate3d[1]}};o.$emit("scroll",t)}).observe(n,{attributes:!0,attributeFilter:["style"]}))},e.refresh=function(e){this.$emit("refresh",e)},e.infinite=function(e){this.$emit("infinite",e)},e)})}(),compClasses.libraryRow=Vue.component("libraryRow",{data:function(){return{}},props:["row"],template:getTemplate("components/libraryRow.html"),mounted:function(){(compInstances.libraryRow=this).init()},computed:{library:function(){return document.getElementById("library").__vue__}},methods:{init:function(){}}}),Vue.component("noPayments",{data:function(){return{}},template:getTemplate("components/noPayments.html"),mounted:function(){this.init()},props:["bookInfoOptions"],methods:{init:function(){},goBack:function(){if(this.bookInfoOptions)return this.bookInfoOptions.stage="info"}}}),compClasses.noteItem=Vue.component("noteItem",{data:function(){return{imgLoading:!0}},template:getTemplate("components/noteItem.html"),mounted:function(){(compInstances.noteItem=this).init()},props:["item"],computed:{},methods:{init:function(){},deleteNote:function(e,t){inherited(this.$parent,"deleteNote",[e,t])},noteItemClicked:function(e){inherited(this.$parent,"noteItemClicked",[e])},noteEntryStyle:function(e,t){var n=[];return t==e&&n.push("editing"),e.public?(n.push("public"),((e.uid=stg.data.user.id)||stg.data.user.perms&&stg.data.user.perms.globaldata)&&n.push("mine"),n.push("hasAvatar")):n.push("mine"),n.join(" ")}}}),function(){function t(){f.bind(this)(h.bind(this)())}function c(e,t){return e.className==t||e.parentNode.className==t}function r(e){var t,n,o,i,r,a,s;this.enabled&&(mobile&&"dblclick"==e.type||c(e.target,"kotobeeScrollbarY")||c(e.target,"kotobeeScrollbarX")||(e=d(e),(t=k.bind(this)()).getBoundingClientRect(),n=g.bind(this)(),o=h.bind(this)(),s=t.offsetWidth/t.offsetHeight>n.width/n.height?(i=this.fitToWidth,function(){var e=g.bind(this)(),t=k.bind(this)();return(e.width-2*e.padding)/t.offsetWidth}.bind(this)()):(i=this.fitToHeight,function(){var e=g.bind(this)(),t=k.bind(this)();return(e.height-2*e.padding)/t.offsetHeight}.bind(this)()),r=o.scale,a=s,v(r)==v(a)?(this.scaleTo(this.maxZoom*s,!0,e),kotobee.dispatchEvent("transformationChanged",this.maxZoom*s)):i(!0)))}function a(e){var t=this;if(this.enabled&&!function(e){if(!e.touches||1<e.touches.length)return;if(P&&Math.abs(e.touches[0].clientX-P.clientX)<25&&Math.abs(e.touches[0].clientY-P.clientY)<25)return r.bind(this)(e),!0;P=e.touches[0],setTimeout(function(){P=null},300)}.bind(this)(e)){if("touchstart"==e.type&&!D)return D=!0,void setTimeout(function(){D&&e.touches&&e.touches.length&&(P=null,a.bind(t)(e))},200);e=d(e),s.bind(this)(e),document.body.addEventListener("touchmove",I=l.bind(this)),document.body.addEventListener("mousemove",C=l.bind(this)),document.body.addEventListener("mouseup",x=s.bind(this)),document.body.addEventListener("touchend",E=s.bind(this));var n=k.bind(this)(),o=n.getBoundingClientRect(),i=(this.container?this.container:this.$el).getBoundingClientRect();if(A=e.clientX-o.x+i.x,N=e.clientY-o.y+i.y,e.touches&&1<e.touches.length){A=e.touches[0].clientX+(e.touches[1].clientX-e.touches[0].clientX)/2,N=e.touches[0].clientY+(e.touches[1].clientY-e.touches[0].clientY)/2,L=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY),L=null;o=n.getBoundingClientRect();return $=((e.touches[1].clientX+e.touches[0].clientX)/2-o.left)/o.width,F=((e.touches[1].clientY+e.touches[0].clientY)/2-o.top)/o.height,void(stg.data.pinching=!0)}}}function s(e){document.body.removeEventListener("touchmove",I),document.body.removeEventListener("mousemove",C),document.body.removeEventListener("mouseup",x),document.body.removeEventListener("touchend",E),D=L=null,stg.data.pinching=!1}function l(e){if((e=d(e)).touches&&1<e.touches.length){var t,n,o=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);return L&&(t=(o-L)/L,e.clientX=(e.touches[0].clientX+e.touches[1].clientX)/2,e.clientY=(e.touches[0].clientY+e.touches[1].clientY)/2,n=h.bind(this)(),e.cursorRatioX=$,e.cursorRatioY=F,this.scaleTo.bind(this)(n.scale+t,!1,e),kotobee.dispatchEvent("transformationChanged",n.scale+t)),void(L=o)}this.panTo(e.clientX-A,e.clientY-N)}function d(e){if(e.touches&&e.touches.length){var t=e.touches;e={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY,screenX:e.touches[0].screenX,screenY:e.touches[0].screenY,touches:[]};for(var n=0;n<t.length;n++)e.touches.push(t[n])}return e}function h(){var e={};return this.scrollPane.style.transform&&(e=window.transform.parse(this.scrollPane.style.transform)),e.translate3d||(e.translate3d=[0,0,0]),e.scale||(e.scale=1),e}function g(){return{left:0,top:0,right:e.bind(this)(),bottom:n.bind(this)(),width:e.bind(this)(),height:n.bind(this)(),padding:this.padding}}function e(){return(this.containerId?document.getElementById(this.containerId):this.$el).offsetWidth}function n(){return(this.containerId?document.getElementById(this.containerId):this.$el).offsetHeight}function f(e,t){var n,o;t=t||{},W&&(o={width:(n=k.bind(this)()).offsetWidth,height:n.offsetHeight},t.dontCap||u.bind(this)(e,o)),p.bind(this)(e,t),kotobee.dispatchEvent("pageTransformed",e)}function u(e,t){var n=g.bind(this)(),o=e.scale*t.width,i=e.scale*t.height;o>n.width-2*n.padding?(e.translate3d[0]>n.padding&&(e.translate3d[0]=n.padding),e.translate3d[0]+o<n.width-n.padding&&(e.translate3d[0]=n.width-n.padding-o)):e.translate3d[0]=(n.width-o)/2,i>n.height-2*n.padding?(e.translate3d[1]>n.padding&&(e.translate3d[1]=n.padding),e.translate3d[1]+i<n.height-n.padding&&(e.translate3d[1]=n.height-n.padding-i)):e.translate3d[1]=(n.height-i)/2,o<n.width-2*n.padding&&(e.translate3d[0]=(n.width-o)/2),i<n.height-2*n.padding&&(e.translate3d[1]=(n.height-i)/2)}function p(e,t){var n=this;if((t=t||{}).pid||(t.pid=B=Math.round(9999*Math.random())),B==t.pid)if(t.ease){var o=h.bind(this)(),i={},r=!0;for(var a in e)if(i[a]=clone(o[a]),Array.isArray(e[a]))for(var s=0;s<e[a].length;s++)i[a][s]=o[a][s]+(e[a][s]-o[a][s])/3,v(i[a][s])==v(e[a][s])?i[a][s]=e[a][s]:r=!1;else a&&(i[a]=o[a]+(e[a]-o[a])/3,v(i[a])==v(e[a])?i[a]=e[a]:r=!1);this.scrollPane.style.transform=window.transform.stringify(i),m.bind(this)(),r||window.requestAnimationFrame(function(){p.bind(n)(e,t),n.$emit("scrolled")})}else this.scrollPane.style.transform=window.transform.stringify(e),m.bind(this)(),n.$emit("scroll")}function m(){var e=this;z||setTimeout(function(){o.bind(e)()},100)}function v(e){return Math.round(1e3*e)/1e3}function i(e){this.scrollHeadX&&this.scrollHeadX.classList.remove("active"),this.scrollHeadY&&this.scrollHeadY.classList.remove("active"),document.body.removeEventListener("mousemove",H),document.body.removeEventListener("mouseup",V),z=!1}function o(){var i=this;(function(){var e=g.bind(this)(),t=k.bind(this)().getBoundingClientRect();{var n;this.scrollHeadY&&(n=e.height/(t.height+2*e.padding),this.scrollHeadY.style.height=n*this.scrollHeadY.parentNode.offsetHeight+"px")}{var o;this.scrollHeadX&&(o=e.width/(t.width+2*e.padding),this.scrollHeadX.style.width=o*this.scrollHeadX.parentNode.offsetWidth+"px")}}).bind(this)();var r=b.bind(this)(),e=r.bounds,a=r.rect;this.showScrollbarY=a.height>e.height-2*e.padding+1,this.showScrollbarX=a.width>e.width-2*e.padding+1,Vue.nextTick(function(){var e,t,n,o;i.showScrollbarY&&i.scrollbarY&&((e=(a.top-r.parentRect.top-r.minY)/(r.maxY-r.minY))<0&&(e=0),1<e&&(e=1),t=r.headMinY+(r.headMaxY-r.headMinY)*e,i.scrollHeadY.style.top=t+"px"),i.showScrollbarX&&i.scrollbarX&&((n=(a.left-r.minX)/(r.maxX-r.minX))<0&&(n=0),1<n&&(n=1),o=r.headMinX+(r.headMaxX-r.headMinX)*n,i.scrollHeadX.style.left=o+"px")})}function b(){var e=g.bind(this)(),t=k.bind(this)().getBoundingClientRect(),n={minY:e.padding,maxY:e.height-t.height-e.padding,minX:e.padding,maxX:e.width-t.width-e.padding,headMinX:0,headMinY:0,bounds:e,rect:t},o=this.container?this.container:this.$el;return o&&(n.parentRect=o.getBoundingClientRect()),this.scrollHeadY&&(n.headMaxY=this.scrollHeadY.parentNode.offsetHeight-this.scrollHeadY.offsetHeight),this.scrollHeadX&&(n.headMaxX=this.scrollHeadX.parentNode.offsetWidth-this.scrollHeadX.offsetWidth),n}function k(){return this.scrollPane.children[0]}function y(){var e=g.bind(this)(),t=k.bind(this)(),n=(e.height-2*e.padding)/t.offsetHeight,o=(e.width-2*e.padding)/t.offsetWidth,i=this.minZoom;return n<i&&(i=n),o<i&&(i=o),i}function w(){var e=this.maxZoom;return e<1&&(e=1),e}var C,x,I,E,S,T,O,A,N,L,B,M,R,P,D,$,F,H,V,U,j,_,z,q,W;compClasses.pan=Vue.component("pan",{data:function(){return{showScrollbarY:null,showScrollbarX:null,enabled:!0}},template:getTemplate("components/pan.html"),mounted:function(){(compInstances.pan=this).init()},destroyed:function(){this.destroyed()},computed:{$child:function(){return this.scrollPane.children[0]},scrollPane:function(){return this.$el.getElementsByClassName("scrollPane")[0]},scrollHeadX:function(){if(this.showScrollbarX&&this.scrollbarX){var e=this.$el.getElementsByClassName("kotobeeScrollbarX");return e.length?e[0].children[0]:void 0}},scrollHeadY:function(){if(this.showScrollbarY&&this.scrollbarY){var e=this.$el.getElementsByClassName("kotobeeScrollbarY");return e.length?e[0].children[0]:void 0}},container:function(){return this.containerId?document.getElementById(this.containerId):null}},props:["scrollbarX","scrollbarY","minZoom","maxZoom","rtl","padding","containerId","resetVariable","wheelMode"],watch:{},methods:(W=!0,(q={}).init=function(){null==this.scrollbarX&&(this.scrollbarX=!1),null==this.scrollbarY&&(this.scrollbarY=!1),null==this.minZoom&&(this.minZoom=.5),null==this.maxZoom&&(this.maxZoom=2),null==this.padding&&(this.padding=100),this.minZoom=Number(this.minZoom),this.maxZoom=Number(this.maxZoom),function(){var n=this,e=this.$el;e.addEventListener("mousedown",a.bind(this)),e.addEventListener("touchstart",a.bind(this)),e.addEventListener("mousewheel",function(e){if(!this.enabled)return;{var t,n,o;"zoom"==this.wheelMode?(o=h.bind(this)(),t=0<e.deltaY?-.1:.1,this.scaleTo.bind(this)(o.scale+t,!0,e),kotobee.dispatchEvent("transformationChanged",o.scale+t)):(n=0<e.deltaY?-25:25,o=h.bind(this)(),R?this.panTo(o.translate3d[0]+n,null):this.panTo(null,o.translate3d[1]+n))}}.bind(this)),mobile||e.addEventListener("dblclick",r.bind(this));document.addEventListener("keydown",T=function(e){R=e.shiftKey}.bind(this)),document.addEventListener("keyup",O=function(e){R=null}.bind(this)),window.addEventListener("resize",S=t.bind(this)),this.resetVariable&&(M=this.$watch(this.resetVariable,function(e,t){n.reset()}))}.bind(this)(),f.bind(this)(h.bind(this)())},q.destroyed=function(){window.removeEventListener("resize",S),document.removeEventListener("keydown",T),document.removeEventListener("keyup",O),M&&M()},q.reset=function(){this.scrollPane.style.transform=null},q.panTo=function(e,t,n){var o=h.bind(this)();null!=e&&(o.translate3d[0]=e),null!=t&&(o.translate3d[1]=t),o.translate3d[2]=0,f.bind(this)(o,{ease:n})},q.scrollMousedown=function(e,t){var n,o;t.stopPropagation(),i.bind(this)(t),document.body.addEventListener("mousemove",H=function(e){var t,n,o=b.bind(this)();{var i;"y"==_&&this.scrollHeadY&&((i=e.clientY-j)<o.headMinY&&(i=o.headMinY),i>o.headMaxY&&(i=o.headMaxY),this.scrollHeadY.style.top=i+"px",n=o.minY+(o.maxY-o.minY)*(i/o.headMaxY))}{var r;"x"==_&&this.scrollHeadX&&((r=e.clientX-U)<o.headMinX&&(r=o.headMinX),r>o.headMaxX&&(r=o.headMaxX),this.scrollHeadX.style.left=r+"px",t=o.minX+(o.maxX-o.minX)*(r/o.headMaxX))}this.panTo(t,n)}.bind(this)),document.body.addEventListener("mouseup",V=i.bind(this)),"y"==(_=e)&&this.scrollHeadY&&(this.scrollHeadY.classList.add("active"),n=this.scrollHeadY.getBoundingClientRect(),o=this.scrollHeadY.parentNode.getBoundingClientRect(),j=t.clientY-n.y+o.y),"x"==_&&this.scrollHeadX&&(this.scrollHeadX.classList.add("active"),n=this.scrollHeadX.getBoundingClientRect(),o=this.scrollHeadX.parentNode.getBoundingClientRect(),U=t.clientX-n.x+o.x),z=!0},q.updateScrollbar=o,q.scrollClicked=function(e,t){var n,o,i,r,a;"head"!=t.target.className&&(n=b.bind(this)(),o=h.bind(this)(),"y"==e&&this.scrollHeadY&&(r=this.scrollHeadY.getBoundingClientRect(),i=t.clientY<r.top,o.translate3d[1]=o.translate3d[1]+((i?n.minY:n.maxY)-o.translate3d[1])/2),"x"==e&&this.scrollHeadX&&(r=this.scrollHeadX.getBoundingClientRect(),a=t.clientX<r.left,o.translate3d[0]=o.translate3d[0]+((a?n.minX:n.maxX)-o.translate3d[0])/2),f.bind(this)(o))},q.scrollTo=function(e,t,n){var o,i,r,a,s=b.bind(this)();null!=t&&this.scrollHeadY&&((r=t)<s.headMinY&&(r=s.headMinY),r>s.headMaxY&&(r=s.headMaxY),i=s.minY+(s.maxY-s.minY)*(r/s.headMaxY)),null!=e&&this.scrollHeadX&&((a=e)<s.headMinX&&(a=s.headMinX),a>s.headMaxX&&(a=s.headMaxX),o=s.minX+(s.maxX-s.minX)*(a/s.headMaxX)),this.panTo(o,i,n)},q.scrollTop=function(e){this.scrollTo(null,0,e)},q.resize=function(){t.bind(this)()},q.getScrollPosition=function(){var e=h.bind(this)(),t=b.bind(this)(),n={};return n.zoom=e.scale,n.left=t.minX-e.translate3d[0],n.top=t.minY-e.translate3d[1],n},q.getPosition=q.getScrollPosition,q.fitToHeight=function(e,t){t=t||{};var n=g.bind(this)(),o=k.bind(this)(),i=(n.height-2*n.padding)/o.offsetHeight;this.scaleTo(i,e),t.disableEvents||kotobee.dispatchEvent("transformationChanged",i)},q.fitToWidth=function(e,t){t=t||{};var n=g.bind(this)(),o=k.bind(this)(),i=(n.width-2*n.padding)/o.offsetWidth,r=null;t.top&&(r={clientX:0,clientY:0}),this.scaleTo(i,e,r),t.disableEvents||kotobee.dispatchEvent("transformationChanged",i)},q.bestFit=function(e,t){var n=g.bind(this)(),o=k.bind(this)(),i=(n.height-2*n.padding)/o.offsetHeight,r=(n.width-2*n.padding)/o.offsetWidth,a=r<i?r:i;this.scaleTo(a,e),kotobee.dispatchEvent("transformationChanged",a)},q.scaleTo=function(e,t,n){var o=h.bind(this)(),i=k.bind(this)(),r=g.bind(this)(),a=y.bind(this)(),s=w.bind(this)();e<a&&(e=a),s<e&&(e=s);var c=e*i.offsetHeight,l=e*i.offsetWidth,d=.5,u=.5;if(n)if(n.cursorRatioX)d=n.cursorRatioX,u=n.cursorRatioY;else{var p=i.getBoundingClientRect();if(0==p.width||0==p.height)throw new Error("Kotobee: Scroll content width or height is zero. Perhaps they are absolutely positioned?");d=(n.clientX-p.left)/p.width,u=(n.clientY-p.top)/p.height}o.translate3d[0]=(r.width-l)*d,o.translate3d[1]=(r.height-c)*u,o.scale=e,f.bind(this)(o,{ease:t})},q.zoomTo=function(e,t){var n=h.bind(this)(),o=k.bind(this)(),i=o.getBoundingClientRect();n.scale=e;var r=y.bind(this)(),a=w.bind(this)();if(n.scale<r&&(n.scale=r),n.scale>a&&(n.scale=a),0==i.width||0==i.height)throw new Error("Kotobee: Scroll content width or height is zero. Perhaps they are absolutely positioned?");n.translate3d[0]-=.5*(o.offsetWidth*n.scale-i.width),n.translate3d[1]-=.5*(o.offsetHeight*n.scale-i.height),f.bind(this)(n,{ease:t}),kotobee.dispatchEvent("transformationChanged",n)},q.zoomToRegion=function(e,t){var n,o,i,r;e&&(e.scale||(e.scale=1),e.x||(e.x=0),e.y||(e.y=0),n=g.bind(this)(),i=o=1,e.width&&(o=(n.width-2*n.padding)/e.width),e.height&&(i=(n.height-2*n.padding)/e.height),r=h.bind(this)(),o<i?(r.scale=o,r.translate3d[0]=-e.x*r.scale,r.translate3d[1]=(n.height-e.height*r.scale)/2-e.y*r.scale):(r.scale=i,r.translate3d[0]=(n.width-e.width*r.scale)/2-e.x*r.scale,r.translate3d[1]=-e.y*r.scale),kotobee.dispatchEvent("transformationChanged",r),f.bind(this)(r,{ease:t,dontCap:!0}))},q.getBestFit=function(e,t){var n=clone(t),o={translate3d:[]},i=g.bind(this)();n.double&&(n.width*=2),o.scale="width"==e?(i.width-2*this.padding)/n.width:(i.height-2*this.padding)/n.height;var r=o.scale*n.width,a=o.scale*n.height;return o.translate3d[0]=.5*(i.width-r),o.translate3d[1]=.5*(i.height-a),W&&u.bind(this)(o,n),o},q)})}(),function(){function n(e){return e.replace(/^[!?., {}()]*(.*?)[!?.,{} ()]*$/g,"$1")}var e;compClasses.selectionOptions=Vue.component("selectionOptions",{data:function(){return{langSelected:null,optionMode:null}},template:getTemplate("components/selectionOptions.html"),mounted:function(){(compInstances.selectionOptions=this).init()},methods:((e={}).init=function(){kotobee.addEventListener("textSelected",{unique:!0},this.textSelected)},e.textSelected=function(){stg.readSlot("ttsLang",function(e){tts.langSelected=!(!e||!e.length)}),this.optionMode=null},e.ttsChangeLangClicked=function(){stg.readSlot("ttsLang",function(e){tts.showOptions()})},e.ttsOptions=function(){this.optionMode="tts"},e.tts=function(){tts.read()},e.ttsReadFromHere=function(){tts.readFromHere()},e.copy=function(){selection.copyToClipboard()},e.share=function(){var e;!config.share||(e=selection.getSelectedText())&&crdv.share(e)},e.note=function(e){var t,n,o;config.annotations&&(o=[],(t=selection.getLocation()).left?((n={type:"content"}).location=t.leftRange,n.chapter=stg.data.currentPageOb.index,n.src=selection.getSelectedText(void 0),n.event=e,o.push(n)):t.right&&((n={type:"content"}).location=t.rightRange,n.chapter=stg.data.currentRPageOb.index,n.src=selection.getSelectedText(void 0),n.event=e,o.push(n)),notes.noteClicked(o,function(e){selection.reset()}))},e.highlight=function(){if(config.annotations){var e,t=selection.getSelectedNodes(),n=selection.getLocation(),o=[];n.left&&((e={}).location=n.leftRange,e.chapter=stg.data.currentPageOb.index,e.src=selection.getSelectedText(t),o.push(e)),n.right&&((e={}).location=n.rightRange,e.chapter=stg.data.currentRPageOb.index,e.src=selection.getSelectedText(t),o.push(e));for(var i=0;i<t.length;i++)if(hasClass(t[i],"contentHlightBG")){for(var r=getClassThatStartsWith(t[i],"hlight"),a=0;a<o.length;a++)o[a].hid=r.substr(6);return void stg.getHlightById(o[0].hid,function(e){for(var t=0;t<o.length;t++)o[t].color=e.color;s()})}s()}function s(){hlights.showPopup(o,function(e){selection.reset()})}},e.google=function(){if(config.googleLookup){var e=n(selection.getSelectedText());if(e)try{var t="http://www.google.com/custom?q="+e;return void backend.externalLink(t,{secure:!0})}catch(e){}}},e.wikipedia=function(){if(config.wikipediaLookup){var e=n(selection.getSelectedText());if(e)try{var t="https://"+(config.wikipediaLang?config.wikipediaLang:"en")+".wikipedia.org/wiki/"+e;backend.externalLink(t,{secure:!0})}catch(e){}}},e.backClicked=function(){selection.reset()},e)})}(),compClasses.stars=Vue.component("stars",{data:function(){return{rating:null,selectedRating:null}},template:getTemplate("components/stars.html"),mounted:function(){(compInstances.stars=this).init()},props:["defaultRating","type"],methods:{init:function(){this.rating=this.defaultRating,this.rating||(this.rating=0),"input"==this.type&&(this.rating=this.selectedRating=0)},over:function(e){"input"==this.type&&(this.rating=e)},select:function(e){"input"==this.type&&(this.rating=this.selectedRating=e,this.$emit("selected",e))},leave:function(){"input"==this.type&&null!=this.selectedRating&&(this.rating=this.selectedRating)}}}),compClasses.zoomControls=Vue.component("zoomControls",{data:function(){return{}},template:getTemplate("components/zoomControls.html"),mounted:function(){(compInstances.zoomControls=this).init()},props:[""],methods:{init:function(){},fxlZoomIn:function(e){nav.fxlZoomIn(e)},fxlZoomOut:function(e){nav.fxlZoomOut(e)},fxlZoomFit:function(e){nav.fxlZoomFit(e)}}}),compClasses.headerDefault=Vue.component("headerDefault",{data:function(){return{}},template:getTemplate("headers/headerDefault.html"),mounted:function(){(compInstances.headerDefault=this).init()},methods:{init:function(){},backClicked:function(){inherited(this.$parent,"backClicked")},exitBook:function(){app.exitBook()},chapterClicked:function(){inherited(this.$parent,"chapterClicked")},freehandClicked:function(e){inherited(this.$parent,"freehandClicked",[e])},noteClicked:function(){inherited(this.$parent,"noteClicked")},bookmarkClicked:function(){inherited(this.$parent,"bookmarkClicked")},miniappsClicked:function(){inherited(this.$parent,"miniappsClicked")}},computed:{header:function(){return inherited(this.$parent,"header")}}}),compClasses.headerFreehand=Vue.component("headerFreehand",{data:function(){return{mode:freehand.mode,currentStyle:freehand.currentStyle,smoothingValue:freehand.smoothing,currentOptions:null,smoothing:null,brushes:null,colors:null}},template:getTemplate("headers/headerFreehand.html"),mounted:function(){(compInstances.headerFreehand=this).init()},methods:{init:function(){},backClicked:function(){freehand.deactivate()},smoothingClicked:function(){if("smoothing"==this.currentOptions)return this.closeOptions();this.currentOptions="smoothing",this.smoothing=freehand.defs.smoothing,this.smoothingValue=freehand.smoothing},brushesClicked:function(){if("brushes"==this.currentOptions)return this.closeOptions();this.currentOptions="brushes",this.brushes=freehand.defs.brushes},colorsClicked:function(){if("colors"==this.currentOptions)return this.closeOptions();this.currentOptions="colors",this.colors=freehand.defs.colors,this.currentStyle=freehand.currentStyle},eraserClicked:function(){this.mode="eraser",freehand.mode="eraser"},penClicked:function(){this.mode="pen",freehand.mode="pen"},clearClicked:function(){freehand.clear()},undoClicked:function(){freehand.undo()},redoClicked:function(){freehand.redo()},closeOptions:function(){this.currentOptions=null},selectColor:function(e){freehand.currentStyle.color=e,this.closeOptions()},selectBrush:function(e){freehand.currentStyle.brush=e,this.closeOptions()},selectSmoothing:function(e){freehand.smoothing=e,this.closeOptions()}},computed:{}}),compClasses.headerLibrary=Vue.component("headerLibrary",{data:function(){return{langDropdownExpanded:null}},template:getTemplate("headers/headerLibrary.html"),mounted:function(){(compInstances.headerLibrary=this).init()},methods:{init:function(){},back:function(){return inherited(this.$parent,"back")},exitLib:function(){app.exitLib()},langSelected:function(e){this.langDropdownExpanded=!1,stg.data.settings.language=e,settings.langChanged()},enableSearch:function(){return inherited(this.$parent,"enableSearch")},redeemCodeClicked:function(){return inherited(this.$parent,"redeemCodeClicked")},showLibraryMenu:function(){return inherited(this.$parent,"showLibraryMenu")},showCart:function(){cart.show()},userLogin:function(){backend.userLoggedIn()?backend.logout():kError.update({error:"s_authError"})},menuItemClicked:function(e){return inherited(this.$parent,"menuItemClicked",[e])}},computed:{header:function(){return inherited(this.$parent,"header")},subMode:function(){return inherited(this.$parent,"subMode")},searchOb:function(){return inherited(this.$parent,"searchOb")},title:function(){return inherited(this.$parent,"title")},shouldShowLogin:function(){return!(!this.cloudParam("allowlogin")||!this.cloudParam("public"))||!this.cloudParam("public")}}}),compClasses.headerLibraryCategories=Vue.component("headerLibraryCategories",{data:function(){return{}},props:["autohideEase"],template:getTemplate("headers/headerLibraryCategories.html"),mounted:function(){(compInstances.headerLibraryCategories=this).init()},methods:{init:function(){}},computed:{hasCategories:function(){return config.showCategories&&stg.data.currentLibrary&&stg.data.currentLibrary.categories&&stg.data.currentLibrary.categories.length}}}),compClasses.headerSearch=Vue.component("headerSearch",{data:function(){return{key:""}},template:getTemplate("headers/headerSearch.html"),mounted:function(){(compInstances.headerSearch=this).init()},methods:{init:function(){this.searchKeyOb&&(this.key=this.searchKeyOb.key)},search:function(e){this.$emit("search",e),this.hide()},hide:function(){this.obj[this.prop]=this.offValue}},props:["obj","prop","kotobeeGradient","onValue","offValue","noCancel","searchKeyOb","placeholder"],watch:{},computed:{}}),compClasses.headerSearchItems=Vue.component("headerSearchItems",{data:function(){return{index:0,titleMode:3,results:[]}},template:getTemplate("headers/headerSearchItems.html"),mounted:function(){(compInstances.headerSearchItems=this).init()},destroyed:function(){this.destroyed()},computed:{searchContent:function(){return compInstances.search.searchContent},countLabel:function(){return translit.get("countWithLimit").replace("[count]",this.index+1).replace("[limit]",this.results.length)}},methods:{init:function(){var e=this.searchContent.results[currentIndex];e&&(this.results=e.matches),this.results.index&&(this.index=this.results.index),0==this.results.length?this.titleMode="empty":this.highlightCurrentItem({initial:!0})},destroyed:function(){search.removeHighlights()},applyHeader:function(e){compInstances.reader.applyHeader(e)},backClicked:function(){this.applyHeader("default")},up:function(){0==this.index&&(this.index=this.results.length),this.index--,this.highlightCurrentItem()},down:function(){this.index==this.results.length-1&&(this.index=-1),this.index++,this.highlightCurrentItem()},highlightCurrentItem:function(t){var n,o=this;function i(e){kotobee.clearListeners("processedRoute"),chapters.hideLoader();var t=chapters.getCurrentHash()||e,n=traverser.getElemsByLocation(t);n[0]&&(n[0].offsetParent?(o.titleMode="title",addClass(n[0],"searchItemHighlight"),virt.safeScrollToElem("content",n[0],!0)):o.titleMode="hidden")}t=t||{},o.results&&o.results.length&&chapters.getPageOb({page:currentIndex},function(e){return search.removeHighlights(),o.results[o.index]&&o.results[o.index].location&&(n=o.results[o.index].location),t.initial?i(n):(kotobee.addEventListener("processedRoute",i),void chapters.redirect(currentIndex,{hash:n}))})}}}),compClasses.headerSelection=Vue.component("headerSelection",{data:function(){return{index:0,titleMode:3,results:[]}},extends:compClasses.selectionOptions,template:getTemplate("headers/headerSelection.html"),mounted:function(){(compInstances.headerSelection=this).init()},computed:{},methods:{init:function(){}}}),function(){function t(){"rfl"==stg.data.book.chapter.layout&&("double"!=stg.data.book.chapter.view&&stg.data.settings.pageScroll||$injector.get("chapters").regenerateSpreads(null,function(){}))}var e;compClasses.headerTextsize=Vue.component("headerTextsize",{data:function(){return{}},template:getTemplate("headers/headerTextSize.html"),mounted:function(){(compInstances.headerTextsize=this).init()},computed:{},methods:((e={}).init=function(){},e.backClicked=function(){inherited(this,"applyHeader",["default"])},e.plus=function(){var e=settings.getTextSize();30<e||(e=Math.round(10*(e+.1))/10,this.data.settings.textSize=e+"em",settings.updateTextSize(),settings.writeTextSize(),t.bind(this)())},e.minus=function(){var e=settings.getTextSize();e<=.2||(e=Math.round(10*(e-.1))/10,this.data.settings.textSize=e+"em",settings.updateTextSize(),settings.writeTextSize(),t.bind(this)())},e)})}(),compClasses.headerTts=Vue.component("headerTts",{data:function(){return{isPlaying:!1}},template:getTemplate("headers/headerTts.html"),mounted:function(){(compInstances.headerTts=this).init()},methods:{init:function(){},backClicked:function(){this.stopClicked()},nextClicked:function(){tts.nextParagraph()},prevClicked:function(){tts.prevParagraph()},pauseClicked:function(){tts.pause()},stopClicked:function(){$rootScope.renderScope.applyHeader("default"),tts.reset()},optionsClicked:function(){tts.showOptions()}},computed:{}}),compClasses.readerHeader=Vue.component("readerHeader",{data:function(){return{}},template:getTemplate("headers/readerHeader.html"),mounted:function(){(compInstances.readerHeader=this).init()},methods:{init:function(){}},computed:{header:function(){return inherited(this.$parent,"header")}}}),compClasses.ionCheckbox=Vue.component("ionCheckbox",{data:function(){return{}},template:getTemplate("ionic/ionCheckbox.html"),props:["value"],mounted:function(){(compInstances.ionCheckbox=this).init()},methods:{init:function(){},valChanged:function(e){this.$emit("input",e.target.checked),this.$emit("change",e.target.checked)}}}),function(){var t,c,l,d,u,e;compClasses.ionContent=Vue.component("ionContent",{data:function(){return{header:null,footer:null}},template:getTemplate("ionic/ionContent.html"),props:["scroll","autoscroll","overflowScroll","padding","hasHeader","hasFooter","panzoom","panContainerId","panResetVariable","delegateHandle"],mounted:function(){(compInstances.ionContent=this).init()},computed:{classArray:function(){var e=[];return e.push("scroll-content"),e.push(this.delegateHandle?"delegate-"+this.delegateHandle:null),e.push("overflow-scroll"),e.push(this.header?"has-header":""),e.push(this.footer?"has-footer":""),e},rtl:function(){return stg.data.settings.rtl}},watch:{},methods:((e={}).init=function(){this.header=this.hasHeader,this.footer=this.hasFooter,function(){for(var e=this.$el.parentNode,t=0;t<e.children.length;t++)null==this.header&&hasClass(e.children[t],"bar-header")&&(this.header=!0),null==this.footer&&hasClass(e.children[t],"bar-footer")&&(this.footer=!0)}.bind(this)(),function(){this.$el.addEventListener("touchstart",function(e){document.addEventListener("touchend",c=function(e){if(document.removeEventListener("touchend",c),1<e.touches.length)return;if(null==l)return;var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,o=l-t,i=d-n,r=(new Date).getTime()-u,a=o/r,s=function(){var e=1,t=document.getElementById("epubInner");if(!t)return e;var n=t.getBoundingClientRect().width;{var o;!t.parentNode.style.transform||(o=window.transform.parse(t.parentNode.style.transform)).scale&&(n*=o.scale)}var i=window.innerWidth/n;1<(e=.1+.9*i)&&(e=1);e=e||1;return e}();.35<Math.abs(a)*s&&r<500&&50<Math.abs(o)*s&&Math.abs(o)>Math.abs(i)&&this.$emit(0<o?"swipeLeft":"swipeRight");l=null}.bind(this)),l=e.touches[0].clientX,d=e.touches[0].clientY,u=(new Date).getTime(),!t||Math.abs(e.touches[0].clientX-t.clientX)<25&&Math.abs(e.touches[0].clientY-t.clientY)<25&&this.$emit("doubleTap");t=e.touches[0],setTimeout(function(){t=null},300)}.bind(this))}.bind(this)(),function(){var t=this;this.$el.addEventListener("scroll",function(e){t.$emit("scroll",e)})}.bind(this)()},e.getScrollProxy=function(){if(this.panzoom)return this.$children[0];var o=this.$el,e={getScrollPosition:function(){return{top:o.top,left:o.left,width:o.width,height:o.height}}};return e.getPosition=e.getScrollPosition,e.scrollTop=function(e){o.scrollTo(0,null)},e.scrollTo=function(e,t,n){o.scrollTo(e,t)},e.scrollBy=function(e,t,n){o.scrollBy(t,e,n)},e.resize=function(){},e.fitToWidth=function(){},e.fitToHeight=function(){},e},e)})}(),compClasses.ionDeleteButton=Vue.component("ionDeleteButton",{data:function(){return{}},template:getTemplate("ionic/ionDeleteButton.html"),mounted:function(){(compInstances.ionDeleteButton=this).init()},methods:{init:function(){}}}),compClasses.ionFooterBar=Vue.component("ionFooterBar",{data:function(){return{}},template:getTemplate("ionic/ionFooterBar.html"),mounted:function(){(compInstances.ionFooterBar=this).init()},methods:{init:function(){}}}),compClasses.ionHeaderBar=Vue.component("ionHeaderBar",{data:function(){return{}},template:getTemplate("ionic/ionHeaderBar.html"),mounted:function(){(compInstances.ionHeaderBar=this).init()},methods:{init:function(){}}}),compClasses.ionicLoading=Vue.component("ionicLoading",{data:function(){return{template:"",active:null}},template:getTemplate("ionic/ionicLoading.html"),mounted:function(){(compInstances.ionicLoading=this).init()},methods:{init:function(){},show:function(e){this.template=e.template,this.active=!0},hide:function(){this.active=!1}}}),compClasses.ionItem=Vue.component("ionItem",{data:function(){return{}},template:getTemplate("ionic/ionItem.html"),mounted:function(){(compInstances.ionItem=this).init()},methods:{init:function(){}}}),compClasses.ionList=Vue.component("ionList",{data:function(){return{}},template:getTemplate("ionic/ionList.html"),props:["scroll","overflowScroll"],mounted:function(){(compInstances.ionList=this).init()},methods:{init:function(){}}}),compClasses.ionPane=Vue.component("ionPane",{data:function(){return{}},template:getTemplate("ionic/ionPane.html"),mounted:function(){(compInstances.ionPane=this).init()},methods:{init:function(){}}}),compClasses.ionRefresher=Vue.component("ionRefresher",{data:function(){return{}},template:getTemplate("ionic/ionRefresher.html"),mounted:function(){(compInstances.ionRefresher=this).init()},methods:{init:function(){}}}),compClasses.ionSideMenu=Vue.component("ionSideMenu",{data:function(){return{width:null}},template:getTemplate("ionic/ionSideMenu.html"),mounted:function(){(compInstances.ionSideMenu=this).init()},props:["side"],computed:{directionClass:function(){return"menu-"+this.side},el:function(){return this.$el},menuWidth:function(){return this.width?this.width:$ionicSideMenuDelegate.menuWidth}},methods:{init:function(){this.width=$ionicSideMenuDelegate.menuWidth,mobile&&this.hide()},show:function(){this.$el.style.display=null},hide:function(){this.$el.style.display="none"}}}),compClasses.ionSideMenuContent=Vue.component("ionSideMenuContent",{data:function(){return{}},template:getTemplate("ionic/ionSideMenuContent.html"),mounted:function(){(compInstances.ionSideMenuContent=this).init()},methods:{init:function(){var e=this;mobile&&this.$el.addEventListener("transitionend",function(){e.$parent.sideMenuOpened||(e.$parent.left.hide(),e.$parent.right.hide())})},clicked:function(){$ionicSideMenuDelegate.isOpen()&&$ionicSideMenuDelegate.close()},getTransform:function(){return this.$el.style.transform},applyTransform:function(e){var t=this;t.$el.style.transform="translate3d("+e+"px, 0px, 0px)",mobile&&(t.$parent.left.show(),t.$parent.right.show()),0!=e&&(t.$parent.left.$el.style.zIndex=t.$parent.right.$el.style.zIndex=-1,0<e?t.$parent.left.$el.style.zIndex=0:t.$parent.right.$el.style.zIndex=0),setTimeout(function(){t.$parent.sideMenuOpened=!!e})}}}),compClasses.ionSideMenus=Vue.component("ionSideMenus",{data:function(){return{sideMenuOpened:null}},template:getTemplate("ionic/ionSideMenus.html"),mounted:function(){(compInstances.ionSideMenus=this).init()},destroyed:function(){this.destroyed()},computed:{left:function(){for(var e=0;e<this.$children.length;e++)if("left"==this.$children[e].side)return this.$children[e]},right:function(){for(var e=0;e<this.$children.length;e++)if("right"==this.$children[e].side)return this.$children[e]}},props:["delegateHandle"],methods:{init:function(){$ionicSideMenuDelegate.add(this.delegateHandle,this)},destroyed:function(){$ionicSideMenuDelegate.remove(this)}}}),compClasses.ionSpinner=Vue.component("ionSpinner",{data:function(){return{}},props:["icon"],template:getTemplate("ionic/ionSpinner.html"),mounted:function(){(compInstances.ionSpinner=this).init()},methods:{init:function(){}}}),compClasses.ionToggle=Vue.component("ionToggle",{data:function(){return{}},template:getTemplate("ionic/ionToggle.html"),props:["value","inline","transparent","small"],mounted:function(){(compInstances.ionToggle=this).init()},methods:{init:function(){},valChanged:function(e){this.$emit("input",e.target.checked),this.$emit("change",e.target.checked)}}}),function(){function a(e){var t=this;(e=e||{}).bid=this.bookInfoOptions.book.id,t.loadingReviews=!0,backend.getReviews(e,function(e){t.loadingReviews=!1,e&&!e.error&&(t.totalReviews=e.total,t.reviews=e.reviews,t.rating=e.rating,t.totalRating=e.totalRating?e.totalRating:0,$rootScope.$$phase||$rootScope.$apply())})}var e;compClasses.bookInfo=Vue.component("bookInfo",{data:function(){return{busy:null,loadingReviews:null,totalReviews:null,reviews:[],rating:null,totalRating:null,entryRating:null,bookInfoOptions:{}}},template:getTemplate("panels/bookInfo.html"),mounted:function(){(compInstances.bookInfo=this).init()},mixins:[closableModal],props:["pageview","book"],computed:{modal:function(){return stg.data.modal},views:function(){if(this.bookInfoOptions.book.stats)return this.bookInfoOptions.book.stats.views},downloads:function(){if(this.bookInfoOptions.book.stats)return this.bookInfoOptions.book.stats.downloads},deletable:function(){var e=this.bookInfoOptions.book.downloaded;return(desktop||native)&&(e=e&&!this.bookInfoOptions.book.prepackage),e}},methods:((e={}).init=function(){var e=this;e.pageview&&(e.data=stg.data,e.book.coverImg=stg.data.epub.bookThumb,e.book.coverStyle={"background-image":"url('"+e.book.coverImg+"')"},e.book.name=e.book.meta.dc.title,e.book.id=1,bookinfo.show({book:e.book,categoryClicked:e.categoryClicked},{noModal:!0}),$rootScope.$$phase||$rootScope.$apply()),this.bookInfoOptions=stg.data.modal.bookInfoOptions,config.kotobee.cloudid&&config.kotobee.reviews&&(e.loadingReviews=!0,setTimeout(function(){a.bind(e)({max:10})},2e3))},e.metaExists=function(e){return this.$options.filters.metaExists(e)},e.addBook=function(e){cart.add(e)},e.extractIsbn=function(e){return e=e&&e.replace("urn:isbn:","")},e.getAllReviews=function(){a.bind(this)({})},e.openRemotely=function(e){book.open(e,{openRemotely:!0})},e.open=function(e){book.open(e)},e.download=function(e){bookinfo.download(e)},e.filterDescription=function(e){var t=this.$options.filters;return e=t.unsafe(t.decodeHtmlEntities(t.nl2br(e))),mobile&&(e=t.nativeLinks(e)),e},e.actionBtnClicked=function(e,t){e.redirect?desktop?np.openLink(e.redirect):native&&crdv.openInNativeBrowser(e.redirect,!0):bookinfo.action(e,t)},e.deleteBook=function(e){bookinfo.delete(e)},e.update=function(e){bookinfo.update(e)},e.addToFav=function(e){bookinfo.addToFav(e)},e.copyURL=function(e){bookinfo.copyURL(e)},e.toggleFav=function(e){bookinfo.toggleFav(e)},e.removeFav=function(e){bookinfo.removeFav(e)},e.categoryClicked=function(e){modals.hide(),this.bookInfoOptions.categoryClicked(e)},e.redeemCodeClicked=function(){bookinfo.redeemCode()},e.backBtnClicked=function(e){bookinfo.prevStage()},e.toLoginScreen=function(){modals.hide();$location.path("/login")},e.selectRating=function(e){this.entryRating=e},e.submitReview=function(e){var t,n,o,i,r=this;config.kotobee.cloudid&&config.kotobee.reviews&&(t=e.target,n=t.parentNode.getElementsByTagName("textarea")[0],o=t.parentNode.getElementsByClassName("nameTxt")[0],(i={}).content=n.value,i.content&&(o&&(i.name=o.value),config.kotobee.reviewsrating&&(i.rating=r.entryRating),"library"===config.kotobee.mode&&(i.bid=this.bookInfoOptions.book.id),backend.addReview(i,function(e){return e.error?(modals.hide(),void modals.show({mode:"generalError",errorOptions:{msg:translit.get("s_reviewExists")}})):(n.value="",o&&(o.value=""),void a.bind(r)({max:10}))})))},e)})}(),Vue.component("bookInfoActionBtns",{data:function(){return{}},template:getTemplate("panels/bookInfoActionBtns.html"),mounted:function(){this.init()},computed:{bookInfoOptions:function(){return this.$parent.$parent.$parent.bookInfoOptions}},methods:{init:function(){},actionBtnClicked:function(){return this.$parent.$parent.$parent.actionBtnClicked.apply(this,arguments)},openRemotely:function(){return this.$parent.$parent.$parent.openRemotely.apply(this,arguments)},redeemCodeClicked:function(){return this.$parent.$parent.$parent.redeemCodeClicked.apply(this,arguments)}}}),Vue.component("bookInfoAuthor",{data:function(){return{}},computed:{book:function(){return this.$parent.bookInfoOptions.book}},template:getTemplate("panels/bookInfoAuthor.html"),mounted:function(){this.init()},methods:{init:function(){}}}),Vue.component("bookInfoBanner",{data:function(){return{bgOpacity:.9,overlay:!0,bookContentExists:!1,interactiveExists:!1,coverHeight:null,matchMedia:!1}},template:getTemplate("panels/bookInfoBanner.html"),mounted:function(){this.init()},computed:{getUrl:function(){return this.bookInfoOptions.book.coverStyle["background-image"].replace(/^url\('|"/,"").replace(/"|'\)$/,"")},bookInfoOptions:function(){return this.$parent.$parent.bookInfoOptions},busy:function(){return this.$parent.$parent.busy},views:function(){return this.$parent.$parent.views},loadingReviews:function(){return this.$parent.$parent.loadingReviews},rating:function(){return this.$parent.$parent.rating},totalRating:function(){return this.$parent.$parent.totalRating},downloads:function(){return this.$parent.$parent.downloads},bgImg:function(){if(this.overlay){if(this.bookInfoOptions.book.bannerStyle)return this.bookInfoOptions.book.bannerStyle;var e="linear-gradient(to bottom, rgba(67, 47, 71, "+this.bgOpacity+") 0%, rgba(52, 80, 97, "+(this.bgOpacity-.2)+") 100%)";return style="background-image:"+e,style+=",url('"+this.bookInfoOptions.book.coverImg+"');",style}return"background: #4e3359;"}},methods:{init:function(){this.handleCover()},handleCover:function(){this.matchMedia=600<=window.innerWidth;var e=this.$refs.section,t=e.getBoundingClientRect();this.coverHeight=e&&t?t.height+20+20:null,this.coverHeight<180&&(this.coverHeight=180)},metaExists:function(){return this.$parent.$parent.metaExists.apply(this,arguments)},toggleFav:function(){return this.$parent.$parent.toggleFav.apply(this,arguments)},copyURL:function(){return this.$parent.$parent.copyURL.apply(this,arguments)}}}),Vue.component("bookInfoMeta",{data:function(){return{}},template:getTemplate("panels/bookInfoMeta.html"),mounted:function(){this.init()},computed:{bookInfoOptions:function(){return this.$parent.$parent.bookInfoOptions},pageview:function(){return this.$parent.$parent.pageview},deletable:function(){return this.$parent.$parent.deletable},reviews:function(){return this.$parent.$parent.reviews}},methods:{init:function(){},toLoginScreen:function(){return this.$parent.$parent.toLoginScreen.apply(this,arguments)},update:function(){return this.$parent.$parent.update.apply(this,arguments)},deleteBook:function(){return this.$parent.$parent.deleteBook.apply(this,arguments)},filterDescription:function(){return this.$parent.$parent.filterDescription.apply(this,arguments)},categoryClicked:function(){return this.$parent.$parent.categoryClicked.apply(this,arguments)},metaExists:function(){return this.$parent.$parent.metaExists.apply(this,arguments)},extractIsbn:function(){return this.$parent.$parent.extractIsbn.apply(this,arguments)},getDate:function(e){return e.replace(/t.*/gi,"")}}}),Vue.component("bookInfoReviews",{data:function(){return{reviewsNum:0,finalRate:0,canShowReviewForm:!1}},template:getTemplate("panels/bookInfoReviews.html"),mounted:function(){this.init()},computed:{bookInfoOptions:function(){return this.$parent.$parent.bookInfoOptions},totalRating:function(){return this.$parent.$parent.totalRating},reviews:function(){return this.$parent.$parent.reviews},totalReviews:function(){return this.$parent.$parent.totalReviews},loadingReviews:function(){return this.$parent.$parent.loadingReviews},rating:function(){return this.$parent.$parent.rating}},watch:{loadingReviews:function(e,t){return!config.kotobee.reviewslocked&&(stg.data.user&&stg.data.user.loggedIn||config.kotobee.reviewspublic)?void(this.canShowReviewForm=!0):this.canShowReviewForm=!1},totalRating:function(){this.reviewsNum=this.reviews.filter(function(e){var t=e.content.trim();return""!==t||null!==t}).length;var t={star1:[],star2:[],star3:[],star4:[],star5:[]};this.reviews.forEach(function(e){1===e.rating?t.star1.push(!0):2===e.rating?t.star2.push(!0):3===e.rating?t.star3.push(!0):4===e.rating?t.star4.push(!0):5===e.rating&&t.star5.push(!0)});var e=(5*t.star5.length+4*t.star4.length+3*t.star3.length+2*t.star2.length+ +t.star1.length)/(t.star5.length+t.star4.length+t.star3.length+t.star2.length+t.star1.length);this.finalRate=e?e.toFixed(1):""}},methods:{init:function(){},selectRating:function(){return this.$parent.$parent.selectRating.apply(this,arguments)},submitReview:function(){return this.$parent.$parent.submitReview.apply(this,arguments)},getAllReviews:function(){return this.$parent.$parent.getAllReviews.apply(this,arguments)}}}),function(){var e;compClasses.bookSettings=Vue.component("bookSettings",{data:function(){return{webWatermarkPlaceholder2:"",navAnims:[{label:"flip",val:"navBookBlock"},{label:"card",val:"navFlip"},{label:"slide",val:"navSlide"},{label:"stack",val:"navStack"},{label:"fade",val:"navFade"}],navModes:[{label:"vertical",val:"vertical"},{label:"horizontal",val:"horizontal"}],viewModes:[{label:"auto",val:"auto"},{label:"singlePage",val:"single"},{label:"doublePage",val:"double"}]}},template:getTemplate("panels/bookSettings.html"),mounted:function(){(compInstances.bookSettings=this).init()},methods:((e={init:function(){},stylingChanged:function(){$timeout(settings.stylingChanged,300)},navAnimChanged:function(){settings.saveSettings()},viewModeChanged:function(){$timeout(settings.viewModeChanged,300),stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings)},navModeChanged:function(){settings.saveSettings()},lineAdjustChanged:function(){$timeout(settings.lineAdjustChanged,300)},singlePageScrollChanged:function(){$timeout(settings.viewModeChanged,300)},editFontSize:function(){inherited(this,"applyHeader",["textSize"]),$ionicSideMenuDelegate.close()},langChanged:function(){$ionicSideMenuDelegate.close(),$timeout(settings.langChanged,500)},sync:function(){$ionicSideMenuDelegate.close(),settings.sync()},fullscreen:function(){$ionicSideMenuDelegate.close(),nav.fullscreen()},share:function(){modals.show({mode:"share",dynamic:!0,animation:"slide-in-up"})},logout:function(){$ionicSideMenuDelegate.close(),backend.logout()},about:function(){this.openAuthorWebsite()},exit:function(){modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},profileClicked:function(e){modals.show({mode:"profile",dynamic:!0,scope:this,animation:"slide-in-up"})}}).settingsClose=function(){modals.hide(),stg.writeSlot("settings"+stg.getBookId(!0),e.data.settings)},e.closePanel=function(){$ionicSideMenuDelegate.close()},e)})}(),compClasses.cart=Vue.component("cart",{data:function(){return{paying:null}},template:getTemplate("panels/cart.html"),mixins:[closableModal],mounted:function(){(compInstances.cart=this).init()},computed:{currency:function(){return cart.currency},paymentOptions:function(){return payment.initialize(config.kotobee.payment)}},methods:{init:function(){},addBook:function(e){cart.add(e)},removeBook:function(e){cart.remove(e)},showCart:function(){cart.show()},showCheckout:function(){cart.checkout()},backToCart:function(){cart.back()},getTotalPrice:function(){return cart.getTotalPrice()},makePayment:function(e){"library"==config.kotobee.mode&&cart.pay(e)}}}),compClasses.chapters=Vue.component("chapters",{data:function(){return{header:{mode:"default"}}},template:getTemplate("panels/chapters.html"),computed:{bookThumb:function(){return stg.data.epub.bookThumb?stg.data.epub.bookThumb:(config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png"}},mounted:function(){(compInstances.chapters=this).init()},methods:{init:function(){},closePanel:function(){stg.data.widescreen=!1,removeClass(document.body,"widescreen"),$ionicSideMenuDelegate.close(),stg.data.widescreen&&Vue.nextTick(nav.fxlZoomFit)},showBookInfo:function(){inherited(this.$parent,"showBookInfo")},gotoPageClicked:function(e){inherited(this.$parent,"gotoPageClicked",[e])},metaExists:function(e){return this.$options.filters.metaExists(e)}}}),compClasses.checkout=Vue.component("checkout",{data:function(){return{}},template:getTemplate("panels/checkout.html"),extends:compClasses.cart,mounted:function(){(compInstances.checkout=this).init()},methods:{init:function(){},getPaymentStyle:function(e){return{backgroundImage:"url("+(e.logo?e.logo:"")+")"}}}}),compClasses.closable=Vue.component("closable",{data:function(){return{}},mounted:function(){compInstances.closable=this},methods:{init:function(){},hideModal:function(){modals.hide()}}}),compClasses.hlight=Vue.component("hlight",{data:function(){return{}},template:getTemplate("panels/hlight.html"),mounted:function(){(compInstances.hlight=this).init()},mixins:[closableModal],computed:{modal:function(){return stg.data.modal}},methods:{init:function(){}}}),compClasses.loginPanel=Vue.component("loginPanel",{data:function(){return{header:{mode:"default"}}},template:getTemplate("panels/loginPanel.html"),mounted:function(){(compInstances.loginPanel=this).init()},mixins:[closableModal],computed:{modal:function(){return stg.data.modal},ssoBusy:function(){return stg.data.sso&&stg.data.sso.ssoBusy}},methods:{init:function(){},emit:function(e,t){vueApp.$emit(e,t)}}}),compClasses.media=Vue.component("media",{data:function(){return{}},template:getTemplate("panels/media.html"),mounted:function(){(compInstances.media=this).init()},methods:{init:function(){},mediaClicked:function(e){media.show(e)},hide:function(){media.hide()}}}),compClasses.miniapps=Vue.component("miniapps",{data:function(){return{editing:null}},template:getTemplate("panels/miniapps.html"),mounted:function(){(compInstances.miniapps=this).init()},methods:{init:function(){},miniappClicked:function(e){kMiniapps.openFromMenu(e)}}}),function(){function n(){if(config.htmlInNotes){var e=document.getElementById("noteTextArea");if(!e)return setTimeout(function(){n()},30);(t=new Quill(e,{theme:"snow"})).clipboard.dangerouslyPasteHTML(0,o.note?o.note.note:"")}}var o,t,e;compClasses.note=Vue.component("note",{data:function(){return{editing:null}},template:getTemplate("panels/note.html"),mounted:function(){(compInstances.note=this).init()},extends:compClasses.closable,computed:{modal:function(){return stg.data.modal}},methods:((e={}).init=function(){var t=this;if(o=stg.data.modal.noteOptions,config.htmlInNotes){var e=document.getElementById("noteTextArea");if(!e||e.children.length)return;setTimeout(n)}setTimeout(function(){var e;!t.$el.length||(e=t.$el.getElementsByClassName("previousNotes")).length&&(e[0].scrollTop=e[0].scrollHeight)},100)},e.save=function(e){config.htmlInNotes&&(e.note=t.container.children[0].innerHTML),o.save(e)},e.remove=function(e){o.delete(e)},e.edit=function(e){this.editing==e&&(e=null),this.editing=e,o.note=e,config.htmlInNotes&&(o.note?t.clipboard.dangerouslyPasteHTML(0,o.note.note):t.setText(""))},e.noteEntryStyle=function(e,t){var n=[];return t==e&&n.push("editing"),e.public?(n.push("public"),((e.uid=stg.data.user.id)||stg.data.user.perms&&stg.data.user.perms.globaldata)&&n.push("mine"),n.push("hasAvatar")):n.push("mine"),n.join(" ")},e)})}(),function(){var s;compClasses.notebook=Vue.component("notebook",{data:function(){return{loadingMoreNotes:null,bookmarkContent:null,noteContent:null,hlightContent:null,notebook:null,noteBtns:{notes:!0,bookmarks:!0,hlights:!0}}},computed:{hasResults:function(){return stg.data.notebookContent&&stg.data.notebookContent.results&&stg.data.notebookContent.results.length}},template:getTemplate("panels/notebook.html"),mounted:function(){(compInstances.notebook=this).init()},methods:((s={init:function(){this.update()},arrayEmpty:function(e){return this.$options.filters.arrayEmpty(e)},update:function(){annotations.updateNotebookArray({},function(){Vue.nextTick(function(){})})},notebookClose:function(){modals.hide(),this.bookmarkContent=null,this.noteContent=null,this.hlightContent=null,this.notebook={}},noteBtnClicked:function(e,t,n){n&&n.stopPropagation(),"all"==e?t.notes=t.bookmarks=t.hlights=!(t.notes&&t.bookmarks&&t.hlights):(t.notes=t.bookmarks=t.hlights=!1,t[e]=!0),overflowScroll?document.getElementById("notebookContent").scrollTop=0:$ionicScrollDelegate.$getByHandle("notebookScroll").scrollTop()},pdfExport:function(t,n){t&&t.stopPropagation&&t.stopPropagation();var e=this.serializeNotebookHtml(),o=(stg.data.book.meta.dc.title?stg.data.book.meta.dc.title:translit.get("book"))+".pdf";$timeout(function(){crdv.createPDF(e,o,function(e){e.error?n&&n({error:!0,event:t}):e.success&&n&&n({success:!0})})},500)}}).exportPdfOptimized=function(e){var i=document.getElementsByClassName("perspectiveContainer")[0],r=document.getElementById("nextPage"),a=document.getElementById("prevPage");e&&e.error&&i&&r&&a&&(r.remove(),a.remove(),s.pdfExport(e.event,function(e){var t,n,o;i.append(r),i.append(a),e&&(e.success||e.error&&(t=e,!(o=document.getElementById("spreadL"))||(n=o.querySelector("section.k-section.parsed"))&&(n.remove(),s.pdfExport(t.event,function(e){o.append(n),e&&e.success}))))}))},s.loadAllNotebook=function(e){var t=this;e&&e.stopPropagation(),t.loadingMoreNotes=!0,annotations.sync({all:!0},function(e){annotations.updateNotebookArray({},function(){t.loadingMoreNotes=!1,$rootScope.$$phase||$rootScope.$apply()})})},s.serializeNotebookHtml=function(){var e="<br/>",t='<html><head><meta charset="UTF-8" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body>';t+='<div id="container">',t+=c([translit.get("notebookFor"),' "'+stg.data.book.meta.dc.title+'"'],"h1","style='font-size:22px'"),t+="<hr/>";for(var n=stg.data.notebookContent.results,o=0;o<n.length;o++)if(n[o]){var i="";i+=c(book.getTitleByIndex(o),"h2",'style="font-size:18px;margin: 16px 0 3px;"')+e;for(var r=0;r<n[o].length;r++){var a=n[o][r],s="";null!=a.nid?"page"==a.type?s+=c([translit.get("pageNote")+": ",a.note.replace(/(?:\r\n|\r|\n)/g,"<br/>")],"div","style='font-weight:bold'")+e:"content"==a.type&&(s+=c([translit.get("noteFor"),' "'+a.src+'"'],"p","style='font-weight:bold;margin: 8px 0;'"),a.note.includes("<img ")&&(a.note=a.note.replace(/\sstyle="(.*?)"/,""),a.note=a.note.replace(/\sclass="(.*?)"/,""),a.note=a.note.replace("<img ",'<img height="100"')),s+=c([a.note],"div","style='border: solid 1px #ddd;;border-radius: 5px;padding: 10px;'")+e):null!=a.hid?s+=c([translit.get("highlight"),': "'+a.src+'"'],"div",'style="background-color:'+a.color+'"')+e:null!=a.bmid&&(s+=c([translit.get("contentBookmark")],"div")+e),i+=c([s],"div")}t+=c([i],"div",'style=""')}function c(e,t,n){for(var o="",i=0;i<e.length;i++)o+=e[i];return"<"+t+(n?" "+n:"")+">"+o+"</"+t+">"}return t+="</div>",t+="</body></html>"},s.shareNotebook=function(){var e=this.serializeNotebookTxt();crdv.share(e)},s.serializeNotebookTxt=function(){for(var e="\n",t=translit.get("notebookFor")+' "'+stg.data.book.meta.dc.title+'"'+e,n=t.length;n--;)t+="#";t+="\n\n";for(var o=stg.data.notebookContent.results,i=0;i<o.length;i++)if(o[i]){var r=translit.get("chapter")+" "+(i+1);t+=r+e;for(n=r.length;n--;)t+="_";t+="\n\n";for(var a=0;a<o[i].length;a++){var s=o[i][a];null!=s.nid?"page"==s.type?t+=translit.get("pageNote")+": "+s.note+e:"content"==s.type&&(s.src?t+=translit.get("noteFor")+' "'+s.src+'"'+e:t+=translit.get("note")+e,t+=translit.get("note")+": "+s.note+e):null!=s.hid?(t+=translit.get("highlightFor")+' "'+s.src+'"'+e,t+=translit.get("highlightColor")+" "+s.color+e):null!=s.bmid&&(t+=translit.get("contentBookmark")+e),t+="........................\n\n"}}return t},s.deleteFromNotebookContent=function(e,t){for(var n=stg.data.notebookContent.results,o=0;o<n.length;o++)if(n[o])for(var i=0;i<n[o].length;i++)if(n[o][i][e]==t)return n[o].splice(i,1),void(n[o].length||n.splice(o,1))},s.noteItemClicked=function(e){var t=e.chapter,n=e.location,n=String(n).split(",")[0];n=String(n).split("-")[0],modals.hide(),$timeout(function(){chapters.redirect(t,{hash:n})},100)},s.deleteNote=function(e,t){var n=this;notes.confirmDeletion(function(){notes.delete(e,null,function(e){n.noteContent=e,$rootScope.$$phase||$rootScope.$apply()})}),t.stopPropagation()},s.deleteBookmark=function(t,e){var n=this;bookmarks.confirmDeletion(function(){bookmarks.delete(t,null,function(e){n.bookmarkContent=e,selection.deleteBookMarker(t),n.deleteFromNotebookContent("bmid",t),$rootScope.$$phase||$rootScope.$apply()})}),e&&e.stopPropagation()},s.deleteHlight=function(t,e){var n=this;hlights.confirmDeletion(function(){hlights.delete(t,null,function(e){n.hlightContent=e,n.deleteFromNotebookContent("hid",t),$rootScope.$$phase||$rootScope.$apply()})}),e.stopPropagation()},s.chaptersHaveSomething=function(){for(var e=0;e<stg.data.notebookContent.results.length;e++)if(this.chapterHasSomething(stg.data.notebookContent.results[e]))return!0},s.chapterHasSomething=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];if(n.bmid&&this.noteBtns.bookmarks)return!0;if(n.nid&&this.noteBtns.notes)return!0;if(n.hid&&this.noteBtns.hlights)return!0}},s)})}(),compClasses.popoverCornerList=Vue.component("popoverCornerList",{data:function(){return{test:"ok"}},template:getTemplate("panels/popoverCornerList.html"),mounted:function(){(compInstances.popoverCornerList=this).init()},computed:{},methods:{init:function(){}}}),compClasses.popoverLibraryMenu=Vue.component("popoverLibraryMenu",{data:function(){return{test:"ok"}},template:getTemplate("panels/popoverLibraryMenu.html"),mounted:function(){(compInstances.popoverLibraryMenu=this).init()},computed:{},methods:{init:function(){}}}),compClasses.popoverList=Vue.component("popoverList",{data:function(){return{test:"ok"}},template:getTemplate("panels/popoverList.html"),mounted:function(){(compInstances.popoverList=this).init()},computed:{},methods:{init:function(){}}}),function(){var n,e;compClasses.profile=Vue.component("profile",{data:function(){return{model:{},ui:{},tab:"info",saving:null,user:null,fields:null,activity:null,payments:null,resetPwd:null,passwordObj:{isLoading:!1,current:{valid:!0,password:null},new:{valid:!0,password:null},confirm:{valid:!0,password:null}}}},template:getTemplate("panels/profile.html"),mounted:function(){(compInstances.profile=this).init()},mixins:[closableModal],methods:((e={}).init=function(){var t=this;if(!n){for(var e in n=!0,t.user=stg.data.user,t.fields=0,config.kotobee.registrationsettings)t.fields++;backend.getUserProfile({},function(e){e&&e.info&&(t.user=e.info,t.user.dob&&(t.user.dob=phpDateToJS(t.user.dob)),t.activity=e.activity,t.payments=e.payments)}),setTimeout(function(){n=!1},2e3)}},e.setTab=function(e){this.tab=e},e.updateInfo=function(){var t=this;t.saving=!0;var e=Object.assign({},t.user);backend.updateProfile(e,function(e){t.saving=!1,e&&!e.error||inherited(t.$parent,"hideModal")})},e.resetPassword=function(){var e,t=this;this.passwordObj.current.password?this.passwordObj.current.valid=!0:this.passwordObj.current.valid=!1,this.passwordObj.new.password?this.passwordObj.new.valid=!0:this.passwordObj.new.valid=!1,this.passwordObj.new.password!==this.passwordObj.confirm.password?this.passwordObj.confirm.valid=!1:this.passwordObj.confirm.valid=!0,this.passwordObj.current.valid&&this.passwordObj.new.valid&&this.passwordObj.confirm.valid&&(this.passwordObj.isLoading=!0,e={oldpwd:this.passwordObj.current.password,newpwd:this.passwordObj.new.password,newpwdconfirm:this.passwordObj.confirm.password},backend.sendRawPost(config.kotobee.liburl+"user/changepwd",e,{responseType:"json"},function(e){t.passwordObj.isLoading=!1,kotobee.popup(translit.get(e.error?e.error:"pwdChanged"),{okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){e.error||(t.hideModal(),setTimeout(function(){if("book"==config.kotobee.mode)return backend.logout()},500))}})}))},e)})}(),function(){function r(e){e=e||this.profiles;for(var t=[],n=0;n<e.length;n++){var o={};o.name=e[n].name,o.mode=e[n].mode,o.liburl=e[n].liburl,o.cloudid=e[n].cloudid,o.hostPath=e[n].hostPath,o.locked=e[n].locked,t.push(o)}stg.writeSlot("sdkProfiles",t,function(){})}function e(e){hasParentWithId(e.target,"sdkProfiler",50)||hasParent(e.target,"modal",50)||this.close()}var a,t,n;compClasses.sdk=Vue.component("sdk",{data:function(){return{expanded:null,profiles:[],useProfiles:null,newProfile:null,addingProfile:null}},template:getTemplate("panels/sdk.html"),mounted:function(){(compInstances.sdk=this).init()},computed:{},methods:(n={name:"Local book",mode:"book",locked:!0,liburl:"http://dev.kotobee.com/"},(t={}).init=function(){debug||this.$el.parentNode.removeChild(this.$el)},t.profilerClicked=function(){this.expanded?this.close():this.open(),function(){var t=this;stg.readSlot("sdkProfiles",function(e){e&&e.length||(e=[clone(n)]),t.profiles=e}),stg.readSlot("sdkProfilesEnabled",function(e){t.useProfiles=e})}()},t.toProfiles=function(){this.$el.getElementsByClassName("profiles")[0].scrollIntoViewIfNeeded()},t.open=function(){this.expanded=!0,document.addEventListener("click",e)},t.close=function(){this.expanded=!1,document.removeEventListener("click",e)},t.lockedProfileClicked=function(e){modals.show({mode:"generalError",errorOptions:{msg:"The default profile is always locked. You can never delete it."}})},t.delProfile=function(t){var n,e,o,i=this;a||(modals.hide(),e={label:"delete",style:"button-assertive",func:function(){n.dontAskChecked&&(a=!0),modals.hide();for(var e=0;e<i.profiles.length;e++)if(t==i.profiles[e])return i.profiles.splice(e,1),void r()}},o={label:"cancel",func:function(){n.dontAskChecked&&(a=!0),modals.hide()}},(n={title:"Confirmation",msg:"Are you sure you want to delete this profile?",barStyle:"bar-dark"}).dontAsk=!0,n.btns=[e,o],modals.show({mode:"confirm",confirmOptions:n}))},t.editProfile=function(e){Vue.set(e,"editing",!0)},t.saveEditedProfile=function(e){r(),Vue.set(e,"editing",!1)},t.cancelEditingProfile=function(e){Vue.set(e,"editing",!1)},t.cancelNewProfileForm=function(){this.addingProfile=!1},t.showNewProfileForm=function(){this.newProfile={mode:"book",liburl:"http://dev.kotobee.com/",cloudid:null},this.addingProfile=!0},t.addProfile=function(e){e.hostType=e.hostPath?"kotobee":null,e.name||(e.name="Untitled profile"),this.profiles.push(e),r(),this.addingProfile=!1},t.useProfilesChanged=function(){stg.writeSlot("sdkProfilesEnabled",this.useProfiles,function(){})},t.connect=function(e){modals.hide();var t={title:"Confirmation",msg:"Restart the reader?",barStyle:"bar-dark"},n={label:"Restart",style:"button-balanced",func:function(){modals.hide(),stg.writeSlot("sdkProfile",e,function(){setTimeout(function(){location.reload()},300)})}},o={label:"cancel",func:function(){modals.hide()}};t.btns=[n,o],modals.show({mode:"confirm",confirmOptions:t})},t)})}(),compClasses.sdkProfileForm=Vue.component("sdkProfileForm",{data:function(){return{}},template:getTemplate("panels/sdkProfileForm.html"),mounted:function(){(compInstances.sdkProfileForm=this).init()},props:["profile","cancel","save"],computed:{},methods:{init:function(){}}}),compClasses.search=Vue.component("search",{data:function(){return{srchOb:{enabled:!1},modal:{scope:compInstances.reader},key:null,searchStack:[],searchContent:{results:null,more:null,key:null,notEmpty:null},isExactWord:!1,isMatchCase:!1}},mixins:[closableModal],template:getTemplate("panels/search.html"),mounted:function(){(compInstances.search=this).init()},computed:{},methods:{init:function(){},search:function(e,n,t,o){var i=this;if(e&&e.length&&0!=e.length){if(e.length<3)return kError.update({error:"lessThan3Characters"}),void modals.hide();compInstances.reader.applyHeader("default"),null==t&&(i.searchStack=[0]),kStatus.update(translit.get("searching"),null,{dots:!0,timeoutDuration:6e4}),n||(n="all",t=t||0);var r={key:e,mode:n,limit:40,start:t,array:o,isExactWord:i.isExactWord,isMatchCase:i.isMatchCase};$timeout(function(){search.start(r,function(e){kStatus.update(null),i.searchContent=e;for(var t=0;t<i.searchContent.results.length;t++)if(i.searchContent.results[t]&&i.searchContent.results[t].matches.length){i.searchContent.notEmpty=!0;break}"all"==n?(i.$broadcast("scroll.infiniteScrollComplete"),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop()):"chapter"==n&&$timeout(function(){compInstances.reader.applyHeader("searchItems")},500)})},500)}},searchMore:function(){for(var e,t=this.searchContent.results.length;t--;)if(this.searchContent.results[t]&&this.searchContent.results[t].matches[0]){e=this.searchContent.results[t].matches[0];break}e?(this.searchStack.push(e.chapter+1),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop(),this.search(this.searchContent.key,"all",e.chapter+1)):this.searchContent.more=!1},searchBack:function(){var e;this.searchStack.length<=1||(this.searchStack.pop(),e=this.searchStack.pop(),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop(),this.search(this.searchContent.key,"all",e))},locateInChapter:function(e){modals.hide(),this.search(e,"chapter")},clearResults:function(){this.searchContent={},compInstances.reader.applyHeader("default"),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop()},searchItemClicked:function(e){search.searchItemClicked(e,{timer:!0},function(){compInstances.reader.applyHeader(""),$timeout(function(){compInstances.reader.applyHeader("searchItems"),$rootScope.$$phase||$rootScope.$apply()})})}}}),function(){function t(){var e={};e.url=window.location.href,this.options.bookAuthor&&(e.creator=stg.data.book.meta.dc.creator),e.language=stg.data.book.meta.dc.language,this.options.bookPublisher&&(e.publisher=stg.data.book.meta.dc.publisher),this.options.bookTitle&&(e.title=stg.data.book.meta.dc.title),e.iconUrl=stg.data.epub.bookThumb,isAbsoluteURLPath(e.iconUrl)||(e.iconUrl=window.location.origin+"/"+e.iconUrl),e.url=this.shareLink,e.iconUrl=e.url+stg.data.epub.bookThumb,this.options.bookDescription&&(e.description=stg.data.book.meta.dc.description),e.lang=stg.data.settings.language;var t="";return t+="\x3c!-- Kotobee Embed Code --\x3e\n",t+="<script data-props='"+encodeURI(JSON.stringify(e))+'\' type="text/javascript" src="'+(config.kotobee.liburl||"https://www.kotobee.com/")+'js/kembed.js?v=1"><\/script>\n',t+="\x3c!-- --\x3e\n"}var e;compClasses.share=Vue.component("share",{data:function(){return{options:{bookTitle:!0},currentTab:"embed",shareLink:null,embedCode:null,twitterLink:null,fbLink:null,whatsappLink:null}},template:getTemplate("panels/share.html"),mounted:function(){(compInstances.share=this).init()},computed:{},methods:((e={}).init=function(){var e=this;e.options={bookTitle:!0},e.currentTab="embed",e.shareLink=window.location.href.split("#")[0],e.shareLink.endsWith("/")||(e.shareLink+="/"),e.embedCode=t.bind(this)(),e.twitterLink="https://twitter.com/share?url="+e.shareLink,e.fbLink="https://www.facebook.com/sharer.php?u="+e.shareLink,e.whatsappLink="whatsapp://send?text="+e.shareLink},e.embedCodeClicked=function(){var e=this.$el.getElementsByClassName("embedCode");e.length&&e[0].select()},e.shareLinkClicked=function(){var e=this.$el.getElementsByClassName("shareLink");e.length&&e[0].select()},e.optionChanged=function(){this.updateEmbedCode()},e.copyEmbedCode=function(){selection.copyToClipboard(this.embedCode,!0)},e.copyLink=function(){selection.copyToClipboard(this.shareLink,!0)},e.openTab=function(e){this.currentTab=e},e.shareClose=function(){modals.hide()},e.updateEmbedCode=function(){this.embedCode=t.bind(this)()},e)})}(),compClasses.sidePanel=Vue.component("sidePanel",{data:function(){return{editing:null}},template:getTemplate("panels/sidePanel.html"),computed:{sideMenuMode:function(){return inherited(this.$parent,"sideMenuMode")}},mounted:function(){(compInstances.sidePanel=this).init()},methods:{init:function(){},close:function(){$ionicSideMenuDelegate.close()}}}),compClasses.tabMenu=Vue.component("tabMenu",{data:function(){return{}},template:getTemplate("panels/tabMenu.html"),mounted:function(){(compInstances.tabMenu=this).init()},computed:{currentChapter:function(){return stg.data.book?stg.data.book.chapter:{}},contentRtl:function(){return book.isRtl()}},methods:function(){var e={};function n(e){inherited(this,"setSideMenuMode",[e])}e.init=function(){var t=this;t.$watch(function(){return $ionicSideMenuDelegate.isOpenRight()},function(e){e||$timeout(function(){n.apply(t,["bookSettings"])},100)})},e.chaptersClicked=function(){chapters.displayChapters()},e.mediaClicked=function(){if(stg.data.settings.rtl){if($ionicSideMenuDelegate.isOpenLeft()&&"media"!=inherited(this,"sideMenuMode"))return $ionicSideMenuDelegate.toggleLeft(),void $timeout(this.mediaClicked,300)}else if($ionicSideMenuDelegate.isOpenRight()&&"media"!=inherited(this,"sideMenuMode"))return $ionicSideMenuDelegate.toggleRight(),void $timeout(this.mediaClicked,300);native&&crdv.vibrate(),n.apply(this,["media"]),mobile&&nav.resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},e.notebookClicked=function(e){if(!(e=e||{}).popupOnly&&stg.data.widescreen)return compInstances.notebook.update(),this.chaptersClicked();notes.notebookClicked(this)},e.pdfClicked=function(){chapters.convertPDF()},e.printClicked=function(){chapters.print()},e.shareClicked=function(){modals.show({mode:"share",dynamic:!0,animation:"slide-in-up"})},e.settingsClicked=function(){if(stg.data.settings.rtl){if($ionicSideMenuDelegate.isOpenLeft()&&"bookSettings"!=inherited(this,"sideMenuMode"))return $ionicSideMenuDelegate.toggleLeft(),void $timeout(this.settingsClicked,300)}else if($ionicSideMenuDelegate.isOpenRight()&&"bookSettings"!=inherited(this,"sideMenuMode"))return $ionicSideMenuDelegate.toggleRight(),void $timeout(this.settingsClicked,300);native&&crdv.vibrate(),n.apply(this,["bookSettings"]),mobile&&nav.resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},e.searchClicked=function(e){var t=this;native&&crdv.vibrate(),mobile&&nav.resize(),modals.show({mode:"search",dynamic:!0,animation:"slide-in-up",scope:t,cb:function(){t.searchContent.notEmpty||$timeout(function(){crdv.showKeyboard()},200),e&&e()}})};var l=[];return e.customTabClicked=function(e,t){var n=document.createElement("div");if(e.relToRoot=!0,"audio"==e.type){var o,i=cleanURL(i=ph.join(bookPath,e.audio));e.id||(e.id=Math.round(1e4*Math.random()));for(var r,a,s=0;s<l.length;s++){if(l[s].getAttribute("id")=="audio-"+e.id&&!(o=l[s]).paused)return o.pause(),void(o.src="");l[s].paused||(l[s].pause(),l[s].src="")}o||((o=document.createElement("audio")).setAttribute("data-dontclose",!0),o.setAttribute("id","audio-"+e.id),o.setAttribute("controls","true"),o.setAttribute("autoplay","true"),o.setAttribute("data-tap-disabled","false"),(r=document.createElement("source")).src=i,o.appendChild(r),o.appendChild(document.createTextNode("Your browser does not support the audio element")),o.className="ki-noHighlight",o.oncanplay=function(){kInteractive.tinCan({verb:"played",activity:"Audio: "+i})}),o.setAttribute("src",i),o.play(),l.push(o),kInteractive.scorm&&((a={}).id=kInteractive.getScormId(e.title,i),a.description="Played audio link: "+i,a.type="other",a.learnerResponses="Played",a.objective=e.options?e.options.objective:null,a.timestamp=new Date,kInteractive.scorm.setInteractions([a])),kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:i,elem:o})}else{kInteractive.writeData(n,e);var c=e.url;if(e.hash&&(c+=e.hash),n.className="kInteractive link",!c)return kInteractive.action(n,t),void t.stopPropagation();c&&n.setAttribute("href",c),e.target&&"_blank"==e.target.toLowerCase()&&n.setAttribute("target","_BLANK"),c.match(/http[s]?:/g)?$rootScope.renderScope.externalLink(n):0==c.indexOf("/")?window.open(c):0==c.indexOf("mailto:")?window.location.href=c:(0!=c.indexOf("#")&&(c=ph.join(stg.data.book.chapter.url,c)),chapters.applyChapterStateFromURL(c))}},e.nextChapter=function(){inherited(this.$parent,"nextChapter")},e.prevChapter=function(){inherited(this.$parent,"prevChapter")},e}()}),compClasses.modals=Vue.component("modals",{data:function(){return{test:"ok"}},template:getTemplate("system/modals.html"),mounted:function(){(compInstances.modals=this).init()},computed:{modalName:function(){if(stg.data.modal.mode)return this.getComponentName()+"Modal"},modalTemplate:function(){if(stg.data.modal.mode)return getTemplate("panels/"+stg.data.modal.mode+".html")},componentDef:function(){var e=this.getComponentName();return compClasses[e]?compClasses[e]:{name:this.modalName,template:this.modalTemplate,mounted:this.modalMounted,mixins:[closableModal],computed:{modal:function(){return stg.data.modal}},methods:{}}}},filters:{firstLetterSmall:function(e){if(e)return e[0].toLowerCase()+e.substr(1)}},methods:{init:function(){},modalMounted:function(){},getComponentName:function(){return stg.data.modal.mode.replace(/(.*?)\//g,"")},backdropClicked:function(e){e.target&&hasClass(e.target,"modal-backdrop")&&modals.hide()},mounted:function(){if(stg.data.modal._cb)return stg.data.modal._cb()},destroyed:function(){if(stg.data.modal._hiddenCb)return stg.data.modal._hiddenCb()}}}),compClasses.popovers=Vue.component("popovers",{data:function(){return{}},template:getTemplate("system/popovers.html"),mounted:function(){(compInstances.popovers=this).init()},computed:{popoverName:function(){if(stg.data.popover.mode)return this.getComponentName()+"Popover"},popoverTemplate:function(){if(stg.data.popover.mode)return getTemplate("panels/"+stg.data.popover.mode+".html")},componentDef:function(){var e=this.getComponentName();return compClasses[e]?compClasses[e]:{name:this.popoverName,template:this.popoverTemplate,mounted:this.popoverMounted,computed:{popover:function(){return stg.data.popover}},methods:{}}}},filters:{firstLetterSmall:function(e){if(e)return e[0].toLowerCase()+e.substr(1)}},methods:{init:function(){},popoverMounted:function(){},getComponentName:function(){return stg.data.popover.mode.replace(/(.*?)\//g,"")},backdropClicked:function(e){e.target&&hasClass(e.target,"popover-backdrop")&&popovers.hide()}}}),compClasses.app=Vue.component("app",{data:function(){return{}},template:getTemplate("views/app.html"),mounted:function(){(compInstances.app=this).init()},methods:{init:function(){}}}),compClasses.authRedirect=Vue.component("authRedirect",{data:function(){return{}},template:getTemplate("views/authRedirect.html"),mounted:function(){(compInstances.authRedirect=this).init()},computed:{},methods:{init:function(){var n=this;design.stylize("oauth",design.getBgStyle()),backend.getFingerprint(function(e){var t=!0;n.$route.params.state&&n.$route.params.state!=e&&(t=!1),t&&sso.setTokens(n.$route.params.provider,decodeURIComponent(n.$route.params.idToken),decodeURIComponent(n.$route.params.accessToken)),initializer.initialize()})}}}),compClasses.blank=Vue.component("blank",{data:function(){return{}},template:getTemplate("views/blank.html"),mounted:function(){(compInstances.blank=this).init()},beforeRouteEnter:function(e,t,n){if("blank"==e.name&&t.name)return window.history.back();n()},methods:{init:function(){}}}),compClasses.forgotPwd=Vue.component("forgotPwd",{data:function(){return{user:{email:""}}},template:getTemplate("views/forgotPwd.html"),mounted:function(){(compInstances.forgotPwd=this).init()},computed:{rtl:function(){return stg.data.settings?stg.data.settings.rtl:null}},methods:{init:function(){mobile||(design.stylize("forgotPwd",design.getBgStyle()),backend.addListener("pathsChanged",function(){design.stylize("forgotPwd",design.getBgStyle())})),this.$on("$ionicView.afterEnter",function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("forgotPwd")))}),this.native||this.desktop||this.$on("$ionicView.beforeEnter",function(){var e;(!initializer.initialized||backend.cloudParam("public")||stg.data.user&&backend.userLoggedIn())&&(e="loading",$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e))})},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},androidBackBtnClicked:function(){window.history.back()},submit:function(){this.user&&this.user.email&&backend.forgotPwd(this.user,function(e){e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):(modals.show({mode:"success",successOptions:{msg:translit.get("pwdEmailSent")}}),window.history.back())})},backClicked:function(){window.history.back()}}}),function(){var i;compClasses.global=Vue.component("global",{data:function(){return{transitionName:"",tick:!0}},template:getTemplate("views/global.html"),mounted:function(){(compInstances.global=this).init()},methods:((i={}).init=function(){var n;this.started=!0,modals.setScope(this),popovers.setScope(this),document.addEventListener("mousedown",function(e){var t=e.target;t.classList.contains("button")&&(t.classList.add("activated"),n=t)}),document.addEventListener("mouseup",function(e){n&&n.classList.remove("activated"),n=null})},i.refresh=function(){var e=this;e.tick=!1,Vue.nextTick(function(){e.tick=!0})},i.tinCanShortcut=function(e){tinCan.send(e)},i.questionsAddToNotebookShortcut=function(e,t){notes.addNotesFromQuestions(e,t||angular.noop)},i.getNotebookShortcut=function(i,r){stg.getNotes(function(e){var t=[currentIndex];stg.data.currentRPageOb&&t.push(stg.data.currentRPageOb.index);for(var n=0;n<t.length;n++)for(var o=0;o<e.length;o++)e[o].chapter==t[n]&&0==e[o].location.indexOf(i.rootIndex)&&(e[o].location=e[o].location.split(i.rootIndex)[1],notes.addIcon(e[o],i.root));r&&r()})},i.location1=function(e){$location.path(e)},i.kTemplate=function(e){return kTemplate(e)},i.translit=function(e){return translit.get(e)},i.htmlSafe=function(e){return $sce.trustAsHtml(e)},i.openAuthorWebsite=function(){var e=stg.data.settings.language;"en"!=e&&"es"!=e&&"ar"!=e&&"fr"!=e&&(e="en"),window.open("https://www.kotobee.com/"+e+"/products/author#ref=readerwatermark","_system")},i.applyNativeScroll=function(t){var n,e=t.getElementsByClassName("kbContent");if(e.length&&!(e[0].scrollHeight<=t.offsetHeight)){t.children.length&&"ion-scroll"==t.children[0].nodeName.toLowerCase()&&(n=t.children[0],t.appendChild(e[0]),t.removeChild(n),t.scrollTop=0),(n=document.createElement("ion-scroll")).setAttribute("scrollY","true"),n.setAttribute("overflow-scroll","false"),n.setAttribute("style","width:100%;height:100%"),n.setAttribute("container-scroll","true");for(var o=0;o<t.children.length;o++)n.appendChild(t.children[o]);setTimeout(function(){var e=$compile(n.outerHTML)(i);angular.element(t).append(e)},0)}},i.globalClick=function(){},i.globalTouch=function(){},i.refreshSignatures=function(){backend.refreshSignatures()},i.getService=function(e){return $injector.get(e)},i.testModals=function(){modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait")});modals.show({mode:"loginPanel",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"update",dynamic:!0,animation:"slide-in-up",backdropClickToClose:!0}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"generalError"}),modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),backdropClickToClose:!0}),modals.show({mode:"note",dynamic:!0,animation:"slide-in-up",backdropClickToClose:!0}),modals.show({mode:"hlight"}),modals.show({mode:"externalSite",dynamic:!0,animation:"slide-in-up",backdropClickToClose:!0}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"flashUnsupported",flashOb:{text:"Text for flash unsupported site"}}),modals.show({mode:"success",successOptions:{msg:"SUCCESS MSG"}}),modals.show({mode:"localOnlyError"}),modals.show({mode:"xFrameError"}),modals.show({mode:"networkError"}),modals.show({mode:"exit"}),modals.show({mode:"waitTimeout"}),modals.show({mode:"backToLib"}),modals.show({mode:"notebook",dynamic:!0,animation:"slide-in-up",scope:{notebookClose:modals.hide}}),modals.show({mode:"search",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"image",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"libraryInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"encryptionKey",backdropClickToClose:!0});modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),timeLimit:3e3})},i.injectUserCSS=function(e){design.injectUserCSS(e)},i.langSelected=function(e){stg.data.settings.language=e,settings.langChanged()},i),watch:{$route:function(e,t){this.transitionName="slide","/"==e.path&&(this.transitionName=""),config.noLoadingScreen&&"/"==t.path&&(this.transitionName="")}}})}(),function(){var e;compClasses.invoice=Vue.component("invoice",{data:function(){return{loading:null,order:null,user:null,paymentOptions:null}},template:getTemplate("views/invoice.html"),mounted:function(){(compInstances.invoice=this).init()},computed:{},methods:((e={}).init=function(){var e,n=this;mobile||(design.stylize("invoice",design.getBgStyle()),backend.addListener("pathsChanged",function(){design.stylize("register",design.getBgStyle())})),n.loading=!0,e=function(){var e=new URLSearchParams(window.location.hash.split("?")[1]),t={uid:e.get("uid")||"",orderid:e.get("orderid")||""};backend.getOrder(t,function(e){return n.loading=!1,e.error?modals.show({mode:"generalError",errorOptions:{msg:translit.get(e.error)}}):(n.order=e.order,n.user=e.user,stg.data.user=e.user,n.paymentOptions=e.paymentoptions,function(){this.paymentOptions=payment.initialize(this.paymentOptions)}.bind(n)(),setTimeout(function(){payment.renderPaypalButton({order:n.order})},1e3),void($rootScope.$$phase||$rootScope.$apply()))})},stg.initialize(),stg.initializeSettings(function(){chapterAPI.initialize(),settings.langChanged(e)})},e.pay=function(e){var t,n=this.order,o=this.user;"moyasar"===e?(t={orderid:n.id,redirecturl:native?nativeRedirectBaseURI:window.location.protocol+"//"+window.location.host+window.location.pathname,price:100*n.amount,name:payment.getOrderName(n)},payment.moyasarSettings.payment(t)):"stripe"===e&&payment.stripeMakePayment(this.paymentOptions,{order:n},{paymentEmail:o.email},{id:""})},e)})}(),compClasses.landing=Vue.component("landing",{data:function(){return{}},template:getTemplate("views/landing.html"),mounted:function(){(compInstances.landing=this).init()},methods:{init:function(){}}}),function(){function e(e){for(var t=0;t<stg.data.sortOb.options.length;t++)if(stg.data.sortOb.options[t].val==e)return stg.data.sortOb.options[t]}function t(){var e,t=this;if(mobile&&autohide.setup(t,"library"),library.initialized=!0,stg.data.currentLibrary){if(t.catList=stg.data.currentLibrary.categories,backend.userLoggedIn()&&("account"!=stg.data.currentLibrary.authbookview||backend.cloudParam("public")||(t.supportsAccountView=!0)),"categories"==stg.data.currentLibrary.startingpage)i(),n.bind(t)("categories");else if(stg.data.currentLibrary.startingpage&&(0!=stg.data.currentLibrary.startingpage.indexOf("book")||(e=stg.data.currentLibrary.startingpage.split("/"))[1]&&(i(),library.startBook=e[1])),0==$location.path().indexOf("/library/tab/downloads"))t.downloadedClicked();else if(t.supportsAccountView)n.bind(t)("account"),$timeout(function(){t.getEbooks({account:!0})});else if(!native&&!desktop||backend.userLoggedIn()||config.kotobee.public||!config.kotobee.offline){if(n.bind(t)("all"),!backend.libraryHasPublicBooks()&&!backend.cloudParam("public")&&"hide"==stg.data.currentLibrary.authbookview&&!backend.userLoggedIn())return t.paneMsg="noEbooksAvailable",void i();$timeout(t.getEbooks)}else{n.bind(t)("downloaded"),t.paneMsg=null,0==a().length&&(t.paneMsg="noEbooksDownloaded"),i()}1==library.run&&(library.startBookDetails||stg.readSlot("lastBook",function(e){Array.isArray(e)&&(e=e[0]),e&&stg.data.currentLibrary.openlastbook&&(library.startBook=e),library.startBook&&(function(e){if(!config.kotobee.public&&!backend.userLoggedIn())return;if(stg.data.currentLibrary&&stg.data.currentLibrary.books)for(var t=0;t<stg.data.currentLibrary.books.length;t++)if(stg.data.currentLibrary.books[t].id==e)return book.open(stg.data.currentLibrary.books[t]);backend.getEbook({bid:e},function(e){book.open(e,{noDelay:!0})})}(library.startBook),library.startBook=null)}))}}function n(e){if(this.tab=e,this.currentCustomCat=null,"category"==this.subMode)for(var t=0;t<stg.data.currentLibrary.categories.length;t++){var n=stg.data.currentLibrary.categories[t];n.tab&&n.id==this.currentCat.id&&(this.currentCustomCat=n,this.tab="customCat")}try{mobile?"undefined"!=typeof $ionicScrollDelegate&&$ionicScrollDelegate.$getByHandle&&"function"==typeof $ionicScrollDelegate.$getByHandle&&$ionicScrollDelegate.$getByHandle("thumbs")&&$ionicScrollDelegate.$getByHandle("thumbs").scrollTop&&$ionicScrollDelegate.$getByHandle("thumbs").scrollTop(!1):document.getElementById("libraryThumbs").scrollTop=0}catch(e){}}function i(){for(var e=document.getElementsByClassName("libLoaderAnim"),t=0;t<e.length;t++)addClass(e[t],"hide")}function r(e,t){t=t||stg.data.currentLibrary.categories;for(var n=0;n<t.length;n++){if(t[n].id==e)return t[n];if(t[n].children){var o=r(e,t[n].children);if(o)return o}}}function o(){var t=this;s&&s(),s=$ionicPlatform.registerBackButtonAction(function(e){kInteractive.frameIsOpen?kInteractive.closeFrame():kInteractive.alertIsOpen?kInteractive.closeAlert():kInteractive.videoIsFullscreen?kInteractive.closeFullscreenVideo():t.searchOb.enabled?t.disableSearch():"categories"==t.tab&&t.catList!=stg.data.currentLibrary.categories?t.categoryBackClicked():(t.currentCat||t.currentKey||t.currentContentKey)&&t.back(),t.$apply()},102)}function a(){var e=[];return library.applyExistingBooks(e),e}var s,c,l;compClasses.library=Vue.component("library",{data:function(){return{bookSource:null,catList:null,tab:null,paneMsg:null,supportsAccountView:null,searchOb:{enabled:!1},sortOb:{options:[],method:null},autohideEase:null,subMode:null,title:null,moreData:null,currentCustomCat:null,currentCat:null,currentKey:null,currentContentKey:null,horizontalScrolling:null}},template:getTemplate("views/library.html"),mounted:function(){compInstances.library=this,library.initialize(this.init)},created:function(){},beforeRouteEnter:function(e,t,n){return book.removeBookConfigElem(),chapters.clearContent(),n()},methods:((l={}).init=function(){var o=this;document.getElementsByClassName("libraryView");if(stg.data.book=null,library.addListener(function(){var e,t=arguments[0];{"preload"==(c=t)&&(arguments[1].accumulated||(e=!0,(o=document.getElementById("libraryThumbs"))&&addClass(o,"dim")),mobile||(e=!0),this.paneMsg=null,e&&function(){for(var e=document.getElementsByClassName("libLoaderAnim"),t=0;t<e.length;t++)removeClass(e[t],"hide")}())}{var n,o,i;"postload"==t&&(n=arguments[2],e=!1,(o=document.getElementById("libraryThumbs"))&&removeClass(o,"dim"),i=function(e){{if(this.currentContentKey){for(var t=0,n=0;n<e.length;n++)if(e[n].searchresults)for(var o=0;o<e[n].searchresults.length;o++)e[n].searchresults[o].results&&(t+=e[n].searchresults[o].results.length);return t}return e.length}}(n),library.moreData=i>=library.maxResults,library.moreData&&library.setMax(i))}}.bind(o)),backend.setLibraryLoginCallback(function(){t.bind(o)()}),backend.setLibraryLogoutCallback(function(){o.supportsAccountView&&"all"!=o.tab&&(n.bind(o)("all"),$timeout(o.getEbooks)),o.supportsAccountView=!1,i()}),stg.data.currentLibrary&&stg.data.currentLibrary.defaultsort&&(stg.data.sortOb.method=e.bind(o)(stg.data.currentLibrary.defaultsort)),stg.data.sortOb.method||(stg.data.sortOb.method=e.bind(o)("dateDesc")),stg.data.sortOb.model=stg.data.sortOb.method.val,o.$on("$ionicView.beforeEnter",function(e,t){var n;book.removeBookConfigElem(),chapters.clearContent(),o.native||o.desktop||auth.authenticated&&"library"==config.kotobee.mode||(n="loading",$ionicHistory.forwardView()?n=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(n=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+n)),$ionicHistory.forwardView()&&$ionicHistory.forwardView().stateId,$ionicHistory.backView()&&$ionicHistory.backView().stateId,"forward"==t.direction&&(stg.data.currentLibrary.books=[],stg.data.favorites=[])}),1,0,vueExclude&&"back"==f.direction)return i(),library.setBrowserTitle(),void stg.resetBook();!backend.cloudParam("public")&&backend.cloudParam("entry")?backend.login().then(function(e){e.error&&t.bind(o)()}):t.bind(o)()},l.langSelected=function(e){stg.data.settings.language=e,settings.langChanged()},l.showLibraryMenu=function(){popovers.show({mode:"popoverLibraryMenu",menuItem:this.menuItemClicked,backdropClickToClose:!1})},l.spaceAvailable=function(e,t){if(this.sectionView)return!1;var n=this.currentContentKey?.95:.8;if(e=e||document.getElementById("libraryThumbs")){var o,i=e.scrollTop,r=document.getElementById("libraryThumbsContent");!mobile||(o=e.__vue__)&&(i=o.$children[0].getPosition().top);if(n<i/(r.offsetHeight-e.offsetHeight)||e.offsetHeight+90>r.offsetHeight){if(!this.moreDataExists())return;return this.loadMore(t),!0}}},l.scroll=function(e){if("preload"!=c)return this.spaceAvailable()},l.bookClicked=function(e,t){config.skipLibBookInfo||t?bookinfo.immediateEnter(e,t):bookinfo.show({book:e,categoryClicked:this.categoryClicked})},l.refresherExists=function(){try{if(!stg.data.currentLibrary)return!1;if("categories"==this.tab)return!1;if("downloaded"==this.tab)return!1;if("favorites"==this.tab)return!0;if("account"==this.tab)return!0;if("all"==this.tab)return!0}catch(e){return!1}return!0},l.doRefresh=function(e){var t={accumulated:!0};"all"==this.tab?this.getEbooks(t,e):"account"==this.tab?(t.account=!0,this.getEbooks(t,e)):"favorites"==this.tab?this.loadFavorites(t,e):e&&e()},l.sortChanged=function(){for(var e=0;e<stg.data.sortOb.options.length;e++)if(stg.data.sortOb.options[e].val==stg.data.sortOb.model){stg.data.sortOb.method=stg.data.sortOb.options[e];break}(function(){"downloaded"==this.tab?$filter("orderBy")(this.data.downloaded,stg.data.sortOb.method.data):"account"==this.tab?this.getEbooks({account:!0}):"favorites"==this.tab?this.loadFavorites():this.getEbooks()}).bind(this)()},l.menuItemClicked=function(e){"language"==e&&settings.langChanged(),"sort"==e&&this.sortChanged(),"redeemCode"==e&&(popovers.hide(),this.redeemCodeClicked()),"info"==e&&(popovers.hide(),modals.show({mode:"libraryInfo",dynamic:!0,animation:"slide-in-up",libraryInfo:stg.data.currentLibrary.libraryinfo})),"login"==e&&(popovers.hide(),this.data.user.pwd||this.data.user.code||kError.update({error:"s_authError"})),"logout"==e&&(popovers.hide(),(this.data.user.pwd||this.data.user.code)&&backend.logout()),"requestDelete"==e&&(popovers.hide(),modals.show({mode:"success",successOptions:{msg:translit.get("requestDeleteEmailSent")}}),backend.sendDeletionRequest(function(e){})),"exit"==e&&(popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}}))},l.getEbooks=function(t,n){var o=this;t=t||{},o.paneMsg=null,o.currentCat&&(t.catid=o.currentCat.id,t.listmode=o.currentCat.listmode),o.currentKey&&(t.key=o.currentKey),o.currentContentKey&&(t.contentkey=o.currentContentKey),o.sectionView&&(t.sections=!0),library.getEbooks(t,function(e){o.bookSource=e,"all"!=o.tab&&"customCat"!=o.tab&&"account"!=o.tab||(e.empty&&(o.paneMsg="noEbooksAvailable"),o.$$phase||o.$apply(),setTimeout(function(){o.spaceAvailable(null,n)||i()},100),n&&n(!0),t.sections&&Vue.nextTick(o.triggerBookSections))},function(e){n&&n(!0)})},l.triggerBookSections=function(){for(var e=this.$el.getElementsByClassName("bookThumbsContainer")[0].getElementsByClassName("bookSection"),t=0;t<e.length;t++)e[t].__vue__.scrolled()},l.loadFavorites=function(e,t){var n=this;e=e||{},n.paneMsg=null,n.currentCat&&(e.catid=n.currentCat.id),n.currentKey&&(e.key=n.currentKey),n.currentContentKey&&(e.contentkey=n.currentContentKey),e.favs=!0,library.getEbooks(e,function(e){n.bookSource=e,"favorites"==n.tab&&(e.error&&(n.paneMsg="failedToGetFavs"),0==e.length&&(n.paneMsg="noFavsAvailable"),setTimeout(function(){n.spaceAvailable(null,t)||i()},100),t&&t(!0))})},l.searchEbooks=function(e){var t=this;if(e&&e.length&&0!=e.length){if(e.length<3)return kError.update({error:"lessThan3Characters"}),void modals.hide();t.subMode="search",t.title="searchResults",config.searchLibContent?t.currentContentKey=e:t.currentKey=e,t.currentCat=null,t.supportsAccountView&&"all"!=t.tab?(n.bind(t)("account"),$timeout(function(){t.getEbooks({account:!0})})):(n.bind(t)("all"),$timeout(t.getEbooks)),o.bind(t)()}},l.enableSearch=function(){this.searchOb.enabled=!0,o.bind(this)()},l.disableSearch=function(){this.searchOb.enabled=!1,s&&s()},l.androidBackBtnClicked=function(){var e=this;isReaderApp?$location.path("/app"):e.searchOb.enabled?e.disableSearch():"categories"==e.tab&&e.catList!=stg.data.currentLibrary.categories?e.categoryBackClicked():e.currentCat||e.currentKey||e.currentContentKey?e.back():modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},l.loadMore=function(e){var t={more:!0,accumulated:!0};"all"==this.tab||"customCat"==this.tab?this.getEbooks(t,e):"account"==this.tab?(t.account=!0,this.getEbooks(t,e)):"favorites"==this.tab?this.loadFavorites(t,e):e&&e(!0)},l.stopRefresher=function(){$rootScope.$broadcast("scroll.refreshComplete")},l.moreDataExists=function(){var e;try{if(!stg.data.currentLibrary)return!1;if("categories"==this.tab)return!1;if("downloaded"==this.tab)return!1;if("favorites"==this.tab&&(e=this.data.favorites),"all"==this.tab&&(e=stg.data.currentLibrary.books),"customCat"==this.tab&&(e=stg.data.currentLibrary.books),"account"==this.tab&&(e=stg.data.currentLibrary.books),!e||0==e.length)return!1}catch(e){return!1}return library.moreData},l.back=function(){var e=this;e.subMode=!1,e.title=null,e.currentKey=null,e.currentContentKey=null,e.currentCat=null,e.supportsAccountView&&"all"!=e.tab?($location.path("library/tab/account"),n.bind(e)("account"),$timeout(function(){e.getEbooks({account:!0})})):($location.path("library/tab/all"),n.bind(e)("all"),$timeout(e.getEbooks)),s&&s()},l.categoryBackClicked=function(){if(this.catList&&this.catList.length)for(var e=r((e=this.catList[0].parent).id);;){if(!(e=e.parent))return void(this.catList=stg.data.currentLibrary.categories);if("separate"==(e=r(e.id)).submode)return void(this.catList=e.children)}},l.categoryClicked=function(e){var t=this;native&&crdv.vibrate(),"expand"!=e.submode?"categories"!=t.tab||"separate"!=e.submode?(t.currentCat=e,t.currentKey=null,t.currentContentKey=null,t.subMode="category",t.title=t.currentCat.name,n.bind(t)("all"),$timeout(t.getEbooks),o.bind(t)()):t.catList=e.children:e.expand=!e.expand},l.categoriesClicked=function(){native&&crdv.vibrate(),this.currentCat=this.currentKey=null,this.currentContentKey=null,this.title=this.subMode=null,n.bind(this)("categories"),this.paneMsg=null,i()},l.accountClicked=function(){var e=this;native&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,n.bind(e)("account"),i(),$timeout(function(){e.getEbooks({account:!0})})},l.allClicked=function(){native&&crdv.vibrate(),this.currentCat=this.currentKey=null,this.currentContentKey=null,this.title=this.subMode=null,n.bind(this)("all"),$timeout(this.getEbooks)},l.downloadedClicked=function(){var e=this;native&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,n.bind(e)("downloaded"),e.bookSource=a(),e.paneMsg=null,0==e.bookSource.length&&(e.paneMsg="noEbooksDownloaded"),i()},l.favoritesClicked=function(){native&&crdv.vibrate(),this.currentCat=this.currentKey=null,this.currentContentKey=null,this.title=this.subMode=null,n.bind(this)("favorites"),this.loadFavorites()},l.redeemCodeClicked=function(){var e=this;auth.redeemCode({source:"topmenu"},function(){"all"==this.$route.params.tab?e.allClicked():$location.path("/library/tab/all")})},l.bannerClass=function(e){try{return[JSON.parse(e.config).scale]}catch(e){}},l.bannerPath=function(e){return config.kotobee.liburl+"libraries/"+stg.data.currentLibrary.path+"/public/"+e.img},l.bannerUrl=function(e){try{var t=JSON.parse(e.config);return"url"!=t.actionType?"":t.actionUrl?("www"==t.actionUrl.substr(0,3)&&(t.actionUrl="https://"+t.actionUrl),t.actionUrl):""}catch(e){}},l.bannerClicked=function(e,t){var n=JSON.parse(e.config);if("url"!=n.actionType){if("book"==n.actionType)backend.getEbook({bid:n.actionResource.id},function(e){e&&!e.error&&bookinfo.show({book:e})});else if("category"==n.actionType)for(var o=0;o<stg.data.currentLibrary.categories.length;o++)if(stg.data.currentLibrary.categories[o].id==n.actionResource.id){this.categoryClicked(stg.data.currentLibrary.categories[o]);break}t.preventDefault()}},l.vScroll=function(e){mobile&&autohide.scrolled(e)},l),watch:{$route:function(e,t){if("libraryBookDetails"==t.name&&modals.hide(),e.params.cat&&!isNaN(e.params.cat)){if(!stg.data.currentLibrary.categories||!stg.data.currentLibrary.categories.length)return;for(var n=0;n<stg.data.currentLibrary.categories.length;n++){if((o=stg.data.currentLibrary.categories[n]).id==e.params.cat)return this.categoryClicked(o)}}if(e.params.tab)if("categories"==e.params.tab)this.categoriesClicked();else if("all"==e.params.tab)this.allClicked();else if("account"==e.params.tab)this.accountClicked();else if("favorites"==e.params.tab)this.favoritesClicked();else if("downloads"==e.params.tab)this.downloadedClicked();else if(!isNaN(e.params.tab)){if(!stg.data.currentLibrary.categories||!stg.data.currentLibrary.categories.length)return;for(var o,n=0;n<stg.data.currentLibrary.categories.length;n++){if((o=stg.data.currentLibrary.categories[n]).id==e.params.tab)return this.categoryClicked(o)}}var i;"libraryBookDetails"==e.name&&e.params.book&&(modals.hide(),i={id:e.params.book},bookinfo.showInternal(i))}},computed:{loggedIn:function(){if(stg.data.user)return stg.data.user.loggedIn},rows:function(){for(var e=(e=stg.data.currentLibrary.sections)||[],t=(t=stg.data.currentLibrary.banners)||[],n=[],o=0;o<t.length;o++)n.push(t[o].bindex?t[o].bindex:0);for(var i=[],o=0;o<e.length;o++)i.push(Object.assign(e[o],{isSection:!0}));for(var r,a=0,o=0;o<i.length;o++){i[o].books&&i[o].books.length&&(null!=(r=existsInArray(a,n,{index:!0}))&&i.splice(o,0,t[r]),a++)}return i},sectionView:function(){return!!stg.data.currentLibrary.sectionsMode&&(!this.currentKey&&(!this.currentContentKey&&(!this.currentCat&&"all"==this.tab)))}}})}(),compClasses.login=Vue.component("login",{data:function(){return{langDropdownExpanded:null,canLoginByEmail:null,canLoginByCode:null,mode:null,model:{}}},template:getTemplate("views/login.html"),mounted:function(){(compInstances.login=this).init()},computed:{ssoBusy:function(){if(stg.data.sso)return stg.data.sso.ssoBusy}},methods:{init:function(){mobile||(design.stylize("login",design.getBgStyle()),backend.addListener("pathsChanged",function(){design.stylize("login",design.getBgStyle())})),"email"==config.kotobee.loginmode||config.kotobee.promocodesdisabled?this.canLoginByEmail=!0:"code"==config.kotobee.loginmode?this.canLoginByCode=!0:this.canLoginByEmail=this.canLoginByCode=!0,this.mode=this.canLoginByEmail?"email":"code",this.$on("$ionicView.afterEnter",function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("login")))}),native||desktop||this.$on("$ionicView.beforeEnter",function(){var e;initializer.initialized&&!config.kotobee.public&&!backend.userLoggedIn()||(e="loading",$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e))})},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},login:function(){var t=this;if(t.model){if("code"==t.mode){if(!t.model.code)return void kError.update({error:"enterYourCode"});stg.data.user.code=t.model.code,stg.data.user.email=stg.data.user.pwd=null}else{if(!stg.data.user.email)return void kError.update({error:"enterYourEmail"});if(!t.model.pwd)return void kError.update({error:"enterYourPwd"});stg.data.user.pwd=t.model.pwd,stg.data.user.code=null}config.kotobee.permsLoaded?e():auth.getPermissions(e)}function e(){backend.login({dontShowErrorDialog:!0,userInput:!0}).then(function(e){return e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):(t.model.pwd=null,t.model.code=null,void auth.startup())})}},register:function(){modals.hide(),$location.path("/register")},forgotPassword:function(){$location.path("/forgotpwd")},signInByEmail:function(){this.mode="email"},redeemCode:function(){this.mode="code"},langSelected:function(e){this.langDropdownExpanded=!1,stg.data.settings.language=e,settings.langChanged()},emit:function(e,t){vueApp.$emit(e,t)}}}),function(){var e;compClasses.payment=Vue.component("payment",{data:function(){return{}},template:getTemplate("views/payment.html"),mounted:function(){(compInstances.payment=this).init()},computed:{state:function(){return this.$route.params.state},bookID:function(){return this.$route.params.bookID},userID:function(){return this.$route.params.userID}},methods:((e={}).init=function(){var e,t=this;mobile||(design.stylize("payment",design.getBgStyle()),backend.addListener("pathsChanged",function(){design.stylize("payment",design.getBgStyle())})),e=function(){var n;n=function(){config.kotobee.payment&&(stg.data.payment||Vue.set(stg.data,"payment",{}),"success"==t.$route.params.state?Vue.set(stg.data.payment,"success",!0):Vue.set(stg.data.payment,"success",!1))},("library"==config.kotobee.mode?backend.getUnauthLibrary:backend.getPermissions)(function(e){var t="library"==config.kotobee.mode?e.cloud:e;config.kotobee.payment=t.payment,n()})},stg.initialize(),stg.initializeSettings(function(){chapterAPI.initialize(),settings.langChanged(e)})},e.openBook=function(){library.startBook=this.bookID,initializer.initialize()},e.backToLib=function(){initializer.initialize()},e.backToLibOld=function(){$location.path("/library")},e)})}(),compClasses.reader=Vue.component("reader",{data:function(){return{webWatermarkPlaceholder1:"",header:{mode:"default"},searchOb:{enabled:!1},sideMenuMode:"bookSettings",autohideEase:null}},template:getTemplate("views/reader.html"),destroyed:function(){this.destroyed()},mounted:function(){(compInstances.reader=this).init()},computed:{contentDir:function(){return book.getContentDir()}},watch:{$route:function(e,t){var n,o,i,r;function a(e){return e.fullPath.replace(/[?&]popup/g,"")}e&&t&&a(e)==a(t)||(n=e.params.ch?e.params.ch:0,o=e.params.hash?e.params.hash:null,i=getQueryStringValue("vi"),(r=chapters.loadChapterByIndex(Number(n),{hash:o,vIndex:i}))&&r.then(function(){kotobee.dispatchEvent("processedRoute")}))}},methods:function(){var t,o,n={};function i(e){"c"==e.key&&(e.ctrlKey||e.metaKey)&&selection.copyToClipboard(),e.shiftKey&&("ArrowRight"==e.key?selection.extendRight():"ArrowLeft"==e.key&&selection.extendLeft())}function r(e,t){if(o&&clearTimeout(),currentIndex==t.currentChapterIndex)return o=setTimeout(function(){r(e,t)},1e3);var n={neighbor:t.currentChapterIndex+("next"==e?1:-1),ch:t.currentChapterTitle,chIndex:t.currentChapterIndex,dir:e,targetIndex:currentIndex,targetCh:stg.data.book.chapter.title};events.add({action:"navBtnClicked",param:JSON.stringify(n)})}n.init=function(){var n=this;n.mode="reading",n.native||n.desktop||n.$on("$ionicView.beforeEnter",function(){var e;initializer.initialized&&(config.kotobee.public||backend.userLoggedIn())||(e="loading",$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e))}),$rootScope.renderScope=n,selection.listener=n.selection,t=$ionicPlatform.registerBackButtonAction(function(e){var t=$location.path();kInteractive.frameIsOpen?kInteractive.closeFrame():kInteractive.alertIsOpen?kInteractive.closeAlert():kInteractive.videoIsFullscreen?kInteractive.closeFullscreenVideo():"default"!=n.header.mode?"selection"==n.header.mode?selection.reset():n.applyHeader("default"):stg.data.book.chapter.viewport&&nav.getFxlScale()!=nav.getFxlFit().bestFit?nav.fxlZoomFit():"library"==config.kotobee.mode&&0==t.indexOf("/book")?$location.path("/library"):isReaderApp&&"/app"!=t?$location.path("/app"):modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}}),n.$apply()},103),n.native||n.desktop||n.$on("$ionicView.beforeEnter",function(){var e;auth.authenticated||(e="loading",$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e))}),mobile&&autohide.setup(this,"reader")},n.vScroll=function(e){mobile&&autohide.scrolled(e)},n.destroyed=function(){t&&t.bind(this)(this)},n.chapterClicked=function(e){chapters.displayChapters()},n.backClicked=function(e){if($ionicSideMenuDelegate.isOpen())return $ionicSideMenuDelegate.close();modals.show({mode:"backToLib",backdropClickToClose:!1,backToLibOptions:{back:function(){modals.hide(),$location.path("/library")}}})},n.searchClicked=function(e){this.applyHeader("search")},n.androidBackBtnClicked=function(){$ionicSideMenuDelegate.isOpen()?$ionicSideMenuDelegate.close():"default"!=this.header.mode?"selection"==this.header.mode?selection.reset():this.applyHeader("default"):stg.data.book.chapter.viewport&&!function(){if(!stg.data.book.chapter.viewport)return;var e=nav.getFxlFit(),t=Math.round(1e3*e.heightFit)/1e3,n=Math.round(1e3*e.widthFit)/1e3,o=Math.round(1e3*nav.getFxlScale())/1e3;return o==t||o==n}()?nav.fxlZoomFit():"library"==config.kotobee.mode&&0==$location.path().indexOf("/book")?this.backClicked():isReaderApp&&"/app"!=$location.path()?$location.path("/app"):modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},n.setSideMenuMode=function(e){this.sideMenuMode=e},n.applyHeader=function(e){try{this.header.mode=e}catch(e){}},n.selection=function(e){var t;mobile?"activated"==e||"selectionFixed"==e?(this.applyHeader("selection"),kotobee.dispatchEvent("textSelected",{text:selection.getSelectedText()})):"deactivated"==e&&(this.applyHeader("default"),kotobee.dispatchEvent("textDeselected")):"selectionFixed"==e?((t=document.getElementById("selectionOptions"))&&addClass(t,"showBar"),document.getElementById("copyBtn").setAttribute("data-clipboard-text",selection.getSelectedText()),window.addEventListener("keydown",i),kotobee.dispatchEvent("textSelected",{text:selection.getSelectedText()})):"deactivated"==e&&((t=document.getElementById("selectionOptions"))&&removeClass(t,"showBar"),window.removeEventListener("keydown",i),kotobee.dispatchEvent("textDeselected"))},n.contentLink=function(e){chapters.applyChapterStateFromURL(e.getAttribute("href"))},n.chapterLink=function(e){var t=this;if(0<e.parentElement.getElementsByTagName("ol").length){var n=e.offsetHeight+20;if(overflowScroll||$ionicScrollDelegate.$getByHandle("chapters").scrollBy(0,n,!0),!e.getAttribute("href")||e.getAttribute("data-dontshow"))return void(hasClass(e.parentElement,"expanded")?removeClass:addClass)(e.parentElement,"expanded");addClass(e.parentElement,"expanded")}$ionicSideMenuDelegate.close(),$location.search("vi");var o=chapters.getIndexFromTocElem(e);chapters.applyChapterStateFromURL(e.getAttribute("href"),{vIndex:0,index:o}),t.$$phase||t.$apply()},n.targetCurrentChapter=function(e){chapters.highlightCurrentTocChapter()},n.externalLink=function(e){var t=e.getAttribute("href"),n=e.getAttribute("target");backend.externalLink(t,{target:n}),kInteractive.events&&kInteractive.events.add({action:"linkClicked",param:t,elem:e})},n.bookmarkClicked=function(e){bookmarks.addBookmark()},n.freehandClicked=function(e,t){var n=e.target;n.classList.contains("active")?freehand.deactivate():freehand.activate(),n.classList.toggle("active")},n.noteClicked=function(e,t){notes.noteClicked(e?[e]:null,t)},n.miniappsClicked=function(){if(stg.data.settings.rtl){if($ionicSideMenuDelegate.isOpenLeft()&&"miniapps"!=this.sideMenuMode)return $ionicSideMenuDelegate.toggleLeft(),void $timeout(this.settingsClicked,300)}else if($ionicSideMenuDelegate.isOpenRight()&&"miniapps"!=this.sideMenuMode)return $ionicSideMenuDelegate.toggleRight(),void $timeout(this.settingsClicked,300);native&&crdv.vibrate(),this.setSideMenuMode("miniapps"),mobile&&nav.resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},n.nextChapter=function(){var t={};return t.currentChapterTitle=stg.data.book.chapter.title,t.currentChapterIndex=currentIndex,chapters.nextChapter({},function(e){r("next",t)})},n.prevChapter=function(){var t={};return t.currentChapterTitle=stg.data.book.chapter.title,t.currentChapterIndex=currentIndex,chapters.prevChapter({},function(e){r("previous",t)})},n.pinched=function(e){},n.showBookInfo=function(){native&&crdv.vibrate();var e=stg.data.book;e.coverImg=stg.data.epub.bookThumb,e.coverImg||(e.coverImg=(config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png"),e.coverStyle={"background-image":"url('"+e.coverImg+"')"},e.name=e.meta.dc.title;var t={ui:{}};t.book=e,t.stage="info",config.kotobee.cloudid&&"book"==config.kotobee.mode&&(t.book.stats=config.kotobee.stats),t.noAction=!0,modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up",bookInfoOptions:t})},n.gotoPageClicked=function(e){e.stopPropagation();var t={};t.page=stg.data.currentPageOb.index+1,config.gotoPageOffset&&(t.page-=config.gotoPageOffset),t.submit=function(){var e;isNaN(t.page)||(e=Number(t.page)-1,config.gotoPageOffset&&(e+=config.gotoPageOffset),chapters.loadChapterByIndex(e),modals.hide())},modals.show({mode:"gotoPage",gotoPageOptions:t})},n.mouseDown=function(){mobile&&nav.resize(),virt.enable()},n.mouseUp=function(){virt.disableAfter(2e3)};var a;return n.scroll=function(){if(stg.data.book){try{var t,n=$ionicScrollDelegate.$getByHandle("content"),o=new Event("kotobeeScrolled");n&&(t=n.getScrollPosition(),o.left=t.left,o.top=t.top,o.zoom=t.zoom),document.dispatchEvent(o)}catch(e){}kotobee&&kotobee.dispatchEvent("scrolled",t),config.preserveLoc&&"app"!=config.kotobee.mode&&(a&&clearTimeout(a),a=setTimeout(function(){var e,t;"app"!=config.kotobee.mode&&(!(e=$ionicScrollDelegate.$getByHandle("content"))||(t=e.getScrollPosition())&&stg.writeSlot("lastLocY"+stg.getBookId(),t.top))},2e3)),mobile&&autohide.scrolled(e),mobile||(virt.enable(),virt.disableAfter(2e3))}},n.doubleTap=function(){},n.swipeLeft=function(){nav.options.swipeDisabled||(native&&crdv.vibrate(),book.isRtl()?chapters.prevChapter():chapters.nextChapter(),config.autohideHeader&&("showOnTap"!=config.autohideReaderMode&&"hideOnTap"!=config.autohideReaderMode||autohide.hideBtns()))},n.swipeRight=function(){nav.options.swipeDisabled||(native&&crdv.vibrate(),book.isRtl()?chapters.nextChapter():chapters.prevChapter(),config.autohideHeader&&("showOnTap"!=config.autohideReaderMode&&"hideOnTap"!=config.autohideReaderMode||autohide.hideBtns()))},n.openAuthorWebsite=function(){inherited(this.$parent,"openAuthorWebsite")},n}()}),compClasses.redeemCode=Vue.component("redeemCode",{data:function(){return{user:{code:""}}},template:getTemplate("views/redeemCode.html"),mounted:function(){(compInstances.redeemCode=this).init()},computed:{rtl:function(){return stg.data.settings?stg.data.settings.rtl:null}},methods:{init:function(){mobile||(design.stylize("redeemCode",design.getBgStyle()),backend.addListener("pathsChanged",function(){design.stylize("redeemCode",design.getBgStyle())})),stg.data.user||Vue.set(stg.data,"user",{}),this.$on("$ionicView.afterEnter",function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("redeemCode")))}),this.native||this.desktop||this.$on("$ionicView.beforeEnter",function(){var e;(!initializer.initialized||backend.cloudParam("public")||stg.data.user&&backend.userLoggedIn())&&(e="loading",$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e))})},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},submit:function(){function e(){backend.cloudParam("entry")?(window.history.back(),backend.login()):backend.login().then(function(e){e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):auth.startup()})}this.user&&this.user.code&&(stg.data.user.code=this.user.code,stg.data.user.email=stg.data.user.pwd=null,config.kotobee.permsLoaded?e():auth.getPermissions(e))},backClicked:function(){window.history.back()}}}),compClasses.register=Vue.component("register",{data:function(){return{user:{email1:"",email2:""},creating:null}},template:getTemplate("views/register.html"),mounted:function(){(compInstances.register=this).init()},computed:{rtl:function(){return stg.data.settings?stg.data.settings.rtl:null}},methods:{init:function(){mobile||(design.stylize("register",design.getBgStyle()),backend.addListener("pathsChanged",function(){design.stylize("register",design.getBgStyle())})),this.$on("$ionicView.afterEnter",function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("register")))}),this.native||this.desktop||this.$on("$ionicView.beforeEnter",function(){var e;initializer.initialized&&!config.kotobee.public&&!backend.userLoggedIn()||(e="loading",$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e))})},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},create:function(){var n=this;this.verify()&&(n.creating||(n.creating=!0,backend.register(n.user,function(e){var t;n.creating=!1,e&&!e.error&&(t="d_accountCreated",e.success&&e.success.approvalRequired&&(t="d_accountCreatedApprovalRequired"),window.history.back(),modals.hideAll(),modals.show({mode:"success",successOptions:{msg:translit.get(t)}}))})))},androidBackBtnClicked:function(){window.history.back()},verify:function(){var e=this.user;if(-1==e.email1.indexOf("@"))return kError.update({error:"emailFormatError"}),!1;if(!/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e.email1))return kError.update({error:"emailFormatError"}),!1;if(e.email1!=e.email2)return kError.update({error:"emailsDontMatch"}),!1;if(stg.view.registration.promocodeMandatory&&!e.promocode)return kError.update({error:"fillInAllFields"}),!1;var t=config.kotobee.registrationsettings;return(!(t=t||{}).name||!t.namerequired||e.name)&&(!t.dob||!t.dobrequired||e.dob)&&(!t.organization||!t.organizationrequired||e.organization)&&(!t.dept||!t.deptrequired||e.dept)&&(!t.univ||!t.univrequired||e.univ)&&(!t.faculty||!t.facultyrequired||e.faculty)&&(!t.class||!t.classrequired||e.class)&&(!t.division||!t.divisionrequired||e.division)&&(!t.customid||!t.customidrequired||e.customid)&&(!t.gender||!t.genderrequired||e.gender)&&(!t.country||!t.countryrequired||e.country)&&(!t.city||!t.cityrequired||e.city)&&(!t.phone||!t.phonerequired||e.phone)&&!(t.info&&t.inforequired&&!e.info)||(kError.update({error:"fillInAllFields"}),!1)},backClicked:function(){vueApp.$router.back()}}}),compClasses.test=Vue.component("test",{data:function(){return{}},template:getTemplate("views/test.html"),mounted:function(){(compInstances.test=this).init()},computed:{},methods:{init:function(){}}});var kInteractive={preRender:function(e,t){var n,o=(t=t||{}).singleElem,i=e||document;o?(n=[e],i=document):n=i.getElementsByClassName("kInteractive"),void 0!==isKotobee&&(kInteractive.absoluteURL=t.chapterUrl?t.chapterUrl:angular.element(document.body).scope().data.book.chapter.absoluteURL);for(var r=n.length;r--;){var a=n[r];this.hasClass(a,"gallery")&&kInteractive.gallery.preRender(a,i,r),this.hasClass(a,"questions")&&kInteractive.questions.preRender(a,i,r),!this.hasClass(a,"image")&&"img"!=a.nodeName.toLowerCase()||kInteractive.image.preRender(a,i,r),this.hasClass(a,"link")&&kInteractive.link.preRender(a,i,r),this.hasClass(a,"container")&&kInteractive.container.preRender(a,i,r),this.hasClass(a,"equation")&&kInteractive.equation.preRender(a,i,r),this.hasClass(a,"lipsync")&&kInteractive.lipsync.preRender(a,i,r)}},postRender:function(t,e){var n=(e=e||{}).singleElem;if(void 0!==isKotobee&&(kInteractive.absoluteURL=e.chapterUrl?e.chapterUrl:angular.element(document.body).scope().data.book.chapter.absoluteURL),kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.clocks&&(kInteractive.clocks=[]),kInteractive.observers){for(var o=kInteractive.observers.length;o--;)kInteractive.observers[o].disconnect();kInteractive.observers=null}kInteractive.clearAudioVideo(t),kInteractive.currentVideo=kInteractive.currentAudio=null;var i,r=t||document;n?(i=[t],r=document):i=r.getElementsByClassName("kInteractive");for(var a=i.length;a--;){var s=i[a],c=a;null!=e.forcedIndex&&(c=e.forcedIndex),this.hasClass(s,"container")?kInteractive.container.postRender(r,s,c,e):this.hasClass(s,"questions")?kInteractive.questions.postRender(r,s,c,e):this.hasClass(s,"widget")?kInteractive.widget.postRender(r,s,c,e):this.hasClass(s,"video")?kInteractive.video.postRender(r,s,c):this.hasClass(s,"audio")?kInteractive.audio.postRender(r,s,c):this.hasClass(s,"threed")?kInteractive.threed.postRender(r,s,c,e):this.hasClass(s,"gallery")?kInteractive.gallery.postRender(r,s,c):this.hasClass(s,"image")?kInteractive.image.postRender(r,s,c):this.hasClass(s,"equation")?kInteractive.equation.postRender(r,s,c):this.hasClass(s,"lipsync")&&kInteractive.lipsync.postRender(r,s,c)}this.firstRun&&(window.addEventListener("resize",function(e){kInteractive.resizeEvent(t,n)}),this.firstRun=!1),kInteractive.resizeEvent(t,n)},actionEvent:function(e){return kInteractive.action(e.target,e)},action:function(e,t){if(!kInteractive.isEditorMode()){void 0!==isKotobee&&(kInteractive.absoluteURL=angular.element(document.body).scope().data.book.chapter.absoluteURL);for(var n=e;!this.hasClass(n,"kInteractive");){if(!n.parentNode)return;if((n=n.parentNode)==document.body)return}return this.hasClass(n,"questions")?kInteractive.questions.action(n,e,t):this.hasClass(n,"widget")?kInteractive.widget.action(n):this.hasClass(e,"link")?kInteractive.link.action(n,e,t):this.hasClass(e,"image")?kInteractive.image.action(n,e,t):this.hasClass(n,"gallery")?kInteractive.gallery.action(n,e,t):this.hasClass(n,"audio")?kInteractive.audio.action(n,e,t):this.hasClass(n,"video")?kInteractive.video.action(n,e,t):this.hasClass(n,"threed")?kInteractive.threed.action(n,e,t):this.hasClass(n,"equation")?kInteractive.equation.action(n,e,t):this.hasClass(n,"lipsync")?kInteractive.lipsync.action(n,e,t):void 0}},trigger:function(e,t){this.action(t,e)},resize:function(e,t){kInteractive.resizeEvent(e,t)},resizeEvent:function(e,t){var n=e||document;t&&(n=document);for(var o=n.getElementsByClassName("kInteractive"),i=o.length;i--;){var r=o[i];this.hasClass(r,"image")?kInteractive.image.resize(r):this.hasClass(r,"gallery")?kInteractive.gallery.resize(r):this.hasClass(r,"container")?kInteractive.container.resize(r):this.hasClass(r,"video")?kInteractive.video.resize(r):this.hasClass(r,"widget")?kInteractive.widget.resize(r):this.hasClass(r,"equation")&&kInteractive.equation.resize(r)}},helpers:{},vQueue:[],youTubeReady:!1,firstRun:!0,scorm:"undefined"!=typeof scorm?scorm:null,events:"undefined"!=typeof events?events:null};if(void 0===isKotobee){kotobee={};var kotobeeListeners=[];function getKotobeeListener(e){if(e)for(var t=kotobeeListeners.length;t--;)if(kotobeeListeners[t].event==e)return kotobeeListeners[t]}function clearKotobeeListeners(e){for(var t=kotobeeListeners.length;t--;)e&&kotobeeListeners[t].event!=e||kotobeeListeners.splice(t,1)}function dispatchKotobeeEvent(){}function kInteractionStart(){window.log||(window.log=function(e){}),kInteractive.setDOMParser(),renderMiniapps(),kInteractive.preRender(),kInteractive.postRender()}function kInteractionStartSingleElem(e,t){kInteractive.setDOMParser(),kInteractive.preRender(e,{singleElem:!0}),kInteractive.postRender(e,{singleElem:!0,forcedIndex:t})}function renderMathJax(){MathJax&&MathJax.typeset&&MathJax.typeset()}document.addEventListener("DOMContentLoaded",function(e){"undefined"!=typeof kotobeeReady&&kotobeeReady(e),document.dispatchEvent(new Event("kotobeeReady")),document.dispatchEvent(new Event("kotobeeChapterLoaded")),kotobee.dispatchEvent("ready"),kotobee.dispatchEvent("chapterLoaded"),document.addEventListener("scroll",function(e){kotobee.dispatchEvent("scrolled",e)})}),kotobee.addEventListener=function(){var e,t,n,o;arguments.length<2||(e=arguments[0],t={},n=2==arguments.length?arguments[1]:(t=arguments[1],arguments[2]),t.unique&&clearKotobeeListeners(e),o={event:e,cb:n},kotobeeListeners.push(o))},kotobee.dispatchEvent=function(e,t){var n;!e||(n=getKotobeeListener(e))&&n.cb&&n.cb.apply(this,[t])};try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}function renderMiniapps(){try{if(window.top&&window.top.document&&window.top.document.body&&"kAuthor"==window.top.document.body.id)return}catch(e){}var chapterBody=document.body.textContent;window.miniapps={test:2},window.miniappsConfig={};var kmetaRoot=getRelativeRoot()+"_kmeta/",appids=[],scriptElem=document.createElement("script");function getRelativeRoot(){for(var e=(e=window.location.href.split("/")).reverse(),t="",n=0;n<e.length&&"EPUB"!=e[n];n++)t+="../";return t}function validate(e,t){for(var n,o=document.getElementsByTagName("meta"),i=0;i<o.length;i++)if(o[i].getAttribute("name")=="m-"+window.atob("Y2hlY2tzdW0=")){n=o[i];break}if(kInteractive.isSDK())return 1;if(n){var r=e.join(";"),a=t.replace(/\s+/g,"");return kInteractive.simpleHash(a+r)==n.getAttribute("content")}}scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=function(result){var json=miniappJson.apps,arr=[],miniappContainer,miniappsBtn;for(var item in json)arr.push({folder:item,code:json[item]});function toggleMiniappsContainer(e){e&&e.preventDefault(),miniappContainer.classList.contains("open")?miniappContainer.classList.remove("open"):miniappContainer.classList.add("open")}function next(index){if(1<=index&&miniappJson.sdk)return finalize();if(index>=arr.length)return finalize();var folder=arr[index].folder,pageLang=document.documentElement.lang,pageLang=-1!=pageLang.indexOf("es")?"es":-1!=pageLang.indexOf("fr")?"fr":-1!=pageLang.indexOf("ar")?"ar":"en",scriptElem=document.createElement("script");scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=function(){scriptElem.parentNode.removeChild(scriptElem);var configJson=window.miniappConfig;"string"==typeof configJson&&(configJson=JSON.parse(configJson));var appid=configJson.appid,code=arr[index].code,regex=new RegExp("{{"+appid+"Root}}","g"),code=code.replace(regex,kmetaRoot+"miniapps/"+folder);code=code.replace(/{{www}}/g,kmetaRoot+"../.."),eval(code),appids.push(appid);var miniappObj={};if(miniappObj.config=miniappsConfig[folder],miniappObj.locale=configJson.locale,miniappObj.appid=appid,miniappObj.appClass=window.miniappOutput,miniappObj.name=configJson.locale[pageLang].name,miniappObj.icon=configJson.icon,!miniappObj.appClass.open)return next(++index);function finishedGettingDataJson(){scriptElem.parentNode.removeChild(scriptElem);var e=document.createElement("a");e.className="app";var t=miniappObj.name,n=kmetaRoot+"miniapps/"+folder+"/icon.png";window.miniappData&&(window.miniappData._listingName&&(t=window.miniappData._listingName),window.miniappData._listingIcon&&(n=kInteractive.isAbsolutePath(window.miniappData._listingIcon)?window.miniappData._listingIcon:kmetaRoot+"miniapps/"+folder+"/userdata/"+window.miniappData._listingIcon)),e.innerHTML='<p class="name">'+t+'</p><img class="icon" src="'+n+'"/>',miniappObj.appClass.externalLink&&(e.setAttribute("href",miniappObj.appClass.externalLink),e.setAttribute("target","_blank")),miniappContainer.appendChild(e),e.addEventListener("click",function(){toggleMiniappsContainer(),miniappObj.appClass.externalLink||miniappObj.appClass.open()}),next(++index)}scriptElem=document.createElement("script"),scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=finishedGettingDataJson,scriptElem.onerror=finishedGettingDataJson,scriptElem.src=kmetaRoot+"miniapps/"+folder+"/userdata/data.js"},scriptElem.src=kmetaRoot+"miniapps/"+folder+"/config.js"}function finalize(){(miniappJson.sdk||validate(appids,chapterBody))&&(document.body.appendChild(miniappsBtn),document.body.appendChild(miniappContainer))}arr.length&&(miniappContainer=document.createElement("div"),miniappContainer.id="kiMiniappContainer",miniappContainer.innerHTML="<a href='' class='closeBtn'>X</a>",miniappContainer.getElementsByClassName("closeBtn")[0].addEventListener("click",toggleMiniappsContainer),miniappsBtn=document.createElement("a"),miniappsBtn.id="kiMiniappsBtn",miniappsBtn.setAttribute("href",""),miniappsBtn.innerHTML="Apps",miniappsBtn.addEventListener("click",toggleMiniappsContainer),next(0))},scriptElem.src=kmetaRoot+"miniapps.js"}}kInteractive.audio={preRender:function(e,t){},postRender:function(e,t,n){var o=e.createDocumentFragment(),i=kInteractive.readData(t);t.setAttribute("id","ki-audio-"+n),t.innerHTML="";var r=document.createElement("div");r.setAttribute("id","ki-audio-"+n+"-container"),r.className="container";var a=document.createElement("a");a.className="playBtn ki-btn",a.appendChild(document.createElement("span")),void 0===isKotobee&&a.addEventListener("click",kInteractive.actionEvent);var s=document.createElement("div");i.style&&kInteractive.c.addClass(s,i.style),o.appendChild(a),o.appendChild(r),s.appendChild(o),t.appendChild(s),i.autoplay&&kInteractive.action(t)},action:function(e){kInteractive.stopCurrentMedia();var t,n,o,i,r=kInteractive.readData(e);r&&(r.audioType||(r.audioType=r.type),e.getAttribute("id"),e.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide",t=r.src,"file"==r.audioType&&(t=void 0===isKotobee?r.audio:r.relToRoot?ph.join(bookPath,r.audio):ph.join(kInteractive.absoluteURL,r.audio)),kInteractive.scorm&&((n={}).id=kInteractive.getScormId(e.getAttribute("id"),t),n.description="Played audio: "+t,n.type="other",n.learnerResponses="Played",n.objective=r.options?r.options.objective:null,n.timestamp=new Date,kInteractive.scorm.setInteractions([n])),kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:t,elem:e,data:r}),(o=document.createElement("audio")).setAttribute("controls","true"),o.setAttribute("autoplay","true"),o.setAttribute("data-tap-disabled","false"),(i=document.createElement("source")).src=kInteractive.cleanURL(t),o.appendChild(i),o.appendChild(document.createTextNode("Your browser does not support the audio element")),o.className="ki-noHighlight",o.oncanplay=function(){kInteractive.currentAudio==e&&kInteractive.tinCan({verb:"played",activity:"Audio: "+t})},e.getElementsByClassName("container")[0].appendChild(o),o.play(),kInteractive.currentAudio=e,kInteractive.c.addClass(kInteractive.currentAudio,"playing"))}};var kInteractiveCommon={checkResponsiveFloat:function(e,t){var n;e&&e.disableWrapForMobile&&"none"!=e.float&&(n=t.parentNode,t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow"))},openLink:function(n){var e={cb:function(e){var t=document.createElement("iframe");t.src=n,e.appendChild(t)},closed:function(){}};kInteractive.openFrame(e)},openFrame:function(p){var h=document.getElementById("kInteractiveFrame"),g=document.getElementById("kiDarkOverlay"),f="";if(p.dict||(p.dict={}),p.width&&(f+="width:"+p.width+"px;max-width:"+p.width+"px;"),p.height&&(f+="height:"+p.height+"px;max-height:"+p.height+"px;"),h||((g=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(g),g.style.display="none",g.style.position="fixed",g.addEventListener("click",kInteractive.closeFrame),(h=document.createElement("div")).id="kInteractiveFrame"),p.pos||(p.pos="top"),"none"!=p.pos){var e=document.createElement("a"),t="closeBtn";p.pos&&(t+=" "+p.pos),e.className=t;var n="Close";try{"undefined"!=typeof translit&&(n=translit.get("close"))}catch(e){}p.dict&&p.dict.close&&(n=p.dict.close),"side"!=p.pos&&(e.innerHTML=n),e.addEventListener("click",kInteractive.closeFrame),h.appendChild(e)}var o,m=p.class?p.class:"";(p.width||p.height)&&(m+=" fixed"),p.aspectRatio&&(m+=" aspectRatio"),h.style.display="block",h.className=m,document.body.appendChild(h),kInteractive.frameIsOpen=!0,kInteractive.frameOb=p;try{void 0!==isKotobee&&(native||1<(o=window.location.hash.split("#")).length&&(window.location.hash+=(-1==o[1].indexOf("?")?"?":"&")+"popup",window.addEventListener("hashchange",this.backBtnPressed)))}catch(e){}function i(){g.style.display="block",g.className="show";var e=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,t=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;e-=20,t-=20;var n,o,i=1;p.width&&p.height&&(1<(i=(n=t/p.width)<(o=e/p.height)?n:o)&&(i=1));var r="display:block;";r+=f;var a=!1;try{void 0!==isKotobee&&(a=stg.data.settings.rtl)}catch(e){}var s=p.width||p.height?(a?"50%":"-50%")+",-50%":"0%,0%";r+="-webkit-transform:translate("+s+") scale("+i+");-moz-transform:translate("+s+") scale("+i+");transform:translate("+s+") scale("+i+");",r+="position:fixed;",void 0===isKotobee&&"-50%,-50%"==s&&(r+="top:"+Math.round(window.innerHeight/2)+"px;",r+="left:"+Math.round(window.innerWidth/2)+"px;"),-1!=m.indexOf("aspectRatio")&&window.innerWidth/window.innerHeight>16/9&&(r+="padding-bottom: "+95*window.innerHeight/Math.round(window.innerWidth)+"%"),h.style.cssText=r,h.className=m+" ready";var c,l,d,u=h.getElementsByClassName("closeBtn");u.length&&(c=u[0],l=1/i,d="-50%",kInteractive.hasClass(c,"side")&&(d="0%"),c.style.cssText="-webkit-transform: translate("+d+",0%) scale("+l+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+d+",0%) scale("+l+");-moz-transform-origin: 50% 50%;transform: translate("+d+",0%) scale("+l+");transform-origin: 50% 50%;")}kInteractive.openFrame.resized=i,window.addEventListener("resize",i),setTimeout(function(){i(),p.cb&&p.cb(h)},100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t&&t.parentNode.removeChild(t),n&&n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1,window.removeEventListener("resize",kInteractive.alert.resized),kInteractive.alert&&(kInteractive.alert.resized=null)},backBtnPressed:function(e){e.oldURL&&e.oldURL.match(/[?&]popup/g)&&(window.removeEventListener("hashchange",kInteractive.backBtnPressed),kInteractive.closeFrame())},closeFrame:function(){document.getElementById("kFullscreenGallery")&&kInteractive.gallery.exitFullscreen();var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,o="";n.width&&(o+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(o+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=o,t.className="",setTimeout(function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null},300),window.removeEventListener("hashchange",kInteractive.closeFrame),window.location.hash=window.location.hash.replace(/[?&]popup/g,"")},stopCurrentMedia:function(){var e,t,n,o,i;if(kInteractive.currentVideo&&(e=kInteractive.currentVideo.getAttribute("id")+"-container",(t=document.getElementById(e))&&(n=t.parentNode,t.parentNode.removeChild(t),(o=document.createElement("div")).setAttribute("id",e),o.className="container",(i=kInteractive.currentVideo.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),n.appendChild(o))),kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id"))e+="-container",(t=document.getElementById(e))&&(n=t.parentNode,t.parentNode.removeChild(t),(o=document.createElement("div")).setAttribute("id",e),o.className="container playerContainer",(i=kInteractive.currentAudio.getElementsByClassName("playBtn")[0])&&(i.className="playBtn ki-btn"),kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),n.appendChild(o));else try{var r=kInteractive.currentAudio.getElementsByTagName("audio");r.length&&(r[0].pause(),r[0].src=""),kInteractive.currentAudio.pause&&(kInteractive.currentAudio.pause(),kInteractive.currentAudio.src="");for(var a=document.getElementsByClassName("kiAudioLoader"),s=a.length;s--;)a[s].parentNode.removeChild(a[s])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),o=0;o<n.length;o++)if(n[o]&&n[o].trim()==t)return!0},appendAfterDelay:function(e,t){setTimeout(function(){e.appendChild(t)},30)},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,o=n.cloneNode(!1);return o.innerHTML=t,n.parentNode.replaceChild(o,n),o},tinCan:function(e){if(void 0!==isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){"use strict";var t=e.prototype,r=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var n,o=document.implementation.createHTMLDocument(""),i=o.documentElement;return i.innerHTML=e,n=i.firstElementChild,1===i.childElementCount&&"html"===n.localName.toLowerCase()&&o.replaceChild(n,i),o}return r.apply(this,arguments)}}(DOMParser)},compareVersions:function(e,t){if(e==t)return 0;if(null==e)return 1;if(null==t)return-1;var n=e.split("."),o=t.split(".");return o.length?n.length?Number(n[0])>Number(o[0])?1:Number(o[0])>Number(n[0])?-1:(n.shift(1),o.shift(1),kInteractive.compareVersions(n.join("."),o.join("."))):-1:1},readData:function(e){var t=(t=e.getAttribute("data-kotobee"))||e.getAttribute("data");return this.readRawData(t)},readRawData:function(t){try{var n=1;if(!t)return;return JSON.parse(decodeURI(kInteractive.XORCipher(n).decode("kotobee%%author",t)))}catch(e){try{return JSON.parse(kInteractive.XORCipher(n).decode("kotobee%%author",t))}catch(e){}}},writeData:function(e,t,n){n=n||1;var o=encodeURI(JSON.stringify(t)),i=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(i,kInteractive.XORCipher(n).encode("kotobee%%author",o))},XORCipher:function(e){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e,t){var n;return n=e,function(e){var t,n,o,i,r,a,s,c,l=0,d="";if(!e)return e;for(;t=e[l++],n=e[l++],o=e[l++],i=(s=t<<16|n<<8|o)>>12&63,r=s>>6&63,a=63&s,d+=u.charAt(s>>18&63)+u.charAt(i)+u.charAt(r)+u.charAt(a),l<e.length;);return((c=e.length%3)?d.slice(0,c-3):d)+"===".slice(c||3)}(t=i(t,function(e,t){return e.charCodeAt(0)^o(n,t)}))},decode:function(e,t){return t=function(e){var t,n,o,i,r,a,s,c,l=0,d=[];if(!e)return e;e+="";for(;i=u.indexOf(e.charAt(l++)),r=u.indexOf(e.charAt(l++)),a=u.indexOf(e.charAt(l++)),s=u.indexOf(e.charAt(l++)),t=(c=i<<18|r<<12|a<<6|s)>>16&255,n=c>>8&255,o=255&c,d.push(t),64!==a&&(d.push(n),64!==s&&d.push(o)),l<e.length;);return d}(t),n=e,i(t,function(e,t){return String.fromCharCode(e^o(n,t))}).join("");var n}};function o(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){for(var n=[],o=0;o<e.length;o++)n[o]=t(e[o],o);return n}},getScormId:function(e,t){return e+(t=t?"-"+t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80):"")},confirm:function(e){kInteractive.alert(e)},alert:function(e){if(e){this.closeAlert();var t,n,o=document.createElement("div");o.setAttribute("id","kiSystemAlertBox"),e.raw&&(o.className="raw"),o.style.position="fixed",void 0===isKotobee&&(o.style.top=Math.round(window.innerHeight/2)+"px",o.style.left=Math.round(window.innerWidth/2)+"px"),e.rtl&&o.setAttribute("direction","rtl"),e.fullHeight&&(o.className+=" fullHeight"),e.raw?o.innerHTML=e.content.replace("&nbsp;","&#160;"):((t=document.createElement("div")).innerHTML=e.content.replace("&nbsp;","&#160;"),t.className="content",o.appendChild(t)),e.title&&((n=document.createElement("div")).innerHTML=e.title.replace("&nbsp;","&#160;"),n.className="header",o.insertBefore(n,o.firstChild)),kInteractive.alertIsOpen=!0;var i=document.createElement("a");if(!e.raw){var r=document.createElement("div");r.className="footer";var a,s="OK";try{"undefined"!=typeof translit&&(s=translit.get("ok"))}catch(e){}e.okBtn&&(s=e.okBtn),i.innerHTML=s.replace("&nbsp;","&#160;"),i.className="okBtn",i.addEventListener("click",kInteractive.closeAlert),e.cb&&i.addEventListener("click",e.cb),r.appendChild(i),e.noBtn&&((a=document.createElement("a")).innerHTML=e.noBtn,a.className="cancelBtn",a.addEventListener("click",kInteractive.closeAlert),r.appendChild(a)),o.appendChild(r)}var c=document.createElement("div");e.noBackdrop||(c.setAttribute("id","kiSystemAlertBackdrop"),c.addEventListener("click",kInteractive.closeAlert),c.style.position="fixed",document.body.appendChild(c)),document.body.appendChild(o),i.focus(),kInteractive.alert.resized=l,window.addEventListener("resize",l),setTimeout(function(){kInteractive.c.addClass(o,"show"),kInteractive.c.addClass(c,"show")},50)}function l(){void 0===isKotobee&&(o.style.top=Math.round(window.innerHeight/2)+"px",o.style.left=Math.round(window.innerWidth/2)+"px")}},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)-1==n.indexOf(t[i])&&(o=!1,n+=(""==n?"":" ")+t[i]);if(o)return}else{if(0<=n.indexOf(t))return;n+=(""==n?"":" ")+t}e.className=n},toggleClass:function(e,t){this.strHasClass(e.className,t)?this.removeClass(e,t):this.addClass(e,t)},hasClass:function(e,t){var n=e.className;return e instanceof SVGElement&&(n=n.baseVal),this.strHasClass(n,t)},strHasClass:function(e,t){for(var n=(e=e||"").trim().split(" "),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)0<=n.indexOf(t[i])&&(o=!1,n=n.replace(t[i],""));if(o)return}else{if(-1==n.indexOf(t))return;n=(n=n.replace(t,"")).replace(/ {2,}?/g," ")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);if(-1==t[t.length-1].indexOf("."))return e;t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==e.substr(0,1)&&(n="/"+n),n},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&0<n&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/kotobee:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/chrome-extension:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t}},shuffleArray:function(e){e.sort(function(){return Math.random()-.5})},allowDrop:function(e){e.preventDefault()},drag:function(e){e.stopPropagation(),e.dataTransfer&&e.dataTransfer.setData("text",e.target.id),dragged=e.target},drop:function(e){e.preventDefault(),e.target.hasAttribute("ondragover")&&e.target.appendChild(e.view.dragged)},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},getChildIndex:function(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t},isAbsolutePath:function(e){if(e)return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||(!!/.\:[\\\/].*/g.test(e.trim())||void 0))))},isMobile:function(e){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!0;try{if(0<window.location.href.indexOf("?preview")){for(var t=(t=window.location.href.split("?"))[1].split("&"),n={},o=0;o<t.length;o++){var i=t[o].split("=");n[i[0]]=i[1]}if(n.mobile)return!0}}catch(e){}},closeFullscreenVideo:function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)},getWidgetHome:function(e,t){return e.path?void 0===isKotobee?e.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e.path):void 0===isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/"},isKotobeeUser:function(){return void 0!==kotobee&&kotobee.user&&kotobee.user.loggedIn},getWidgetUrl:function(e,t){var n,o=kInteractive.getWidgetHome(e,t)+"/"+e.name+"/"+e.src;return void 0===isKotobee||(n=angular.element(document.body).scope().data.user)&&n.email&&n.signatures&&n.signatures.bookwidgets&&e.id&&0==e.id.indexOf("com.kidimedia")&&(o+="?oauth_signature="+n.signatures.bookwidgets.signature,o+="&oauth_nonce="+n.signatures.bookwidgets.nonce,o+="&oauth_timestamp="+n.signatures.bookwidgets.timestamp,o+="&oauth_consumer_key="+n.signatures.bookwidgets.key,o+="&lti_version=LTI-1p0",o+="&oauth_signature_method=HMAC-SHA1",o+="&oauth_version=1.0",o+="&tool_consumer_info_product_family_code=kotobee",o+="&lis_person_contact_email_primary="+n.email,o+="&lis_person_name_full="+(n.name?n.name:""),o+="&user_id="+n.id,o+="&lti_message_type=basic-lti-launch-request",angular.element(document.body).scope().refreshSignatures&&angular.element(document.body).scope().refreshSignatures()),o=kInteractive.cleanURL(o)},clearAudioVideo:function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),o=n.length;o--;)try{if(n[o].hasAttribute("data-dontclose"))continue;n[o].pause(),n[o].children.length||(n[o].src="")}catch(e){}for(var i=t.getElementsByTagName("video"),o=i.length;o--;)i[o].pause(),i[o].children.length||(i[o].src="")},cleanURL:function(e){try{native&&mobile&&(e=(e=window.Ionic.WebView.convertFileSrc(e)).replace(/([^:])\/\//g,"$1/"))}catch(e){}return e},listenForSwiping:function(a){a.addEventListener("touchstart",function(e){s=e.touches[0].clientX,c=e.touches[0].clientY},!1),a.addEventListener("touchmove",function(e){if(null===s)return;if(null===c)return;var t=e.touches[0].clientX,n=e.touches[0].clientY,o=s-t,i=c-n;5<o?(a.dispatchEvent(new Event("swipeleft")),r()):o<-5?(a.dispatchEvent(new Event("swiperight")),r()):5<i?(a.dispatchEvent(new Event("swipeup")),r()):i<-5&&(a.dispatchEvent(new Event("swipedown")),r());function r(){c=s=null}e.preventDefault()},!1);var s=null,c=null},unique:function(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})},getFile:function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200===n.status&&t(n.responseText)},n.send()},getBookID:function(){var e=document.head.querySelector('meta[name="kotobee-book"]');return void 0!==isKotobee&&kotobee.book?kotobee.book.meta.dc.identifier.replace("urn:uuid:","")+(kotobee.user&&kotobee.user.email?kotobee.user.email:""):e?e.content.replace("urn:uuid:",""):""},getChapterID:function(){var e,t;return(t=void 0!==isKotobee?kotobee.currentChapter?kotobee.currentChapter.url:"/ch1.xhtml":(e=document.head.querySelector('meta[name="kotobee-chapter"]'))?e.content:"").substring(t.lastIndexOf("/")+1).replace(".xhtml","")},setStorage:function(e){kInteractive.storage=e||sessionStorage},getLocalData:function(t,e){var n,o=t.label||t.category;t&&e&&(o?(n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",e(n=(n=JSON.parse(n)).filter(function(e){return t.label?t.category?t.subcategory?e.label==t.label&&e.category==t.category&&e.subcategory==t.subcategory:e.label==t.label&&e.category==t.category:e.label==t.label:t.subcategory?e.category==t.category&&e.subcategory==t.subcategory:e.category==t.category}))):e({error:"invalid label or category!"}))},getLocalDataArray:function(e,t){var n,o;Array.isArray(e)?t&&(n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",n=JSON.parse(n),o=[],e.forEach(function(t){(t.label||t.category)&&o.push({results:n.filter(function(e){return t.label?t.category?t.subcategory?e.label==t.label&&e.category==t.category&&e.subcategory==t.subcategory:e.label==t.label&&e.category==t.category:e.label==t.label:t.subcategory?e.category==t.category&&e.subcategory==t.subcategory:e.category==t.category})})}),t(o.length?o:n)):t([{error:"invalid array!"}])},setLocalData:function(t,e){var n,o,i;t&&e&&(t.label?t.data?(n={label:t.label,data:t.data,date:(new Date).toUTCString()},t.category&&(n.category=t.category),t.subcategory&&(n.subcategory=t.subcategory),i=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",i=JSON.parse(i),t.overwrite&&-1!=(o=i.findIndex(function(e){return t.category?t.subcategory?e.label==t.label&&e.category==t.category&&e.subcategory==t.subcategory:e.label==t.label&&e.category==t.category:e.label==t.label}))?i.splice(o,1,n):i.push(n),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(i)),e({success:"added"})):e({error:"invalid data!"}):e({error:"invalid label!"}))},setLocalDataArray:function(e,t){var o,i;Array.isArray(e)?t&&(o=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",o=JSON.parse(o),i={},e.forEach(function(t){var e,n;t.label?i.hasOwnProperty("error")||(e={label:t.label,data:t.data,date:(new Date).toUTCString()},t.category&&(e.category=t.category),t.subcategory&&(e.subcategory=t.subcategory),t.overwrite&&-1!=(n=o.findIndex(function(e){return t.category?t.subcategory?e.label==t.label&&e.category==t.category&&e.subcategory==t.subcategory:e.label==t.label&&e.category==t.category:e.label==t.label}))?o.splice(n,1,e):o.push(e)):i.error="invalid label!"}),i.hasOwnProperty("error")||(i.success="added"),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(o)),t(i)):t([{error:"invalid array!"}])},deleteLocalData:function(t,e){var n,o;t&&e&&(t.label?(n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",-1!=(o=(n=JSON.parse(n)).findIndex(function(e){return t.category?t.subcategory?e.label==t.label&&e.category==t.category&&e.subcategory==t.subcategory:e.label==t.label&&e.category==t.category:e.label==t.label}))&&n.splice(o,1),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),e({success:!0})):e({error:"invalid label!"}))},deleteLocalDataArray:function(e,t){var n,o;Array.isArray(e)?t&&(n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",n=JSON.parse(n),o={},e.forEach(function(t){var e;t.label?o.hasOwnProperty("error")||-1!=(e=n.findIndex(function(e){return t.category?t.subcategory?e.label==t.label&&e.category==t.category&&e.subcategory==t.subcategory:e.label==t.label&&e.category==t.category:e.label==t.label}))&&n.splice(e,1):o.error="invalid label!"}),o.hasOwnProperty("error")||(o.success=!0),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t(o)):t([{error:"invalid array!"}])},clearLocalData:function(){kInteractive.storage?kInteractive.storage.removeItem("ebook-"+kInteractive.getBookID()):kInteractive.error("unable to find storage!")},isEditorMode:function(){return"undefined"!=typeof editorMode&&editorMode},isPreview:function(){return/\/Kotobee\s?Author\//.test(location.pathname)},isSDK:function(){return void 0!==isKotobee?!isRelease:-1!=location.host.indexOf("localhost")&&-1!=["http:","https:"].indexOf(location.protocol)||-1!=location.href.indexOf("reader/www/epub/EPUB")},getBoundingBox:function(e){if(3!=e.nodeType)return e.getBoundingClientRect();var t=document.createRange();t.selectNode(e);var n=t.getBoundingClientRect();return t.detach(),n},simpleHash:function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t},phpDateToJS:function(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])},getClock:function(e){if(kInteractive.clocks||(kInteractive.clocks=[],setInterval(function(){for(var e=0;e<kInteractive.clocks.length;e++){var t=kInteractive.clocks[e];t.paused||(t.time++,t.cb&&t.cb(t.time))}},1e3)),kInteractive.clocks[e])return kInteractive.clocks[e];var t={id:e,time:0,pause:function(){this.paused=!0},resume:function(){this.paused=!1},destroy:function(){for(var e=0;e<kInteractive.clocks.length;e++)if(kInteractive.clocks[e]==this)return kInteractive.clocks.splice(e,1)}};return kInteractive.clocks.push(t),t},observe:function(e,n,o){kInteractive.observers||(kInteractive.observers=[]);var t=new IntersectionObserver(function(e){for(var t=0;t<e.length;t++)0==e[t].intersectionRatio?(o&&o(),e[t].hidden&&e[t].hidden()):(n&&n(),e[t].shown&&e[t].shown())},{threshold:[0,1],rootMargin:"0px"});kInteractive.observers.push(t),t.observe(e)},getTimezone:function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return"GMT"}}},sdkProfilesEnabled,sdkProfile;for(var item in kInteractiveCommon)kInteractive[item]=kInteractiveCommon[item];function kPersister(e){this.enabled=!0,this.delegateEvents=!0,this.storage="cloud",this.root=document.body,this.interval=200,this.maxDataSize=0,this.book="",this.chapter="",this.data=[],this.text=[],this.number=[],this.radio=[],this.checkbox=[],this.textarea=[],this.dragdrop=[],this.callback=null,this.silentMode=!1,this.appendDataMode=!1,this.forceNotification=!1,this.saveGlobal=!1,this.isSaveGlobal=!1,this.listener=null,this.testMode=!1,this.enableUncheckRadio=!1,this.setRadioGroup=!0,this.messages={save:"Save",unsaved:"You have unsaved changes",saving:"Saving your responses ..",saved:"Changes has been saved!",dismiss:"Dismiss",lastSaved:"Last saved on",longDataError:"Some answers not saved (marked in red)"},this.design={placement:"bottom-right",unsaved:{color:"#fff",background:"#de7a7a"},success:{color:"#fff",background:"#14c39a"}},this.enable=function(e){this.enabled=!0,this.silentMode=e,this.renderInlineBar(),this.renderFloatingBar()},this.disable=function(){this.enabled=!1,u(".unsaved-changes-"+n.root.id)&&u(".unsaved-changes-"+n.root.id).classList.remove("show")},this.setOptions=function(e){for(var t in e)"messages"==t?this.setMessages(e.messages):"design"==t?this.setDesign(e.design):this.hasOwnProperty(t)&&(this[t]=e[t],"root"==t&&(this[t].id=e[t].id||"_"+Math.random().toString(36).substr(2,9)))},this.setDesign=function(e){for(var t in e)this.design.hasOwnProperty(t)?(-1!=["placement"].indexOf(t)||e[t].color||e[t].background)&&(this.design[t]=e[t]):p("error",["invalid design state:",t])},this.setMessages=function(e){for(var t in e)if(this.messages.hasOwnProperty(t)){if(this.messages[t]=e[t],u(".unsaved-changes-"+this.root.id)&&!kInteractive.isEditorMode()&&u(".unsaved-changes-"+this.root.id+" ."+t))if("button"==u(".unsaved-changes-"+this.root.id+" ."+t).nodeName.toLowerCase())try{u(".unsaved-changes-"+this.root.id+" ."+t).innerText=e[t]}catch(e){}else try{u(".unsaved-changes-"+this.root.id+" ."+t+" span").innerText=e[t]}catch(e){}}else p("error",["invalid message key:",t])},this.waitFor=function(e,t,n){var o=this;n=n||0,window[e]||0==e.indexOf("#")&&"undefined"!=typeof document&&document.querySelector(e)||0==e.indexOf(".")&&"undefined"!=typeof document&&document.querySelector(e)||"document.body"==e&&"undefined"!=typeof document&&document.body?t():n<3e3?setTimeout(function(){o.waitFor(e,t,n+100)},100):(p("error",["unable to find:",e]),t&&t())},this.renderInlineBar=function(){var e,t,n=this;u(".persist-log-"+n.root.id)&&u(".persist-log-"+n.root.id).parentNode.removeChild(u(".persist-log-"+n.root.id)),n.silentMode&&!kInteractive.isEditorMode()&&(u(e=n.getRootSelector())?((t=u(e)).length&&(t=t[0]),t.insertAdjacentHTML("beforeend",'<div class="persist-log persist-log-'+n.root.id+'"><span class="saving" style="display:none;color:'+n.design.unsaved.background+'">'+n.messages.saving+'</span><span class="success" style="display:none;color:'+n.design.success.background+'">'+n.messages.lastSaved.trim()+" "+(new Date).toLocaleDateString()+'</span><span class="error" style="display:none"></span></div>')):p("warn",["unable to find root selector:",e]))},this.renderFloatingBar=function(){var e=this;if(u(".unsaved-changes-"+e.root.id)&&u(".unsaved-changes-"+e.root.id).parentNode.removeChild(u(".unsaved-changes-"+e.root.id)),!e.silentMode&&!kInteractive.isEditorMode()){var t="",n="",o="",i=e.design.placement.split("-");if(i.length&&(o+=i[0]+":70px;"),1<i.length)switch(o+=i[1]+":0px;",i[1]){case"left":t="-",n="";break;case"right":t="",n="-";break;default:p("error",["invalid horizontal placement:",i[1]])}var r,a="#fff",s="#333";void 0===kotobee||(r=document.querySelectorAll("#kotobee .tabs")).length&&(a=getComputedStyle(r[0]).backgroundColor,s=getComputedStyle(r[0]).color);var c='<style id="'+e.root.id+'-persister-styles">.unsaved-changes-'+e.root.id+"{"+o+";display:none;transform:translateX("+t+"100%);background:"+a+";color:"+s+"}.unsaved-changes-"+e.root.id+".show{display:block;transform: translateX("+n+"20px)}.unsaved-changes-"+e.root.id+" button{background-color:"+e.design.unsaved.background+";color:"+e.design.unsaved.color+"}.unsaved-changes-"+e.root.id+".success button{background-color:"+e.design.success.background+";color:"+e.design.success.color+"</style>";document.head.querySelector("#"+e.root.id+"-persister-styles")||document.head.insertAdjacentHTML("beforeend",c);var l=u(".perspectiveContainer")?u(".perspectiveContainer"):document.body;if(l){var d='<div class="unsaved-changes unsaved-changes-'+e.root.id+'"><div class="unsaved"><span>'+e.messages.unsaved+'</span> <button class="dismiss">'+e.messages.dismiss+'</button> <button class="save-now">'+e.messages.save+'</button></div><div class="saving" style="display:none;"><svg width="20px" height="20px" style="background:none;float:left;margin-top:5px;margin-right:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-rolling"><circle cx="50" cy="50" fill="none" stroke="#ffffff" stroke-width="10" r="35" stroke-dasharray="164.93361431346415 56.97787143782138" transform="rotate(149.879 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></circle></svg><span>'+e.messages.saving+'</span></div><div class="saved" style="display:none;"><span>'+e.messages.saved+'</span> <button class="dismiss">'+e.messages.dismiss+'</button></div><div class="notsaved" style="display:none;"><span></span> <button class="dismiss">'+e.messages.dismiss+"</button></div></div>";try{l.insertAdjacentHTML("afterbegin",d),e.waitFor(".unsaved-changes-"+e.root.id,function(){u(".unsaved-changes-"+e.root.id+" .dismiss",!0)?u(".unsaved-changes-"+e.root.id+" .dismiss",!0).forEach(function(e){e.addEventListener("click",function(e){u(e.currentTarget).parents(".unsaved-changes").classList.remove("show")})}):p("error",["unable to find dismiss button!"]),u(".unsaved-changes-"+e.root.id+" .save-now")?u(".unsaved-changes-"+e.root.id+" .save-now").addEventListener("click",function(){e.save()}):p("error",["unable to find save button!"])})}catch(e){p("error",[e,d])}}else p("error",["unable to find suitable container!"])}},this.getRootSelector=function(){return n.root.id?"#"+n.root.id:"."+n.root.className.splice(" ").join(".")},this.setNotify=function(e){this.enabled&&u(".unsaved-changes-"+this.root.id)&&!kInteractive.isEditorMode()&&(e&&e.constructor===Object&&0<Object.keys(e).length&&this.setOptions(e),u(".unsaved-changes-"+this.root.id).classList.contains("show")&&!u(".unsaved-changes-"+this.root.id).classList.contains("success")||this.updateNotification("reset"))},this.save=function(e){var t=this;if(t.enabled){t.collectInputs(),t.updateNotification("saving");var n=[];t.text&&t.text.forEach(function(e){e.id&&n.push(e)}),t.number&&t.number.forEach(function(e){e.id&&n.push(e)}),t.radio&&t.radio.forEach(function(e){e.id&&n.push(e)}),t.checkbox&&t.checkbox.forEach(function(e){e.id&&n.push(e)}),t.textarea&&t.textarea.forEach(function(e){e.id&&n.push(e)}),t.dragdrop&&t.dragdrop.forEach(function(e){e.dataset.category=Array.prototype.slice.apply(e.parentNode.classList).find(function(e){return-1!=e.indexOf("ki-dd-category")})||"",e.id&&n.push(e)});var o=n.map(function(e){var t=-1!=["radio","checkbox"].indexOf(e.type)?e.checked:"div"==e.nodeName.toLowerCase()?e.dataset.category||"":e.value;return{id:e.id,type:e.type||e.nodeName.toLowerCase(),value:t}});if(this.appendDataMode)for(var i=0;i<t.data.length;i++){var r=t.data[i],a=o.find(function(e){return e.id==r.id});a?Object.assign(r,a):o.push(r)}t.setLocalData(o,function(){"cloud"==t.storage&&kInteractive.isKotobeeUser()?void 0!==isKotobee?t.push(e):(t.updateNotification("success"),e&&e()):e&&e()})}},this.setLocalData=function(e,n){var o=this,t={label:kInteractive.getChapterID()+"-"+o.root.id,data:JSON.stringify(e),overwrite:!0};kInteractive.setLocalData(t,function(e){window.unsaved="cloud"==o.storage,"cloud"!=o.storage&&o.updateNotification("success");var t={target:o};e.error?t.error=e.error:t.result=e,o.listener.emit("persister.saved",t),"function"==typeof n&&n()})},this.getLocalData=function(){var o=this;return new Promise(function(n){if("cloud"==o.storage&&void 0!==isKotobee&&kInteractive.isKotobeeUser())try{kotobee.getData({label:kInteractive.getChapterID()+"-"+o.root.id},function(e){e.length?(o.merge(e),t()):(o.data=[],n())})}catch(e){o.listener.emit("persister.error",e.toString()),n()}else kInteractive.getLocalDataArray([{}],function(e){e.length?kInteractive.setLocalDataArray(o.cleanupData(e).map(function(e){return Object.assign(e,{overwrite:!0})}),t):t()});function t(){kInteractive.getLocalData({label:kInteractive.getChapterID()+"-"+o.root.id},function(t){if(Array.isArray(t)){if(t.length)try{o.data=JSON.parse(t[0].data)}catch(e){o.data=[],u("body.cke_editable")||o.listener.emit("persister.error",{target:o,error:'invalid or empty slot for "'+kInteractive.getChapterID()+"-"+o.root.id+'": '+JSON.stringify(t)})}else o.data=[];n()}else u("body.cke_editable")||o.listener.emit("persister.error",{target:o,error:'invalid or empty slot for "'+kInteractive.getChapterID()+"-"+o.root.id+'": '+JSON.stringify(t)})})}})},this.cleanupData=function(e){return Array.isArray(e)?e.slice(0).sort(function(e,t){return e.date>t.date?-1:e.date<t.date?1:0}).filter(function(t,e,n){return n.findIndex(function(e){return e.label==t.label})==e}):(p("error",["invalid data:",e]),[])},this.clear=function(n){var o=this;function t(e){p("warn",[e]),window.unsaved=!1;var t={target:o};e.error?t.error=e.error:t.result=e,o.listener.emit("persister.unsaved",t),"function"==typeof n&&n()}kInteractive.deleteLocalData({label:kInteractive.getChapterID()+"-"+o.root.id},function(e){e.success&&("cloud"==o.storage&&kInteractive.isKotobeeUser()?kotobee.deleteData({label:kInteractive.getChapterID()+"-"+o.root.id},function(e){e.success&&t(e)}):t(e))})},this.merge=function(e){var t,n,o=this;1<e.length&&(p("warn",["duplicate slots:",t=e.sort(function(e,t){return e.date>t.date?-1:e.date<t.date?1:0})]),p("warn",["deleting all slots matching",(n=t[0]).label]),kotobee.deleteData({label:n.label,all:!0},function(e){p("warn",[e]),p("warn",["insert only last slot for",n.label]),kotobee.setData(n,function(e){p("warn",[e])})}));var i=o.storageAPI.getItem("ebook-"+kInteractive.getBookID())||"[]",r=(i=JSON.parse(i)).findIndex(function(e){return e.label==kInteractive.getChapterID()+"-"+o.root.id});-1!=r&&i.splice(r,1),i=i.concat(e),i=o.cleanupData(i),o.storageAPI.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(i))},this.push=function(t){var n=this;if(n.enabled){var e=n.storageAPI.getItem("ebook-"+kInteractive.getBookID())||"[]";if(e=(e=JSON.parse(e)).map(function(e){var t=JSON.parse(JSON.stringify(e));return t.overwrite=!0,delete t.date,t}),"cloud"==n.storage&&kInteractive.isKotobeeUser())try{var o=n.cleanupData(e),i=o;i.forEach(function(e){JSON.parse(e.data).forEach(function(e){var t=u("#"+e.id);t&&t.classList.remove("inputError")})});o.filter(function(e){return e.data.length>n.maxDataSize});var r=[];0,kotobee.setDataArray(i,function(e){p("warn",[e]),a(t,e.error||(r.length?n.messages.longDataError:null))})}catch(e){a(t,e.toString())}else a(t)}function a(e,t){window.unsaved=!1,t?(n.updateNotification("error",t),n.listener.emit("persister.error",{target:n,error:t})):(n.updateNotification("success"),n.listener.emit("persister.pushed",{target:n,result:{success:"pushed"}}),n.isSaveGlobal?("function"==typeof n.saveGlobal?n.saveGlobal():"object"==typeof n.saveGlobal&&n.saveGlobal.hasOwnProperty("callback")&&n.saveGlobal.callback(),n.isSaveGlobal=!1):"function"==typeof e&&e())}},this.updateNotification=function(e,t){var n=this;try{if(n.enabled&&!kInteractive.isEditorMode())if(u(".persist-log-"+n.root.id)&&n.silentMode)switch(e){case"saving":u(".persist-log-"+n.root.id+" span.saving").style.display="block",u(".persist-log-"+n.root.id+" span.success").style.display="none",u(".persist-log-"+n.root.id+" span.error").style.display="none";break;case"success":u(".persist-log-"+n.root.id+" span.saving").style.display="none",u(".persist-log-"+n.root.id+" span.success").style.display="block",u(".persist-log-"+n.root.id+" span.error").style.display="none";break;case"error":u(".persist-log-"+n.root.id+" span.saving").style.display="none",u(".persist-log-"+n.root.id+" span.success").style.display="none",u(".persist-log-"+n.root.id+" span.error").style.display="block",u(".persist-log-"+n.root.id+" span.error").textContent=t||"Unexpected error!"}else if(u(".unsaved-changes-"+n.root.id))switch(e){case"saving":u(".unsaved-changes-"+n.root.id+" .saved").style.display="none",u(".unsaved-changes-"+n.root.id+" .saving").style.display="block",u(".unsaved-changes-"+n.root.id+" .unsaved").style.display="none",u(".unsaved-changes-"+n.root.id+" .notsaved").style.display="none",u(".unsaved-changes-"+n.root.id).classList.contains("success")&&u(".unsaved-changes-"+n.root.id).classList.remove("success"),n.silentMode||u(".unsaved-changes-"+n.root.id).classList.contains("show")||u(".unsaved-changes-"+n.root.id).classList.add("show");break;case"success":u(".unsaved-changes-"+n.root.id+" .saving").style.display="none",n.silentMode||n.isSaveGlobal?u(".unsaved-changes-"+n.root.id).classList.remove("show"):(u(".unsaved-changes-"+n.root.id).classList.add("success"),u(".unsaved-changes-"+n.root.id+" .saved").style.display="block");break;case"error":u(".unsaved-changes-"+n.root.id+" .saving").style.display="none",n.silentMode||n.isSaveGlobal?u(".unsaved-changes-"+n.root.id).classList.remove("show"):(u(".unsaved-changes-"+n.root.id).classList.add("error"),u(".unsaved-changes-"+n.root.id+" .notsaved span").textContent=t||"Unexpected error!",u(".unsaved-changes-"+n.root.id+" .notsaved").style.display="block");break;case"reset":u(".unsaved-changes-"+n.root.id+" .saved").style.display="none",u(".unsaved-changes-"+n.root.id+" .saving").style.display="none",u(".unsaved-changes-"+n.root.id+" .unsaved").style.display=n.silentMode?"none":"block",u(".unsaved-changes-"+n.root.id+" .notsaved").style.display="none",u(".unsaved-changes-"+n.root.id).classList.contains("success")&&u(".unsaved-changes-"+n.root.id).classList.remove("success"),n.silentMode||u(".unsaved-changes-"+n.root.id).classList.contains("show")||u(".unsaved-changes-"+n.root.id).classList.add("show")}}catch(e){}},this.collectInputs=function(){var e=this,t=this.getRootSelector();e.root=u(t),e.root?(e.text=u(e.root).find('input[type="text"]',!0),e.number=u(e.root).find('input[type="number"]',!0),e.radio=u(e.root).find('input[type="radio"]',!0),e.checkbox=u(e.root).find('input[type="checkbox"]:not([name="preserveAnswers"])',!0),e.textarea=u(e.root).find("textarea",!0),e.dragdrop=u(e.root).find(".ki-draggable",!0)):p("error",["unable to re-select root element by:",t])},this.handleChange=function(){this.enabled&&(this.silentMode?this.save():this.saveGlobal&&!this.forceNotification||this.setNotify())},this.processInputs=function(){var s=this;function c(){p("warn",["persister change handler:",this.id,-1!=["radio","checkbox"].indexOf(this.type)?this.checked:this.value]),s.handleChange()}function t(e,t){document.body.addEventListener(e,function(e){var o,i,r,a;e.target.id==t.id&&(-1!=["radio","checkbox"].indexOf(t.type)?t.checked=e.target.checked:t.value=e.target.value,o=c.bind(t),i=(i=s.interval)||20,r=r||!0,function(){var e=this,t=arguments,n=r&&!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}())})}s.collectInputs();var o=0;if(s.text&&s.text.forEach(function(e){e.id||(e.id=(e.name?e.name:"tx")+"-"+o),o++,e.id&&!e.dataset.freeze&&(t("keyup",e),t("change",e))}),s.number&&s.number.forEach(function(e){e.id||(e.id=(e.name?e.name:"num")+"-"+o),o++,e.id&&!e.dataset.freeze&&(t("keyup",e),t("change",e))}),s.radio&&s.radio.forEach(function(n){n.id||(n.id=(n.name?n.name:"rb")+"-"+o),o++,n.id&&!n.dataset.freeze&&(s.enabledUncheckRadio?document.body.addEventListener("click",function(e){var t;e.target.id==n.id&&(t=e.target.dataset.state||"",Boolean(t.toString())?(e.target.checked=!1,e.target.dataset.state=""):e.target.dataset.state=e.target.checked,c.call(n))}):t("change",n))}),s.checkbox&&s.checkbox.forEach(function(e){e.id||(e.id=(e.name?e.name:"cb")+"-"+o),o++,e.id&&!e.dataset.freeze&&t("change",e)}),s.textarea&&s.textarea.forEach(function(e){e.id||(e.id=(e.name?e.name:"ta")+"-"+o),o++,e.id&&!e.dataset.freeze&&(t("keyup",e),t("change",e))}),s.setRadioGroup)try{s.radio&&s.radio.forEach(function(e){e.name=e.id?e.id.match(/(.*?)(\d+)/)[0].replace("-0-",""):e.name})}catch(e){}},this.restore=function(e){var a=this;setTimeout(function(){a.getLocalData().then(function(){a.data.length&&a.data.forEach(function(e){var t=e.id;if(t)if(isNaN(t)){var n,o,i,r=u("#"+t);if(r)switch(e.type){case"text":case"number":case"textarea":r.value=e.value||"";break;case"radio":case"checkbox":r.checked=e.value;break;case"div":e.value&&((n=r.cloneNode(!0)).dataset.category=e.value,!(o=a.getQContainer(r))||(i=o.getElementsByClassName(e.value)[0])&&(i.appendChild(n),r.parentNode.removeChild(r)));break;default:p("warn",["invalid input type:",e.type])}else p("error",["unable to find input by id:",t])}else p("error",["invalid input selector:",t]);else p("error",["invalid input selector:",t])}),a.renderInlineBar(),"function"==typeof e?e():(window.unsaved=!1,a.listener.emit("persister.restored",{target:a}))})},0)},this.getQContainer=function(e){for(;!e.classList.contains("ques");)e=e.parentNode;return e},this.renderSaveTab=function(e){var t,n,o,i,r=this;e?e.addEventListener("click",function(e){e.preventDefault(),r.isSaveGlobal=!0,r.push()}):u("#save-changes")||(t=u("#tabMenu"))&&((n=t.querySelectorAll("a:not(.chapterBtn)")).length&&(o=(n=n[0]).parentNode,(i=n.cloneNode(!0)).id="save-changes",i.querySelector(".icon").className="icon ion-"+(r.saveGlobal.icon||"checkmark-circled"),i.querySelector(".tab-title").innerText=r.saveGlobal.label||r.messages.save,o.insertAdjacentHTML("beforeend",i.outerHTML)),u("#save-changes").addEventListener("click",function(e){e.preventDefault(),r.isSaveGlobal=!0,r.push()}))},this.init=function(){var t=this;function n(){t.delegateEvents&&t.processInputs(),t.enabled&&(t.renderInlineBar(),t.renderFloatingBar()),window.addEventListener("beforeunload",function(e){void 0!==kotobee&&(-1!=!location.hostname.indexOf("localhost")&&-1!=!location.hostname.indexOf("127.0.0.1")||"undefined"!=typeof config&&!config.kotobee.public||t.testMode)&&window.unsaved&&(t.setNotify(),e.preventDefault(),e.returnValue="",delete e.returnValue)})}kInteractive.isEditorMode()||("cloud"==t.storage&&kInteractive.isKotobeeUser()?kotobee.getDataPerms(function(e){e&&e.maxDataSize&&(t.maxDataSize=e.maxDataSize,p("warn",["data size limit:",t.maxDataSize]),n())}):n()),window.unsaved=!1,t.listener.emit("persister.ready",{target:t})},this.listener=new function(){this.listeners={},this.on=function(e,t){return this.addListener(e,t)},this.once=function(e,t){this.listeners[e]=this.listeners[e]||[];var n=function(){t(),this.off(e,n)};return this.listeners[e].push(n),this},this.off=function(e,t){return this.removeListener(e,t)},this.die=function(e){return this.removeAllListeners(e)},this.addListener=function(e,t){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t),this},this.removeListener=function(e,t){var n=this.listeners[e]||[];return this.listeners[e]=n.filter(function(e){return e!==t}),this},this.removeAllListeners=function(e){return delete this.listeners[e],this},this.emit=function(){if(arguments.length<1)return!1;var e=arguments[0],t=this.listeners[e];if(!t)return!1;var n=1<arguments.length?Array.prototype.slice.call(arguments).slice(1):[];return t.forEach(function(e){e.apply(this,n)}),!0},this.listListeners=function(e){return this.listeners[e]||[]}};var t,n=this;function u(e){if(arguments.length<1)return null;var t=e,i=null;if("string"==typeof t){var n=!1,o=document;if(1<arguments.length)for(var r,a=Array.prototype.slice.call(arguments).slice(1),s=0;s<a.length;s++)"boolean"==typeof(r=a[s])?n=r:"object"==typeof r&&(o=r);if(0==(i=Array.prototype.slice.call(o.querySelectorAll(t))).length)return null;i=n||1!=i.length?i:i[0]}else i=t;return Array.isArray(i)||(i.find=function(e,t){return u(e,i,t)},i.parents=function e(t){var n=null;var o=-1!=t.indexOf(".")?t.split(".")[1]:"";i.parentNode.nodeName.toLowerCase()==t.toLowerCase()||""!=o&&i.parentNode.classList.contains(o)||i.parentNode.id==t.replace("#","")?n=i.parentNode:"body"==i.parentNode.nodeName.toLowerCase()||n||(i=i.parentNode,n=e(t));return n},i.closest=function(e){return function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}(i,e)},i.ascendants=function(e){return function(e){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n});for(var t=[];e&&e!==document;e=e.parentNode)t.push(e);return t}(i)}),i}function p(e,t){"dev"==(window.debug||-1!=location.hostname.indexOf(".local")||-1!=location.hostname.indexOf("kotobee.com")||-1!=location.hostname.indexOf("localhost")||-1!=location.hostname.indexOf("localhost")||-1!=location.hostname.indexOf("192.168.")?"dev":"production")&&console[e].apply(null,t)}t=this.listener,Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]}).forEach(function(e){n[e]||(n[e]=n.listener[e].bind(n.listener))}),e&&this.setOptions(e),this.storageAPI=-1!=["session","cloud"].indexOf(this.storage)?sessionStorage:localStorage,kInteractive.setStorage(this.storageAPI)}function setConfigDefaults(){null==config.mediaTab&&(config.mediaTab=!0),null==config.settingsTab&&(config.settingsTab=!0),null==config.notebookTab&&(config.notebookTab=!0),null==config.textSizeControls&&(config.textSizeControls=!0),null==config.chaptersTab&&(config.chaptersTab=!0),null==config.showCategories&&(config.showCategories=!0),null==config.showFavorites&&(config.showFavorites=!0),null==config.styleControls&&(config.styleControls=!1),null==config.imagesInMediaTab&&(config.imagesInMediaTab=!0),null==config.copyBookURLBtn&&(config.copyBookURLBtn=!0),config.gotoPageOffset&&(config.gotoPageOffset=Number(config.gotoPageOffset)),null==config.mediaModalTitle&&(config.mediaModalTitle=!0)}if(kInteractive.setStorage(),kInteractive.container={preRender:function(e,t){var n,o,i=kInteractive.readData(e);i&&i.path&&(n=e.getAttribute("style"),o=kInteractive.cleanURL(i.path),e.setAttribute("style",n+' background-image:url("'+o+'");'))},postRender:function(e,t,n){var o=kInteractive.readData(t);o&&kInteractive.isMobile()&&"cScroll"==o.type&&void 0!==isKotobee&&angular.element(document.body).scope().applyNativeScroll(t)},action:function(e){},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.equation={preRender:function(e,t){var n,o;kInteractive.isEditorMode()||"undefined"==typeof MathJax&&(MathJax={loader:{load:["input/asciimath","input/mml","input/tex","output/chtml","ui/menu"]}},n=document.createElement("script"),o="",o=void 0===isKotobee?"../../js/lib/mathjax/startup.js":bookPath+"EPUB/js/lib/mathjax/startup.js",n.src=kInteractive.cleanURL(o),n.setAttribute("type","text/javascript"),document.head.appendChild(n))},postRender:function(root,item,index){var frag=root.createDocumentFragment(),eData=kInteractive.readData(item);if(eData){item.setAttribute("id","ki-equation-"+index),item.innerHTML="";var content=eData.content,img,path,path;!eData.img||"image"!=eData.rendermode&&supportsEs6()?"mathml"==eData.type?content="<math>"+content+"</math>":"asciimath"==eData.type?content="`"+content+"`":"tex"==eData.type&&(content="\\("+content+"\\)"):(img=document.createElement("img"),path=void 0===isKotobee?eData.img:ph.join(kInteractive.absoluteURL,eData.img),path=kInteractive.cleanURL(path),img.className="equationImg",img.src=path,eData.imgHeight?img.style.maxHeight=eData.imgHeight+"px":eData.imgWidth&&(img.style.maxWidth=eData.maxWidth+"px"),content=img.outerHTML);var tagName="inline"==eData.placement?"span":"div",container=document.createElement(tagName);container.setAttribute("id","ki-equation-"+index+"-container"),container.className="parsed container";try{container.innerHTML=content}catch(e){container.textContent=content}var styleContainer=document.createElement(tagName);eData.style&&kInteractive.c.addClass(styleContainer,eData.style),frag.appendChild(container),styleContainer.appendChild(frag),item.appendChild(styleContainer),kInteractive.isEditorMode()||MathJax&&MathJax.typeset&&MathJax.typeset()}function supportsEs6(){try{return eval('"use strict"; class foo {}'),1}catch(e){}}},action:function(e){kInteractive.readData(e)},resize:function(e){kInteractive.readData(e)}},kInteractive.gallery={preRender:function(e,t){var n=t.createDocumentFragment(),o=kInteractive.readData(e);if(o){e.innerHTML="";var i=(i=e.getAttribute("data-index"))||0;o.rtl&&kInteractive.c.addClass(e,"dirRtl");var r=document.createElement("div");r.className="imgMask";var a=document.createElement("div");a.className="images "+o.scale;var s=o.rtl?"right":"left";a.style[s]="0",r.appendChild(a);for(var c=0;c<o.imgs.length;c++){var l=document.createElement("div");l.className="imgContainer ki-btn";var d=void 0===isKotobee?o.imgs[c].path:ph.join(kInteractive.absoluteURL,o.imgs[c].path),d=kInteractive.cleanURL(d);l.setAttribute("style","background-color:"+o.bgColor+";background-image:url('"+d+"')"),o.imgs[c].caption&&l.setAttribute("data-caption",o.imgs[c].caption),void 0!==isKotobee||kInteractive.c.hasClass(e,"fullscreen")||l.addEventListener("click",kInteractive.actionEvent),a.appendChild(l)}var u=document.createElement("div");u.className="navBtns";var p=document.createElement("a");p.className="next btn ki-btn",u.appendChild(p);var h=document.createElement("a");h.className="prev btn ki-btn",u.appendChild(h),n.appendChild(u),void 0!==isKotobee&&!kInteractive.c.hasClass(e,"fullscreen")||(p.addEventListener("click",kInteractive.actionEvent),h.addEventListener("click",kInteractive.actionEvent)),n.appendChild(r);var g=document.createElement("div");g.className="kFooter",o.footerShadow&&(g.className+=" shadow"),n.appendChild(g);var f=document.createElement("div");f.className="imgCaption";var m,v,b=document.createElement("div");b.className="inner",b.style.display="none",o.imgs[0]&&o.imgs[0].caption&&(b.innerHTML=o.imgs[0].caption,b.style.display=null),f.appendChild(b),g.appendChild(f),o.thumbnails&&((m=document.createElement("div")).className="kThumbs",o.thumbShowOnHover&&(m.className+=" showOnHover"),"small"==o.thumbSize?kInteractive.c.addClass(m,"small"):"large"==o.thumbSize?kInteractive.c.addClass(m,"large"):kInteractive.c.addClass(m,"medium"),g.appendChild(m)),kInteractive.c.hasClass(e,"fullscreen")&&((v=document.createElement("div")).className="fullscreenControls",v.innerHTML="<a class='closeBtn ki-btn'></a>",e.appendChild(v),v.children[0].addEventListener("click",kInteractive.actionEvent),document.addEventListener("keydown",kInteractive.gallery.detectKey));var k=document.createElement("div");o.style&&kInteractive.c.addClass(k,o.style),k.appendChild(n),e.appendChild(k),kInteractive.gallery.dimBtns(e),kInteractive.gallery.resize(e),this.showImage(e,{index:i,dontGoFullscreen:!0}),setTimeout(function(){kInteractive.gallery.showImage(e,{index:i,dontGoFullscreen:!0})},80)}},postRender:function(e,t,n){kInteractive.gallery.resize(t);var o=this.getState(t);this.dimBtns(t),this.showImage(t,{index:o.selectedIndex,dontGoFullscreen:!0})},action:function(e,t,n){var o;kInteractive.readData(e),e.getElementsByClassName("images")[0].getElementsByClassName("selected")[0];if(kInteractive.hasClass(t,"btn")){if(kInteractive.hasClass(t,"disable"))return n.stopPropagation();kInteractive.hasClass(t,"next")?kInteractive.gallery.showImage(e,{dir:"next"}):kInteractive.hasClass(t,"prev")&&kInteractive.gallery.showImage(e,{dir:"prev"})}else if(kInteractive.hasClass(t,"closeBtn"))kInteractive.gallery.exitFullscreen();else if(kInteractive.hasClass(t,"imgContainer")){if(kInteractive.readData(e).fullscreenMode)return kInteractive.gallery.goToFullscreen(e)}else{kInteractive.hasClass(t,"kMapItem")?(o=kInteractive.getChildIndex(t),kInteractive.gallery.goToThumb(e,{windowIndex:o,highlightThumb:!1})):kInteractive.hasClass(t,"kThumb")?(o=t.getAttribute("data-index"),kInteractive.gallery.showImage(e,{index:t.getAttribute("data-index")})):kInteractive.hasClass(t,"thumbNavBtn")&&(kInteractive.hasClass(t,"next")?kInteractive.gallery.goToThumb(e,{dir:"nextWindow",highlightThumb:!1}):kInteractive.hasClass(t,"prev")&&kInteractive.gallery.goToThumb(e,{dir:"prevWindow",highlightThumb:!1}))}kInteractive.gallery.dimBtns(e)},goToThumb:function(e,t){var n=kInteractive.readData(e);t=t||{};var o,i,r,a,s=this.getState(e),c=s.thumbWindows,l=s.activeWindow,d=s.currentIndex,u=s.selectedIndex,p=s.currentThumb,h=t.index;if(null==h&&(null!=t.windowIndex?h=t.windowIndex*c[0].children[0].children.length:("nextThumb"==t.dir&&(h=u+1),"prevThumb"==t.dir&&(h=u-1),"nextWindow"==t.dir&&(h=d+c[0].children[0].children.length),"prevWindow"==t.dir&&(h=d-c[0].children[0].children.length))),c.length)for(var g=c[0].getElementsByClassName("kThumb"),f=g.length;f--;)if(g[f].getAttribute("data-index")==h){o=g[f],i=o.parentNode;break}i&&(r=n.rtl?"right":"left",l!=i&&(d<h?(l.style[r]=-e.offsetWidth+"px",i.style[r]=e.offsetWidth/2+"px"):(l.style[r]=e.offsetWidth+"px",i.style[r]=-e.offsetWidth/2+"px"),i.style.display="none",setTimeout(function(){i.style.display="block",setTimeout(function(){i.style[r]=0},20)},20),(a=e.getElementsByClassName("kMapItem")).length&&(l&&kInteractive.c.removeClass(a[kInteractive.getChildIndex(l)],"active"),kInteractive.c.addClass(a[kInteractive.getChildIndex(i)],"active")),kInteractive.c.addClass(i,"active"),kInteractive.c.removeClass(l,"active")),t.highlightThumb&&(kInteractive.c.removeClass(p,"active"),kInteractive.c.addClass(o,"active")))},dimBtns:function(e){for(var t,n=e.getElementsByClassName("kThumbWindow"),o=n.length;o--;)if(kInteractive.c.hasClass(n[o],"active")){t=n[o];break}if(t)for(var i=e.getElementsByClassName("thumbNavBtn"),o=0;o<i.length;o++)kInteractive.c.hasClass(i[o],"next")?t.nextElementSibling?kInteractive.c.removeClass(i[o],"disable"):kInteractive.c.addClass(i[o],"disable"):kInteractive.c.hasClass(i[o],"prev")&&(t.previousElementSibling?kInteractive.c.removeClass(i[o],"disable"):kInteractive.c.addClass(i[o],"disable"));var r=e.getElementsByClassName("imgContainer");if(r.length)for(var a=kInteractive.c.hasClass(r[0],"selected"),s=kInteractive.c.hasClass(r[r.length-1],"selected"),c=e.getElementsByClassName("btn"),o=0;o<c.length;o++)kInteractive.c.hasClass(c[o],"next")?s?kInteractive.c.addClass(c[o],"disable"):kInteractive.c.removeClass(c[o],"disable"):kInteractive.c.hasClass(c[o],"prev")&&(a?kInteractive.c.addClass(c[o],"disable"):kInteractive.c.removeClass(c[o],"disable"))},getState:function(e){var t={};t.images=e.getElementsByClassName("images")[0],t.selectedImg=t.images.getElementsByClassName("selected"),t.imgContainer=e.getElementsByClassName("imgContainer"),t.thumbWindows=e.getElementsByClassName("kThumbWindows");for(var n=0;n<t.imgContainer.length;n++)if(kInteractive.c.hasClass(t.imgContainer[n],"selected")){t.selectedIndex=n;break}if(t.thumbWindows.length)for(var o=t.thumbWindows[0].getElementsByClassName("active"),n=0;n<o.length;n++)kInteractive.c.hasClass(o[n],"kThumbWindow")?(t.activeWindow=o[n],t.currentIndex=Number(t.activeWindow.children[0].getAttribute("data-index"))):t.currentThumb=o[n];return t},goToFullscreen:function(e){var t,n,o,i;kInteractive.frameIsOpen=!0,kInteractive.c.hasClass(e,"fullscreen")||((t=document.createElement("div")).innerHTML=e.outerHTML,n=t.children[0],document.body.appendChild(n),o=this.getState(e),i=e.getBoundingClientRect(),n.setAttribute("data-index",o.selectedIndex),n.setAttribute("id","kFullscreenGallery"),n.style.top=i.top+"px",n.style.left=i.left+"px",n.style.width=i.width+"px",n.style.height=i.height+"px",kInteractive.listenForSwiping(n),n.addEventListener("swipeleft",function(){kInteractive.gallery.showImage(n,{dir:"next"})}),n.addEventListener("swiperight",function(){kInteractive.gallery.showImage(n,{dir:"prev"})},!1),void 0===isKotobee&&(n.style.position="fixed"),kInteractive.c.addClass(n,"fullscreen"),kInteractive.preRender(n,{singleElem:!0}),kInteractive.postRender(n,{singleElem:!0}),setTimeout(function(){kInteractive.c.addClass(n,"in")},20))},showImage:function(e,t){t=t||{};var n=kInteractive.readData(e),o=this.getState(e),i=o.images,r=o.selectedImg,a=o.imgContainer,s=t.index;null==s&&r.length&&(s=kInteractive.getChildIndex(r[0])+("next"==t.dir?1:-1)),s<0&&(s=0),null==s&&(s=0),r.length&&kInteractive.c.removeClass(r[0],"selected"),kInteractive.c.addClass(a[s],"selected");var c=n.rtl?"right":"left";a[s].style[c]=i.offsetWidth*s+"px",a[s].style.display="block",i.style[c]=-i.offsetWidth*s+"px",this.goToThumb(e,{index:s,highlightThumb:!0});var l=e.getElementsByClassName("imgCaption");if(l.length){var d=(l=l[0]).getElementsByClassName("inner");if(d.length&&((d=d[0]).style.display="none",a[s].hasAttribute("data-caption")&&(d.innerHTML=a[s].getAttribute("data-caption"),n.captionFontSize&&(d.style.fontSize=n.captionFontSize+"em"),n.captionColor&&(d.style.color=n.captionColor),d.style.display=null),!n.footerOverlap)){var u=e.getElementsByClassName("imgMask");if(!u.length)return;u=u[0];var p=e.getElementsByClassName("kFooter")[0];u.style.bottom=p.offsetHeight+"px"}}},detectKey:function(e){kInteractive.gallery.exitFullscreen()},exitFullscreen:function(){var e=document.getElementById("kFullscreenGallery");e&&(kInteractive.c.removeClass(e,"in"),e.style.opacity=0,setTimeout(function(){e.parentNode.removeChild(e),document.removeEventListener("keydown",kInteractive.gallery.detectKey)},1e3))},resize:function(e){var t=kInteractive.readData(e);if(t&&(kInteractive.checkResponsiveFloat(t,e),t.thumbnails)){var n=kInteractive.gallery.getState(e).selectedIndex;null==n&&(e.getAttribute("data-index"),n=n||0);var o=e.getElementsByClassName("kThumbs")[0];o.innerHTML="";var i=50;"small"==t.thumbSize?i=40:"large"==t.thumbSize&&(i=60);var r,a=Math.floor((e.offsetWidth-80)/i),s=document.createElement("div");s.className="kThumbWindows";for(var c,l,d,u,p=0;p<t.imgs.length;p++){t.imgs[p].thumbPath&&((c=document.createElement("a")).className="ki-btn kThumb"+(p==n?" active":""),c.setAttribute("data-index",p),l=void 0===isKotobee?t.imgs[p].thumbPath:ph.join(kInteractive.absoluteURL,t.imgs[p].thumbPath),l=kInteractive.cleanURL(l),c.setAttribute("style","background-image:url('"+l+"')"),void 0!==isKotobee&&!kInteractive.c.hasClass(e,"fullscreen")||c.addEventListener("click",kInteractive.actionEvent),p%a==0&&((r=document.createElement("div")).className="kThumbWindow",t.rtl&&r.setAttribute("dir","rtl"),s.appendChild(r)),p==n&&kInteractive.c.addClass(r,"active"),r.appendChild(c))}if(o.appendChild(s),t.thumbMap){var h=document.createElement("div");h.className="kThumbMap",t.rtl&&h.setAttribute("dir","rtl");for(var g,p=0;p<t.imgs.length;p++){p%a==0&&((g=document.createElement("a")).className="ki-btn kMapItem"+(p==n?" active":""),h.appendChild(g),void 0!==isKotobee&&!kInteractive.c.hasClass(e,"fullscreen")||g.addEventListener("click",kInteractive.actionEvent))}o.appendChild(h)}1<s.children.length&&((d=document.createElement("a")).className="thumbNavBtn next",o.appendChild(d),(u=document.createElement("a")).className="thumbNavBtn prev",o.appendChild(u),void 0!==isKotobee&&!kInteractive.c.hasClass(e,"fullscreen")||(d.addEventListener("click",kInteractive.actionEvent),u.addEventListener("click",kInteractive.actionEvent)))}}},kInteractive.image={preRender:function(e,t){var n=kInteractive.readData(e);n&&(n.style&&kInteractive.c.addClass(e,n.style),n.popup&&n.splash&&(e.src=n.splash),e.parentNode&&kInteractive.hasClass(e.parentNode,"link")||void 0===isKotobee&&e.addEventListener("click",kInteractive.actionEvent))},postRender:function(e,t,n){kInteractive.readData(t)},action:function(e,o,t){var n,i;function r(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function a(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function s(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}o.parentNode&&kInteractive.hasClass(o.parentNode,"kInteractive")&&kInteractive.hasClass(o.parentNode,"link")?kInteractive.action(o.parentNode,event):!(n=kInteractive.readData(o))||"none"!=(i=n.behavior)&&(r(o,"none"),a(o,"none"),s(o,"none"),setTimeout(function(){"wiggle"==i?(r(o,"wiggle"),a(o,"0.5s"),s(o,"1")):"jump"==i?(r(o,"jump"),a(o,"0.7s"),s(o,"1")):"scale"==i&&(r(o,"scale"),a(o,"0.5s"),s(o,"1"));var n=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();n&&o.addEventListener(n,function e(t){r(o,"none"),a(o,"none"),s(o,"none"),o.removeEventListener(n,e)})}),kInteractive.tinCan({verb:"clicked",activity:i+"image: "+o.getAttribute("src")}))},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.link={preRender:function(e,t){var n,o,i=kInteractive.readData(e);i&&(kInteractive.isEditorMode()||("#"==e.getAttribute("href")&&e.setAttribute("href",""),"div"==e.nodeName.toLowerCase()&&(n=document.createElement("a"),o=e.getAttribute("href")?e.getAttribute("href"):i.href,e.getAttribute("data-href")&&(o=e.getAttribute("data-href")),o=o||"",n.setAttribute("href",o),n.setAttribute("target",i.target?i.target:""),n.setAttribute("style",e.getAttribute("style")),n.setAttribute("data-kotobee",e.getAttribute("data-kotobee")),n.className=e.className,e.id?n.id=e.id:i.id&&(n.id=i.id),kInteractive.c.addClass(n,"btn"),n.style.opacity=Number(i.transparency)/100,e.parentNode.replaceChild(n,e),e=n),void 0===isKotobee&&("popup"!=i.type&&"audio"!=i.type&&"action"!=i.type||e.setAttribute("onclick","return false;"),e.addEventListener("click",kInteractive.actionEvent))))},postRender:function(e,t,n){},action:function(t,e,n){var o=kInteractive.readData(e);if(o){if("popup"==o.type){var i,r=(r="<div class='kbAlertScroll'>"+o.msg+"</div>").replace(/src="(.*?)"/g,function(){var e=arguments[1];return void 0!==isKotobee&&(e=ph.join(kInteractive.absoluteURL,e)),'src="'+e+'"'});"image"==o.popupMode&&(i=o.popupImg,void 0!==isKotobee&&(i=o.relToRoot?ph.join(bookPath,i):ph.join(kInteractive.absoluteURL,i)),r="<img src='"+(i=kInteractive.cleanURL(i))+"'/>"),kInteractive.alert({content:r}),setTimeout(function(){var e;kInteractive.scorm&&((e={}).id=kInteractive.getScormId("popup",o.msg),e.description="Shown popup message: "+o.msg,e.type="other",e.learnerResponses="Shown",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])),kInteractive.events&&kInteractive.events.add({action:"popup",param:o.msg,elem:t,data:o})})}else if("action"==o.type){var a,s=o.asset,c=o.action;if(s.remote)return void("widget"==s.type&&((a=document.createElement("div")).className="kInteractive widget kbHidden",a.setAttribute("data-kotobee",s.data),document.body.appendChild(a),kInteractive.trigger("click",a)));for(var l=document.getElementsByClassName(s.classname),d=0;d<l.length;d++)if(kInteractive.hasClass(l[d],"kInteractive")&&kInteractive.hasClass(l[d],s.type))if("activate"==c)if("gallery"==s.type){var u=l[d].getElementsByClassName("next");kInteractive.trigger("click",u[0])}else if("questions"==s.type){for(var p=l[d].getElementsByClassName("ki-btn"),h=0;h<p.length;h++)if("submit"==p[h].type){kInteractive.trigger("click",p[h]);break}}else kInteractive.trigger("click",l[d]);else"visibility"==c&&kInteractive.c.toggleClass(l[d],"kbHidden")}else if("audio"==o.type){kInteractive.stopCurrentMedia();var g,f=document.createElement("audio"),m=o.src;function v(){g||(kInteractive.c.addClass(y,"hide"),g=!0)}"file"==o.audioType&&(m=void 0===isKotobee?o.audio:ph.join(kInteractive.absoluteURL,o.audio)),m=kInteractive.cleanURL(m),f.setAttribute("src",m);var b=document.createElement("div");b.className="kiAudioLoader",b.style.transform=b.style.webkitTransform=b.style.mozTransform="scale(1)";var k,y=document.createElement("div");y.className="kiAudioSpinner",b.appendChild(y),e.parentNode.insertBefore(b,e),f.onplaying=v,setTimeout(v,5e3),f.play(),kInteractive.currentAudio=f,kInteractive.tinCan({verb:"played",activity:"Audio: "+m}),kInteractive.scorm&&((k={}).id=kInteractive.getScormId(e.textContent,m),k.description="Played audio link: "+m,k.type="other",k.learnerResponses="Played",k.objective=o.options?o.options.objective:null,k.timestamp=new Date,kInteractive.scorm.setInteractions([k])),kInteractive.events&&kInteractive.events.add({action:"audioLinkClicked",param:m,elem:t,data:o})}else if("attachment"==o.type){var w=o.file;if(void 0!==isKotobee&&(w=o.relToRoot?ph.join(bookPath,o.file):ph.join(kInteractive.absoluteURL,o.file)),void 0!==kotobee&&native)return void angular.element(document.body).scope().getService("crdv").mobileDownload(w);var C=document.createElement("a");document.body.appendChild(C),C.setAttribute("style","display: none"),C.href=kInteractive.cleanURL(w),C.target="_blank",C.download=o.file.split("/")[o.file.split("/").length-1],C.setAttribute("onclick","");var x=document.createEvent("MouseEvents");x.initMouseEvent("click"),C.dispatchEvent(x),C.remove()}return!1}}},kInteractive.lipsync={preRender:function(e,t){},postRender:function(e,t,n){var o,i=e.createDocumentFragment(),r=kInteractive.readData(t);t.setAttribute("id",o="ki-lipsync-"+n),t.innerHTML="";var a,s,c,l=document.createElement("div");l.className="container",r.sync&&((a=document.createElement("div")).className="audioContainer",(s=document.createElement("a")).className="playBtn ki-btn",s.appendChild(document.createElement("span")),void 0===isKotobee&&s.addEventListener("click",kInteractive.actionEvent),a.appendChild(s),(c=document.createElement("div")).setAttribute("id",o+"-container"),c.className="playerContainer",a.appendChild(c),r.interaction.playBtn?r.interaction.btnAlignment&&kInteractive.c.addClass(a,r.interaction.btnAlignment):a.style.display="none",l.appendChild(a));var d=document.createElement("div");d.className="contentContainer",d.innerHTML=function(e){document.createElement("div");var t=/(>)([^<\n]*?[^<]+?)(<[^\/])/g;e=e.replace(/([< \/][^>]*?>)((\s*[^<\s]+\s+?)+)([^<\s]+\s*)(<)/g,function(e,t){if(0<=t.indexOf('class="parsed"'))return e;if(0==t.indexOf("<pre"))return e;if(0==t.indexOf("<code"))return e;if(0==t.indexOf("<script"))return e;var n=arguments[2].split(" ");""==n[n.length-1]&&n.splice(-1,1),n.push(arguments[4]);for(var o="",i=0;i<n.length;i++){var r=i==n.length-1?"":" ";o+="<span>"+n[i]+r+"</span>"}return t+o+"<"}),e=e.replace(t,function(e,t){return arguments[2].trim()?t+("<span>"+arguments[2]+"</span>")+arguments[3]:e});return e=(e=e.replace(/(<a [\s\S]*?)(>)/g,'$1 onclick="return false;" $2')).replace(/&nbsp;/g,"&#160;")}(r.content),l.appendChild(d);var u=document.createElement("div");r.style&&kInteractive.c.addClass(u,r.style),i.appendChild(l),u.appendChild(i),t.appendChild(u);var p=document.createElement("style");p.className="system parsed";var h="";h+="#"+o+" .lipSyncCurrentWord {",h+="color:"+r.layout.color+";",r.layout.underline&&(h+="text-decoration:underline;"),r.layout.scale&&1<Number(r.layout.scale)&&(h+="transform:scale("+r.layout.scale+");",h+="padding:0 3px;",h+="display:inline-block;"),h+="}",p.innerHTML=h,t.appendChild(p),r.autoplay&&kInteractive.action(t)},action:function(r,e){kInteractive.stopCurrentMedia();var t,n,o,i,a,s,c=kInteractive.readData(r);c&&(c.audioType||(c.audioType=c.type),r.getAttribute("id"),r.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide",t=c.src,"file"==c.audioType&&(t=void 0===isKotobee?c.audio:c.relToRoot?ph.join(bookPath,c.audio):ph.join(kInteractive.absoluteURL,c.audio)),kInteractive.scorm&&((n={}).id=kInteractive.getScormId(r.getAttribute("id"),t),n.description="Played audio: "+t,n.type="other",n.learnerResponses="Played",n.objective=c.options?c.options.objective:null,n.timestamp=new Date,kInteractive.scorm.setInteractions([n])),kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:t,elem:r,data:c}),(o=document.createElement("audio")).setAttribute("controls","true"),o.setAttribute("autoplay","true"),o.setAttribute("data-tap-disabled","false"),(i=document.createElement("source")).src=kInteractive.cleanURL(t),o.appendChild(i),o.appendChild(document.createTextNode("Your browser does not support the audio element")),o.className="ki-noHighlight",o.oncanplay=function(){kInteractive.currentAudio==r&&kInteractive.tinCan({verb:"played",activity:"Audio: "+t})},o.ontimeupdate=function(e){!function(e){var t,n=c;for(var o=n.sync.length;o--;)if(e>=n.sync[o]){t=o;break}if(null==t)return;s!=t&&(null!=s&&a[s]&&kInteractive.c.removeClass(a[s],"lipSyncCurrentWord"),a[t]&&kInteractive.c.addClass(a[t],"lipSyncCurrentWord"),s=t)}(o.currentTime)},c.interaction.nextAuto&&(o.onended=function(e){var t,n,o,i=[].slice.call(document.getElementsByClassName("lipsync"));i.length&&(t=i.indexOf(r),!(n=i[t+1])||(o=n.getElementsByClassName("playBtn")[0])&&o.click())}),r.getElementsByClassName("playerContainer")[0].appendChild(o),o.play(),kInteractive.currentAudio=r,kInteractive.c.addClass(kInteractive.currentAudio,"playing"),a=function(){for(var e=[],t=r.getElementsByClassName("contentContainer")[0],n=t.getElementsByClassName("lipSyncCurrentWord"),o=n.length;o--;)hasClass(n[o],"lipSyncCurrentWord")&&removeClass(n[o],"lipSyncCurrentWord");for(;t.children&&t.children.length;)t=t.children[0];e.push(t);for(;t;)if(t.nextSibling){for(t=t.nextSibling;t.children&&t.children.length;)t=t.children[0];if(3==t.nodeType)continue;if(""==t.textContent)continue;e.push(t)}else if("contentContainer"==(t=t.parentNode).className)break;return e}(),s=0,kInteractive.c.addClass(a[s],"lipSyncCurrentWord"))}},kInteractive.questions={preRender:function(e,t,n,o){o=o||{};var i=t.createDocumentFragment(),r=kInteractive.readData(e);if(r){var a,s,c=(c=r.dict)||{},l=(l=r.userDict)||c;if(r.options||(r.options={}),e.id||(e.id="ki-qs-"+n+"-"+Math.ceil(1e3*Math.random())),e.innerHTML="",r.layout&&r.layout.popup&&!kInteractive.hasClass(e,"inpopup")){var d=document.createElement("img"),u=r.layout.popupImg,u=kInteractive.cleanURL(u);return d.src=u,i.appendChild(d),void 0===isKotobee&&d.addEventListener("click",kInteractive.actionEvent),void e.appendChild(i)}if(r.options.randomize){for(var p=0;p<r.q.length;p++)r.q[p].origin=p;for(var h,g,f=r.q.length;0!==f;)g=Math.floor(Math.random()*(r.q.length-1e-4)),f--,h=r.q[f],r.q[f]=r.q[g],r.q[g]=h;if("slides"==r.options.displayMode){for(var m="",p=0;p<r.q.length;p++)m+=(m?",":"")+r.q[p].origin;e.setAttribute("data-o",m)}}r.options.questionsDisplayed&&(a=Number(r.options.questionsDisplayed),r.q=r.q.slice(0,a)),r.title&&((s=document.createElement("span")).innerHTML="<h4>"+kInteractive.escapeHtml(r.title)+"</h4>",kInteractive.c.hasClass(e,"parsed")&&kInteractive.c.addClass(s.children[0],"parsed"),i.appendChild(s));var v=null;r.options&&r.options.emailForm&&(v=this.f.createEmailForm(l));var b=null;"none"!=r.action&&(b=this.f.createSubmitBtn(l,e));var k=null,y=null,w=null;r.options&&r.options.clearAnswers&&(k=this.f.createClearBtn(l)),r.options&&r.options.addToNotebook&&(w=this.f.createAddToNotebookBtn(l)),r.options&&r.options.preserveAnswers&&!r.options.preserveAnswers.auto&&(y=this.f.createPreserveBtn(l,e,r.layout.persist||{}));var C=this.f.createSeparator(),x=document.createElement("div");x.className="qContainer";var I=document.createElement("div");if(I.className="btnContainer","slides"==r.options.displayMode)e.qIndex=0,x.appendChild(kInteractive.questions.f.createQElem(r,{questionNo:1,index:0,elem:e,rendered:!1})),kInteractive.isEditorMode()||r.options.dateRangeEnabled&&!o.skipDateValidation&&(x.style.display="none",I.style.display="none"),i.appendChild(x),i.appendChild(I),kInteractive.questions.f.showNavBtns(0,i,{isFrag:!0,userDict:l,qsData:r});else{for(var E=0,p=0;p<r.q.length;p++)"sp"!=r.q[p].type&&E++,x.appendChild(kInteractive.questions.f.createQElem(r,{questionNo:E,index:p,elem:e,rendered:!1}));kInteractive.isEditorMode()||r.options.dateRangeEnabled&&!o.skipDateValidation&&(x.style.display="none",I.style.display="none"),i.appendChild(x),y&&I.appendChild(y),v&&I.appendChild(v),b&&I.appendChild(b),w&&I.appendChild(w),k&&I.appendChild(k),C&&i.appendChild(C),i.appendChild(I)}r.options.rtl?(e.setAttribute("dir","rtl"),kInteractive.c.addClass(e,"rtl")):e.setAttribute("dir","ltr");var S=document.createElement("div");r.style&&kInteractive.c.addClass(S,r.style),S.appendChild(i),e.appendChild(S)}},postRender:function(s,u,e,c){var l=kInteractive.readData(u);if(l){c=c||{};var t=(t=l.dict)||{};E=(E=l.userDict)||t;for(var n=u.getElementsByClassName("ques"),o=u.getElementsByClassName("explanation"),i=o.length;i--;)o[i].parentNode.removeChild(o[i]);for(var r,a,d=u.getElementsByClassName("reference"),i=d.length;i--;)d[i].parentNode.removeChild(d[i]);if(l.options.scoreHistory&&kInteractive.isKotobeeUser()&&(T=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"admin/library/questions/get",r=angular.element(document.body).scope(),a={env:"library"==config.kotobee.mode?"library":"book",cloudid:config.kotobee.cloudid,email:r.data.user.email,code:r.data.user.code,pwd:r.data.user.pwd,qsxid:u.id,mode:"submissions"},"library"==config.kotobee.mode&&r.data.book&&(a.bid=r.data.book.id),kInteractive.questions.f.sendPost(T,a,function(e){e.target;var t=e.target;if(4===t.readyState&&200===t.status){var n=JSON.parse(t.response);if(n&&n.scores&&n.scores.length){for(var o=u.getElementsByClassName("scoreHistory"),i=o.length;i--;)o[0].parentNode.removeChild(o[0]);var r=document.createElement("div");r.className="scoreHistory";var a=document.createElement("h5");a.textContent=E.scoreHistoryLabel?E.scoreHistoryLabel:"Score history",r.appendChild(a);for(i=0;i<n.scores.length;i++){var s=n.scores[i],c=kInteractive.questions.f.phpDateToJs(s.date),l=(E.scoreLabel?E.scoreLabel:"Score")+": "+s.fullscore,d=document.createElement("div");d.className="scoreItem",d.innerHTML="<div><span class='date'>"+c.toLocaleString()+"</span> <span class='score'>"+l+"</span></div>",r.appendChild(d)}u.appendChild(r)}}})),kInteractive.isEditorMode()||!l.options.dateRangeEnabled||c.skipDateValidation){if(!kInteractive.isEditorMode()){var p=kInteractive.getBookID()+"-"+u.id;u.clock=kInteractive.getClock(p),u.clock.pause(),u.clock.cb=function(e){var t,n,o,i,r;l.options.visibilityDuration&&(t=l.options.visibilityDuration-e,l.options.visibilityDurationTimer&&((n=u.getElementsByClassName("qTimer")[0])||((n=document.createElement("div")).className="qTimer",u.appendChild(n)),i=t-60*(o=Math.floor(t/60)),n.textContent=("0"+o).substr(-2)+":"+("0"+i).substr(-2)),t<0&&(!l.options.visibilityDurationAutoSubmit||(r=u.getElementsByClassName("questions-submit")[0])&&r.click(),kInteractive.questions.f.replaceWithError(u,{msg:E.questionsTimeUp?E.questionsTimeUp:E.questionsInactive,className:"qInactive"})))};try{kInteractive.observe(u,function(){u.clock&&u.clock.resume()},function(){u.clock&&u.clock.pause()})}catch(e){}}kInteractive.isEditorMode()||l.options.disableAfterAttempts&&kInteractive.isKotobeeUser()&&kInteractive.questions.f.getAttempts(u,function(e){e&&e>=l.options.disableAfterAttempts&&kInteractive.questions.f.replaceWithError(u,{msg:E.questionsInactive,className:"qInactive"})});for(var h,g,f,m,v=0;v<n.length;v++){var b=n[v].getElementsByClassName("ans"),k=(b.length,v);l.options.randomize&&(k="slides"==l.options.displayMode&&u.originArray?u.originArray[v]:Number(n[v].getAttribute("data-o"))),document[u.id]&&document[u.id].preserve&&document[u.id].q&&document[u.id].q[k]&&kInteractive.questions.f.showExp(l.userDict,n[v],l.q[k],l.options);for(var y,i=0;i<b.length;i++)if(kInteractive.c.removeClass(b[i].parentNode,"correct"),0<=b[i].getAttribute("id").indexOf("ki-tf-"))document[u.id]&&document[u.id].preserve&&document[u.id].q&&document[u.id].q[k]&&(document[u.id].q[k][i]?b[i].setAttribute("checked",!0):b[i].removeAttribute("checked"),l.options&&l.options.highlightCorrect&&(0==i&&l.q[k].a||1==i&&!l.q[k].a)&&kInteractive.c.addClass(b[i].parentNode,"correct"));else if(0<=b[i].getAttribute("id").indexOf("ki-dd-")){if(document[u.id]&&document[u.id].preserve&&document[u.id].q&&document[u.id].q[k])for(var w=0;w<document[u.id].q[k].length;w++){var C=document[u.id].q[k][w];try{for(var x=document.getElementById(C.id),I=x;!kInteractive.c.hasClass(I,"ques");)I=I.parentNode;I.getElementsByClassName("categoryContainer")[0].children[C.category].appendChild(x)}catch(e){}}}else 0<=b[i].getAttribute("id").indexOf("ki-sa-")?document[u.id]&&document[u.id].preserve&&document[u.id].q&&document[u.id].q[k]&&(b[i].removeAttribute("value"),document[u.id].q[k]&&b[i].setAttribute("value",document[u.id].q[k])):document[u.id]&&document[u.id].preserve&&document[u.id].q&&document[u.id].q[k]&&(document[u.id].q[k][i]?b[i].setAttribute("checked",!0):b[i].removeAttribute("checked"),l.options&&l.options.highlightCorrect&&l.q[k].c[i].a&&kInteractive.c.addClass(b[i].parentNode,"correct"));!document[u.id]||(y=u.getElementsByClassName("questions-preserve")).length&&(document[u.id].preserve?y[0].setAttribute("checked",!0):y[0].removeAttribute("checked"))}kInteractive.isEditorMode()||kInteractive.isPreview()||(h="persist-"+kInteractive.getBookID()+"-"+u.id,g="true"==sessionStorage.getItem(h)||l.options.preserveAnswers.auto,(f=u.querySelector("input.questions-preserve"))&&(g?f.setAttribute("checked",!0):f.removeAttribute("checked")),kInteractive.helpers&&kInteractive.helpers.persister&&(kInteractive.helpers.persister.instances[u.id]?kInteractive.helpers.persister.instances[u.id]instanceof kPersister&&kInteractive.helpers.persister.instances[u.id].restore():(m={storage:l.options.preserveAnswers.option,enabled:g,root:u,silentMode:l.options.preserveAnswers.auto,appendDataMode:"slides"==l.options.displayMode,delegateEvents:!1,messages:{save:E.save?E.save:"Save",unsaved:E.unsaved?E.unsaved:"You have unsaved changes",saving:E.saving?E.saving:"Saving ..",saved:E.saved?E.saved:"Changes has been saved!",dismiss:E.dismiss?E.dismiss:"Dismiss",lastSaved:E.lastSaved?E.lastSaved:"Last saved on",longDataError:E.longDataError?E.longDataError:"Some answers not saved (marked in red)"}},Object.keys(l.options.preserveAnswers).some(function(e){return-1!=e.indexOf("design")})&&(m.design=function(e){var t={};e.designPlacement&&(t.placement=e.designPlacement);(e.designUnsavedColor||e.designUnsavedBackground)&&(t.unsaved={});e.designUnsavedColor&&(t.unsaved.color=e.designUnsavedColor);e.designUnsavedBackground&&(t.unsaved.background=e.designUnsavedBackground);(e.designSuccessColor||e.designSuccessBackground)&&(t.success={});e.designSuccessColor&&(t.success.color=e.designSuccessColor);e.designSuccessBackground&&(t.success.background=e.designSuccessBackground);return t}(l.options.preserveAnswers)),kInteractive.helpers.persister.addInstance(u.id,m),kInteractive.helpers.persister.instances[u.id].on("persister.ready",function(e){e.target.enabled&&e.target.restore()}),kInteractive.helpers.persister.instances[u.id].on("persister.restored",function(e){}),kInteractive.helpers.persister.instances[u.id].on("persister.error",function(e){}),kInteractive.helpers.persister.instances[u.id].on("persister.saved",function(e){}),kInteractive.helpers.persister.instances[u.id].on("persister.unsaved",function(e){}),kInteractive.helpers.persister.instances[u.id].on("persister.pushed",function(e){}),kInteractive.helpers.persister.instances[u.id].init())))}else{var E=l.userDict,S="https://www.kotobee.com/";void 0!==isKotobee&&(S=config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/");var T=S+"timestamp";kInteractive.questions.f.sendPost(T,{timezone:kInteractive.getTimezone()},function(e){var t,n,o,i,r,a=e.target;4===a.readyState&&200===a.status&&(t=a.responseText,(n=kInteractive.questions.f.checkTimeValidity(t,l.options.dateRange)).valid?(o=u.getElementsByClassName("qContainer")[0],i=u.getElementsByClassName("btnContainer")[0],o&&(o.style.display="block"),i&&(i.style.display="block"),r=Object.assign({},c,{skipDateValidation:!0}),kInteractive.questions.postRender(s,u,w,r)):n.expired?kInteractive.questions.f.replaceWithError(u,{msg:E.questionsExpired,className:"qExpired"}):n.early&&kInteractive.questions.f.replaceWithError(u,{msg:E.questionsNotStarted,className:"qEarly"}))})}}},action:function(b,k){var y=kInteractive.readData(b);if(y){var e,w=y.dict,C=y.userDict,w=w||{},C=C||w;if(y.layout&&y.layout.popup&&!kInteractive.hasClass(b,"inpopup")&&"img"==k.nodeName.toLowerCase()){var t=document.getElementById("epubContent");t&&b.setAttribute("data-loc",function(e,t){for(var n="";e!=t;){n=function(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}(e)+"."+n;e=e.parentNode}return""==n?"":n.substr(0,n.length-1)}(b,t));var v=document.createElement("iframe");v.setAttribute("nwdisable","true"),v.setAttribute("nwfaketop","true"),v.setAttribute("scrolling","yes");var x=document.createElement("div");return x.className="scroller",x.appendChild(v),y.cb=function(e){var t,n=document.createElement("head");if(void 0===isKotobee){for(var o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var r=o[i];if(0<=r.getAttribute("href").indexOf("base.css")){var a=r.getAttribute("href").split("/");delete a[a.length-1],t=a.join("/");break}}if(!t)return}var s=void 0===isKotobee?kInteractive.c.removeHash(window.location.href):kInteractive.absoluteURL,s=kInteractive.cleanURL(kInteractive.c.removeFilename(s)+"/");void 0!==isKotobee&&(kInteractive.isAbsolutePath(s)||(s=kInteractive.cleanURL(kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+s)));for(var c=s.split("EPUB/xhtml"),l=c[c.length-1].split("/").length-1,d="",u=0;u<l;u++)d+="../";var p,n="<head>";n+='<base href="'+s+'"/>',n+='<link rel="stylesheet" type="text/css" href="'+(d+"css/base.css")+'" />',n+='<link rel="stylesheet" type="text/css" href="'+(d+"css/global.css")+'" />',n+='<link rel="stylesheet" type="text/css" href="'+(d+"css/kotobeeInteractive.css")+'" />',n+='<script type="text/javascript" src="'+(d+"js/kotobeeInteractive.js")+'"><\/script>',n+='<script type="text/javascript" src="'+(d+"js/global.js")+'"><\/script>',void 0!==isKotobee&&((p=clone(config)).kotobee.email=angular.element(document.body).scope().data.user.email,n+='<script type="text/javascript">var config='+JSON.stringify(p)+";<\/script>"),n+='<meta name="viewport" content="viewport-fit=cover,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,width=device-width">',n+='<meta charset="utf-8" />',n+="</head>";var h=b.outerHTML;h=(h=(h=(h=(h=(h=h.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var g="<html>"+n+"<body>"+(h+='<div class="vSpace20"></div>')+"</body></html>";v.setAttribute("srcdoc",g);var f="javascript: window.frameElement.getAttribute('srcdoc');";function m(){var e;void 0!==isKotobee&&((e={}).root=v.contentDocument.documentElement.ownerDocument.body,e.rootIndex=b.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(e,function(){}))}v.setAttribute("src",f),v.contentWindow&&(v.contentWindow.location=f),e.appendChild(x),v.addEventListener?v.addEventListener("load",m,!0):v.attachEvent&&v.attachEvent("onload",m)},y.closed=function(){},y.pos=y.layout.pos,kInteractive.openFrame(y),kInteractive.tinCan({verb:"opened",activity:"Questions: "+y.title}),void setTimeout(function(){var e;kInteractive.scorm&&((e={}).id=kInteractive.getScormId("question",y.title),e.description="Opened question popup: "+y.title,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])),kInteractive.events&&kInteractive.events.add({action:"questionPopup",param:y.title,elem:b,data:y})},800)}if(kInteractive.hasClass(k,"ki-inputbox"))kInteractive.helpers.persister.instances[b.id]&&kInteractive.helpers.persister.instances[b.id].handleChange();else if(kInteractive.hasClass(k,"ki-textfield"))kInteractive.helpers.persister.instances[b.id]&&kInteractive.helpers.persister.instances[b.id].handleChange();else if(kInteractive.hasClass(k,"ki-draggable"))kInteractive.helpers.persister.instances[b.id]&&kInteractive.helpers.persister.instances[b.id].handleChange();else if(!kInteractive.hasClass(k,"kInteractive")){if(kInteractive.hasClass(k,"questions-next")){var n=b.qIndex?b.qIndex:0;if(b.questions||(b.questions=[]),++n<0)return;if(n>=y.q.length)return;var o=(i=b.getElementsByClassName("qContainer")[0]).children[0];if(y.options.strictNav)if(!(M=kInteractive.questions.f.assess(o,y.q[n-1],y)).correct)return void kInteractive.questions.f.showExp(y.userDict,o,y.q[n-1],y.options);return b.questions[n-1]||(b.questions[n-1]=o),b.questions[n]||(b.questions[n]=kInteractive.questions.f.createQElem(y,{questionNo:n+1,index:n,elem:b,rendered:!0})),i.innerHTML="",i.appendChild(b.questions[n]),kInteractive.questions.f.showNavBtns(n,b,{userDict:C,qsData:y}),b.qIndex=n,void kInteractive.helpers.persister.instances[b.id].restore()}if(kInteractive.hasClass(k,"questions-prev")){if(!b.questions||!b.questions.length)return;var i,n=b.qIndex?b.qIndex:0;return n--,(i=b.getElementsByClassName("qContainer")[0]).innerHTML="",i.appendChild(b.questions[n]),kInteractive.questions.f.showNavBtns(n,b,{userDict:C,qsData:y}),b.qIndex=n,void kInteractive.helpers.persister.instances[b.id].restore()}if(kInteractive.hasClass(k,"questions-clear")){for(var r=b.getElementsByClassName("ans"),a=[],s=0;s<r.length;s++)r[s].checked=!1,r[s].value=null,kInteractive.c.removeClass(r[s].parentNode,"correct"),kInteractive.c.removeClass(r[s],"incorrect"),kInteractive.c.hasClass(r[s].parentNode,"dCategory")&&a.push(r[s]);for(s=0;s<a.length;s++)a[s].parentNode.parentNode.parentNode.getElementsByClassName("ki-dd-answers")[0].appendChild(a[s]);for(var c=b.getElementsByClassName("explanation"),s=c.length;s--;)c[s].parentNode.removeChild(c[s]);for(var l=b.getElementsByClassName("reference"),s=l.length;s--;)l[s].parentNode.removeChild(l[s]);return document[b.id]=null,void(kInteractive.helpers.persister.instances&&kInteractive.helpers.persister.instances[b.id].clear())}if(kInteractive.hasClass(k,"questions-notebook")){var d=y.layout&&y.layout.popup&&kInteractive.hasClass(b,"inpopup");if(void 0===isKotobee&&!d)return void kInteractive.alert({content:w.kotobeeOnly,title:C.sorry?C.sorry:"Sorry"});var u,p={elem:b};if(void 0!==isKotobee)angular.element(document.body).scope();else{try{window.parent.getGlobal()}catch(e){return void kInteractive.alert({content:w.kotobeeOnly,title:C.sorry?C.sorry:"Sorry"})}p.rootIndex=b.getAttribute("data-loc"),p.root=b}return window.compInstances&&window.compInstances.global&&(u=window.compInstances.global),kInteractive.hasClass(b,"inpopup")&&(u=window.top.compInstances.global),void(u&&(kInteractive.c.addClass(k,"busy"),u.questionsAddToNotebookShortcut(p,function(){kInteractive.c.removeClass(k,"busy"),kInteractive.alert({content:C.savedToNotebook?C.savedToNotebook:"Saved to notebook!"})})))}if(kInteractive.hasClass(k,"questions-preserve"))return document[b.id]||(document[b.id]={}),document[b.id].preserve=k.checked,void(kInteractive.helpers.persister.instances&&(e="persist-"+kInteractive.getBookID()+"-"+b.id,k.checked?(sessionStorage.setItem(e,"true"),kInteractive.helpers.persister.instances[b.id].enable(y.optione.preserveAnswers.auto)):(sessionStorage.setItem(e,"false"),kInteractive.helpers.persister.instances[b.id].disable())));if(kInteractive.hasClass(k,"questions-submit")){var I="Untitled questions",h=b.getElementsByTagName("h4");h.length&&(I=h[0].textContent||h[0].data);for(var E=0,g="",S=0,T=0,f=[],O="slides"==y.options.displayMode?b.questions.slice(0):b.getElementsByClassName("ques"),A=0,s=0;s<O.length;s++)if(!kInteractive.hasClass(O[s],"sp")){A++;var m=((r=O[s].getElementsByClassName("ans")).length,0),N=y.q[s],L=kInteractive.questions.f.getItemOrder(b);if(y.options.randomize&&(N="slides"==y.options.displayMode&&L?y.q[Number(L[s])]:y.q[Number(O[s].getAttribute("data-o"))]),N.q||(N.q=""),N.q=N.q.replace(/<html.*<body>([\s\S]*?)<\/body><\/html>/g,"$1"),kInteractive.scorm&&y.options&&y.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(b.id+"-"+A,N.q))){var B="<p style='text-align:center'>"+(C.alreadySubmitted?C.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:B})}var M,R={},P=r[0].getAttribute("id");f.push(R),R.id=kInteractive.getScormId(b.id+"-"+A,N.q),R.qid=b.id,0<=P.indexOf("ki-tf-")?R.type="true-false":0<=P.indexOf("ki-mcq-")||P.indexOf("ki-mmcq-")?R.type="choice":0<=P.indexOf("ki-dd-")?R.type="drag-drop":0<=P.indexOf("ki-sa-")&&(R.type="short-answer"),R.objective=y.options?y.options.objective:null,R.timestamp=kInteractive.timestamp,R.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),R.description=N.q,(M=kInteractive.questions.f.assess(O[s],N,y)).correctResponses&&(R.correctResponses=M.correctResponses),M.learnerResponses&&(R.learnerResponses=M.learnerResponses);var D=(D=M.ddInteractionOb)||[],m=M.correct;if(D.length)for(var $=0;$<D.length;$++)R.correctResponses&&(R.correctResponses+="; "),R.learnerResponses&&(R.learnerResponses+="; "),R.correctResponses+=D[$].correct,R.learnerResponses+=D[$].learner;R.result=0,m&&E++,null!=N.weight&&(S+=+N.weight,m&&(T+=+N.weight,R.result=+N.weight)),R.scoreMax=y.options?Number(y.options.totalScore):null,kInteractive.questions.f.showExp(y.userDict,O[s],N,y.options);var F=document.createElement("div");F.innerHTML=N.q.replace(/'/g,"&#39;");var H=F.textContent,V=C.question?C.question.replace("[no]",A):"Question "+A;g+=m?"<span style='border-bottom: dotted 1px #aaa;' title='"+H+"'>"+V+".</span>  <span style='color:#366c20'>"+C.correct+"</span><br/>":"<span style='border-bottom: dotted 1px #aaa;' title='"+H+"'>"+V+".</span>  <span style='color:#7a1818'>"+C.incorrect+"</span><br/>"}y.options&&y.options.visibilityDurationStopAfterSubmit&&b.clock&&(b.clock.destroy&&b.clock.destroy(),b.clock=null),setTimeout(function(){void 0!==isKotobee&&"undefined"!=typeof markers&&markers.refreshMarkers()},100);for(s=0;s<f.length;s++)f[s].weighting=Math.round(1e3*y.options.totalScore/S)/1e3;function U(){var e="Questions: "+I+". Score: "+E+" questions out of "+A;e+=". Action: "+_,"selfAnswerReport"==_&&(e+=". Details: "+g),kInteractive.tinCan({verb:"solved",activity:e})}var j,_=y.action;y.options.totalScore&&S&&(j=Math.round(10*y.options.totalScore*T/S)/10);var z="";"ar"==y.options.lang&&(z=' direction="rtl"');var q,W="";C.scoreWeight?(null!=j&&(q="",y.options.passScore&&(j>=y.options.passScore||j==y.options.totalScore?q+=C.pass:q+=C.fail),q&&(q+=". "),W+="<h3"+z+">"+(q||"")+C.scoreWeight.replace("[score]",j).replace("[total]",y.options.totalScore)+"</h3>"),W+="<p"+z+">"+C.score.replace("[correct]",E).replace("[total]",A)+"</p>"):W="You scored "+E+" question(s) out of "+A,"selfAnswerReport"==_&&(W="<p"+z+"><strong>"+W+"</strong></p><p><strong>"+(C.details?C.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+g+"</p>"),"selfAnswer"!=_&&"selfAnswerReport"!=_||(kInteractive.alert({content:W}),U()),("email"==_||y.options.reportEmail||y.options.emailForm||y.options.serverReports)&&function(){var e="email"==_||y.options.reportEmail||y.options.emailForm,n="selfAnswer"!=_&&"selfAnswerReport"!=_&&"email"!=_;try{if(!config.kotobee.cloudid)return n&&kInteractive.alert({content:w.cloudOnly,title:C.sorry?C.sorry:"Sorry"})}catch(e){return n&&kInteractive.alert({content:w.cloudOnly,title:C.sorry?C.sorry:"Sorry"})}var t={};t.ans=new Array;for(var o=0,i=0;i<O.length;i++){var r=O[i].getElementsByClassName("ans"),a=kInteractive.questions.f.getQClass(O[i]),s=O[i].getElementsByClassName("questionTxt"),c=s.length?s[0].textContent:"",l=O[i].id,d=y.q[i];if("tf"==a||"mcq"==a||"mmcq"==a)for(var u=0;u<r.length;u++)r[u].checked&&t.ans.push({q:o,id:l,title:c,type:a,weight:d.weight,index:u,label:r[u].nextSibling.textContent||r[u].nextSibling.data});else if("sa"==a)t.ans.push({q:o,id:l,title:c,type:a,weight:d.weight,label:r[0].value});else if("dd"==a)for(u=0;u<r.length;u++)t.ans.push({q:o,id:l,title:c,type:a,weight:d.weight,index:u,label:r[u].textContent,category:kInteractive.hasClass(r[u].parentNode,"dCategory")?r[u].parentNode.children[0].textContent:""});"sp"!=a&&o++}t.id=b.id,t.title=I,y.options.reportLabel&&(t.title=y.options.reportLabel);t.fullScore=j,t.maxScore=y.options.totalScore,t.weightedScore=T,t.maxWeight=S,t.score=E,t.total=A,t.correctQuestions=E,t.totalQuestions=A,t.rtl=y.options.rtl;var p={};p.recipient=y.address,y.options.reportEmail&&(p.recipient=y.options.reportEmail);{var h,g;y.options.emailForm&&(!(h=b.getElementsByClassName("emailForm")).length||(g=h[0].getElementsByClassName("txtfield")).length&&(p.recipient=p.recipient?p.recipient+","+g[0].value:g[0].value))}p.content=JSON.stringify(t),p.mode=config.kotobee.mode,p.cloudid=config.kotobee.cloudid;try{var f=angular.element(document.body).scope();void 0!==kotobee&&(p.env=config.kotobee.mode,"library"==config.kotobee.mode&&f.data.book&&(p.bid=f.data.book.id)),p.email=f.data.user.email,p.code=f.data.user.code,p.pwd=f.data.user.pwd}catch(e){}{var m;e&&p.recipient&&(m=k.value,k.value=C.submitting?C.submitting:"Submitting ..",k.setAttribute("disabled","true"),v=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"library/report/questions",kInteractive.questions.f.sendPost(v,p,function(e){try{var t=e.target;if(k.value=m,k.removeAttribute("disabled"),4===t.readyState&&200===t.status){if(!n)return;JSON.parse(t.responseText).success?kInteractive.alert({content:C.submitted?C.submitted:"Answers submitted!"}):kInteractive.alert({content:C.errorSubmitting?C.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(e){if(k.value=m,k.setAttribute("value",k.value),k.removeAttribute("disabled"),!n)return;kInteractive.alert({content:C.errorSubmitting?C.errorSubmitting:"An error has occurred while sending answers to the server"})}}))}y.options.dateRange&&y.options.dateRangeEnabled&&(p.drange=encodeURI(JSON.stringify(y.options.dateRange)));y.options.reportsubmission&&(p.reportsubmission=y.options.reportsubmission);b.clock&&(p.duration=b.clock.time);{var v;void 0!==isKotobee&&(y.options.serverReports&&(v=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"library/questions/add",kInteractive.questions.f.sendPost(v,p,function(e){try{var t,n=e.target;4===n.readyState&&(200!==n.status||(t=JSON.parse(n.responseText)).error&&("s_userAlreadySubmitted"==t.error?kInteractive.alert({content:C.errorAlreadySubmitted?C.errorAlreadySubmitted:"Answers have already been submitted previously"}):"early"==t.error||"expired"==t.error?kInteractive.alert({content:C.questionsExpired}):kotobee.popup("An error has occurred. Please contact support if you believe this is a mistake.",{title:"Error Code: "+t.error})))}catch(e){}})),config.kotobee.ltireporting&&"undefined"!=typeof launchid&&(p.launchid=launchid,v=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"lti/1.3/report",kInteractive.questions.f.sendPost(v,p)),U())}}(),document[b.id]||(document[b.id]={}),document[b.id].q=[];for(var K=b.getElementsByClassName("ques"),X=0;X<K.length;X++){var Y=X,L=kInteractive.questions.f.getItemOrder(b);y.options.randomize&&(Y="slides"==y.options.displayMode&&L?Number(L[X]):Number(K[X].getAttribute("data-o"))),document[b.id].q[Y]=[];for(var J=K[X].getElementsByClassName("ans"),s=0;s<J.length;s++)kInteractive.hasClass(J[s],"txtfield")?document[b.id].q[Y][s]=J[s].value:J[s].type&&"checkbox"==J[s].type.toLowerCase()||J[s].type&&"radio"==J[s].type.toLowerCase()?document[b.id].q[Y][s]=J[s].checked:kInteractive.c.hasClass(J[s].parentNode,"dCategory")&&(document[b.id].q[Y][s]={id:J[s].id,category:kInteractive.getChildIndex(J[s].parentNode)})}setTimeout(function(){kInteractive.scorm&&kInteractive.scorm.setInteractions(f),kInteractive.events&&kInteractive.events.add({action:"questionsSubmitted",param:I,elem:b,data:y}),kInteractive.isEditorMode()||y.options.disableAfterAttempts&&kInteractive.isKotobeeUser()&&kInteractive.questions.f.getAttempts(b,function(e){e=e||0,e++;var t={label:b.id+"-attempts"};if(y.options.serverReports&&kInteractive.isKotobeeUser()||kotobee.setData(Object.assign(t,{overwrite:1,data:e}),function(){}),e>=y.options.disableAfterAttempts){kInteractive.c.addClass(b,"disabled");for(var n=b.getElementsByTagName("input"),o=0;o<n.length;o++)n[o].setAttribute("disabled","disabled")}})},500),y.options.hideAfterSubmit&&W&&kInteractive.questions.f.replaceWithError(b,{msg:W,className:"qSubmitted",tag:"div"})}}}},f:{showExp:function(e,t,n,o){var i,r,a,s;if(o=o||{},n.exp&&(t.getElementsByClassName("explanation").length||((i=document.createElement("p")).className="explanation",i.innerHTML=n.exp,kInteractive.appendAfterDelay(t,i))),(n.ref||n.reftype)&&(t.getElementsByClassName("reference").length||((r=document.createElement("a")).className="reference",r.innerHTML=e.learnMode?e.learnMode:"Learn more",n.reftype&&"website"!=n.reftype?"booklocation"==n.reftype&&n.refchapter&&(a=ph.relative(bookPath,kInteractive.absoluteURL),s=ph.relative(a,n.refchapter.ahref),n.refanchor&&(s+="#"+n.refanchor),r.setAttribute("href",s),r.setAttribute("onclick","return false;"),kInteractive.appendAfterDelay(t,r)):(r.setAttribute("href",kInteractive.escapeHtml(n.ref)),r.setAttribute("target","_blank"),r.setAttribute("onclick","return false;"),kInteractive.appendAfterDelay(t,r)))),n.c&&n.c.length){for(var c=t.getElementsByClassName("answer"),l=t.getElementsByClassName("explanation");l.length;)l[0].parentNode.removeChild(l[0]);for(var d=0;d<n.c.length;d++)(!o.expForSelection||c[d].getElementsByTagName("input")[0].checked)&&kInteractive.questions.f.showExp(e,c[d],n.c[d],o)}},getQClass:function(e){var t=e.className;return-1!=t.indexOf("mmcq")?"mmcq":-1!=t.indexOf("mcq")?"mcq":-1!=t.indexOf("tf")?"tf":-1!=t.indexOf("sa")?"sa":-1!=t.indexOf("dd")?"dd":void 0},getItemOrder:function(e){var t=e.getAttribute("data-o");return t&&(e.originArray=t.split(",")),e.originArray},createQElem:function(e,t){var n=(t=t||{}).index,o=t.elem,i=t.rendered,r=this.getQId(o),a=kInteractive.questions.f.getItemOrder(o),s=e.q[n];e.options.randomize&&a&&"slides"==e.options.displayMode&&(s=e.q[o.originArray[n]]);var c=document.createElement("div");c.className="ques",s.id&&(c.id=s.id),null!=s.origin&&c.setAttribute("data-o",s.origin),s.q||(s.q="");var l=e.options.numbering;"sp"==s.type&&(l=!1);var d,u,p="";l&&(p="<span class='no'>"+(t.questionNo?t.questionNo:n)+"</span>"),s.q=s.q.replace(/<html.*<body>([\s\S]*?)<\/body><\/html>/g,"$1");try{c.innerHTML="<div class='questionTxt'><strong>"+p+"</strong> <span class='inner'> "+s.q+"</span></div>"}catch(e){c.innerHTML="<div class='questionTxt'><strong>"+p+"</strong> <span class='inner'>"+kInteractive.escapeHtml(" "+s.q)+"</span></div>"}if(kInteractive.c.hasClass(o,"parsed")&&kInteractive.c.addClass(c.children[0].getElementsByClassName("inner")[0],"parsed"),s.path&&(d=document.createElement("img"),u=!i||void 0===isKotobee?s.path:ph.join(kInteractive.absoluteURL,s.path),d.src=kInteractive.cleanURL(u),d.className=typeof isKotobee,c.appendChild(d)),c.classList.add(s.type),"sp"==s.type&&(s.topBorder&&kInteractive.c.addClass(c,"topBorder"),s.bottomBorder&&kInteractive.c.addClass(c,"bottomBorder"),kInteractive.c.addClass(c,"separator")),"sa"==s.type){var h=s.lines?s.lines:1,g=document.createElement(1<h?"textarea":"input"),f="ki-sa-"+r+"-"+n;g.id=f,g.name="sa-"+r+"-"+n,1==h?g.type="text":g.rows=s.lines?s.lines:1,g.className="ki-textfield ans txtfield",void 0===isKotobee&&(g.addEventListener("keyup",kInteractive.actionEvent),g.addEventListener("change",kInteractive.actionEvent)),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[n]&&(g.value=document[item.id].q[n]),c.appendChild(g)}else if("mcq"==s.type||"mmcq"==s.type)for(var m=s.c,v=0;v<m.length;v++){var f="ki-mcq-"+r+"-"+n+"-"+v,b=document.createElement("input");b.id=f,"mmcq"==s.type?(b.name="name",b.type="checkbox"):(b.name="mcq-"+r+"-"+n,b.type="radio"),b.className="ki-inputbox ans",void 0===isKotobee&&b.addEventListener("click",kInteractive.actionEvent),(k=document.createElement("label")).htmlFor=f,k.innerHTML=" "+kInteractive.escapeHtml(m[v].t),k.className="ki-noHighlight",kInteractive.c.hasClass(o,"parsed")&&kInteractive.c.addClass(k,"parsed"),(w=document.createElement("div")).className="answer",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[n]&&(b.checked=document[item.id].q[n][v],e.options&&e.options.highlightCorrect&&s.c[v].a&&kInteractive.c.addClass(w,"correct")),w.appendChild(b),w.appendChild(k),c.appendChild(w)}else if("tf"==s.type)for(v=0;v<2;v++){var k,f="ki-tf-"+r+"-"+n+"-"+v,y=document.createElement("input");y.type="radio",y.className="ki-inputbox ans",y.id=f,y.name="tf-"+r+"-"+n,void 0===isKotobee&&y.addEventListener("click",kInteractive.actionEvent),(k=document.createElement("label")).htmlFor=f,s.choice1&&s.choice2?k.innerHTML=kInteractive.escapeHtml(" "+(0==v?s.choice1:s.choice2)):k.innerHTML=" "+(0==v?"True":"False"),k.className="ki-noHighlight";var w=document.createElement("div");document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[n]&&(y.checked=document[item.id].q[n][v],e.options&&e.options.highlightCorrect&&(0==v&&s.a||1==v&&!s.a)&&kInteractive.c.addClass(w,"correct")),w.appendChild(y),w.appendChild(k),c.appendChild(w)}else if("dd"==s.type){var C=document.createElement("div");C.className="categoryContainer";for(var x=[],v=0;v<s.k.length;v++){var I=s.k[v],E=v,S=document.createElement("div");S.className="dCategory ki-noHighlight ki-dd-category-"+E,S.setAttribute("ondragover","kInteractive.allowDrop(event)"),S.setAttribute("ondrop","kInteractive.drop(event)");var T=document.createElement("div");T.innerHTML=I.category.name,T.className="qTitle",S.appendChild(T);for(var O=0;O<I.category.answers.length;O++)x.push(I.category.answers[O].t);C.appendChild(S)}c.appendChild(C);var A=document.createElement("div");A.className="ki-dd-clearfix",c.appendChild(A);var N=document.createElement("div");N.setAttribute("ondragover","kInteractive.allowDrop(event)"),N.setAttribute("ondrop","kInteractive.drop(event)"),N.className="ki-dd-answers ki-noHighlight";for(var L=[],v=0;v<x.length;v++){var E=v,w=x[v],B=document.createElement("div"),f="ki-dd-"+r+"-"+n+"-"+E;B.id=f,B.innerHTML="<span></span>",B.children[0].innerText=w,B.className="ki-draggable ans ki-noHighlight",B.draggable=!0,B.setAttribute("ondragstart","kInteractive.drag(event);"),B.setAttribute("onmousedown","event.stopPropagation();"),B.setAttribute("ontouchstart","event.stopPropagation();"),kInteractive.questions.manualDrag.isIOS()&&(B.setAttribute("ontouchstart","kInteractive.questions.manualDrag.dragStart(event);"),B.setAttribute("ontouchmove","kInteractive.questions.manualDrag.dragMove(event);"),document.addEventListener("touchend",function(){kInteractive.questions.manualDrag.isDown=!1})),void 0===isKotobee&&B.addEventListener("dragend",kInteractive.actionEvent),L.push(B)}kInteractive.shuffleArray(L);for(v=0;v<L.length;v++)N.appendChild(L[v]);c.appendChild(N)}var M=document.createElement("p");return M.className="separator",c.appendChild(M),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[n]&&kInteractive.questions.f.showExp(e.userDict,c,s,e.options),c},getQId:function(e){return Number(e.id.replace("ki-qs-",""))},createSubmitBtn:function(e,t){var n=this.getQId(t),o=document.createElement("input"),i="ki-"+n+"-btn";return o.type="submit",o.value=e.submit?e.submit:"Submit Answers",o.id=i,o.className="btn ki-btn questions-submit",void 0===isKotobee&&o.addEventListener("click",kInteractive.actionEvent),o},createClearBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.clear?e.clear:"Clear Answers",t.className="btn ki-btn ki-questions questions-clear",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createAddToNotebookBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.notebook?e.notebook:"Save to Notebook",t.className="btn ki-btn ki-questions questions-notebook",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPreserveBtn:function(e,t,n){var o=this.getQId(t),i=document.createElement("div");i.style.marginBottom="10px";var r=document.createElement("input");function a(e){return e.slice(0,1).toUpperCase()+e.slice(1)}r.type="checkbox",r.name="preserveAnswers",r.className="ki-btn ki-questions questions-preserve",r.id="ki-"+o+"-preserveAnswersBtn",n&&(0<Object.keys(n).length&&Object.keys(n).forEach(function(t){"placement"==t?r.dataset["design"+a(t)]=n[t]:Object.entries(n[t]).forEach(function(e){r.dataset["design"+a(t)+a(e[0])]=e[1]})}),void 0!==isKotobee&&t.addEventListener("change",function(e){e.target.matches("input.questions-preserve")&&kInteractive.actionEvent(e)})),document[item.id]&&(r.checked=document[item.id].preserve),i.appendChild(r);var s=document.createElement("label");return s.htmlFor=r.id,s.innerHTML=" "+(e.preserve?e.preserve:"Preserve submitted answers"),s.className="ki-noHighlight",i.appendChild(s),void 0===isKotobee&&r.addEventListener("change",kInteractive.actionEvent),i},createNextBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.next?e.next:"Next",t.className="btn ki-btn ki-questions questions-next",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPrevBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.prev?e.prev:"Previous",t.className="btn ki-btn ki-questions questions-prev",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createSeparator:function(){document.createElement("p").className="separator"},createEmailForm:function(e){var a=document.createElement("div");return a.setAttribute("class","emailForm"),function(e,t,n){var o=document.createElement("div");o.className="address",o.innerHTML="<p><strong>"+e+"</strong><em>"+t+"</em></p>";var i=document.createElement("input");i.name=n,i.type="text",i.className="txtfield",o.appendChild(i);var r=document.createElement("p");r.className="separator",o.appendChild(r),a.appendChild(o)}(e.recipientEmail?e.recipientEmail:"Recipient email",e.separateEmails?e.separateEmails:"Separate multiple emails with commas","recipientEmail"),a},showNavBtns:function(e,t,n){var o;(o=(n=n||{}).isFrag?t.lastElementChild:t.getElementsByClassName("btnContainer")[0]).innerHTML="";var i=kInteractive.questions.f.createPrevBtn(n.userDict);o.appendChild(i),e<=0&&i.classList.add("disabled");var r,a,s=kInteractive.questions.f.createNextBtn(n.userDict);o.appendChild(s),e==n.qsData.q.length-1&&(s.classList.add("disabled"),(r=kInteractive.questions.f.createSubmitBtn(n.userDict,t)).classList.add("shift"),o.appendChild(r),!n.qsData.options.emailForm||(a=kInteractive.questions.f.createEmailForm(n.userDict))&&o.insertBefore(a,o.firstChild))},assess:function(e,t,n){for(var o={ddInteractionOb:[]},i=e.getElementsByClassName("ans"),r=0<i.length,a=0;a<i.length;a++)if(0<=i[a].getAttribute("id").indexOf("ki-tf-"))0==a&&t.a?o.correctResponses=t.choice1:1!=a||t.a||(o.correctResponses=t.choice2),i[a].checked?(o.learnerResponses=a?t.choice2:t.choice1,(0==a&&!t.a||1==a&&t.a)&&(r=!1)):(0==a&&t.a||1==a&&!t.a)&&(r=!1),n.options&&n.options.highlightCorrect&&(0==a&&t.a||1==a&&!t.a)&&kInteractive.c.addClass(i[a].parentNode,"correct");else if(0<=i[a].getAttribute("id").indexOf("ki-sa-")){for(var s=(s=i[a].value.toLowerCase())&&s.trim(),r=!0,c="",l=0;l<t.k.length;l++){var d=t.k[l].t;if(!d){r=!1;break}c&&(c+="+"),c+=d=d.toLowerCase();for(var u=d.split(","),p=!1,h=0;h<u.length;h++)if(0<=s.indexOf(u[h].trim())){p=!0;break}if(!p){r=!1;break}}o.correctResponses=c,o.learnerResponses=s}else if(0<=i[a].getAttribute("id").indexOf("ki-dd-")){kInteractive.c.removeClass(i[a],"incorrect");for(var g,f=i[a].id.split("-")[4],m=0,v=0;v<t.k.length;v++){if(f<(m+=t.k[v].category.answers.length)){g=v;break}}var b,k,y,w=e.getElementsByClassName("dCategory")[g],C={};C.correct=i[a].innerText+" -> "+w.children[0].innerText,kInteractive.c.hasClass(i[a].parentNode,"ki-dd-answers")?(kInteractive.c.addClass(i[a],"incorrect"),r=!1,C.learner=i[a].innerText+" unassigned"):(k=(b=i[a].parentNode).children[0].innerText,y=kInteractive.getChildIndex(b),C.learner=i[a].innerText+" -> "+k,y!=g&&n.options&&n.options.highlightCorrect&&(r=!1,kInteractive.c.addClass(i[a],"incorrect"))),o.ddInteractionOb.push(C)}else t.c[a].a&&(o.correctResponses=t.c[a].t),i[a].checked&&(o.learnerResponses=t.c[a].t),(i[a].checked&&!t.c[a].a||!i[a].checked&&t.c[a].a)&&(r=!1),n.options&&n.options.highlightCorrect&&t.c[a].a&&kInteractive.c.addClass(i[a].parentNode,"correct");return o.correct=r,o},checkTimeValidity:function(e,t){var n=kInteractive.phpDateToJS(e),o={};function i(e){var t=e.split(":");return 1==t[0].length&&(t[0]="0"+t[0]),1==t[1].length&&(t[1]="0"+t[1]),t[0]+":"+t[1]}if(!t.fromDate){var r=a(n.getHours())+":"+a(n.getMinutes());return r>i(t.toTime)?o.expired=!0:r<i(t.fromTime)?o.early=!0:o.valid=!0,o;function a(e){return String(e+100).substr(1)}}var s=t.fromDate.split("-"),c=t.fromTime.split(":"),l=new Date(s[2],s[1]-1,s[0],c[0],c[1]),d=t.toDate.split("-"),u=t.toTime.split(":");return new Date(d[2],d[1]-1,d[0],u[0],u[1])<n?o.expired=!0:n<l?o.early=!0:o.valid=!0,o},sendPost:function(e,t,n){t=t||{};var o=new XMLHttpRequest;n&&(o.onreadystatechange=n),o.open("POST",e),o.setRequestHeader("Content-type","application/x-www-form-urlencoded");var i="a=a";for(var r in void 0!==uuid&&(i+="&fingerprint="+uuid),t){var a=t[r];null!=a&&"object"!=typeof a&&("string"==typeof a&&(a=encodeURIComponent(a)),"boolean"==typeof a&&(a=a?1:0),i+="&"+r+"="+a)}o.send(i)},replaceWithError:function(e,t){t=t||{},this.stopClock(e);var n=e.getElementsByClassName("scoreHistory")[0],o=e.getElementsByTagName("h4")[0],i=kInteractive.readData(e);e.innerHTML="";var r=document.createElement("div");i.style&&kInteractive.c.addClass(r,i.style),e.appendChild(r),o&&!i.options.hideTitleOnError&&r.appendChild(o);var a=document.createElement("div"),s=(s=t.tag)||"p";a.innerHTML="<"+s+" class='"+t.className+"'>"+t.msg+"</"+s+">",r.appendChild(a.children[0]),n&&r.appendChild(n)},phpDateToJs:function(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])},stopClock:function(e){e&&e.clock&&(e.clock.pause(),e.clock.destroy(),e.clock=null)},getAttempts:function(e,i){var t,n,o;kInteractive.readData(e).options.serverReports&&kInteractive.isKotobeeUser()?(t=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"admin/library/questions/get",n=angular.element(document.body).scope(),o={env:"library"==config.kotobee.mode?"library":"book",cloudid:config.kotobee.cloudid,email:n.data.user.email,code:n.data.user.code,pwd:n.data.user.pwd,qsxid:e.id,mode:"submissions"},"library"==config.kotobee.mode&&n.data.book&&(o.bid=n.data.book.id),kInteractive.questions.f.sendPost(t,o,function(e){var t=e.target;if(4===t.readyState&&200===t.status){var n=0;try{var o=JSON.parse(t.responseText),n=Number(o.scores.length)}catch(e){}i(n)}})):kotobee.getData({label:e.id+"-attempts"},function(e){return e&&e.length?void i(Number(e[0].data)):i(0)})},clearSavedAnswers:function(){for(obj in document)0==obj.indexOf("ki-qs-")&&delete document[obj]}},manualDrag:{isDown:null,startX:null,startY:null,currentX:null,currentY:null,walkX:null,walkY:null,margin:0,currentAnswerObj:{},answersContainers:[],store:null,dragStart:function(e){e.stopPropagation(),this.isDown=!0;var t=(e=e||window.event).target;this.getContainers(t);var n=t.getElementsByTagName("span")[0];n&&(n.style.pointerEvents="none"),t.style.zIndex="999",this.startX=Math.round(e.touches[0].clientX)-this.margin,this.startY=Math.round(e.touches[0].clientY)-this.margin,this.dragEnd(t)},dragEnd:function(t){t.addEventListener("touchend",function(){function e(){return kInteractive.questions.manualDrag}e().isDown=!1,t.style.left="initial",t.style.top="initial",t.style.zIndex="initial",null!==e().store&&e().store.container.append(e().store.answer)})},dragMove:function(e){var t=(e=e||window.event).target;this.currentAnswerObj=t.getBoundingClientRect(),this.isDown&&(this.currentX=Math.round(e.touches[0].clientX)-this.margin,this.currentY=Math.round(e.touches[0].clientY)-this.margin,this.walkX=this.currentX-this.startX,this.walkY=this.currentY-this.startY,t.style.left=this.walkX+"px",t.style.top=this.walkY+"px",this.detectBoundaries(t))},detectBoundaries:function(i){function r(){return kInteractive.questions.manualDrag}this.answersContainers.forEach(function(e){var t,n,o;e&&(n={w:(t=e.getBoundingClientRect()).width,h:t.height,x:t.x,y:t.y},o={w:r().currentAnswerObj.width,h:r().currentAnswerObj.height,x:r().currentAnswerObj.x,y:r().currentAnswerObj.y},kInteractive.questions.manualDrag.hasIntersection(o,n)&&(r().store={container:e,answer:i}))})},hasIntersection:function(e,t){return!(e.y+0>t.y+t.h)&&(!(e.x+e.w+0<t.x)&&(!(e.y+e.h+0<t.y)&&!(e.x+0>t.x+t.w)))},getContainers:function(e){function n(){return kInteractive.questions.manualDrag}var o=e.parentElement,t=o?o.className:"";function i(e){var t;o&&e?(t=e.getElementsByClassName("dCategory")).length&&(n().answersContainers=Array.from(t)):n().answersContainers=[]}t.includes("ki-dd-answers")?i(o.parentElement.getElementsByClassName("categoryContainer")[0]):t.includes("dCategory")&&i(o.parentElement)},isIOS:function(){return void 0!==isKotobee&&void 0!==ios&&ios}}},kInteractive.threed={preRender:function(e,t){},postRender:function(e,t,n,o){var i,r,a,s=e.createDocumentFragment(),c=kInteractive.readData(t);c&&(t.innerHTML="",i=t.getAttribute("style"),c.inter.placeholderPath&&(r=void 0===isKotobee?c.inter.placeholderPath:ph.join(kInteractive.absoluteURL,c.inter.placeholderPath),i+="background-image:url('"+(r=kInteractive.cleanURL(r))+"');"),t.setAttribute("style",i),a=document.createElement("a"),c.inter.includeMsg?(a.innerHTML=kInteractive.escapeHtml(c.inter.msg),a.className="msgBtn ki-btn"):a.className="invisibleBtn ki-btn",s.appendChild(a),void 0===isKotobee&&a&&a.addEventListener("click",kInteractive.actionEvent),t.appendChild(s))},action:function(s,e,t){var d=kInteractive.readData(s);if(d){"inPanel"==d.inter.target?kInteractive.c.addClass(s,"running"):s.innerHTML="";var u=document.createElement("div");if(u.className="loading",s.appendChild(u),"undefined"==typeof THREE){var n,o=document.getElementsByTagName("head")[0],i=o.getElementsByTagName("script");if(void 0!==isKotobee)n=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(var r=0;r<i.length;r++)if(0<=i[r].src.indexOf("kotobeeinteractive.js")){n=i[r].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!n)return;var a=document.createElement("script");a.type="text/javascript",a.src=n,a.onload=c,a.onreadystatechange=function(){"complete"==this.readyState&&c()},o.appendChild(a)}else c()}function c(){var a,e,t=s;function n(t){if(setTimeout(function(){var e;kInteractive.scorm&&((e={}).id=kInteractive.getScormId("_3D",d.name?d.name:"Model"),e.description="Opened 3D model: "+(d.name?d.name:"No name"),e.learnerResponses="Viewed",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])),kInteractive.events&&kInteractive.events.add({action:"3dModelViewed",param:d.name?d.name:"No name",elem:s,data:d})},800),a&&cancelAnimationFrame(a),"fbx"!==d.type){if(!kInteractive.threed.webglAvailable)return kInteractive.threed.alert();var n=new THREE.WebGLRenderer({precision:"highp"}),e=t.offsetWidth,o=t.offsetHeight,i=new THREE.PerspectiveCamera(d.camera.viewAngle,e/o,d.camera.near,d.camera.far),c=new THREE.Scene;null!=d.scene.bgColor&&n.setClearColor(d.scene.bgColor,1),c.add(i),i.position.x=d.camera.x,i.position.y=d.camera.y,i.position.z=d.camera.z,n.setSize(e,o),d.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:d.scene.floorColor?d.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,c.add(floor));var l=new THREE.LoadingManager;l.onProgress=function(e,t,n){},function r(a){var s,e;a>=d.objects.length||(s=d.objects[a],e=void 0===isKotobee?s.path:ph.join(kInteractive.absoluteURL,s.path),e=kInteractive.cleanURL(e),new OBJLoader(l).load(e,function(i){u&&u.parentNode&&u.parentNode.removeChild(u),n.domElement.parentNode||t.appendChild(n.domElement),i.position.set(s.x,s.y,s.z),i.traverse(function(n){var o,e,t;n instanceof THREE.Mesh&&(o=n==i.children[i.children.length-1],s.textPath?(e=new THREE.ImageLoader(l),t=void 0===isKotobee?s.textPath:ph.join(kInteractive.absoluteURL,s.textPath),e.load(t,function(e){var t=new THREE.Texture;t.image=e,t.needsUpdate=!0,n.material.map=t,o&&c.add(i),r(++a)},function(){},function(e){})):(o&&c.add(i),r(++a)))})},function(e){e.lengthComputable&&(e.loaded,e.total)},function(e){}))}(0),new OrbitControls(i,n.domElement).target=new THREE.Vector3(0,0,0),kInteractive.threed.addLight(c,d);var r=new THREE.Clock;!function e(){try{n.render(c,i)}catch(e){return}r.getDelta();a=requestAnimFrame(e)}()}else"inPanel"===d.inter.target?setTimeout(function(){kInteractive.threed.fbxLoader(t,d)},500):kInteractive.threed.fbxLoader(t,d)}"inPanel"==d.inter.target?(e={class:"threed",cb:function(e){var t=document.createElement("div");t.className="container",e.appendChild(t),n(t)},closed:function(){kInteractive.c.removeClass(s,"running")}},kInteractive.openFrame(e)):n(t)}},get webglAvailable(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},alert:function(){kotobee.popup(translit.get("webglNotAvailable"),{title:"WebGl",okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})},addLight:function(s,e){e.lights.forEach(function(e){var t,n,o,i,r,a;"pointLight"==e.type?((t=new THREE.PointLight(e.color)).position.set(e.x,e.y,e.z),s.add(t)):"directionalLight"==e.type?((n=new THREE.DirectionalLight(e.color,e.intensity)).position.set(e.x,e.y,e.z),s.add(n)):"hemisphereLight"==e.type?((o=new THREE.HemisphereLight(e.sky,e.ground,e.intensity)).position.set(e.x,e.y,e.z),s.add(o)):"spotLight"==e.type?((i=new THREE.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent,e.decay)).position.set(e.x,e.y,e.z),s.add(i)):"ambientLight"==e.type?(r=new THREE.AmbientLight(e.color),s.add(r)):"areaLight"==e.type&&(a=new THREE.RectAreaLight(e.color,e.intensity),s.add(a))})},fbxLoader:function(e,n){if(!kInteractive.threed.webglAvailable)return kInteractive.threed.alert();var o,t,i="inPanel"===n.inter.target?(t=e.getBoundingClientRect().width,e.getBoundingClientRect().height):(t=+n.scene.width,+n.scene.height),r=n.scene.bgColor,a=new THREE.Scene,s=new THREE.PerspectiveCamera(+n.camera.viewAngle,t/i,n.camera.near,+n.camera.far);s.position.setX(+n.camera.x),s.position.setY(+n.camera.y),s.position.setZ(+n.camera.z);var c=new THREE.Clock;kInteractive.threed.addLight(a,n);var l,d=((l=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),l.setSize(t,i),l.shadowMap.enabled=!0,l.setClearColor(r,1),l);e.appendChild(d.domElement);var u=new OrbitControls(s,d.domElement);u.target.set(0,0,0),u.update();var p=new FBXLoader,h=function(e){if(Array.isArray(e.objects)&&e.objects.length){var t=e.objects[0],n=void 0===isKotobee?t.path:ph.join(kInteractive.absoluteURL,t.path);return kInteractive.cleanURL(n)}return!1}(n);h&&(p.load(h,function(e){o=new THREE.AnimationMixer(e),Array.isArray(e.animations)&&e.animations.length&&o.clipAction(e.animations[0]).play(),e.traverse(function(e){var t;e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,(t=document.getElementsByClassName(n.classname)[0])&&[].slice.call(t.getElementsByClassName("loading")).forEach(function(e){kInteractive.c.removeClass(e,"loading")}))}),a.add(e)}),function e(){requestAnimationFrame(e);var t=c.getDelta();o&&o.update(t),d.render(a,s)}())}},kInteractive.video={preRender:function(e,t){},postRender:function(e,t,n){var o,i,r,a,s,c,l=e.createDocumentFragment(),d=kInteractive.readData(t);d&&(i="",d.splash&&(i=void 0===isKotobee?d.splash:ph.join(kInteractive.absoluteURL,d.splash)),i&&(t.style.backgroundImage=null,o=t.style.cssText,i=kInteractive.cleanURL(i),t.setAttribute("style","background-image:url('"+i+"');"+o)),t.setAttribute("id","ki-video-"+n),t.innerHTML="",(r=document.createElement("div")).setAttribute("id","ki-video-"+n+"-container"),r.className="container",a=document.createElement("div"),d.style&&kInteractive.c.addClass(a,d.style),(s=document.createElement("a")).className="playBtn ki-btn",s.appendChild(document.createElement("span")),void 0===isKotobee&&s.addEventListener("click",kInteractive.actionEvent),l.appendChild(s),l.appendChild(r),a.appendChild(l),t.appendChild(a),c=function(){for(var e=[],t=document.getElementsByClassName("kInteractive"),n=0;n<t.length;n++){if(-1!==t[n].className.indexOf("video"))if(kInteractive.readData(t[n]).autoplay){e.push(t[n]);break}}return e.length?e[0]:null}(),d.autoplay&&c&&t===c&&kInteractive.action(c))},action:function(a){var s=kInteractive.readData(a);if(s){if(s.popup&&"kInteractiveFrame"!=a.parentNode.id){var e={pos:"side",aspectRatio:"16:9",cb:function(e){var t=document.createElement("div");t.innerHTML=a.outerHTML;var n=t.children[0];n.style.width="100%",n.style.height="100%",n.style.margin="0",n.style.position="absolute",n.style.left=0,n.style.top=0,kInteractive.c.removeClass(n,"kbHidden"),e.appendChild(n);var o=a.id.split("ki-video-")[1];kInteractive.postRender(document,n,o),setTimeout(function(){kInteractive.action(n)},100)}};return kInteractive.openFrame(e)}var t,n=a.getAttribute("id")+"-container",c=a.getElementsByClassName("playBtn")[0];if(!(0<=c.className.indexOf("loading"))){if(kInteractive.stopCurrentMedia(),c.className="playBtn ki-btn loading",s.autoplay&&(c.className="playBtn ki-btn hide"),kInteractive.scorm&&((t={}).id=kInteractive.getScormId(a.getAttribute("id"),s.src),t.description="Played video: "+s.src,t.type="other",t.learnerResponses="Played",t.objective=s.options?s.options.objective:null,t.timestamp=new Date,kInteractive.scorm.setInteractions([t])),kInteractive.events&&kInteractive.events.add({action:"videoPlayed",param:s.src,elem:a,data:s}),"file"==s.type){u(void 0===isKotobee?s.video:ph.join(kInteractive.absoluteURL,s.video))}else{var o,i=new URL(s.src);if(i.origin.includes("youtube.com")||i.origin.includes("youtu.be")){if(!(o=i.origin.includes("youtube.com")?i.searchParams.get("v"):i.pathname.split("/")[1]))return;if(window&&window.iBooks)return setTimeout(function(){c.className="playBtn ki-btn"},1500),void(window.location.href=s.src);var r={videoId:o,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+s.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){c.className="playBtn ki-btn hide",new YT.Player(n,r)}}else"ready"==kInteractive.youTubeStatus&&(c.className="playBtn ki-btn hide",new YT.Player(n,r));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var l=document.createElement("script");l.src="https://www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(l,d),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){c.className="playBtn ki-btn hide",new YT.Player(n,r)}}}else u(s.src)}kInteractive.currentVideo=a,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}}function u(e){var t,n=document.createElement("video");n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("src",kInteractive.cleanURL(e)),n.setAttribute("autoplay","true"),n.setAttribute("disablePictureInPicture","true"),n.setAttribute("data-tap-disabled","false"),0!=e.indexOf("http://")&&0!=e.indexOf("https://")||(t=!0),t&&n.setAttribute("crossorigin","anonymous");var o=!1;try{o=-1<navigator.userAgent.toLowerCase().indexOf("android")}catch(e){}o||n.setAttribute("type","video/mp4"),n.setAttribute("webkit-playsinline","true"),n.setAttribute("controls","true");var i="";s.splash&&(i=void 0===isKotobee?s.splash:ph.join(kInteractive.absoluteURL,s.splash)),i&&n.setAttribute("poster",kInteractive.cleanURL(i)),n.className="ki-noHighlight",s.hideDownloadBtn&&(n.className+=" hideDownloadBtn",n.setAttribute("controlsList","nodownload")),n.innerHTML="Your browser doesn't support HTML5 video.",t&&(n.crossOrigin="anonymous"),n.oncanplay=function(){kInteractive.currentVideo==a&&(c.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+e}))},n.addEventListener("error",function(e){e.target.error&&kInteractive.stopCurrentMedia()}),n.addEventListener("webkitfullscreenchange",function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t});var r=a.getElementsByClassName("container")[0];r.setAttribute("data-tap-disabled","true"),r.appendChild(n)}},resize:function(e){var t=kInteractive.readData(e);t&&(kInteractive.checkResponsiveFloat(t,e),t.maintainRatio&&"px"==t.widthUnit&&t.height&&t.width&&"absolute"!=e.style.position&&(e.style.height=e.offsetWidth*(t.height/t.width)+"px"))}},kInteractive.widget={preRender:function(e,t){},postRender:function(e,t,n,o){o=o||{};var i=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){var a,s=r.name,c=(r.src,r.width),l=r.height;if("page"==r.mode){if(t.children.length)return;var d=document.createElement("div");d.className="cover",i.appendChild(d),r.interaction&&(d.style.pointerEvents="none");var u=document.createElement("div");u.className="iframeContainer";var p,h,g=document.createElement("iframe");g.setAttribute("nwdisable","true"),g.setAttribute("nwfaketop","true"),void 0!==desktop&&desktop&&(p=!0),void 0!==isReaderApp&&isReaderApp&&(p=!0),p&&g.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-top-navigation"),g.setAttribute("width",t.style.width?t.style.width:c+r.widthUnit),g.setAttribute("height",t.style.height?t.style.height:l+"px"),g.src=kInteractive.getWidgetUrl(r,o),void 0!==kotobee&&-1!==g.src.indexOf(".amazonaws.com")&&((h=document.createElement("a")).href=g.src,g.addEventListener("load",function(e){e.target.contentWindow.postMessage({user:{name:kotobee.user.name?kotobee.user.name:"",email:kotobee.user.email?kotobee.user.email:"",loggedIn:kotobee.user.loggedIn},book:kotobee.book.meta.dc.identifier,chapter:kotobee.currentChapter.url.split("EPUB/xhtml/")[1]},h.protocol+"//"+h.hostname)})),u.appendChild(g),i.appendChild(u);var f=t.style.width,m=t.style.height;0<=f.indexOf("px")&&(r.widthUnit="px"),0<=f.indexOf("%")&&(r.widthUnit="%");try{r.widthUnit?r.width=Number(f.split(r.widthUnit)[0]):r.width=Number(f)}catch(e){r.width=Number(f)}try{r.height=Number(m.split("px")[0])}catch(e){r.height=Number(m)}kInteractive.writeData(t,r)}else{t.children.length||t.innerHTML.trim()||((a=document.createElement("img")).src=kInteractive.cleanURL(kInteractive.getWidgetHome(r,o)+"/"+s+"/Icon.png?c="+Math.round(9999*Math.random())),a.className="wdgtIcon",i.appendChild(a)),void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent)}t.appendChild(i)}},action:function(t){var n,o,e,i=kInteractive.readData(t);i&&(n=kInteractive.getWidgetUrl(i),(o=document.createElement("iframe")).setAttribute("nwdisable","true"),o.setAttribute("nwfaketop","true"),void 0!==desktop&&desktop&&(e=!0),void 0!==isReaderApp&&isReaderApp&&(e=!0),e&&o.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-top-navigation"),i.cb=function(e){o.src=n,e.appendChild(o)},i.cb1="yes",i.closed=function(){},i.responsive&&(i.width=i.height=null),kInteractive.openFrame(i),kInteractive.tinCan({verb:"opened",activity:"Widget: "+i.name}),setTimeout(function(){var e;kInteractive.scorm&&((e={}).id=kInteractive.getScormId("widget",i.name),e.description="Opened popup widget: "+i.name,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])),kInteractive.events&&kInteractive.events.add({action:"popupWidgetOpened",param:i.name,elem:t,data:i})},800))},resize:function(e){var t=kInteractive.readData(e);if(t&&"page"==t.mode&&"px"==t.widthUnit){var n=t.width,o=t.height,i=e.parentNode;if(i)if(n>i.offsetWidth){var r=i.offsetWidth/n,a=e.children.length-1;e.children[a].style.transform=e.children[a].style.webkitTransform=e.children[a].style.mozTransform="scale("+r+")",e.children[a].style.transformOrigin=e.children[a].style.webkitTransformOrigin=e.children[a].style.mozTransformOrigin="0 0",e.style.maxWidth=e.style.width,e.style.height=Math.round(o*r)+"px"}else{for(a=0;a<e.children.length;a++)e.children[a].style.transform=e.children[a].style.webkitTransform=e.children[a].style.mozTransform=e.children[a].style.transformOrigin=e.children[a].style.webkitTransformOrigin=e.children[a].style.mozTransformOrigin=null;e.style.maxWidth=null,e.style.height=o+"px"}}}},kInteractive.helpers.persister={instances:{},addInstance:function(e,t){kInteractive.helpers.persister.instances[e]=new kPersister(t)}},"undefined"==typeof rootDir&&(rootDir=""),"undefined"==typeof hostingDomain&&(hostingDomain=""),"undefined"==typeof hostUrlMode&&(hostUrlMode=""),"null"==hostingDomain&&(hostingDomain=""),"null"==hostUrlMode&&(hostUrlMode=""),setConfigDefaults(),debug&&(sdkProfilesEnabled=localStorage.sdkProfilesEnabled,sdkProfile=localStorage.sdkProfile,sdkProfilesEnabled&&JSON.parse(sdkProfilesEnabled)&&sdkProfile&&JSON.parse(sdkProfile)&&(config.kotobee=JSON.parse(sdkProfile),delete config.kotobee.name,delete config.kotobee.locked,sdkProfile=null)),config.kotobee||(config.kotobee={}),window.location.origin&&config.kotobee.liburl&&0==window.location.origin.indexOf("https://")&&-1!=window.location.origin.indexOf(".kotobee.com")&&isKotobeeHosted()&&!isKotobeeBooks()&&(config.kotobee.liburl=window.location.origin+"/"),isKotobeeHosted())try{publicRoot}catch(e){publicRoot=""}function delayIfSDK(e){return e()}function createVueApp(){Vue.mixin({data:function(){return{data:stg.data,view:stg.view,vueExclude:vueExclude,mobile:mobile,isRelease:isRelease,native:native,desktop:desktop,ios:ios,preview:preview,readerApp:isReaderApp,config:config}},methods:{noop:function(){},d:function(e,t){for(var n=(t=t||"").split("."),o=e,i=0;i<n.length;i++)if(!(o=o[n[i]]))return;return o},htmlSafe:function(e){return e},refreshData:function(){this.$nextTick(stg.forceDataRender)},set:function(e,t,n){Vue.set(e,t,n)},templateUrl:getTemplate,unsafe:function(e){return e},unsafeResource:function(e){return e},nativeLinks:function(e){return this.$options.filters.nativeLinks(e)},cloudParam:function(){return backend.cloudParam.apply(this,arguments)},$broadcast:function(){},$apply:function(){},inherited:function(e,t,n){return inherited(e,t,n)},t:function(){return this.$options.filters.t.apply(this,arguments)}},filters:{lc:function(e){return e},filter:function(e,t){return e.filter(t)}},created:function(){if(this.$el)for(var e=this.$el.getElementsByTagName("input"),t=0;t<e.length;t++)e[t].settAttribute("autocomplete","off")},computed:{rootDir:function(){return rootDir||""}},mounted:function(){}});var e=[{path:"/",name:"blank",component:compClasses.blank},{path:"/landing",name:"landing",component:compClasses.landing},{path:"/authredirect/:provider/:idToken/:accessToken",name:"authredirect",component:compClasses.authRedirect},{path:"/payment/:provider/:state/:bookID/:userID",name:"payment",component:compClasses.payment},{path:"/payment/:provider/:state/:userID",name:"payment",component:compClasses.payment},{path:"/invoice",name:"invoice",component:compClasses.invoice},{path:"/login",name:"login",component:compClasses.login},{path:"/register",name:"register",component:compClasses.register},{path:"/forgotpwd",name:"forgotpwd",component:compClasses.forgotPwd},{path:"/redeemcode",name:"redeemcode",component:compClasses.redeemCode},{path:"/library",name:"library",component:compClasses.library},{path:"/library/tab/:tab",name:"libraryTab",component:compClasses.library},{path:"/library/cat/:cat",name:"libraryCat",component:compClasses.library},{path:"/library/book/:book",name:"libraryBookDetails",component:compClasses.library},{path:"/reader",name:"reader",component:compClasses.reader},{path:"/reader/chapter/:ch",name:"reader",component:compClasses.reader},{path:"/reader/chapter/:ch/:hash",name:"reader",component:compClasses.reader},{path:"/book/:book/reader",name:"reader",component:compClasses.reader},{path:"/book/:book/reader/chapter/:ch",name:"reader",component:compClasses.reader},{path:"/book/:book/reader/chapter/:ch/:hash",name:"reader",component:compClasses.reader},{path:"/app",name:"app",component:compClasses.app}];isRelease||e.push({path:"/test",component:compClasses.test});var d,t=new VueRouter({routes:e});t.beforeEach(function(e,t,n){var o,i,r,a;if(e&&e.name&&t&&t.name&&"reader"===t.name&&"library"===e.name&&window.dispatchEvent(new CustomEvent("unmountMiniapp")),d=d||$location.path(),firstRouteShown)l();else if(0==d.indexOf("/book/")?0<(r=(a=d.split("/book/")[1]).split("/")).length&&(library.startBook=Number(r[0])):-1!=window.location.href.indexOf("?book=")&&(o=window.location.href.replace(/.*\?book=(\d*).*/g,"$1"),Number(o)&&(library.startBook=o)),0<=d.indexOf("/reader/chapter/")&&(1<(i=(a=d.split("/reader/chapter/")[1]).split("?vi=")).length&&(chapters.startVIndex=i[1],a=i[0]),0<(r=a.split("/")).length&&(chapters.startChapter=isNaN(r[0])?0:Number(r[0])),1<r.length&&(chapters.startHash=r[1])),0<=d.indexOf("/library/book/")&&(a=d.split("/library/book/")[1],library.startBookDetails=Number(a)),"/"==e.path&&"/"==t.path)l();else{for(var s=["/authredirect","/payment","/invoice","/test"],c=0;c<s.length;c++)if(0==e.path.indexOf(s[c]))return l();n(!1)}function l(){"blank"!=e.name&&setTimeout(removeSplashScreen,1e3),n()}}),firstRouteShown=!1,new Vue({el:"#kotobeeVue",data:{ob:{},currentScreen:"",modal:null},mounted:function(){this.start()},router:t,methods:{start:function(){if(window.vueApp=this,"undefined"!=typeof kTemplates&&kTemplates(),"undefined"==typeof initializer)return setTimeout(this.start,100);delayIfSDK(function(){if(firstRouteShown=!0,!initializer.handleRedirect(d)){for(var e,t,n,o=["/authredirect","/payment","/invoice","/test"],i=0;i<o.length;i++)if(-1!=d.indexOf(o[i]))return;e=document.getElementById("kotobeeLink"),t=document.getElementById("html5Fallback"),n=document.getElementById("localFallback"),e.parentNode.removeChild(e),t.parentNode.removeChild(t),n.parentNode.removeChild(n),initializer.initialize()}})}}})}function stopAllAudio(){for(var e=document.getElementsByTagName("audio"),t=0;t<e.length;t++)e[t].pause(),e[t].src="";try{document.bgAudio&&(document.bgAudio.pause(),document.bgAudio.src="")}catch(e){}}function applyPreview(e){var t=angular.element(document.body).scope();t.config=config=e,t.$apply(),design.injectUserCSS(e)}function previewPage(e,t){if("undefined"==typeof stg)return setTimeout(function(){previewPage(e,t)},100);t=t||{lang:"en",book:{name:"Alice",description:"A great book indeed"}},"bookInfo"==(e=e||"bookInfo")&&(config=t.config?t.config:{kotobee:{entry:1,mode:"library"}},stg.data.user=t.user?t.user:{loggedIn:!0},stg.data.currentLibrary=t.library?t.library:{},backend.getS3Paths(function(){translit.setLang(t.lang?t.lang:"en"),bookinfo.show({book:t.book},{animation:"none"})}))}function previewPageOld(e,t){var n=angular.element(document.body).scope();n.previewPage&&n.previewPage(e,t)}function getCookie(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()}function getVar(e){return Modernizr.localstorage?localStorage[e]:getCookie("continueWithoutHTML5")}function setVar(e,t){Modernizr.localstorage?localStorage[e]=t:document.cookie=e+"="+t}function getGlobal(){return angular.element(document.body).scope()}function closePrintIframe(){var e=document.getElementById("printContainer");e&&e.parentNode.removeChild(e)}function putTest(e){}function continueLocally(){setVar("continueLocally","true"),location.reload()}function continueWithoutHTML5(){setVar("continueWithoutHTML5","true"),location.reload()}function isArabic(e){return e.match(/[\u0600-\u06FF\u0750-\u077F]+/g)}function normalize(e){return e.replace(/\u0610/g,"").replace(/\u0611/g,"").replace(/\u0612/g,"").replace(/\u0613/g,"").replace(/\u0614/g,"").replace(/\u0615/g,"").replace(/\u0616/g,"").replace(/\u0617/g,"").replace(/\u0618/g,"").replace(/\u0619/g,"").replace(/\u061A/g,"").replace(/\u06D6/g,"").replace(/\u06D7/g,"").replace(/\u06D8/g,"").replace(/\u06D9/g,"").replace(/\u06DA/g,"").replace(/\u06DB/g,"").replace(/\u06DC/g,"").replace(/\u06DD/g,"").replace(/\u06DE/g,"").replace(/\u06DF/g,"").replace(/\u06E0/g,"").replace(/\u06E1/g,"").replace(/\u06E2/g,"").replace(/\u06E3/g,"").replace(/\u06E4/g,"").replace(/\u06E5/g,"").replace(/\u06E6/g,"").replace(/\u06E7/g,"").replace(/\u06E8/g,"").replace(/\u06E9/g,"").replace(/\u06EA/g,"").replace(/\u06EB/g,"").replace(/\u06EC/g,"").replace(/\u06ED/g,"").replace(/\u0640/g,"").replace(/\u064B/g,"").replace(/\u064C/g,"").replace(/\u064D/g,"").replace(/\u064E/g,"").replace(/\u064F/g,"").replace(/\u0650/g,"").replace(/\u0651/g,"").replace(/\u0652/g,"").replace(/\u0653/g,"").replace(/\u0654/g,"").replace(/\u0655/g,"").replace(/\u0656/g,"").replace(/\u0657/g,"").replace(/\u0658/g,"").replace(/\u0659/g,"").replace(/\u065A/g,"").replace(/\u065B/g,"").replace(/\u065C/g,"").replace(/\u065D/g,"").replace(/\u065E/g,"").replace(/\u065F/g,"").replace(/\u0670/g,"").replace(//g,"").replace(//g,"").replace(//g,"").replace(//g,"").replace(//g,"").replace(//g,"").replace(//g,"").replace(//g,"")}!function(){function e(){addClass(document.getElementsByTagName("body")[0],mobile?"mobile":"web");for(var e,t=document.getElementsByTagName("head")[0],n=t.innerHTML,o=[],i=document.getElementsByTagName("script"),r=0;r<i.length;r++)if(i[r].getAttribute("src")&&0<=i[r].getAttribute("src").indexOf("lib/ionic/release/js")){var a=i[r].getAttribute("src").split("lib/ionic/release/js");rootDir=a[0];break}e=[rootDir+"lib/ionic/release/css/ionic.min.css"];for(r=0;r<o.length;r++)n+='<script src="'+o[r]+'" type="text/javascript"><\/script>';for(r=0;r<e.length;r++)n='<link rel="stylesheet" href="'+e[r]+'">'+n;t.innerHTML=n,config.noLoadingScreen&&document.body.classList.add("noLoadingScreen")}(detectIE()||ios)&&!function e(){var t=document.getElementsByTagName("body");if(!t.length)return setTimeout(e,100);ios?(addClass(t[0],"ios"),addClass(t[0],"fullscreen")):addClass(t[0],"ie")}();var t,n,o,i,r,a=document.getElementsByTagName("head");if(!preview){if(config.gAnalyticsID&&(t="",isKotobeeHosted()&&(t="/bundles/vijualib/templates/reader/public/"),n=native||desktop?"ga('set','checkProtocolTask',null);ga('set','anonymizeIp',true);ga('set','forceSSL',true)":"",o="'auto'",native?o="{'storage':'none','clientId':device.uuid}":desktop&&(o="{'storage':'none'}"),(r=document.createElement("script")).innerHTML="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','"+t+"lib/gAnalytics/analytics.js','ga');ga('create', '"+config.gAnalyticsID+"', "+o+");"+n,a.length&&a[0].appendChild(r)),config.gAnalyticsMeasurementId&&((r=document.createElement("script")).async=!0,r.src="https://www.googletagmanager.com/gtag/js?id="+config.gAnalyticsMeasurementId,(i=document.createElement("script")).innerHTML="window.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\ngtag('js', new Date());\ngtag('config', '"+config.gAnalyticsMeasurementId+"');",document.head.appendChild(r),document.head.appendChild(i)),config.js)for(var s=0;s<config.js.length;s++){(r=document.createElement("script")).src=config.js[s],r.className="kotobeeInjectedScript",document.getElementsByTagName("body")[0].appendChild(r)}if(config.css)for(s=0;s<config.css.length;s++){var c=document.createElement("link");c.rel="stylesheet",c.href=config.css[s],c.className="kotobeeInjectedScript",document.getElementsByTagName("body")[0].appendChild(c)}if("undefined"!=typeof cordova)native=!0;else if("file:"==window.location.protocol||"kotobee:"==window.location.protocol||"undefined"!=typeof require){if(mobile)native=!0;else if("undefined"!=typeof require){desktop=!0,os="mac",process.env.OS&&0<=process.env.OS.toLowerCase().indexOf("windows")&&(os=0<=process.env.PROCESSOR_ARCHITECTURE.indexOf("64")?"win64":"win32"),0<=String(require("nw.gui").App.argv).indexOf("--mobile")&&(mobile=1)}else if(window.chrome&&chrome.app&&chrome.app.runtime&&chrome.storage){try{if(!chromeEnabled)return}catch(e){return}chromeApp=!0}else if("true"!=getVar("continueLocally"))return setTimeout(function(){document.getElementById("localFallback").style.display="block",document.getElementById("kotobeeLink").style.display="none",document.getElementsByTagName("body")[0].style.cssText="overflow-y: scroll;"},100),e()}else"chrome-extension:"==window.location.protocol&&(chromeApp=!0)}if(!chromeApp){if("true"!=getVar("continueWithoutHTML5")&&!(Modernizr.audio&&Modernizr.video&&Modernizr.backgroundsize&&Modernizr.borderradius&&Modernizr.canvas&&Modernizr.opacity&&Modernizr.localstorage&&Modernizr.rgba))return setTimeout(function(){document.getElementById("html5Fallback").style.display="block",document.getElementById("kotobeeLink").style.display="none",document.getElementsByTagName("body")[0].style.cssText="overflow-y: scroll;"},100),e();setVar("continueLocally","false"),setVar("continueWithoutHTML5","false")}if(e(),vueExclude){angular.module("ngIOS9UIWebViewPatch",["ng"]).config(["$provide",function(e){"use strict";e.decorator("$browser",["$delegate","$window",function(e,t){if(a=t.navigator.userAgent,/(iPhone|iPad|iPod).* OS 9_\d/.test(a)&&!/Version\/9\./.test(a))return i=null,r=(o=e).url,o.url=function(){return arguments.length?(i=arguments[0],r.apply(o,arguments)):i||r.apply(o,arguments)},window.addEventListener("popstate",n,!1),window.addEventListener("hashchange",n,!1),o;function n(){i=null}var o,i,r,a;return e}])}]);var l=["ionic","angular.css.injector","ngIOS9UIWebViewPatch","templates"];"undefined"!=typeof scormEnabled&&scormEnabled&&l.push("scormwrapper");try{angular.module("templates")}catch(e){angular.module("templates",[]).run(["$templateCache",function(e){}])}0,app=angular.module("reader.Kotobee",l),ionic.Platform.isFullScreen=!1,app.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$compileProvider",function(e,t,n,o){(chromeApp||desktop||native)&&(o.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|kotobee|blob|chrome-extension):|data:image\/)/),o.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|kotobee|chrome-extension):/)),n.views.swipeBackEnabled(!1),e.state("loading",{url:"/loading",templateUrl:kTemplate("views/blank.html")}).state("landing",{url:"/landing",templateUrl:kTemplate("views/landing.html")}).state("oauth",{url:"/oauth/:provider/:idToken/:accessToken",templateUrl:kTemplate("views/auth.html")}).state("payment",{url:"/payment/:provider/:state/:bookID/:userID",templateUrl:kTemplate("views/payment.html")}).state("paymentMultiple",{url:"/payment/:provider/:state/:userID",templateUrl:kTemplate("views/payment.html")}).state("invoice",{url:"/invoice",templateUrl:kTemplate("views/invoice.html")}).state("login",{url:"/login",templateUrl:kTemplate("views/login.html")}).state("register",{url:"/register",templateUrl:kTemplate("views/register.html")}).state("forgotPwd",{url:"/forgotpwd",templateUrl:kTemplate("views/forgotPwd.html")}).state("redeemCode",{url:"/redeemcode",templateUrl:kTemplate("views/redeemCode.html")}).state("library",{url:"/library",templateUrl:kTemplate("views/library.html")}).state("library_tab",{url:"/library/tab/:tab",templateUrl:kTemplate("views/library.html")}).state("library_bookdetails",{url:"/library/book/:book",templateUrl:kTemplate("views/library.html")}).state("reader",{url:"/reader",templateUrl:kTemplate("views/reader.html")}).state("reader.chapter",{url:"/chapter/:ch",templateUrl:kTemplate("views/reader.html")}).state("reader.chapterhash",{url:"/chapter/:ch/:hash",templateUrl:kTemplate("views/reader.html")}).state("libraryreader",{url:"/book/:book/reader",templateUrl:kTemplate("views/reader.html")}).state("libraryreader.chapter",{url:"/chapter/:ch",templateUrl:kTemplate("views/reader.html")}).state("libraryreader.chapterhash",{url:"/chapter/:ch/:hash",templateUrl:kTemplate("views/reader.html")}).state("app",{url:"/app",templateUrl:kTemplate("views/app.html")})}]),app.run(function(e,t,n,o,i,r){var a,s,c,l,d=t.path();if(0==d.indexOf("/book/")?((l=d.split("/"))[1]&&(o.startBook=Number(l[0])),l[2]&&(o.startPage=l[2])):-1!=window.location.href.indexOf("?book=")&&(a=window.location.href.replace(/.*\?book=(\d*).*/g,"$1"),Number(a)&&(o.startBook=a)),0<=d.indexOf("/reader/chapter/")&&(1<(c=(s=d.split("/reader/chapter/")[1]).split("?vi=")).length&&(n.startVIndex=c[1],s=c[0]),0<(l=s.split("/")).length&&(n.startChapter=isNaN(l[0])?0:Number(l[0])),1<l.length&&(n.startHash=l[1])),"undefined"!=typeof kTemplates&&kTemplates(i),!r.handleRedirect(d)){for(var u=["/oauth","/invoice","/test"],p=0;p<u.length;p++)if(-1!=d.indexOf(u[p]))return;r.initialize()}})}delayIfSDK(createVueApp)}();